(function(){"use strict";var Module=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,i;r.ready=new Promise(function(c,p){n=c,i=p});var o=Object.assign({},r),a="./this.program",l=(c,p)=>{throw p},f=typeof window=="object",d=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",b="";function _(c){return r.locateFile?r.locateFile(c,b):b+c}var E,k,D;function L(c){if(c instanceof qr)return;X("exiting due to exception: "+c)}var M,U,R;g?(d?b=require("path").dirname(b)+"/":b=__dirname+"/",R=()=>{U||(M=require("fs"),U=require("path"))},E=function(p,v){return R(),p=U.normalize(p),M.readFileSync(p,v?void 0:"utf8")},D=c=>{var p=E(c,!0);return p.buffer||(p=new Uint8Array(p)),p},k=(c,p,v)=>{R(),c=U.normalize(c),M.readFile(c,function(P,w){P?v(P):p(w.buffer)})},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(c){if(!(c instanceof qr))throw c}),process.on("unhandledRejection",function(c){throw c}),l=(c,p)=>{if(Yt())throw process.exitCode=c,p;L(p),process.exit(c)},r.inspect=function(){return"[Emscripten Module object]"}):(f||d)&&(d?b=self.location.href:typeof document<"u"&&document.currentScript&&(b=document.currentScript.src),t&&(b=t),b.indexOf("blob:")!==0?b=b.substr(0,b.replace(/[?#].*/,"").lastIndexOf("/")+1):b="",E=c=>{var p=new XMLHttpRequest;return p.open("GET",c,!1),p.send(null),p.responseText},d&&(D=c=>{var p=new XMLHttpRequest;return p.open("GET",c,!1),p.responseType="arraybuffer",p.send(null),new Uint8Array(p.response)}),k=(c,p,v)=>{var P=new XMLHttpRequest;P.open("GET",c,!0),P.responseType="arraybuffer",P.onload=()=>{if(P.status==200||P.status==0&&P.response){p(P.response);return}v()},P.onerror=v,P.send(null)});var z=r.print||console.log.bind(console),X=r.printErr||console.warn.bind(console);Object.assign(r,o),o=null,r.arguments&&r.arguments,r.thisProgram&&(a=r.thisProgram),r.quit&&(l=r.quit);var se=4,$;r.wasmBinary&&($=r.wasmBinary);var q=r.noExitRuntime||!0;typeof WebAssembly!="object"&&nt("no native wasm support detected");var ee,Pe=!1;function ce(c,p){c||nt(p)}var ve=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function we(c,p,v){for(var P=p+v,w=p;c[w]&&!(w>=P);)++w;if(w-p>16&&c.buffer&&ve)return ve.decode(c.subarray(p,w));for(var x="";p<w;){var A=c[p++];if(!(A&128)){x+=String.fromCharCode(A);continue}var O=c[p++]&63;if((A&224)==192){x+=String.fromCharCode((A&31)<<6|O);continue}var B=c[p++]&63;if((A&240)==224?A=(A&15)<<12|O<<6|B:A=(A&7)<<18|O<<12|B<<6|c[p++]&63,A<65536)x+=String.fromCharCode(A);else{var G=A-65536;x+=String.fromCharCode(55296|G>>10,56320|G&1023)}}return x}function ue(c,p){return c?we(_e,c,p):""}function pe(c,p,v,P){if(!(P>0))return 0;for(var w=v,x=v+P-1,A=0;A<c.length;++A){var O=c.charCodeAt(A);if(O>=55296&&O<=57343){var B=c.charCodeAt(++A);O=65536+((O&1023)<<10)|B&1023}if(O<=127){if(v>=x)break;p[v++]=O}else if(O<=2047){if(v+1>=x)break;p[v++]=192|O>>6,p[v++]=128|O&63}else if(O<=65535){if(v+2>=x)break;p[v++]=224|O>>12,p[v++]=128|O>>6&63,p[v++]=128|O&63}else{if(v+3>=x)break;p[v++]=240|O>>18,p[v++]=128|O>>12&63,p[v++]=128|O>>6&63,p[v++]=128|O&63}}return p[v]=0,v-w}function Q(c,p,v){return pe(c,_e,p,v)}function re(c){for(var p=0,v=0;v<c.length;++v){var P=c.charCodeAt(v);P>=55296&&P<=57343&&(P=65536+((P&1023)<<10)|c.charCodeAt(++v)&1023),P<=127?++p:P<=2047?p+=2:P<=65535?p+=3:p+=4}return p}var ye=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function me(c,p){for(var v=c,P=v>>1,w=P+p/2;!(P>=w)&&rt[P];)++P;if(v=P<<1,v-c>32&&ye)return ye.decode(_e.subarray(c,v));for(var x="",A=0;!(A>=p/2);++A){var O=Be[c+A*2>>1];if(O==0)break;x+=String.fromCharCode(O)}return x}function ae(c,p,v){if(v===void 0&&(v=2147483647),v<2)return 0;v-=2;for(var P=p,w=v<c.length*2?v/2:c.length,x=0;x<w;++x){var A=c.charCodeAt(x);Be[p>>1]=A,p+=2}return Be[p>>1]=0,p-P}function fe(c){return c.length*2}function Ae(c,p){for(var v=0,P="";!(v>=p/4);){var w=j[c+v*4>>2];if(w==0)break;if(++v,w>=65536){var x=w-65536;P+=String.fromCharCode(55296|x>>10,56320|x&1023)}else P+=String.fromCharCode(w)}return P}function De(c,p,v){if(v===void 0&&(v=2147483647),v<4)return 0;for(var P=p,w=P+v-4,x=0;x<c.length;++x){var A=c.charCodeAt(x);if(A>=55296&&A<=57343){var O=c.charCodeAt(++x);A=65536+((A&1023)<<10)|O&1023}if(j[p>>2]=A,p+=4,p+4>w)break}return j[p>>2]=0,p-P}function Re(c){for(var p=0,v=0;v<c.length;++v){var P=c.charCodeAt(v);P>=55296&&P<=57343&&++v,p+=4}return p}function qe(c){var p=re(c)+1,v=ut(p);return v&&pe(c,Se,v,p),v}function Ke(c,p){Se.set(c,p)}function $e(c,p,v){for(var P=0;P<c.length;++P)Se[p++>>0]=c.charCodeAt(P);Se[p>>0]=0}var He,Se,_e,Be,rt,j,be,Ze,Rt;function Nt(c){He=c,r.HEAP8=Se=new Int8Array(c),r.HEAP16=Be=new Int16Array(c),r.HEAP32=j=new Int32Array(c),r.HEAPU8=_e=new Uint8Array(c),r.HEAPU16=rt=new Uint16Array(c),r.HEAPU32=be=new Uint32Array(c),r.HEAPF32=Ze=new Float32Array(c),r.HEAPF64=Rt=new Float64Array(c)}r.INITIAL_MEMORY;var Ut,Gt=[],Xt=[],Wt=[];function Yt(){return q}function ar(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)cr(r.preRun.shift());Lt(Gt)}function lr(){!r.noFSInit&&!S.init.initialized&&S.init(),S.ignorePermissions=!1,Lt(Xt)}function ur(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)pr(r.postRun.shift());Lt(Wt)}function cr(c){Gt.unshift(c)}function fr(c){Xt.unshift(c)}function pr(c){Wt.unshift(c)}var it=0,yt=null;function jr(c){return c}function Ot(c){it++,r.monitorRunDependencies&&r.monitorRunDependencies(it)}function St(c){if(it--,r.monitorRunDependencies&&r.monitorRunDependencies(it),it==0&&yt){var p=yt;yt=null,p()}}function nt(c){r.onAbort&&r.onAbort(c),c="Aborted("+c+")",X(c),Pe=!0,c+=". Build with -sASSERTIONS for more info.";var p=new WebAssembly.RuntimeError(c);throw i(p),p}var kt="data:application/octet-stream;base64,";function Vt(c){return c.startsWith(kt)}function It(c){return c.startsWith("file://")}var Ve;Ve="replicad_single.wasm",Vt(Ve)||(Ve=_(Ve));function Dt(c){try{if(c==Ve&&$)return new Uint8Array($);if(D)return D(c);throw"both async and sync fetching of the wasm failed"}catch(p){nt(p)}}function hr(){if(!$&&(f||d)){if(typeof fetch=="function"&&!It(Ve))return fetch(Ve,{credentials:"same-origin"}).then(function(c){if(!c.ok)throw"failed to load wasm binary file at '"+Ve+"'";return c.arrayBuffer()}).catch(function(){return Dt(Ve)});if(k)return new Promise(function(c,p){k(Ve,function(v){c(new Uint8Array(v))},p)})}return Promise.resolve().then(function(){return Dt(Ve)})}function dr(){var c={a:oo};function p(A,O){var B=A.exports;r.asm=B,ee=r.asm.oa,Nt(ee.buffer),Ut=r.asm.va,fr(r.asm.pa),St()}Ot();function v(A){p(A.instance)}function P(A){return hr().then(function(O){return WebAssembly.instantiate(O,c)}).then(function(O){return O}).then(A,function(O){X("failed to asynchronously prepare wasm: "+O),nt(O)})}function w(){return!$&&typeof WebAssembly.instantiateStreaming=="function"&&!Vt(Ve)&&!It(Ve)&&!g&&typeof fetch=="function"?fetch(Ve,{credentials:"same-origin"}).then(function(A){var O=WebAssembly.instantiateStreaming(A,c);return O.then(v,function(B){return X("wasm streaming compile failed: "+B),X("falling back to ArrayBuffer instantiation"),P(v)})}):P(v)}if(r.instantiateWasm)try{var x=r.instantiateWasm(c,p);return x}catch(A){return X("Module.instantiateWasm callback failed with error: "+A),!1}return w().catch(i),{}}var Ne,Qe;function vr(){return r.HEAP8.length}function Lt(c){for(;c.length>0;){var p=c.shift();if(typeof p=="function"){p(r);continue}var v=p.func;typeof v=="number"?p.arg===void 0?Tt(v)():Tt(v)(p.arg):v(p.arg===void 0?null:p.arg)}}var Ct=[];function Tt(c){var p=Ct[c];return p||(c>=Ct.length&&(Ct.length=c+1),Ct[c]=p=Ut.get(c)),p}function mr(c,p,v,P){nt("Assertion failed: "+ue(c)+", at: "+[p?ue(p):"unknown filename",v,P?ue(P):"unknown function"])}function gr(c){return ut(c+24)+24}function yr(c){this.excPtr=c,this.ptr=c-24,this.set_type=function(p){be[this.ptr+4>>2]=p},this.get_type=function(){return be[this.ptr+4>>2]},this.set_destructor=function(p){be[this.ptr+8>>2]=p},this.get_destructor=function(){return be[this.ptr+8>>2]},this.set_refcount=function(p){j[this.ptr>>2]=p},this.set_caught=function(p){p=p?1:0,Se[this.ptr+12>>0]=p},this.get_caught=function(){return Se[this.ptr+12>>0]!=0},this.set_rethrown=function(p){p=p?1:0,Se[this.ptr+13>>0]=p},this.get_rethrown=function(){return Se[this.ptr+13>>0]!=0},this.init=function(p,v){this.set_adjusted_ptr(0),this.set_type(p),this.set_destructor(v),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var p=j[this.ptr>>2];j[this.ptr>>2]=p+1},this.release_ref=function(){var p=j[this.ptr>>2];return j[this.ptr>>2]=p-1,p===1},this.set_adjusted_ptr=function(p){be[this.ptr+16>>2]=p},this.get_adjusted_ptr=function(){return be[this.ptr+16>>2]},this.get_exception_ptr=function(){var p=dn(this.get_type());if(p)return be[this.excPtr>>2];var v=this.get_adjusted_ptr();return v!==0?v:this.excPtr}}function Pr(c,p,v){var P=new yr(c);throw P.init(p,v),c}var Ce={isAbs:c=>c.charAt(0)==="/",splitPath:c=>{var p=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return p.exec(c).slice(1)},normalizeArray:(c,p)=>{for(var v=0,P=c.length-1;P>=0;P--){var w=c[P];w==="."?c.splice(P,1):w===".."?(c.splice(P,1),v++):v&&(c.splice(P,1),v--)}if(p)for(;v;v--)c.unshift("..");return c},normalize:c=>{var p=Ce.isAbs(c),v=c.substr(-1)==="/";return c=Ce.normalizeArray(c.split("/").filter(P=>!!P),!p).join("/"),!c&&!p&&(c="."),c&&v&&(c+="/"),(p?"/":"")+c},dirname:c=>{var p=Ce.splitPath(c),v=p[0],P=p[1];return!v&&!P?".":(P&&(P=P.substr(0,P.length-1)),v+P)},basename:c=>{if(c==="/")return"/";c=Ce.normalize(c),c=c.replace(/\/$/,"");var p=c.lastIndexOf("/");return p===-1?c:c.substr(p+1)},join:function(){var c=Array.prototype.slice.call(arguments,0);return Ce.normalize(c.join("/"))},join2:(c,p)=>Ce.normalize(c+"/"+p)};function _r(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var c=new Uint8Array(1);return function(){return crypto.getRandomValues(c),c[0]}}else if(g)try{var p=require("crypto");return function(){return p.randomBytes(1)[0]}}catch{}return function(){nt("randomDevice")}}var et={resolve:function(){for(var c="",p=!1,v=arguments.length-1;v>=-1&&!p;v--){var P=v>=0?arguments[v]:S.cwd();if(typeof P!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!P)return"";c=P+"/"+c,p=Ce.isAbs(P)}return c=Ce.normalizeArray(c.split("/").filter(w=>!!w),!p).join("/"),(p?"/":"")+c||"."},relative:(c,p)=>{c=et.resolve(c).substr(1),p=et.resolve(p).substr(1);function v(G){for(var Z=0;Z<G.length&&G[Z]==="";Z++);for(var J=G.length-1;J>=0&&G[J]==="";J--);return Z>J?[]:G.slice(Z,J-Z+1)}for(var P=v(c.split("/")),w=v(p.split("/")),x=Math.min(P.length,w.length),A=x,O=0;O<x;O++)if(P[O]!==w[O]){A=O;break}for(var B=[],O=A;O<P.length;O++)B.push("..");return B=B.concat(w.slice(A)),B.join("/")}},ot={ttys:[],init:function(){},shutdown:function(){},register:function(c,p){ot.ttys[c]={input:[],output:[],ops:p},S.registerDevice(c,ot.stream_ops)},stream_ops:{open:function(c){var p=ot.ttys[c.node.rdev];if(!p)throw new S.ErrnoError(43);c.tty=p,c.seekable=!1},close:function(c){c.tty.ops.flush(c.tty)},flush:function(c){c.tty.ops.flush(c.tty)},read:function(c,p,v,P,w){if(!c.tty||!c.tty.ops.get_char)throw new S.ErrnoError(60);for(var x=0,A=0;A<P;A++){var O;try{O=c.tty.ops.get_char(c.tty)}catch{throw new S.ErrnoError(29)}if(O===void 0&&x===0)throw new S.ErrnoError(6);if(O==null)break;x++,p[v+A]=O}return x&&(c.node.timestamp=Date.now()),x},write:function(c,p,v,P,w){if(!c.tty||!c.tty.ops.put_char)throw new S.ErrnoError(60);try{for(var x=0;x<P;x++)c.tty.ops.put_char(c.tty,p[v+x])}catch{throw new S.ErrnoError(29)}return P&&(c.node.timestamp=Date.now()),x}},default_tty_ops:{get_char:function(c){if(!c.input.length){var p=null;if(g){var v=256,P=Buffer.alloc(v),w=0;try{w=M.readSync(process.stdin.fd,P,0,v,-1)}catch(x){if(x.toString().includes("EOF"))w=0;else throw x}w>0?p=P.slice(0,w).toString("utf-8"):p=null}else typeof window<"u"&&typeof window.prompt=="function"?(p=window.prompt("Input: "),p!==null&&(p+=`
`)):typeof readline=="function"&&(p=readline(),p!==null&&(p+=`
`));if(!p)return null;c.input=or(p,!0)}return c.input.shift()},put_char:function(c,p){p===null||p===10?(z(we(c.output,0)),c.output=[]):p!=0&&c.output.push(p)},flush:function(c){c.output&&c.output.length>0&&(z(we(c.output,0)),c.output=[])}},default_tty1_ops:{put_char:function(c,p){p===null||p===10?(X(we(c.output,0)),c.output=[]):p!=0&&c.output.push(p)},flush:function(c){c.output&&c.output.length>0&&(X(we(c.output,0)),c.output=[])}}};function br(c,p){_e.fill(0,c,c+p)}function wr(c,p){return Math.ceil(c/p)*p}function Ht(c){c=wr(c,65536);var p=hn(65536,c);return p?(br(p,c),p):0}var he={ops_table:null,mount:function(c){return he.createNode(null,"/",16895,0)},createNode:function(c,p,v,P){if(S.isBlkdev(v)||S.isFIFO(v))throw new S.ErrnoError(63);he.ops_table||(he.ops_table={dir:{node:{getattr:he.node_ops.getattr,setattr:he.node_ops.setattr,lookup:he.node_ops.lookup,mknod:he.node_ops.mknod,rename:he.node_ops.rename,unlink:he.node_ops.unlink,rmdir:he.node_ops.rmdir,readdir:he.node_ops.readdir,symlink:he.node_ops.symlink},stream:{llseek:he.stream_ops.llseek}},file:{node:{getattr:he.node_ops.getattr,setattr:he.node_ops.setattr},stream:{llseek:he.stream_ops.llseek,read:he.stream_ops.read,write:he.stream_ops.write,allocate:he.stream_ops.allocate,mmap:he.stream_ops.mmap,msync:he.stream_ops.msync}},link:{node:{getattr:he.node_ops.getattr,setattr:he.node_ops.setattr,readlink:he.node_ops.readlink},stream:{}},chrdev:{node:{getattr:he.node_ops.getattr,setattr:he.node_ops.setattr},stream:S.chrdev_stream_ops}});var w=S.createNode(c,p,v,P);return S.isDir(w.mode)?(w.node_ops=he.ops_table.dir.node,w.stream_ops=he.ops_table.dir.stream,w.contents={}):S.isFile(w.mode)?(w.node_ops=he.ops_table.file.node,w.stream_ops=he.ops_table.file.stream,w.usedBytes=0,w.contents=null):S.isLink(w.mode)?(w.node_ops=he.ops_table.link.node,w.stream_ops=he.ops_table.link.stream):S.isChrdev(w.mode)&&(w.node_ops=he.ops_table.chrdev.node,w.stream_ops=he.ops_table.chrdev.stream),w.timestamp=Date.now(),c&&(c.contents[p]=w,c.timestamp=w.timestamp),w},getFileDataAsTypedArray:function(c){return c.contents?c.contents.subarray?c.contents.subarray(0,c.usedBytes):new Uint8Array(c.contents):new Uint8Array(0)},expandFileStorage:function(c,p){var v=c.contents?c.contents.length:0;if(!(v>=p)){var P=1024*1024;p=Math.max(p,v*(v<P?2:1.125)>>>0),v!=0&&(p=Math.max(p,256));var w=c.contents;c.contents=new Uint8Array(p),c.usedBytes>0&&c.contents.set(w.subarray(0,c.usedBytes),0)}},resizeFileStorage:function(c,p){if(c.usedBytes!=p)if(p==0)c.contents=null,c.usedBytes=0;else{var v=c.contents;c.contents=new Uint8Array(p),v&&c.contents.set(v.subarray(0,Math.min(p,c.usedBytes))),c.usedBytes=p}},node_ops:{getattr:function(c){var p={};return p.dev=S.isChrdev(c.mode)?c.id:1,p.ino=c.id,p.mode=c.mode,p.nlink=1,p.uid=0,p.gid=0,p.rdev=c.rdev,S.isDir(c.mode)?p.size=4096:S.isFile(c.mode)?p.size=c.usedBytes:S.isLink(c.mode)?p.size=c.link.length:p.size=0,p.atime=new Date(c.timestamp),p.mtime=new Date(c.timestamp),p.ctime=new Date(c.timestamp),p.blksize=4096,p.blocks=Math.ceil(p.size/p.blksize),p},setattr:function(c,p){p.mode!==void 0&&(c.mode=p.mode),p.timestamp!==void 0&&(c.timestamp=p.timestamp),p.size!==void 0&&he.resizeFileStorage(c,p.size)},lookup:function(c,p){throw S.genericErrors[44]},mknod:function(c,p,v,P){return he.createNode(c,p,v,P)},rename:function(c,p,v){if(S.isDir(c.mode)){var P;try{P=S.lookupNode(p,v)}catch{}if(P)for(var w in P.contents)throw new S.ErrnoError(55)}delete c.parent.contents[c.name],c.parent.timestamp=Date.now(),c.name=v,p.contents[v]=c,p.timestamp=c.parent.timestamp,c.parent=p},unlink:function(c,p){delete c.contents[p],c.timestamp=Date.now()},rmdir:function(c,p){var v=S.lookupNode(c,p);for(var P in v.contents)throw new S.ErrnoError(55);delete c.contents[p],c.timestamp=Date.now()},readdir:function(c){var p=[".",".."];for(var v in c.contents)c.contents.hasOwnProperty(v)&&p.push(v);return p},symlink:function(c,p,v){var P=he.createNode(c,p,41471,0);return P.link=v,P},readlink:function(c){if(!S.isLink(c.mode))throw new S.ErrnoError(28);return c.link}},stream_ops:{read:function(c,p,v,P,w){var x=c.node.contents;if(w>=c.node.usedBytes)return 0;var A=Math.min(c.node.usedBytes-w,P);if(A>8&&x.subarray)p.set(x.subarray(w,w+A),v);else for(var O=0;O<A;O++)p[v+O]=x[w+O];return A},write:function(c,p,v,P,w,x){if(p.buffer===Se.buffer&&(x=!1),!P)return 0;var A=c.node;if(A.timestamp=Date.now(),p.subarray&&(!A.contents||A.contents.subarray)){if(x)return A.contents=p.subarray(v,v+P),A.usedBytes=P,P;if(A.usedBytes===0&&w===0)return A.contents=p.slice(v,v+P),A.usedBytes=P,P;if(w+P<=A.usedBytes)return A.contents.set(p.subarray(v,v+P),w),P}if(he.expandFileStorage(A,w+P),A.contents.subarray&&p.subarray)A.contents.set(p.subarray(v,v+P),w);else for(var O=0;O<P;O++)A.contents[w+O]=p[v+O];return A.usedBytes=Math.max(A.usedBytes,w+P),P},llseek:function(c,p,v){var P=p;if(v===1?P+=c.position:v===2&&S.isFile(c.node.mode)&&(P+=c.node.usedBytes),P<0)throw new S.ErrnoError(28);return P},allocate:function(c,p,v){he.expandFileStorage(c.node,p+v),c.node.usedBytes=Math.max(c.node.usedBytes,p+v)},mmap:function(c,p,v,P,w){if(!S.isFile(c.node.mode))throw new S.ErrnoError(43);var x,A,O=c.node.contents;if(!(w&2)&&O.buffer===He)A=!1,x=O.byteOffset;else{if((v>0||v+p<O.length)&&(O.subarray?O=O.subarray(v,v+p):O=Array.prototype.slice.call(O,v,v+p)),A=!0,x=Ht(p),!x)throw new S.ErrnoError(48);Se.set(O,x)}return{ptr:x,allocated:A}},msync:function(c,p,v,P,w){if(!S.isFile(c.node.mode))throw new S.ErrnoError(43);return w&2||he.stream_ops.write(c,p,0,P,v,!1),0}}};function Sr(c,p,v,P){var w="al "+c;k(c,function(x){ce(x,'Loading data file "'+c+'" failed (no arrayBuffer).'),p(new Uint8Array(x)),w&&St()},function(x){if(v)v();else throw'Loading data file "'+c+'" failed.'}),w&&Ot()}var S={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(c,p={})=>{if(c=et.resolve(S.cwd(),c),!c)return{path:"",node:null};var v={follow_mount:!0,recurse_count:0};if(p=Object.assign(v,p),p.recurse_count>8)throw new S.ErrnoError(32);for(var P=Ce.normalizeArray(c.split("/").filter(J=>!!J),!1),w=S.root,x="/",A=0;A<P.length;A++){var O=A===P.length-1;if(O&&p.parent)break;if(w=S.lookupNode(w,P[A]),x=Ce.join2(x,P[A]),S.isMountpoint(w)&&(!O||O&&p.follow_mount)&&(w=w.mounted.root),!O||p.follow)for(var B=0;S.isLink(w.mode);){var G=S.readlink(x);x=et.resolve(Ce.dirname(x),G);var Z=S.lookupPath(x,{recurse_count:p.recurse_count+1});if(w=Z.node,B++>40)throw new S.ErrnoError(32)}}return{path:x,node:w}},getPath:c=>{for(var p;;){if(S.isRoot(c)){var v=c.mount.mountpoint;return p?v[v.length-1]!=="/"?v+"/"+p:v+p:v}p=p?c.name+"/"+p:c.name,c=c.parent}},hashName:(c,p)=>{for(var v=0,P=0;P<p.length;P++)v=(v<<5)-v+p.charCodeAt(P)|0;return(c+v>>>0)%S.nameTable.length},hashAddNode:c=>{var p=S.hashName(c.parent.id,c.name);c.name_next=S.nameTable[p],S.nameTable[p]=c},hashRemoveNode:c=>{var p=S.hashName(c.parent.id,c.name);if(S.nameTable[p]===c)S.nameTable[p]=c.name_next;else for(var v=S.nameTable[p];v;){if(v.name_next===c){v.name_next=c.name_next;break}v=v.name_next}},lookupNode:(c,p)=>{var v=S.mayLookup(c);if(v)throw new S.ErrnoError(v,c);for(var P=S.hashName(c.id,p),w=S.nameTable[P];w;w=w.name_next){var x=w.name;if(w.parent.id===c.id&&x===p)return w}return S.lookup(c,p)},createNode:(c,p,v,P)=>{var w=new S.FSNode(c,p,v,P);return S.hashAddNode(w),w},destroyNode:c=>{S.hashRemoveNode(c)},isRoot:c=>c===c.parent,isMountpoint:c=>!!c.mounted,isFile:c=>(c&61440)===32768,isDir:c=>(c&61440)===16384,isLink:c=>(c&61440)===40960,isChrdev:c=>(c&61440)===8192,isBlkdev:c=>(c&61440)===24576,isFIFO:c=>(c&61440)===4096,isSocket:c=>(c&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:c=>{var p=S.flagModes[c];if(typeof p>"u")throw new Error("Unknown file open mode: "+c);return p},flagsToPermissionString:c=>{var p=["r","w","rw"][c&3];return c&512&&(p+="w"),p},nodePermissions:(c,p)=>S.ignorePermissions?0:p.includes("r")&&!(c.mode&292)||p.includes("w")&&!(c.mode&146)||p.includes("x")&&!(c.mode&73)?2:0,mayLookup:c=>{var p=S.nodePermissions(c,"x");return p||(c.node_ops.lookup?0:2)},mayCreate:(c,p)=>{try{var v=S.lookupNode(c,p);return 20}catch{}return S.nodePermissions(c,"wx")},mayDelete:(c,p,v)=>{var P;try{P=S.lookupNode(c,p)}catch(x){return x.errno}var w=S.nodePermissions(c,"wx");if(w)return w;if(v){if(!S.isDir(P.mode))return 54;if(S.isRoot(P)||S.getPath(P)===S.cwd())return 10}else if(S.isDir(P.mode))return 31;return 0},mayOpen:(c,p)=>c?S.isLink(c.mode)?32:S.isDir(c.mode)&&(S.flagsToPermissionString(p)!=="r"||p&512)?31:S.nodePermissions(c,S.flagsToPermissionString(p)):44,MAX_OPEN_FDS:4096,nextfd:(c=0,p=S.MAX_OPEN_FDS)=>{for(var v=c;v<=p;v++)if(!S.streams[v])return v;throw new S.ErrnoError(33)},getStream:c=>S.streams[c],createStream:(c,p,v)=>{S.FSStream||(S.FSStream=function(){this.shared={}},S.FSStream.prototype={},Object.defineProperties(S.FSStream.prototype,{object:{get:function(){return this.node},set:function(w){this.node=w}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(w){this.shared.flags=w}},position:{get:function(){return this.shared.position},set:function(w){this.shared.position=w}}})),c=Object.assign(new S.FSStream,c);var P=S.nextfd(p,v);return c.fd=P,S.streams[P]=c,c},closeStream:c=>{S.streams[c]=null},chrdev_stream_ops:{open:c=>{var p=S.getDevice(c.node.rdev);c.stream_ops=p.stream_ops,c.stream_ops.open&&c.stream_ops.open(c)},llseek:()=>{throw new S.ErrnoError(70)}},major:c=>c>>8,minor:c=>c&255,makedev:(c,p)=>c<<8|p,registerDevice:(c,p)=>{S.devices[c]={stream_ops:p}},getDevice:c=>S.devices[c],getMounts:c=>{for(var p=[],v=[c];v.length;){var P=v.pop();p.push(P),v.push.apply(v,P.mounts)}return p},syncfs:(c,p)=>{typeof c=="function"&&(p=c,c=!1),S.syncFSRequests++,S.syncFSRequests>1&&X("warning: "+S.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var v=S.getMounts(S.root.mount),P=0;function w(A){return S.syncFSRequests--,p(A)}function x(A){if(A)return x.errored?void 0:(x.errored=!0,w(A));++P>=v.length&&w(null)}v.forEach(A=>{if(!A.type.syncfs)return x(null);A.type.syncfs(A,c,x)})},mount:(c,p,v)=>{var P=v==="/",w=!v,x;if(P&&S.root)throw new S.ErrnoError(10);if(!P&&!w){var A=S.lookupPath(v,{follow_mount:!1});if(v=A.path,x=A.node,S.isMountpoint(x))throw new S.ErrnoError(10);if(!S.isDir(x.mode))throw new S.ErrnoError(54)}var O={type:c,opts:p,mountpoint:v,mounts:[]},B=c.mount(O);return B.mount=O,O.root=B,P?S.root=B:x&&(x.mounted=O,x.mount&&x.mount.mounts.push(O)),B},unmount:c=>{var p=S.lookupPath(c,{follow_mount:!1});if(!S.isMountpoint(p.node))throw new S.ErrnoError(28);var v=p.node,P=v.mounted,w=S.getMounts(P);Object.keys(S.nameTable).forEach(A=>{for(var O=S.nameTable[A];O;){var B=O.name_next;w.includes(O.mount)&&S.destroyNode(O),O=B}}),v.mounted=null;var x=v.mount.mounts.indexOf(P);v.mount.mounts.splice(x,1)},lookup:(c,p)=>c.node_ops.lookup(c,p),mknod:(c,p,v)=>{var P=S.lookupPath(c,{parent:!0}),w=P.node,x=Ce.basename(c);if(!x||x==="."||x==="..")throw new S.ErrnoError(28);var A=S.mayCreate(w,x);if(A)throw new S.ErrnoError(A);if(!w.node_ops.mknod)throw new S.ErrnoError(63);return w.node_ops.mknod(w,x,p,v)},create:(c,p)=>(p=p!==void 0?p:438,p&=4095,p|=32768,S.mknod(c,p,0)),mkdir:(c,p)=>(p=p!==void 0?p:511,p&=1023,p|=16384,S.mknod(c,p,0)),mkdirTree:(c,p)=>{for(var v=c.split("/"),P="",w=0;w<v.length;++w)if(v[w]){P+="/"+v[w];try{S.mkdir(P,p)}catch(x){if(x.errno!=20)throw x}}},mkdev:(c,p,v)=>(typeof v>"u"&&(v=p,p=438),p|=8192,S.mknod(c,p,v)),symlink:(c,p)=>{if(!et.resolve(c))throw new S.ErrnoError(44);var v=S.lookupPath(p,{parent:!0}),P=v.node;if(!P)throw new S.ErrnoError(44);var w=Ce.basename(p),x=S.mayCreate(P,w);if(x)throw new S.ErrnoError(x);if(!P.node_ops.symlink)throw new S.ErrnoError(63);return P.node_ops.symlink(P,w,c)},rename:(c,p)=>{var v=Ce.dirname(c),P=Ce.dirname(p),w=Ce.basename(c),x=Ce.basename(p),A,O,B;if(A=S.lookupPath(c,{parent:!0}),O=A.node,A=S.lookupPath(p,{parent:!0}),B=A.node,!O||!B)throw new S.ErrnoError(44);if(O.mount!==B.mount)throw new S.ErrnoError(75);var G=S.lookupNode(O,w),Z=et.relative(c,P);if(Z.charAt(0)!==".")throw new S.ErrnoError(28);if(Z=et.relative(p,v),Z.charAt(0)!==".")throw new S.ErrnoError(55);var J;try{J=S.lookupNode(B,x)}catch{}if(G!==J){var V=S.isDir(G.mode),K=S.mayDelete(O,w,V);if(K)throw new S.ErrnoError(K);if(K=J?S.mayDelete(B,x,V):S.mayCreate(B,x),K)throw new S.ErrnoError(K);if(!O.node_ops.rename)throw new S.ErrnoError(63);if(S.isMountpoint(G)||J&&S.isMountpoint(J))throw new S.ErrnoError(10);if(B!==O&&(K=S.nodePermissions(O,"w"),K))throw new S.ErrnoError(K);S.hashRemoveNode(G);try{O.node_ops.rename(G,B,x)}catch(oe){throw oe}finally{S.hashAddNode(G)}}},rmdir:c=>{var p=S.lookupPath(c,{parent:!0}),v=p.node,P=Ce.basename(c),w=S.lookupNode(v,P),x=S.mayDelete(v,P,!0);if(x)throw new S.ErrnoError(x);if(!v.node_ops.rmdir)throw new S.ErrnoError(63);if(S.isMountpoint(w))throw new S.ErrnoError(10);v.node_ops.rmdir(v,P),S.destroyNode(w)},readdir:c=>{var p=S.lookupPath(c,{follow:!0}),v=p.node;if(!v.node_ops.readdir)throw new S.ErrnoError(54);return v.node_ops.readdir(v)},unlink:c=>{var p=S.lookupPath(c,{parent:!0}),v=p.node;if(!v)throw new S.ErrnoError(44);var P=Ce.basename(c),w=S.lookupNode(v,P),x=S.mayDelete(v,P,!1);if(x)throw new S.ErrnoError(x);if(!v.node_ops.unlink)throw new S.ErrnoError(63);if(S.isMountpoint(w))throw new S.ErrnoError(10);v.node_ops.unlink(v,P),S.destroyNode(w)},readlink:c=>{var p=S.lookupPath(c),v=p.node;if(!v)throw new S.ErrnoError(44);if(!v.node_ops.readlink)throw new S.ErrnoError(28);return et.resolve(S.getPath(v.parent),v.node_ops.readlink(v))},stat:(c,p)=>{var v=S.lookupPath(c,{follow:!p}),P=v.node;if(!P)throw new S.ErrnoError(44);if(!P.node_ops.getattr)throw new S.ErrnoError(63);return P.node_ops.getattr(P)},lstat:c=>S.stat(c,!0),chmod:(c,p,v)=>{var P;if(typeof c=="string"){var w=S.lookupPath(c,{follow:!v});P=w.node}else P=c;if(!P.node_ops.setattr)throw new S.ErrnoError(63);P.node_ops.setattr(P,{mode:p&4095|P.mode&-4096,timestamp:Date.now()})},lchmod:(c,p)=>{S.chmod(c,p,!0)},fchmod:(c,p)=>{var v=S.getStream(c);if(!v)throw new S.ErrnoError(8);S.chmod(v.node,p)},chown:(c,p,v,P)=>{var w;if(typeof c=="string"){var x=S.lookupPath(c,{follow:!P});w=x.node}else w=c;if(!w.node_ops.setattr)throw new S.ErrnoError(63);w.node_ops.setattr(w,{timestamp:Date.now()})},lchown:(c,p,v)=>{S.chown(c,p,v,!0)},fchown:(c,p,v)=>{var P=S.getStream(c);if(!P)throw new S.ErrnoError(8);S.chown(P.node,p,v)},truncate:(c,p)=>{if(p<0)throw new S.ErrnoError(28);var v;if(typeof c=="string"){var P=S.lookupPath(c,{follow:!0});v=P.node}else v=c;if(!v.node_ops.setattr)throw new S.ErrnoError(63);if(S.isDir(v.mode))throw new S.ErrnoError(31);if(!S.isFile(v.mode))throw new S.ErrnoError(28);var w=S.nodePermissions(v,"w");if(w)throw new S.ErrnoError(w);v.node_ops.setattr(v,{size:p,timestamp:Date.now()})},ftruncate:(c,p)=>{var v=S.getStream(c);if(!v)throw new S.ErrnoError(8);if(!(v.flags&2097155))throw new S.ErrnoError(28);S.truncate(v.node,p)},utime:(c,p,v)=>{var P=S.lookupPath(c,{follow:!0}),w=P.node;w.node_ops.setattr(w,{timestamp:Math.max(p,v)})},open:(c,p,v)=>{if(c==="")throw new S.ErrnoError(44);p=typeof p=="string"?S.modeStringToFlags(p):p,v=typeof v>"u"?438:v,p&64?v=v&4095|32768:v=0;var P;if(typeof c=="object")P=c;else{c=Ce.normalize(c);try{var w=S.lookupPath(c,{follow:!(p&131072)});P=w.node}catch{}}var x=!1;if(p&64)if(P){if(p&128)throw new S.ErrnoError(20)}else P=S.mknod(c,v,0),x=!0;if(!P)throw new S.ErrnoError(44);if(S.isChrdev(P.mode)&&(p&=-513),p&65536&&!S.isDir(P.mode))throw new S.ErrnoError(54);if(!x){var A=S.mayOpen(P,p);if(A)throw new S.ErrnoError(A)}p&512&&!x&&S.truncate(P,0),p&=-131713;var O=S.createStream({node:P,path:S.getPath(P),flags:p,seekable:!0,position:0,stream_ops:P.stream_ops,ungotten:[],error:!1});return O.stream_ops.open&&O.stream_ops.open(O),r.logReadFiles&&!(p&1)&&(S.readFiles||(S.readFiles={}),c in S.readFiles||(S.readFiles[c]=1)),O},close:c=>{if(S.isClosed(c))throw new S.ErrnoError(8);c.getdents&&(c.getdents=null);try{c.stream_ops.close&&c.stream_ops.close(c)}catch(p){throw p}finally{S.closeStream(c.fd)}c.fd=null},isClosed:c=>c.fd===null,llseek:(c,p,v)=>{if(S.isClosed(c))throw new S.ErrnoError(8);if(!c.seekable||!c.stream_ops.llseek)throw new S.ErrnoError(70);if(v!=0&&v!=1&&v!=2)throw new S.ErrnoError(28);return c.position=c.stream_ops.llseek(c,p,v),c.ungotten=[],c.position},read:(c,p,v,P,w)=>{if(P<0||w<0)throw new S.ErrnoError(28);if(S.isClosed(c))throw new S.ErrnoError(8);if((c.flags&2097155)===1)throw new S.ErrnoError(8);if(S.isDir(c.node.mode))throw new S.ErrnoError(31);if(!c.stream_ops.read)throw new S.ErrnoError(28);var x=typeof w<"u";if(!x)w=c.position;else if(!c.seekable)throw new S.ErrnoError(70);var A=c.stream_ops.read(c,p,v,P,w);return x||(c.position+=A),A},write:(c,p,v,P,w,x)=>{if(P<0||w<0)throw new S.ErrnoError(28);if(S.isClosed(c))throw new S.ErrnoError(8);if(!(c.flags&2097155))throw new S.ErrnoError(8);if(S.isDir(c.node.mode))throw new S.ErrnoError(31);if(!c.stream_ops.write)throw new S.ErrnoError(28);c.seekable&&c.flags&1024&&S.llseek(c,0,2);var A=typeof w<"u";if(!A)w=c.position;else if(!c.seekable)throw new S.ErrnoError(70);var O=c.stream_ops.write(c,p,v,P,w,x);return A||(c.position+=O),O},allocate:(c,p,v)=>{if(S.isClosed(c))throw new S.ErrnoError(8);if(p<0||v<=0)throw new S.ErrnoError(28);if(!(c.flags&2097155))throw new S.ErrnoError(8);if(!S.isFile(c.node.mode)&&!S.isDir(c.node.mode))throw new S.ErrnoError(43);if(!c.stream_ops.allocate)throw new S.ErrnoError(138);c.stream_ops.allocate(c,p,v)},mmap:(c,p,v,P,w)=>{if(P&2&&!(w&2)&&(c.flags&2097155)!==2)throw new S.ErrnoError(2);if((c.flags&2097155)===1)throw new S.ErrnoError(2);if(!c.stream_ops.mmap)throw new S.ErrnoError(43);return c.stream_ops.mmap(c,p,v,P,w)},msync:(c,p,v,P,w)=>!c||!c.stream_ops.msync?0:c.stream_ops.msync(c,p,v,P,w),munmap:c=>0,ioctl:(c,p,v)=>{if(!c.stream_ops.ioctl)throw new S.ErrnoError(59);return c.stream_ops.ioctl(c,p,v)},readFile:(c,p={})=>{if(p.flags=p.flags||0,p.encoding=p.encoding||"binary",p.encoding!=="utf8"&&p.encoding!=="binary")throw new Error('Invalid encoding type "'+p.encoding+'"');var v,P=S.open(c,p.flags),w=S.stat(c),x=w.size,A=new Uint8Array(x);return S.read(P,A,0,x,0),p.encoding==="utf8"?v=we(A,0):p.encoding==="binary"&&(v=A),S.close(P),v},writeFile:(c,p,v={})=>{v.flags=v.flags||577;var P=S.open(c,v.flags,v.mode);if(typeof p=="string"){var w=new Uint8Array(re(p)+1),x=pe(p,w,0,w.length);S.write(P,w,0,x,void 0,v.canOwn)}else if(ArrayBuffer.isView(p))S.write(P,p,0,p.byteLength,void 0,v.canOwn);else throw new Error("Unsupported data type");S.close(P)},cwd:()=>S.currentPath,chdir:c=>{var p=S.lookupPath(c,{follow:!0});if(p.node===null)throw new S.ErrnoError(44);if(!S.isDir(p.node.mode))throw new S.ErrnoError(54);var v=S.nodePermissions(p.node,"x");if(v)throw new S.ErrnoError(v);S.currentPath=p.path},createDefaultDirectories:()=>{S.mkdir("/tmp"),S.mkdir("/home"),S.mkdir("/home/web_user")},createDefaultDevices:()=>{S.mkdir("/dev"),S.registerDevice(S.makedev(1,3),{read:()=>0,write:(p,v,P,w,x)=>w}),S.mkdev("/dev/null",S.makedev(1,3)),ot.register(S.makedev(5,0),ot.default_tty_ops),ot.register(S.makedev(6,0),ot.default_tty1_ops),S.mkdev("/dev/tty",S.makedev(5,0)),S.mkdev("/dev/tty1",S.makedev(6,0));var c=_r();S.createDevice("/dev","random",c),S.createDevice("/dev","urandom",c),S.mkdir("/dev/shm"),S.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{S.mkdir("/proc");var c=S.mkdir("/proc/self");S.mkdir("/proc/self/fd"),S.mount({mount:()=>{var p=S.createNode(c,"fd",16895,73);return p.node_ops={lookup:(v,P)=>{var w=+P,x=S.getStream(w);if(!x)throw new S.ErrnoError(8);var A={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>x.path}};return A.parent=A,A}},p}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?S.createDevice("/dev","stdin",r.stdin):S.symlink("/dev/tty","/dev/stdin"),r.stdout?S.createDevice("/dev","stdout",null,r.stdout):S.symlink("/dev/tty","/dev/stdout"),r.stderr?S.createDevice("/dev","stderr",null,r.stderr):S.symlink("/dev/tty1","/dev/stderr"),S.open("/dev/stdin",0),S.open("/dev/stdout",1),S.open("/dev/stderr",1)},ensureErrnoError:()=>{S.ErrnoError||(S.ErrnoError=function(p,v){this.node=v,this.setErrno=function(P){this.errno=P},this.setErrno(p),this.message="FS error"},S.ErrnoError.prototype=new Error,S.ErrnoError.prototype.constructor=S.ErrnoError,[44].forEach(c=>{S.genericErrors[c]=new S.ErrnoError(c),S.genericErrors[c].stack="<generic error, no stack>"}))},staticInit:()=>{S.ensureErrnoError(),S.nameTable=new Array(4096),S.mount(he,{},"/"),S.createDefaultDirectories(),S.createDefaultDevices(),S.createSpecialDirectories(),S.filesystems={MEMFS:he}},init:(c,p,v)=>{S.init.initialized=!0,S.ensureErrnoError(),r.stdin=c||r.stdin,r.stdout=p||r.stdout,r.stderr=v||r.stderr,S.createStandardStreams()},quit:()=>{S.init.initialized=!1;for(var c=0;c<S.streams.length;c++){var p=S.streams[c];p&&S.close(p)}},getMode:(c,p)=>{var v=0;return c&&(v|=365),p&&(v|=146),v},findObject:(c,p)=>{var v=S.analyzePath(c,p);return v.exists?v.object:null},analyzePath:(c,p)=>{try{var v=S.lookupPath(c,{follow:!p});c=v.path}catch{}var P={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var v=S.lookupPath(c,{parent:!0});P.parentExists=!0,P.parentPath=v.path,P.parentObject=v.node,P.name=Ce.basename(c),v=S.lookupPath(c,{follow:!p}),P.exists=!0,P.path=v.path,P.object=v.node,P.name=v.node.name,P.isRoot=v.path==="/"}catch(w){P.error=w.errno}return P},createPath:(c,p,v,P)=>{c=typeof c=="string"?c:S.getPath(c);for(var w=p.split("/").reverse();w.length;){var x=w.pop();if(x){var A=Ce.join2(c,x);try{S.mkdir(A)}catch{}c=A}}return A},createFile:(c,p,v,P,w)=>{var x=Ce.join2(typeof c=="string"?c:S.getPath(c),p),A=S.getMode(P,w);return S.create(x,A)},createDataFile:(c,p,v,P,w,x)=>{var A=p;c&&(c=typeof c=="string"?c:S.getPath(c),A=p?Ce.join2(c,p):c);var O=S.getMode(P,w),B=S.create(A,O);if(v){if(typeof v=="string"){for(var G=new Array(v.length),Z=0,J=v.length;Z<J;++Z)G[Z]=v.charCodeAt(Z);v=G}S.chmod(B,O|146);var V=S.open(B,577);S.write(V,v,0,v.length,0,x),S.close(V),S.chmod(B,O)}return B},createDevice:(c,p,v,P)=>{var w=Ce.join2(typeof c=="string"?c:S.getPath(c),p),x=S.getMode(!!v,!!P);S.createDevice.major||(S.createDevice.major=64);var A=S.makedev(S.createDevice.major++,0);return S.registerDevice(A,{open:O=>{O.seekable=!1},close:O=>{P&&P.buffer&&P.buffer.length&&P(10)},read:(O,B,G,Z,J)=>{for(var V=0,K=0;K<Z;K++){var oe;try{oe=v()}catch{throw new S.ErrnoError(29)}if(oe===void 0&&V===0)throw new S.ErrnoError(6);if(oe==null)break;V++,B[G+K]=oe}return V&&(O.node.timestamp=Date.now()),V},write:(O,B,G,Z,J)=>{for(var V=0;V<Z;V++)try{P(B[G+V])}catch{throw new S.ErrnoError(29)}return Z&&(O.node.timestamp=Date.now()),V}}),S.mkdev(w,x,A)},forceLoadFile:c=>{if(c.isDevice||c.isFolder||c.link||c.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(E)try{c.contents=or(E(c.url),!0),c.usedBytes=c.contents.length}catch{throw new S.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(c,p,v,P,w)=>{function x(){this.lengthKnown=!1,this.chunks=[]}if(x.prototype.get=function(K){if(!(K>this.length-1||K<0)){var oe=K%this.chunkSize,xe=K/this.chunkSize|0;return this.getter(xe)[oe]}},x.prototype.setDataGetter=function(K){this.getter=K},x.prototype.cacheLength=function(){var K=new XMLHttpRequest;if(K.open("HEAD",v,!1),K.send(null),!(K.status>=200&&K.status<300||K.status===304))throw new Error("Couldn't load "+v+". Status: "+K.status);var oe=Number(K.getResponseHeader("Content-length")),xe,Le=(xe=K.getResponseHeader("Accept-Ranges"))&&xe==="bytes",Fe=(xe=K.getResponseHeader("Content-Encoding"))&&xe==="gzip",Y=1024*1024;Le||(Y=oe);var ne=(Oe,je)=>{if(Oe>je)throw new Error("invalid range ("+Oe+", "+je+") or no bytes requested!");if(je>oe-1)throw new Error("only "+oe+" bytes available! programmer error!");var Me=new XMLHttpRequest;if(Me.open("GET",v,!1),oe!==Y&&Me.setRequestHeader("Range","bytes="+Oe+"-"+je),Me.responseType="arraybuffer",Me.overrideMimeType&&Me.overrideMimeType("text/plain; charset=x-user-defined"),Me.send(null),!(Me.status>=200&&Me.status<300||Me.status===304))throw new Error("Couldn't load "+v+". Status: "+Me.status);return Me.response!==void 0?new Uint8Array(Me.response||[]):or(Me.responseText||"",!0)},Xe=this;Xe.setDataGetter(Oe=>{var je=Oe*Y,Me=(Oe+1)*Y-1;if(Me=Math.min(Me,oe-1),typeof Xe.chunks[Oe]>"u"&&(Xe.chunks[Oe]=ne(je,Me)),typeof Xe.chunks[Oe]>"u")throw new Error("doXHR failed!");return Xe.chunks[Oe]}),(Fe||!oe)&&(Y=oe=1,oe=this.getter(0).length,Y=oe,z("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=oe,this._chunkSize=Y,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!d)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var A=new x;Object.defineProperties(A,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var O={isDevice:!1,contents:A}}else var O={isDevice:!1,url:v};var B=S.createFile(c,p,O,P,w);O.contents?B.contents=O.contents:O.url&&(B.contents=null,B.url=O.url),Object.defineProperties(B,{usedBytes:{get:function(){return this.contents.length}}});var G={},Z=Object.keys(B.stream_ops);Z.forEach(V=>{var K=B.stream_ops[V];G[V]=function(){return S.forceLoadFile(B),K.apply(null,arguments)}});function J(V,K,oe,xe,Le){var Fe=V.node.contents;if(Le>=Fe.length)return 0;var Y=Math.min(Fe.length-Le,xe);if(Fe.slice)for(var ne=0;ne<Y;ne++)K[oe+ne]=Fe[Le+ne];else for(var ne=0;ne<Y;ne++)K[oe+ne]=Fe.get(Le+ne);return Y}return G.read=(V,K,oe,xe,Le)=>(S.forceLoadFile(B),J(V,K,oe,xe,Le)),G.mmap=(V,K,oe,xe,Le)=>{S.forceLoadFile(B);var Fe=Ht(K);if(!Fe)throw new S.ErrnoError(48);return J(V,Se,Fe,K,oe),{ptr:Fe,allocated:!0}},B.stream_ops=G,B},createPreloadedFile:(c,p,v,P,w,x,A,O,B,G)=>{var Z=p?et.resolve(Ce.join2(c,p)):c;function J(V){function K(oe){G&&G(),O||S.createDataFile(c,p,oe,P,w,B),x&&x(),St()}Browser.handledByPreloadPlugin(V,Z,K,()=>{A&&A(),St()})||K(V)}Ot(),typeof v=="string"?Sr(v,V=>J(V),A):J(v)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(c,p,v)=>{p=p||(()=>{}),v=v||(()=>{});var P=S.indexedDB();try{var w=P.open(S.DB_NAME(),S.DB_VERSION)}catch(x){return v(x)}w.onupgradeneeded=()=>{z("creating db");var x=w.result;x.createObjectStore(S.DB_STORE_NAME)},w.onsuccess=()=>{var x=w.result,A=x.transaction([S.DB_STORE_NAME],"readwrite"),O=A.objectStore(S.DB_STORE_NAME),B=0,G=0,Z=c.length;function J(){G==0?p():v()}c.forEach(V=>{var K=O.put(S.analyzePath(V).object.contents,V);K.onsuccess=()=>{B++,B+G==Z&&J()},K.onerror=()=>{G++,B+G==Z&&J()}}),A.onerror=v},w.onerror=v},loadFilesFromDB:(c,p,v)=>{p=p||(()=>{}),v=v||(()=>{});var P=S.indexedDB();try{var w=P.open(S.DB_NAME(),S.DB_VERSION)}catch(x){return v(x)}w.onupgradeneeded=v,w.onsuccess=()=>{var x=w.result;try{var A=x.transaction([S.DB_STORE_NAME],"readonly")}catch(V){v(V);return}var O=A.objectStore(S.DB_STORE_NAME),B=0,G=0,Z=c.length;function J(){G==0?p():v()}c.forEach(V=>{var K=O.get(V);K.onsuccess=()=>{S.analyzePath(V).exists&&S.unlink(V),S.createDataFile(Ce.dirname(V),Ce.basename(V),K.result,!0,!0,!0),B++,B+G==Z&&J()},K.onerror=()=>{G++,B+G==Z&&J()}}),A.onerror=v},w.onerror=v}},Te={DEFAULT_POLLMASK:5,calculateAt:function(c,p,v){if(Ce.isAbs(p))return p;var P;if(c===-100)P=S.cwd();else{var w=S.getStream(c);if(!w)throw new S.ErrnoError(8);P=w.path}if(p.length==0){if(!v)throw new S.ErrnoError(44);return P}return Ce.join2(P,p)},doStat:function(c,p,v){try{var P=c(p)}catch(w){if(w&&w.node&&Ce.normalize(p)!==Ce.normalize(S.getPath(w.node)))return-54;throw w}return j[v>>2]=P.dev,j[v+4>>2]=0,j[v+8>>2]=P.ino,j[v+12>>2]=P.mode,j[v+16>>2]=P.nlink,j[v+20>>2]=P.uid,j[v+24>>2]=P.gid,j[v+28>>2]=P.rdev,j[v+32>>2]=0,Qe=[P.size>>>0,(Ne=P.size,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],j[v+40>>2]=Qe[0],j[v+44>>2]=Qe[1],j[v+48>>2]=4096,j[v+52>>2]=P.blocks,j[v+56>>2]=P.atime.getTime()/1e3|0,j[v+60>>2]=0,j[v+64>>2]=P.mtime.getTime()/1e3|0,j[v+68>>2]=0,j[v+72>>2]=P.ctime.getTime()/1e3|0,j[v+76>>2]=0,Qe=[P.ino>>>0,(Ne=P.ino,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],j[v+80>>2]=Qe[0],j[v+84>>2]=Qe[1],0},doMsync:function(c,p,v,P,w){var x=_e.slice(c,c+v);S.msync(p,x,w,v,P)},varargs:void 0,get:function(){Te.varargs+=4;var c=j[Te.varargs-4>>2];return c},getStr:function(c){var p=ue(c);return p},getStreamFromFD:function(c){var p=S.getStream(c);if(!p)throw new S.ErrnoError(8);return p}};function Pt(c,p){try{return c=Te.getStr(c),S.chmod(c,p),0}catch(v){if(typeof S>"u"||!(v instanceof S.ErrnoError))throw v;return-v.errno}}function zt(c,p,v,P){try{if(p=Te.getStr(p),p=Te.calculateAt(c,p),v&-8)return-28;var w=S.lookupPath(p,{follow:!0}),x=w.node;if(!x)return-44;var A="";return v&4&&(A+="r"),v&2&&(A+="w"),v&1&&(A+="x"),A&&S.nodePermissions(x,A)?-2:0}catch(O){if(typeof S>"u"||!(O instanceof S.ErrnoError))throw O;return-O.errno}}function Cr(c){return j[cn()>>2]=c,c}function Tr(c,p,v){Te.varargs=v;try{var P=Te.getStreamFromFD(c);switch(p){case 0:{var w=Te.get();if(w<0)return-28;var x;return x=S.createStream(P,w),x.fd}case 1:case 2:return 0;case 3:return P.flags;case 4:{var w=Te.get();return P.flags|=w,0}case 5:{var w=Te.get(),A=0;return Be[w+A>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Cr(28),-1;default:return-28}}catch(O){if(typeof S>"u"||!(O instanceof S.ErrnoError))throw O;return-O.errno}}function Er(c,p){try{var v=Te.getStreamFromFD(c);return Te.doStat(S.stat,v.path,p)}catch(P){if(typeof S>"u"||!(P instanceof S.ErrnoError))throw P;return-P.errno}}function xr(c,p,v){Te.varargs=v;try{var P=Te.getStreamFromFD(c);switch(p){case 21509:case 21505:return P.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return P.tty?0:-59;case 21519:{if(!P.tty)return-59;var w=Te.get();return j[w>>2]=0,0}case 21520:return P.tty?-28:-59;case 21531:{var w=Te.get();return S.ioctl(P,p,w)}case 21523:return P.tty?0:-59;case 21524:return P.tty?0:-59;default:nt("bad ioctl syscall "+p)}}catch(x){if(typeof S>"u"||!(x instanceof S.ErrnoError))throw x;return-x.errno}}function Ar(c,p){try{return c=Te.getStr(c),Te.doStat(S.lstat,c,p)}catch(v){if(typeof S>"u"||!(v instanceof S.ErrnoError))throw v;return-v.errno}}function ft(c,p,v,P){try{p=Te.getStr(p);var w=P&256,x=P&4096;return P=P&-4353,p=Te.calculateAt(c,p,x),Te.doStat(w?S.lstat:S.stat,p,v)}catch(A){if(typeof S>"u"||!(A instanceof S.ErrnoError))throw A;return-A.errno}}function Or(c,p,v,P){Te.varargs=P;try{p=Te.getStr(p),p=Te.calculateAt(c,p);var w=P?Te.get():0;return S.open(p,v,w).fd}catch(x){if(typeof S>"u"||!(x instanceof S.ErrnoError))throw x;return-x.errno}}function kr(c,p){try{return c=Te.getStr(c),Te.doStat(S.stat,c,p)}catch(v){if(typeof S>"u"||!(v instanceof S.ErrnoError))throw v;return-v.errno}}function Ir(c,p,v,P,w){}function Et(c){switch(c){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+c)}}function Dr(){for(var c=new Array(256),p=0;p<256;++p)c[p]=String.fromCharCode(p);qt=c}var qt=void 0;function We(c){for(var p="",v=c;_e[v];)p+=qt[_e[v++]];return p}var pt={},st={},Ue={},Lr=48,Fr=57;function xt(c){if(c===void 0)return"_unknown";c=c.replace(/[^a-zA-Z0-9_]/g,"$");var p=c.charCodeAt(0);return p>=Lr&&p<=Fr?"_"+c:c}function de(c,p){return c=xt(c),new Function("body","return function "+c+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(p)}function _t(c,p){var v=de(p,function(P){this.name=p,this.message=P;var w=new Error(P).stack;w!==void 0&&(this.stack=this.toString()+`
`+w.replace(/^Error(:[^\n]*)?\n/,""))});return v.prototype=Object.create(c.prototype),v.prototype.constructor=v,v.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},v}var ht=void 0;function Ee(c){throw new ht(c)}var $t=void 0;function At(c){throw new $t(c)}function s(c,p,v){c.forEach(function(O){Ue[O]=p});function P(O){var B=v(O);B.length!==c.length&&At("Mismatched type converter count");for(var G=0;G<c.length;++G)u(c[G],B[G])}var w=new Array(p.length),x=[],A=0;p.forEach((O,B)=>{st.hasOwnProperty(O)?w[B]=st[O]:(x.push(O),pt.hasOwnProperty(O)||(pt[O]=[]),pt[O].push(()=>{w[B]=st[O],++A,A===x.length&&P(w)}))}),x.length===0&&P(w)}function u(c,p,v={}){if(!("argPackAdvance"in p))throw new TypeError("registerType registeredInstance requires argPackAdvance");var P=p.name;if(c||Ee('type "'+P+'" must have a positive integer typeid pointer'),st.hasOwnProperty(c)){if(v.ignoreDuplicateRegistrations)return;Ee("Cannot register type '"+P+"' twice")}if(st[c]=p,delete Ue[c],pt.hasOwnProperty(c)){var w=pt[c];delete pt[c],w.forEach(x=>x())}}function h(c,p,v,P,w){var x=Et(v);p=We(p),u(c,{name:p,fromWireType:function(A){return!!A},toWireType:function(A,O){return O?P:w},argPackAdvance:8,readValueFromPointer:function(A){var O;if(v===1)O=Se;else if(v===2)O=Be;else if(v===4)O=j;else throw new TypeError("Unknown boolean type size: "+p);return this.fromWireType(O[A>>x])},destructorFunction:null})}function m(c){if(!(this instanceof vt)||!(c instanceof vt))return!1;for(var p=this.$$.ptrType.registeredClass,v=this.$$.ptr,P=c.$$.ptrType.registeredClass,w=c.$$.ptr;p.baseClass;)v=p.upcast(v),p=p.baseClass;for(;P.baseClass;)w=P.upcast(w),P=P.baseClass;return p===P&&v===w}function y(c){return{count:c.count,deleteScheduled:c.deleteScheduled,preservePointerOnDelete:c.preservePointerOnDelete,ptr:c.ptr,ptrType:c.ptrType,smartPtr:c.smartPtr,smartPtrType:c.smartPtrType}}function C(c){function p(v){return v.$$.ptrType.registeredClass.name}Ee(p(c)+" instance already deleted")}var T=!1;function I(c){}function F(c){c.smartPtr?c.smartPtrType.rawDestructor(c.smartPtr):c.ptrType.registeredClass.rawDestructor(c.ptr)}function N(c){c.count.value-=1;var p=c.count.value===0;p&&F(c)}function W(c,p,v){if(p===v)return c;if(v.baseClass===void 0)return null;var P=W(c,p,v.baseClass);return P===null?null:v.downcast(P)}var H={};function te(){return Object.keys(bt).length}function le(){var c=[];for(var p in bt)bt.hasOwnProperty(p)&&c.push(bt[p]);return c}var ie=[];function ge(){for(;ie.length;){var c=ie.pop();c.$$.deleteScheduled=!1,c.delete()}}var ke=void 0;function Ye(c){ke=c,ie.length&&ke&&ke(ge)}function Je(){r.getInheritedInstanceCount=te,r.getLiveInheritedInstances=le,r.flushPendingDeletes=ge,r.setDelayFunction=Ye}var bt={};function Mr(c,p){for(p===void 0&&Ee("ptr should not be undefined");c.baseClass;)p=c.upcast(p),c=c.baseClass;return p}function dt(c,p){return p=Mr(c,p),bt[p]}function jt(c,p){(!p.ptrType||!p.ptr)&&At("makeClassHandle requires ptr and ptrType");var v=!!p.smartPtrType,P=!!p.smartPtr;return v!==P&&At("Both smartPtrType and smartPtr must be specified"),p.count={value:1},Ft(Object.create(c,{$$:{value:p}}))}function vn(c){var p=this.getPointee(c);if(!p)return this.destructor(c),null;var v=dt(this.registeredClass,p);if(v!==void 0){if(v.$$.count.value===0)return v.$$.ptr=p,v.$$.smartPtr=c,v.clone();var P=v.clone();return this.destructor(c),P}function w(){return this.isSmartPointer?jt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:p,smartPtrType:this,smartPtr:c}):jt(this.registeredClass.instancePrototype,{ptrType:this,ptr:c})}var x=this.registeredClass.getActualType(p),A=H[x];if(!A)return w.call(this);var O;this.isConst?O=A.constPointerType:O=A.pointerType;var B=W(p,this.registeredClass,O.registeredClass);return B===null?w.call(this):this.isSmartPointer?jt(O.registeredClass.instancePrototype,{ptrType:O,ptr:B,smartPtrType:this,smartPtr:c}):jt(O.registeredClass.instancePrototype,{ptrType:O,ptr:B})}function Ft(c){return typeof FinalizationRegistry>"u"?(Ft=p=>p,c):(T=new FinalizationRegistry(p=>{N(p.$$)}),Ft=p=>{var v=p.$$,P=!!v.smartPtr;if(P){var w={$$:v};T.register(p,w,p)}return p},I=p=>T.unregister(p),Ft(c))}function mn(){if(this.$$.ptr||C(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var c=Ft(Object.create(Object.getPrototypeOf(this),{$$:{value:y(this.$$)}}));return c.$$.count.value+=1,c.$$.deleteScheduled=!1,c}function gn(){this.$$.ptr||C(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ee("Object already scheduled for deletion"),I(this),N(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function yn(){return!this.$$.ptr}function Pn(){return this.$$.ptr||C(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ee("Object already scheduled for deletion"),ie.push(this),ie.length===1&&ke&&ke(ge),this.$$.deleteScheduled=!0,this}function _n(){vt.prototype.isAliasOf=m,vt.prototype.clone=mn,vt.prototype.delete=gn,vt.prototype.isDeleted=yn,vt.prototype.deleteLater=Pn}function vt(){}function Br(c,p,v){if(c[p].overloadTable===void 0){var P=c[p];c[p]=function(){return c[p].overloadTable.hasOwnProperty(arguments.length)||Ee("Function '"+v+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+c[p].overloadTable+")!"),c[p].overloadTable[arguments.length].apply(this,arguments)},c[p].overloadTable=[],c[p].overloadTable[P.argCount]=P}}function Zr(c,p,v){r.hasOwnProperty(c)?(Ee("Cannot register public name '"+c+"' twice"),Br(r,c,c),r.hasOwnProperty(v)&&Ee("Cannot register multiple overloads of a function with the same number of arguments ("+v+")!"),r[c].overloadTable[v]=p):r[c]=p}function bn(c,p,v,P,w,x,A,O){this.name=c,this.constructor=p,this.instancePrototype=v,this.rawDestructor=P,this.baseClass=w,this.getActualType=x,this.upcast=A,this.downcast=O,this.pureVirtualFunctions=[]}function Rr(c,p,v){for(;p!==v;)p.upcast||Ee("Expected null or instance of "+v.name+", got an instance of "+p.name),c=p.upcast(c),p=p.baseClass;return c}function wn(c,p){if(p===null)return this.isReference&&Ee("null is not a valid "+this.name),0;p.$$||Ee('Cannot pass "'+Wr(p)+'" as a '+this.name),p.$$.ptr||Ee("Cannot pass deleted object as a pointer of type "+this.name);var v=p.$$.ptrType.registeredClass,P=Rr(p.$$.ptr,v,this.registeredClass);return P}function Sn(c,p){var v;if(p===null)return this.isReference&&Ee("null is not a valid "+this.name),this.isSmartPointer?(v=this.rawConstructor(),c!==null&&c.push(this.rawDestructor,v),v):0;p.$$||Ee('Cannot pass "'+Wr(p)+'" as a '+this.name),p.$$.ptr||Ee("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&p.$$.ptrType.isConst&&Ee("Cannot convert argument of type "+(p.$$.smartPtrType?p.$$.smartPtrType.name:p.$$.ptrType.name)+" to parameter type "+this.name);var P=p.$$.ptrType.registeredClass;if(v=Rr(p.$$.ptr,P,this.registeredClass),this.isSmartPointer)switch(p.$$.smartPtr===void 0&&Ee("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:p.$$.smartPtrType===this?v=p.$$.smartPtr:Ee("Cannot convert argument of type "+(p.$$.smartPtrType?p.$$.smartPtrType.name:p.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:v=p.$$.smartPtr;break;case 2:if(p.$$.smartPtrType===this)v=p.$$.smartPtr;else{var w=p.clone();v=this.rawShare(v,Ge.toHandle(function(){w.delete()})),c!==null&&c.push(this.rawDestructor,v)}break;default:Ee("Unsupporting sharing policy")}return v}function Cn(c,p){if(p===null)return this.isReference&&Ee("null is not a valid "+this.name),0;p.$$||Ee('Cannot pass "'+Wr(p)+'" as a '+this.name),p.$$.ptr||Ee("Cannot pass deleted object as a pointer of type "+this.name),p.$$.ptrType.isConst&&Ee("Cannot convert argument of type "+p.$$.ptrType.name+" to parameter type "+this.name);var v=p.$$.ptrType.registeredClass,P=Rr(p.$$.ptr,v,this.registeredClass);return P}function Zt(c){return this.fromWireType(be[c>>2])}function Tn(c){return this.rawGetPointee&&(c=this.rawGetPointee(c)),c}function En(c){this.rawDestructor&&this.rawDestructor(c)}function xn(c){c!==null&&c.delete()}function An(){at.prototype.getPointee=Tn,at.prototype.destructor=En,at.prototype.argPackAdvance=8,at.prototype.readValueFromPointer=Zt,at.prototype.deleteObject=xn,at.prototype.fromWireType=vn}function at(c,p,v,P,w,x,A,O,B,G,Z){this.name=c,this.registeredClass=p,this.isReference=v,this.isConst=P,this.isSmartPointer=w,this.pointeeType=x,this.sharingPolicy=A,this.rawGetPointee=O,this.rawConstructor=B,this.rawShare=G,this.rawDestructor=Z,!w&&p.baseClass===void 0?P?(this.toWireType=wn,this.destructorFunction=null):(this.toWireType=Cn,this.destructorFunction=null):this.toWireType=Sn}function On(c,p,v){r.hasOwnProperty(c)||At("Replacing nonexistant public symbol"),r[c].overloadTable!==void 0&&v!==void 0?r[c].overloadTable[v]=p:(r[c]=p,r[c].argCount=v)}function kn(c,p,v){var P=r["dynCall_"+c];return v&&v.length?P.apply(null,[p].concat(v)):P.call(null,p)}function In(c,p,v){return c.includes("j")?kn(c,p,v):Tt(p).apply(null,v)}function Dn(c,p){var v=[];return function(){return v.length=0,Object.assign(v,arguments),In(c,p,v)}}function wt(c,p){c=We(c);function v(){return c.includes("j")?Dn(c,p):Tt(p)}var P=v();return typeof P!="function"&&Ee("unknown function pointer with signature "+c+": "+p),P}var Jr=void 0;function Kr(c){var p=fn(c),v=We(p);return ct(p),v}function Jt(c,p){var v=[],P={};function w(x){if(!P[x]&&!st[x]){if(Ue[x]){Ue[x].forEach(w);return}v.push(x),P[x]=!0}}throw p.forEach(w),new Jr(c+": "+v.map(Kr).join([", "]))}function Ln(c,p,v,P,w,x,A,O,B,G,Z,J,V){Z=We(Z),x=wt(w,x),O&&(O=wt(A,O)),G&&(G=wt(B,G)),V=wt(J,V);var K=xt(Z);Zr(K,function(){Jt("Cannot construct "+Z+" due to unbound types",[P])}),s([c,p,v],P?[P]:[],function(oe){oe=oe[0];var xe,Le;P?(xe=oe.registeredClass,Le=xe.instancePrototype):Le=vt.prototype;var Fe=de(K,function(){if(Object.getPrototypeOf(this)!==Y)throw new ht("Use 'new' to construct "+Z);if(ne.constructor_body===void 0)throw new ht(Z+" has no accessible constructor");var Me=ne.constructor_body[arguments.length];if(Me===void 0)throw new ht("Tried to invoke ctor of "+Z+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(ne.constructor_body).toString()+") parameters instead!");return Me.apply(this,arguments)}),Y=Object.create(Le,{constructor:{value:Fe}});Fe.prototype=Y;var ne=new bn(Z,Fe,Y,V,xe,x,O,G),Xe=new at(Z,ne,!0,!1,!1),Oe=new at(Z+"*",ne,!1,!1,!1),je=new at(Z+" const*",ne,!1,!0,!1);return H[c]={pointerType:Oe,constPointerType:je},On(K,Fe),[Xe,Oe,je]})}function Qr(c,p){if(!(c instanceof Function))throw new TypeError("new_ called with constructor type "+typeof c+" which is not a function");var v=de(c.name||"unknownFunctionName",function(){});v.prototype=c.prototype;var P=new v,w=c.apply(P,p);return w instanceof Object?w:P}function en(c){for(;c.length;){var p=c.pop(),v=c.pop();v(p)}}function Nr(c,p,v,P,w){var x=p.length;x<2&&Ee("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var A=p[1]!==null&&v!==null,O=!1,B=1;B<p.length;++B)if(p[B]!==null&&p[B].destructorFunction===void 0){O=!0;break}for(var G=p[0].name!=="void",Z="",J="",B=0;B<x-2;++B)Z+=(B!==0?", ":"")+"arg"+B,J+=(B!==0?", ":"")+"arg"+B+"Wired";var V="return function "+xt(c)+"("+Z+`) {
if (arguments.length !== `+(x-2)+`) {
throwBindingError('function `+c+" called with ' + arguments.length + ' arguments, expected "+(x-2)+` args!');
}
`;O&&(V+=`var destructors = [];
`);var K=O?"destructors":"null",oe=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],xe=[Ee,P,w,en,p[0],p[1]];A&&(V+="var thisWired = classParam.toWireType("+K+`, this);
`);for(var B=0;B<x-2;++B)V+="var arg"+B+"Wired = argType"+B+".toWireType("+K+", arg"+B+"); // "+p[B+2].name+`
`,oe.push("argType"+B),xe.push(p[B+2]);if(A&&(J="thisWired"+(J.length>0?", ":"")+J),V+=(G?"var rv = ":"")+"invoker(fn"+(J.length>0?", ":"")+J+`);
`,O)V+=`runDestructors(destructors);
`;else for(var B=A?1:2;B<p.length;++B){var Le=B===1?"thisWired":"arg"+(B-2)+"Wired";p[B].destructorFunction!==null&&(V+=Le+"_dtor("+Le+"); // "+p[B].name+`
`,oe.push(Le+"_dtor"),xe.push(p[B].destructorFunction))}G&&(V+=`var ret = retType.fromWireType(rv);
return ret;
`),V+=`}
`,oe.push(V);var Fe=Qr(Function,oe).apply(null,xe);return Fe}function Ur(c,p){for(var v=[],P=0;P<c;P++)v.push(j[(p>>2)+P]);return v}function Fn(c,p,v,P,w,x,A){var O=Ur(v,P);p=We(p),x=wt(w,x),s([],[c],function(B){B=B[0];var G=B.name+"."+p;function Z(){Jt("Cannot call "+G+" due to unbound types",O)}p.startsWith("@@")&&(p=Symbol[p.substring(2)]);var J=B.registeredClass.constructor;return J[p]===void 0?(Z.argCount=v-1,J[p]=Z):(Br(J,p,G),J[p].overloadTable[v-1]=Z),s([],O,function(V){var K=[V[0],null].concat(V.slice(1)),oe=Nr(G,K,null,x,A);return J[p].overloadTable===void 0?(oe.argCount=v-1,J[p]=oe):J[p].overloadTable[v-1]=oe,[]}),[]})}function Mn(c,p,v,P,w,x){ce(p>0);var A=Ur(p,v);w=wt(P,w),s([],[c],function(O){O=O[0];var B="constructor "+O.name;if(O.registeredClass.constructor_body===void 0&&(O.registeredClass.constructor_body=[]),O.registeredClass.constructor_body[p-1]!==void 0)throw new ht("Cannot register multiple constructors with identical number of parameters ("+(p-1)+") for class '"+O.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return O.registeredClass.constructor_body[p-1]=()=>{Jt("Cannot construct "+O.name+" due to unbound types",A)},s([],A,function(G){return G.splice(1,0,null),O.registeredClass.constructor_body[p-1]=Nr(B,G,null,w,x),[]}),[]})}function Bn(c,p,v,P,w,x,A,O){var B=Ur(v,P);p=We(p),x=wt(w,x),s([],[c],function(G){G=G[0];var Z=G.name+"."+p;p.startsWith("@@")&&(p=Symbol[p.substring(2)]),O&&G.registeredClass.pureVirtualFunctions.push(p);function J(){Jt("Cannot call "+Z+" due to unbound types",B)}var V=G.registeredClass.instancePrototype,K=V[p];return K===void 0||K.overloadTable===void 0&&K.className!==G.name&&K.argCount===v-2?(J.argCount=v-2,J.className=G.name,V[p]=J):(Br(V,p,Z),V[p].overloadTable[v-2]=J),s([],B,function(oe){var xe=Nr(Z,oe,G,x,A);return V[p].overloadTable===void 0?(xe.argCount=v-2,V[p]=xe):V[p].overloadTable[v-2]=xe,[]}),[]})}var Gr=[],tt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Xr(c){c>4&&--tt[c].refcount===0&&(tt[c]=void 0,Gr.push(c))}function Rn(){for(var c=0,p=5;p<tt.length;++p)tt[p]!==void 0&&++c;return c}function Nn(){for(var c=5;c<tt.length;++c)if(tt[c]!==void 0)return tt[c];return null}function Un(){r.count_emval_handles=Rn,r.get_first_emval=Nn}var Ge={toValue:c=>(c||Ee("Cannot use deleted val. handle = "+c),tt[c].value),toHandle:c=>{switch(c){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var p=Gr.length?Gr.pop():tt.length;return tt[p]={refcount:1,value:c},p}}}};function Gn(c,p){p=We(p),u(c,{name:p,fromWireType:function(v){var P=Ge.toValue(v);return Xr(v),P},toWireType:function(v,P){return Ge.toHandle(P)},argPackAdvance:8,readValueFromPointer:Zt,destructorFunction:null})}function Xn(c,p,v){switch(p){case 0:return function(P){var w=v?Se:_e;return this.fromWireType(w[P])};case 1:return function(P){var w=v?Be:rt;return this.fromWireType(w[P>>1])};case 2:return function(P){var w=v?j:be;return this.fromWireType(w[P>>2])};default:throw new TypeError("Unknown integer type: "+c)}}function Wn(c,p,v,P){var w=Et(v);p=We(p);function x(){}x.values={},u(c,{name:p,constructor:x,fromWireType:function(A){return this.constructor.values[A]},toWireType:function(A,O){return O.value},argPackAdvance:8,readValueFromPointer:Xn(p,w,P),destructorFunction:null}),Zr(p,x)}function Kt(c,p){var v=st[c];return v===void 0&&Ee(p+" has unknown type "+Kr(c)),v}function Yn(c,p,v){var P=Kt(c,"enum");p=We(p);var w=P.constructor,x=Object.create(P.constructor.prototype,{value:{value:v},constructor:{value:de(P.name+"_"+p,function(){})}});w.values[v]=x,w[p]=x}function Wr(c){if(c===null)return"null";var p=typeof c;return p==="object"||p==="array"||p==="function"?c.toString():""+c}function Vn(c,p){switch(p){case 2:return function(v){return this.fromWireType(Ze[v>>2])};case 3:return function(v){return this.fromWireType(Rt[v>>3])};default:throw new TypeError("Unknown float type: "+c)}}function Hn(c,p,v){var P=Et(v);p=We(p),u(c,{name:p,fromWireType:function(w){return w},toWireType:function(w,x){return x},argPackAdvance:8,readValueFromPointer:Vn(p,P),destructorFunction:null})}function zn(c,p,v){switch(p){case 0:return v?function(w){return Se[w]}:function(w){return _e[w]};case 1:return v?function(w){return Be[w>>1]}:function(w){return rt[w>>1]};case 2:return v?function(w){return j[w>>2]}:function(w){return be[w>>2]};default:throw new TypeError("Unknown integer type: "+c)}}function qn(c,p,v,P,w){p=We(p);var x=Et(v),A=J=>J;if(P===0){var O=32-8*v;A=J=>J<<O>>>O}var B=p.includes("unsigned"),G=(J,V)=>{},Z;B?Z=function(J,V){return G(V,this.name),V>>>0}:Z=function(J,V){return G(V,this.name),V},u(c,{name:p,fromWireType:A,toWireType:Z,argPackAdvance:8,readValueFromPointer:zn(p,x,P!==0),destructorFunction:null})}function $n(c,p,v){var P=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],w=P[p];function x(A){A=A>>2;var O=be,B=O[A],G=O[A+1];return new w(He,G,B)}v=We(v),u(c,{name:v,fromWireType:x,argPackAdvance:8,readValueFromPointer:x},{ignoreDuplicateRegistrations:!0})}function jn(c,p){p=We(p);var v=p==="std::string";u(c,{name:p,fromWireType:function(P){var w=be[P>>2],x;if(v)for(var A=P+4,O=0;O<=w;++O){var B=P+4+O;if(O==w||_e[B]==0){var G=B-A,Z=ue(A,G);x===void 0?x=Z:(x+="\0",x+=Z),A=B+1}}else{for(var J=new Array(w),O=0;O<w;++O)J[O]=String.fromCharCode(_e[P+4+O]);x=J.join("")}return ct(P),x},toWireType:function(P,w){w instanceof ArrayBuffer&&(w=new Uint8Array(w));var x,A=typeof w=="string";A||w instanceof Uint8Array||w instanceof Uint8ClampedArray||w instanceof Int8Array||Ee("Cannot pass non-string to std::string"),v&&A?x=()=>re(w):x=()=>w.length;var O=x(),B=ut(4+O+1);if(be[B>>2]=O,v&&A)Q(w,B+4,O+1);else if(A)for(var G=0;G<O;++G){var Z=w.charCodeAt(G);Z>255&&(ct(B),Ee("String has UTF-16 code units that do not fit in 8 bits")),_e[B+4+G]=Z}else for(var G=0;G<O;++G)_e[B+4+G]=w[G];return P!==null&&P.push(ct,B),B},argPackAdvance:8,readValueFromPointer:Zt,destructorFunction:function(P){ct(P)}})}function Zn(c,p,v){v=We(v);var P,w,x,A,O;p===2?(P=me,w=ae,A=fe,x=()=>rt,O=1):p===4&&(P=Ae,w=De,A=Re,x=()=>be,O=2),u(c,{name:v,fromWireType:function(B){for(var G=be[B>>2],Z=x(),J,V=B+4,K=0;K<=G;++K){var oe=B+4+K*p;if(K==G||Z[oe>>O]==0){var xe=oe-V,Le=P(V,xe);J===void 0?J=Le:(J+="\0",J+=Le),V=oe+p}}return ct(B),J},toWireType:function(B,G){typeof G!="string"&&Ee("Cannot pass non-string to C++ string type "+v);var Z=A(G),J=ut(4+Z+p);return be[J>>2]=Z>>O,w(G,J+4,Z+p),B!==null&&B.push(ct,J),J},argPackAdvance:8,readValueFromPointer:Zt,destructorFunction:function(B){ct(B)}})}function Jn(c,p){p=We(p),u(c,{isVoid:!0,name:p,argPackAdvance:0,fromWireType:function(){},toWireType:function(v,P){}})}function Kn(){return Date.now()}var Qn=!0;function ei(){return Qn}function ti(c,p,v){c=Ge.toValue(c),p=Kt(p,"emval::as");var P=[],w=Ge.toHandle(P);return j[v>>2]=w,p.toWireType(P,c)}function ri(c){var p=[];return j[c>>2]=Ge.toHandle(p),p}var ni={};function Yr(c){var p=ni[c];return p===void 0?We(c):p}var Vr=[];function ii(c,p,v,P,w){return c=Vr[c],p=Ge.toValue(p),v=Yr(v),c(p,v,ri(P),w)}function tn(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function oi(c){return c===0?Ge.toHandle(tn()):(c=Yr(c),Ge.toHandle(tn()[c]))}function si(c){var p=Vr.length;return Vr.push(c),p}function ai(c,p){for(var v=new Array(c),P=0;P<c;++P)v[P]=Kt(be[p+P*se>>2],"parameter "+P);return v}var rn=[];function li(c,p){var v=ai(c,p),P=v[0],w=P.name+"_$"+v.slice(1).map(function(oe){return oe.name}).join("_")+"$",x=rn[w];if(x!==void 0)return x;for(var A=["retType"],O=[P],B="",G=0;G<c-1;++G)B+=(G!==0?", ":"")+"arg"+G,A.push("argType"+G),O.push(v[1+G]);for(var Z=xt("methodCaller_"+w),J="return function "+Z+`(handle, name, destructors, args) {
`,V=0,G=0;G<c-1;++G)J+="    var arg"+G+" = argType"+G+".readValueFromPointer(args"+(V?"+"+V:"")+`);
`,V+=v[G+1].argPackAdvance;J+="    var rv = handle[name]("+B+`);
`;for(var G=0;G<c-1;++G)v[G+1].deleteObject&&(J+="    argType"+G+".deleteObject(arg"+G+`);
`);P.isVoid||(J+=`    return retType.toWireType(destructors, rv);
`),J+=`};
`,A.push(J);var K=Qr(Function,A).apply(null,O);return x=si(K),rn[w]=x,x}function ui(c,p){return c=Ge.toValue(c),p=Ge.toValue(p),Ge.toHandle(c[p])}function ci(c){c>4&&(tt[c].refcount+=1)}function fi(c){return Ge.toHandle(Yr(c))}function pi(c){var p=Ge.toValue(c);en(p),Xr(c)}function hi(c,p,v){c=Ge.toValue(c),p=Ge.toValue(p),v=Ge.toValue(v),c[p]=v}function di(c,p){c=Kt(c,"_emval_take_value");var v=c.readValueFromPointer(p);return Ge.toHandle(v)}function vi(c){return c=Ge.toValue(c),Ge.toHandle(typeof c)}function mi(c,p){var v=new Date(j[c>>2]*1e3);j[p>>2]=v.getSeconds(),j[p+4>>2]=v.getMinutes(),j[p+8>>2]=v.getHours(),j[p+12>>2]=v.getDate(),j[p+16>>2]=v.getMonth(),j[p+20>>2]=v.getFullYear()-1900,j[p+24>>2]=v.getDay();var P=new Date(v.getFullYear(),0,1),w=(v.getTime()-P.getTime())/(1e3*60*60*24)|0;j[p+28>>2]=w,j[p+36>>2]=-(v.getTimezoneOffset()*60);var x=new Date(v.getFullYear(),6,1).getTimezoneOffset(),A=P.getTimezoneOffset(),O=(x!=A&&v.getTimezoneOffset()==Math.min(A,x))|0;j[p+32>>2]=O}function gi(c,p,v,P,w,x){try{var A=S.getStream(w);A&&(v&2&&Te.doMsync(c,A,p,P,x),S.munmap(A))}catch(O){if(typeof S>"u"||!(O instanceof S.ErrnoError))throw O;return-O.errno}}function yi(c,p,v){var P=new Date().getFullYear(),w=new Date(P,0,1),x=new Date(P,6,1),A=w.getTimezoneOffset(),O=x.getTimezoneOffset(),B=Math.max(A,O);j[c>>2]=B*60,j[p>>2]=+(A!=O);function G(oe){var xe=oe.toTimeString().match(/\(([A-Za-z ]+)\)$/);return xe?xe[1]:"GMT"}var Z=G(w),J=G(x),V=qe(Z),K=qe(J);O<A?(be[v>>2]=V,be[v+4>>2]=K):(be[v>>2]=K,be[v+4>>2]=V)}function Hr(c,p,v){Hr.called||(Hr.called=!0,yi(c,p,v))}function Pi(){nt("")}function nn(){return 2147483648}function _i(){return nn()}function bi(c,p,v){_e.copyWithin(c,p,p+v)}function wi(c){try{return ee.grow(c-He.byteLength+65535>>>16),Nt(ee.buffer),1}catch{}}function Si(c){var p=_e.length;c=c>>>0;var v=nn();if(c>v)return!1;let P=(B,G)=>B+(G-B%G)%G;for(var w=1;w<=4;w*=2){var x=p*(1+.2/w);x=Math.min(x,c+100663296);var A=Math.min(v,P(Math.max(c,x),65536)),O=wi(A);if(O)return!0}return!1}var zr={};function Ci(){return a||"./this.program"}function Mt(){if(!Mt.strings){var c=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",p={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:c,_:Ci()};for(var v in zr)zr[v]===void 0?delete p[v]:p[v]=zr[v];var P=[];for(var v in p)P.push(v+"="+p[v]);Mt.strings=P}return Mt.strings}function Ti(c,p){var v=0;return Mt().forEach(function(P,w){var x=p+v;be[c+w*4>>2]=x,$e(P,x),v+=P.length+1}),0}function Ei(c,p){var v=Mt();be[c>>2]=v.length;var P=0;return v.forEach(function(w){P+=w.length+1}),be[p>>2]=P,0}function xi(c){so(c)}function Ai(c){try{var p=Te.getStreamFromFD(c);return S.close(p),0}catch(v){if(typeof S>"u"||!(v instanceof S.ErrnoError))throw v;return v.errno}}function Oi(c,p,v,P){for(var w=0,x=0;x<v;x++){var A=be[p>>2],O=be[p+4>>2];p+=8;var B=S.read(c,Se,A,O,P);if(B<0)return-1;if(w+=B,B<O)break}return w}function ki(c,p,v,P){try{var w=Te.getStreamFromFD(c),x=Oi(w,p,v);return j[P>>2]=x,0}catch(A){if(typeof S>"u"||!(A instanceof S.ErrnoError))throw A;return A.errno}}function Ii(c,p){return p+2097152>>>0<4194305-!!c?(c>>>0)+p*4294967296:NaN}function Di(c,p,v,P,w){try{var x=Ii(p,v);if(isNaN(x))return 61;var A=Te.getStreamFromFD(c);return S.llseek(A,x,P),Qe=[A.position>>>0,(Ne=A.position,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],j[w>>2]=Qe[0],j[w+4>>2]=Qe[1],A.getdents&&x===0&&P===0&&(A.getdents=null),0}catch(O){if(typeof S>"u"||!(O instanceof S.ErrnoError))throw O;return O.errno}}function Li(c,p,v,P){for(var w=0,x=0;x<v;x++){var A=be[p>>2],O=be[p+4>>2];p+=8;var B=S.write(c,Se,A,O,P);if(B<0)return-1;w+=B}return w}function Fi(c,p,v,P){try{var w=Te.getStreamFromFD(c),x=Li(w,p,v);return be[P>>2]=x,0}catch(A){if(typeof S>"u"||!(A instanceof S.ErrnoError))throw A;return A.errno}}function on(c){for(var p=c.split("."),v=0;v<4;v++){var P=Number(p[v]);if(isNaN(P))return null;p[v]=P}return(p[0]|p[1]<<8|p[2]<<16|p[3]<<24)>>>0}function Bt(c){return parseInt(c)}function Mi(c){var p,v,P,w,x=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,A=[];if(!x.test(c))return null;if(c==="::")return[0,0,0,0,0,0,0,0];for(c.startsWith("::")?c=c.replace("::","Z:"):c=c.replace("::",":Z:"),c.indexOf(".")>0?(c=c.replace(new RegExp("[.]","g"),":"),p=c.split(":"),p[p.length-4]=Bt(p[p.length-4])+Bt(p[p.length-3])*256,p[p.length-3]=Bt(p[p.length-2])+Bt(p[p.length-1])*256,p=p.slice(0,p.length-2)):p=c.split(":"),P=0,w=0,v=0;v<p.length;v++)if(typeof p[v]=="string")if(p[v]==="Z"){for(w=0;w<8-p.length+1;w++)A[v+w]=0;P=w-1}else A[v+P]=pn(parseInt(p[v],16));else A[v+P]=p[v];return[A[1]<<16|A[0],A[3]<<16|A[2],A[5]<<16|A[4],A[7]<<16|A[6]]}var mt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(c){var p=on(c);if(p!==null||(p=Mi(c),p!==null))return c;var v;if(mt.address_map.addrs[c])v=mt.address_map.addrs[c];else{var P=mt.address_map.id++;ce(P<65535,"exceeded max address mappings of 65535"),v="172.29."+(P&255)+"."+(P&65280),mt.address_map.names[v]=c,mt.address_map.addrs[c]=v}return v},lookup_addr:function(c){return mt.address_map.names[c]?mt.address_map.names[c]:null}};function Bi(c){var p=ut(20),v=ut(c.length+1);Q(c,v,c.length+1),be[p>>2]=v;var P=ut(4);be[P>>2]=0,be[p+4>>2]=P;var w=2;j[p+8>>2]=w,j[p+12>>2]=4;var x=ut(12);return be[x>>2]=x+8,be[x+4>>2]=0,j[x+8>>2]=on(mt.lookup_name(c)),be[p+16>>2]=x,p}function Ri(c){return Bi(ue(c))}function Ni(c){var p=c.getExtension("ANGLE_instanced_arrays");if(p)return c.vertexAttribDivisor=function(v,P){p.vertexAttribDivisorANGLE(v,P)},c.drawArraysInstanced=function(v,P,w,x){p.drawArraysInstancedANGLE(v,P,w,x)},c.drawElementsInstanced=function(v,P,w,x,A){p.drawElementsInstancedANGLE(v,P,w,x,A)},1}function Ui(c){var p=c.getExtension("OES_vertex_array_object");if(p)return c.createVertexArray=function(){return p.createVertexArrayOES()},c.deleteVertexArray=function(v){p.deleteVertexArrayOES(v)},c.bindVertexArray=function(v){p.bindVertexArrayOES(v)},c.isVertexArray=function(v){return p.isVertexArrayOES(v)},1}function Gi(c){var p=c.getExtension("WEBGL_draw_buffers");if(p)return c.drawBuffers=function(v,P){p.drawBuffersWEBGL(v,P)},1}function Xi(c){return!!(c.multiDrawWebgl=c.getExtension("WEBGL_multi_draw"))}var Ie={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(p){Ie.lastError||(Ie.lastError=p)},getNewId:function(c){for(var p=Ie.counter++,v=c.length;v<p;v++)c[v]=null;return p},getSource:function(c,p,v,P){for(var w="",x=0;x<p;++x){var A=P?j[P+x*4>>2]:-1;w+=ue(j[v+x*4>>2],A<0?void 0:A)}return w},createContext:function(c,p){if(!c.getContextSafariWebGL2Fixed){let w=function(x,A){var O=c.getContextSafariWebGL2Fixed(x,A);return x=="webgl"==O instanceof WebGLRenderingContext?O:null};c.getContextSafariWebGL2Fixed=c.getContext,c.getContext=w}var v=c.getContext("webgl",p);if(!v)return 0;var P=Ie.registerContext(v,p);return P},registerContext:function(c,p){var v=Ie.getNewId(Ie.contexts),P={handle:v,attributes:p,version:p.majorVersion,GLctx:c};return c.canvas&&(c.canvas.GLctxObject=P),Ie.contexts[v]=P,(typeof p.enableExtensionsByDefault>"u"||p.enableExtensionsByDefault)&&Ie.initExtensions(P),v},makeContextCurrent:function(c){return Ie.currentContext=Ie.contexts[c],r.ctx=ze=Ie.currentContext&&Ie.currentContext.GLctx,!(c&&!ze)},getContext:function(c){return Ie.contexts[c]},deleteContext:function(c){Ie.currentContext===Ie.contexts[c]&&(Ie.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(Ie.contexts[c].GLctx.canvas),Ie.contexts[c]&&Ie.contexts[c].GLctx.canvas&&(Ie.contexts[c].GLctx.canvas.GLctxObject=void 0),Ie.contexts[c]=null},initExtensions:function(c){if(c||(c=Ie.currentContext),!c.initExtensionsDone){c.initExtensionsDone=!0;var p=c.GLctx;Ni(p),Ui(p),Gi(p),p.disjointTimerQueryExt=p.getExtension("EXT_disjoint_timer_query"),Xi(p);var v=p.getSupportedExtensions()||[];v.forEach(function(P){!P.includes("lose_context")&&!P.includes("debug")&&p.getExtension(P)})}}};function sn(c){return c.slice(-1)=="]"&&c.lastIndexOf("[")}function Wi(c){var p=c.uniformLocsById,v=c.uniformSizeAndIdsByName,P,w;if(!p)for(c.uniformLocsById=p={},c.uniformArrayNamesById={},P=0;P<ze.getProgramParameter(c,35718);++P){var x=ze.getActiveUniform(c,P),A=x.name,O=x.size,B=sn(A),G=B>0?A.slice(0,B):A,Z=c.uniformIdCounter;for(c.uniformIdCounter+=O,v[G]=[O,Z],w=0;w<O;++w)p[Z]=w,c.uniformArrayNamesById[Z++]=G}}function Yi(c,p){if(p=ue(p),c=Ie.programs[c]){Wi(c);var v=c.uniformLocsById,P=0,w=p,x=sn(p);x>0&&(P=Bt(p.slice(x+1))>>>0,w=p.slice(0,x));var A=c.uniformSizeAndIdsByName[w];if(A&&P<A[0]&&(P+=A[1],v[P]=v[P]||ze.getUniformLocation(c,p)))return P}else Ie.recordError(1281);return-1}function gt(c){var p=ze.currentProgram;if(p){var v=p.uniformLocsById[c];return typeof v=="number"&&(p.uniformLocsById[c]=v=ze.getUniformLocation(p,p.uniformArrayNamesById[c]+(v>0?"["+v+"]":""))),v}else Ie.recordError(1282)}function Vi(c,p){ze.uniform1f(gt(c),p)}function Hi(c,p){ze.uniform1i(gt(c),p)}var Qt=[];function zi(c,p,v){if(p<=144)for(var P=Qt[2*p-1],w=0;w<2*p;w+=2)P[w]=Ze[v+4*w>>2],P[w+1]=Ze[v+(4*w+4)>>2];else var P=Ze.subarray(v>>2,v+p*8>>2);ze.uniform2fv(gt(c),P)}var er=[];function qi(c,p,v){if(p<=144)for(var P=er[2*p-1],w=0;w<2*p;w+=2)P[w]=j[v+4*w>>2],P[w+1]=j[v+(4*w+4)>>2];else var P=j.subarray(v>>2,v+p*8>>2);ze.uniform2iv(gt(c),P)}function $i(c,p,v){if(p<=96)for(var P=Qt[3*p-1],w=0;w<3*p;w+=3)P[w]=Ze[v+4*w>>2],P[w+1]=Ze[v+(4*w+4)>>2],P[w+2]=Ze[v+(4*w+8)>>2];else var P=Ze.subarray(v>>2,v+p*12>>2);ze.uniform3fv(gt(c),P)}function ji(c,p,v){if(p<=96)for(var P=er[3*p-1],w=0;w<3*p;w+=3)P[w]=j[v+4*w>>2],P[w+1]=j[v+(4*w+4)>>2],P[w+2]=j[v+(4*w+8)>>2];else var P=j.subarray(v>>2,v+p*12>>2);ze.uniform3iv(gt(c),P)}function Zi(c,p,v){if(p<=72){var P=Qt[4*p-1],w=Ze;v>>=2;for(var x=0;x<4*p;x+=4){var A=v+x;P[x]=w[A],P[x+1]=w[A+1],P[x+2]=w[A+2],P[x+3]=w[A+3]}}else var P=Ze.subarray(v>>2,v+p*16>>2);ze.uniform4fv(gt(c),P)}function Ji(c,p,v){if(p<=72)for(var P=er[4*p-1],w=0;w<4*p;w+=4)P[w]=j[v+4*w>>2],P[w+1]=j[v+(4*w+4)>>2],P[w+2]=j[v+(4*w+8)>>2],P[w+3]=j[v+(4*w+12)>>2];else var P=j.subarray(v>>2,v+p*16>>2);ze.uniform4iv(gt(c),P)}function Ki(c){}function tr(c){return c%4===0&&(c%100!==0||c%400===0)}function Qi(c,p){for(var v=0,P=0;P<=p;v+=c[P++]);return v}var an=[31,29,31,30,31,30,31,31,30,31,30,31],ln=[31,28,31,30,31,30,31,31,30,31,30,31];function eo(c,p){for(var v=new Date(c.getTime());p>0;){var P=tr(v.getFullYear()),w=v.getMonth(),x=(P?an:ln)[w];if(p>x-v.getDate())p-=x-v.getDate()+1,v.setDate(1),w<11?v.setMonth(w+1):(v.setMonth(0),v.setFullYear(v.getFullYear()+1));else return v.setDate(v.getDate()+p),v}return v}function to(c,p,v,P){var w=j[P+40>>2],x={tm_sec:j[P>>2],tm_min:j[P+4>>2],tm_hour:j[P+8>>2],tm_mday:j[P+12>>2],tm_mon:j[P+16>>2],tm_year:j[P+20>>2],tm_wday:j[P+24>>2],tm_yday:j[P+28>>2],tm_isdst:j[P+32>>2],tm_gmtoff:j[P+36>>2],tm_zone:w?ue(w):""},A=ue(v),O={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var B in O)A=A.replace(new RegExp(B,"g"),O[B]);var G=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Z=["January","February","March","April","May","June","July","August","September","October","November","December"];function J(Y,ne,Xe){for(var Oe=typeof Y=="number"?Y.toString():Y||"";Oe.length<ne;)Oe=Xe[0]+Oe;return Oe}function V(Y,ne){return J(Y,ne,"0")}function K(Y,ne){function Xe(je){return je<0?-1:je>0?1:0}var Oe;return(Oe=Xe(Y.getFullYear()-ne.getFullYear()))===0&&(Oe=Xe(Y.getMonth()-ne.getMonth()))===0&&(Oe=Xe(Y.getDate()-ne.getDate())),Oe}function oe(Y){switch(Y.getDay()){case 0:return new Date(Y.getFullYear()-1,11,29);case 1:return Y;case 2:return new Date(Y.getFullYear(),0,3);case 3:return new Date(Y.getFullYear(),0,2);case 4:return new Date(Y.getFullYear(),0,1);case 5:return new Date(Y.getFullYear()-1,11,31);case 6:return new Date(Y.getFullYear()-1,11,30)}}function xe(Y){var ne=eo(new Date(Y.tm_year+1900,0,1),Y.tm_yday),Xe=new Date(ne.getFullYear(),0,4),Oe=new Date(ne.getFullYear()+1,0,4),je=oe(Xe),Me=oe(Oe);return K(je,ne)<=0?K(Me,ne)<=0?ne.getFullYear()+1:ne.getFullYear():ne.getFullYear()-1}var Le={"%a":function(Y){return G[Y.tm_wday].substring(0,3)},"%A":function(Y){return G[Y.tm_wday]},"%b":function(Y){return Z[Y.tm_mon].substring(0,3)},"%B":function(Y){return Z[Y.tm_mon]},"%C":function(Y){var ne=Y.tm_year+1900;return V(ne/100|0,2)},"%d":function(Y){return V(Y.tm_mday,2)},"%e":function(Y){return J(Y.tm_mday,2," ")},"%g":function(Y){return xe(Y).toString().substring(2)},"%G":function(Y){return xe(Y)},"%H":function(Y){return V(Y.tm_hour,2)},"%I":function(Y){var ne=Y.tm_hour;return ne==0?ne=12:ne>12&&(ne-=12),V(ne,2)},"%j":function(Y){return V(Y.tm_mday+Qi(tr(Y.tm_year+1900)?an:ln,Y.tm_mon-1),3)},"%m":function(Y){return V(Y.tm_mon+1,2)},"%M":function(Y){return V(Y.tm_min,2)},"%n":function(){return`
`},"%p":function(Y){return Y.tm_hour>=0&&Y.tm_hour<12?"AM":"PM"},"%S":function(Y){return V(Y.tm_sec,2)},"%t":function(){return"	"},"%u":function(Y){return Y.tm_wday||7},"%U":function(Y){var ne=Y.tm_yday+7-Y.tm_wday;return V(Math.floor(ne/7),2)},"%V":function(Y){var ne=Math.floor((Y.tm_yday+7-(Y.tm_wday+6)%7)/7);if((Y.tm_wday+371-Y.tm_yday-2)%7<=2&&ne++,ne){if(ne==53){var Oe=(Y.tm_wday+371-Y.tm_yday)%7;Oe!=4&&(Oe!=3||!tr(Y.tm_year))&&(ne=1)}}else{ne=52;var Xe=(Y.tm_wday+7-Y.tm_yday-1)%7;(Xe==4||Xe==5&&tr(Y.tm_year%400-1))&&ne++}return V(ne,2)},"%w":function(Y){return Y.tm_wday},"%W":function(Y){var ne=Y.tm_yday+7-(Y.tm_wday+6)%7;return V(Math.floor(ne/7),2)},"%y":function(Y){return(Y.tm_year+1900).toString().substring(2)},"%Y":function(Y){return Y.tm_year+1900},"%z":function(Y){var ne=Y.tm_gmtoff,Xe=ne>=0;return ne=Math.abs(ne)/60,ne=ne/60*100+ne%60,(Xe?"+":"-")+("0000"+ne).slice(-4)},"%Z":function(Y){return Y.tm_zone},"%%":function(){return"%"}};A=A.replace(/%%/g,"\0\0");for(var B in Le)A.includes(B)&&(A=A.replace(new RegExp(B,"g"),Le[B](x)));A=A.replace(/\0\0/g,"%");var Fe=or(A,!1);return Fe.length>p?0:(Ke(Fe,c),Fe.length-1)}function ro(c,p,v,P){return to(c,p,v,P)}var un=function(c,p,v,P){c||(c=this),this.parent=c,this.mount=c.mount,this.mounted=null,this.id=S.nextInode++,this.name=p,this.mode=v,this.node_ops={},this.stream_ops={},this.rdev=P},rr=365,nr=146;Object.defineProperties(un.prototype,{read:{get:function(){return(this.mode&rr)===rr},set:function(c){c?this.mode|=rr:this.mode&=~rr}},write:{get:function(){return(this.mode&nr)===nr},set:function(c){c?this.mode|=nr:this.mode&=~nr}},isFolder:{get:function(){return S.isDir(this.mode)}},isDevice:{get:function(){return S.isChrdev(this.mode)}}}),S.FSNode=un,S.staticInit(),Dr(),ht=r.BindingError=_t(Error,"BindingError"),$t=r.InternalError=_t(Error,"InternalError"),_n(),Je(),An(),Jr=r.UnboundTypeError=_t(Error,"UnboundTypeError"),Un();for(var ze,no=new Float32Array(288),lt=0;lt<288;++lt)Qt[lt]=no.subarray(0,lt+1);for(var io=new Int32Array(288),lt=0;lt<288;++lt)er[lt]=io.subarray(0,lt+1);function or(c,p,v){var P=re(c)+1,w=new Array(P),x=pe(c,w,0,w.length);return p&&(w.length=x),w}var oo={_:vr,k:mr,a:gr,b:Pr,S:Pt,T:zt,p:Tr,M:Er,V:xr,J:Ar,K:ft,t:Or,L:kr,B:Ir,X:h,d:Ln,f:Fn,e:Mn,c:Bn,W:Gn,i:Wn,h:Yn,w:Hn,j:qn,g:$n,v:jn,q:Zn,Y:Jn,P:Kn,O:ei,m:ti,la:ii,y:Xr,ma:oi,ka:li,r:ui,z:ci,ja:fi,na:pi,n:hi,l:di,x:vi,Q:mi,G:gi,R:Hr,s:Pi,F:_i,N:bi,E:Si,H:Ti,I:Ei,$:xi,o:Ai,U:ki,A:Di,u:Fi,Z:Ri,ia:Yi,ga:Vi,ha:Hi,ca:zi,fa:qi,ba:$i,ea:ji,aa:Zi,da:Ji,C:Ki,D:ro};dr(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var ut=r._malloc=function(){return(ut=r._malloc=r.asm.qa).apply(null,arguments)},ct=r._free=function(){return(ct=r._free=r.asm.ra).apply(null,arguments)},cn=r.___errno_location=function(){return(cn=r.___errno_location=r.asm.sa).apply(null,arguments)},fn=r.___getTypeName=function(){return(fn=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var pn=r._htons=function(){return(pn=r._htons=r.asm.wa).apply(null,arguments)},hn=r._emscripten_builtin_memalign=function(){return(hn=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},dn=r.___cxa_is_pointer_type=function(){return(dn=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Aa).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Ea).apply(null,arguments)},r.FS=S;var sr;function qr(c){this.name="ExitStatus",this.message="Program terminated with exit("+c+")",this.status=c}yt=function c(){sr||$r(),sr||(yt=c)};function $r(c){if(it>0||(ar(),it>0))return;function p(){sr||(sr=!0,r.calledRun=!0,!Pe&&(lr(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),ur()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),p()},1)):p()}r.run=$r;function so(c,p){ao(c)}function ao(c){Yt()||(r.onExit&&r.onExit(c),Pe=!0),l(c,new qr(c))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return $r(),r.ready}})(),opencascadeWasm="/abundance-mo-fork/assets/replicad_single-C4NBJ5vg.wasm";const OC={library:null},setOC=t=>{OC.library=t},getOC=()=>{if(!OC.library)throw new Error("oppencascade has not been loaded");return OC.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const deletetableRegistry=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class WrappingObj{constructor(e){this.oc=getOC(),e&&deletetableRegistry.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(deletetableRegistry.unregister(this._wrapped),this._wrapped.delete()),deletetableRegistry.register(this,e,e),this._wrapped=e}delete(){var e;deletetableRegistry.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const GCWithScope=()=>{function t(e){return deletetableRegistry.register(t,e),e}return t},GCWithObject=t=>{function e(r){return deletetableRegistry.register(t,r),r}return e},localGC=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},HASH_CODE_MAX=2147483647,DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI,round3=t=>Math.round(t*1e3)/1e3;function isPoint(t){return Array.isArray(t)?t.length===3||t.length===2:t instanceof Vector?!0:!!(t&&typeof(t==null?void 0:t.XYZ)=="function")}const makeAx3=(t,e,r)=>{const n=getOC(),i=asPnt(t),o=asDir(e);let a;if(r){const l=asDir(r);a=new n.gp_Ax3_3(i,o,l),l.delete()}else a=new n.gp_Ax3_4(i,o);return i.delete(),o.delete(),a},makeAx2=(t,e,r)=>{const n=getOC(),i=asPnt(t),o=asDir(e);let a;if(r){const l=asDir(r);a=new n.gp_Ax2_2(i,o,l),l.delete()}else a=new n.gp_Ax2_3(i,o);return i.delete(),o.delete(),a},makeAx1=(t,e)=>{const r=getOC(),n=asPnt(t),i=asDir(e),o=new r.gp_Ax1_2(n,i);return n.delete(),i.delete(),o},makeVec=(t=[0,0,0])=>{const e=getOC();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof Vector)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class Vector extends WrappingObj{constructor(e=[0,0,0]){super(makeVec(e))}get repr(){return`x: ${round3(this.x)}, y: ${round3(this.y)}, z: ${round3(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new Vector(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new Vector(this.wrapped.Subtracted(e.wrapped))}add(e){return new Vector(this.wrapped.Added(e.wrapped))}multiply(e){return new Vector(this.wrapped.Multiplied(e))}normalized(){return new Vector(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*RAD2DEG}projectToPlane(e){const r=e.origin,n=e.zDir,i=this.sub(r),o=n.multiply(i.dot(n)/n.Length**2),a=this.sub(o);return i.delete(),o.delete(),a}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const i=makeAx1(r,n);return this.wrapped.Rotate(i,e*DEG2RAD),i.delete(),this}}const DIRECTIONS$1={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function makeDirection(t){return t==="X"||t==="Y"||t==="Z"?DIRECTIONS$1[t]:t}function asPnt(t){const e=new Vector(t),r=e.toPnt();return e.delete(),r}function asDir(t){const e=new Vector(t),r=e.toDir();return e.delete(),r}class Transformation extends WrappingObj{constructor(e){const r=getOC();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const i=new Vector(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(i.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const i=asDir(n),o=asPnt(r),a=new this.oc.gp_Ax1_2(o,i);return this.wrapped.SetRotation_1(a,e*DEG2RAD),a.delete(),i.delete(),o.delete(),this}mirror(e="YZ",r){const n=GCWithScope();let i,o;if(typeof e=="string"){const l=n(createNamedPlane(e,r));i=l.origin,o=l.zDir}else e instanceof Plane?(i=r||e.origin,o=e.zDir):(i=r||[0,0,0],o=e);const a=n(makeAx2(i,o));return this.wrapped.SetMirror_3(a),this}scale(e,r){const n=asPnt(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=GCWithScope(),i=n(e==="reference"?new this.oc.gp_Ax3_1:makeAx3(e.origin,e.zDir,e.xDir)),o=n(r==="reference"?new this.oc.gp_Ax3_1:makeAx3(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(i,o),this}transformPoint(e){const r=asPnt(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Plane{constructor(e,r=null,n=[0,0,1]){this.oc=getOC();const i=new Vector(n);if(i.Length===0)throw new Error("normal should be non null");this.zDir=i.normalize();let o;if(r)o=new Vector(r);else{const a=makeAx3(e,i);o=new Vector(a.XDirection()),a.delete()}if(o.Length===0)throw new Error("xDir should be non null");this.xDir=o.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new Vector(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Plane(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new Vector(e),r}translate(e,r=0,n=0){const i=new Vector(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(i))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=makeDirection(r),i=new Vector(this.zDir).rotate(e,[0,0,0],n),o=new Vector(this.xDir).rotate(e,[0,0,0],n);return new Plane(this.origin,o,i)}rotate2DAxes(e){const r=new Vector(this.xDir).rotate(e,[0,0,0],this.zDir);return new Plane(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=makeAx3(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new Transformation,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new Transformation,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new Vector(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new Vector(r);return r.delete(),n}}const PLANES_CONFIG={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},createNamedPlane=(t,e=[0,0,0])=>{const r=PLANES_CONFIG[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(i=>i*e):n=e,new Plane(n,r.xDir,r.normal)};let BoundingBox$1=class extends WrappingObj{constructor(e){const r=getOC();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new Vector(e).repr} - ${new Vector(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},i={current:0},o={current:0},a={current:0};return this.wrapped.Get(e,r,n,i,o,a),[[e.current,r.current,n.current],[i.current,o.current,a.current]]}get center(){const[[e,r,n],[i,o,a]]=this.bounds;return[e+(i-e)/2,r+(o-r)/2,n+(a-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};const makePlaneFromFace=(t,e=[0,0])=>{const r=t.pointOnSurface(...e),n=t.normalAt(r),i=new Vector([0,0,1]);let o=i.cross(n);return o.Length<1e-8&&(o.delete(),o=new Vector([1,0,0])),i.delete(),new Plane(r,o,n)};function makePlane(t="XY",e=[0,0,0]){return t instanceof Plane?t.clone():createNamedPlane(t,e)}function rotate$1(t,e,r=[0,0,0],n=[0,0,1]){const i=new Transformation;i.rotate(e,r,n);const o=i.transform(t);return i.delete(),o}function translate(t,e){const r=new Transformation;r.translate(e);const n=r.transform(t);return r.delete(),n}function mirror(t,e,r){const n=new Transformation;n.mirror(e,r);const i=n.transform(t);return n.delete(),i}function scale(t,e,r){const n=new Transformation;n.scale(e,r);const i=n.transform(t);return n.delete(),i}function isPoint2D(t){return Array.isArray(t)&&t.length===2}let CURVE_TYPES_MAP=null;const getCurveTypesMap=t=>{if(CURVE_TYPES_MAP&&!t)return CURVE_TYPES_MAP;const r=getOC().GeomAbs_CurveType;return CURVE_TYPES_MAP=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),CURVE_TYPES_MAP},findCurveType=t=>{let e=getCurveTypesMap().get(t);if(e||(e=getCurveTypesMap(!0).get(t)),!e)throw new Error("unknown type");return e};function precisionRound(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function range$1(t){return Array.from(Array(t).keys())}function zip(t){const e=Math.min(...t.map(r=>r.length));return range$1(e).map(r=>t.map(n=>n[r]))}function round2(t){return Math.round(t*100)/100}const reprPnt=([t,e])=>`(${round2(t)},${round2(e)})`,asFixed=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},removeDuplicatePoints=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${asFixed(r,e)},${asFixed(n,e)}]`,[r,n]])).values()),pnt=([t,e])=>{const r=getOC();return new r.gp_Pnt2d_3(t,e)},direction2d=([t,e])=>{const r=getOC();return new r.gp_Dir2d_4(t,e)},vec=([t,e])=>{const r=getOC();return new r.gp_Vec2d_4(t,e)},axis2d=(t,e)=>{const r=getOC(),[n,i]=localGC(),o=new r.gp_Ax2d_2(n(pnt(t)),n(direction2d(e)));return i(),o};class BoundingBox2d extends WrappingObj{constructor(e){const r=getOC();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${reprPnt(e)} - ${reprPnt(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},i={current:0};return this.wrapped.Get(e,r,n,i),[[e.current,r.current],[n.current,i.current]]}get center(){const[[e,r],[n,i]]=this.bounds;return[e+(n-e)/2,r+(i-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,i=n[0]-r[0],o=n[1]-r[1];return[n[0]+i/100*e,n[1]+o/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=GCWithScope()(pnt(e));return!this.wrapped.IsOut_1(n)}}const samePoint$2=([t,e],[r,n],i=1e-6)=>Math.abs(t-r)<=i&&Math.abs(e-n)<=i,add2d=([t,e],[r,n])=>[t+r,e+n],subtract2d=([t,e],[r,n])=>[t-r,e-n],scalarMultiply2d=([t,e],r)=>[t*r,e*r],distance2d=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),squareDistance2d=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function crossProduct2d([t,e],[r,n]){return t*n-e*r}const angle2d=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),polarAngle2d=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),normalize2d=([t,e])=>{const r=distance2d([t,e]);return[t/r,e/r]},rotate2d=(t,e,r=[0,0])=>{const[n,i]=t,[o,a]=r,l=n-o,f=i-a,d=Math.sin(e),g=Math.cos(e),b=l*g-f*d,_=l*d+f*g;return[b+o,_+a]},polarToCartesian=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},cartesianToPolar=([t,e])=>{const r=distance2d([t,e]),n=Math.atan2(e,t);return[r,n]};class Curve2D extends WrappingObj{constructor(e){const r=getOC(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=getOC(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new BoundingBox2d(r),this._boundingBox}get repr(){return`${this.geomType} ${reprPnt(this.firstPoint)} - ${reprPnt(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=getOC();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=findCurveType(e.GetType());return e.delete(),r}clone(){return new Curve2D(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=getOC(),n=GCWithScope(),i=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(pnt(e)),this.wrapped));let o=1/0;try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,distance2d(e,this.firstPoint),distance2d(e,this.lastPoint))}distanceFromCurve(e){const r=getOC(),n=GCWithScope();let i=1/0;const o=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return isPoint2D(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=getOC(),i=GCWithScope();let o,a;try{const l=i(new n.Geom2dAPI_ProjectPointOnCurve_2(i(pnt(e)),this.wrapped));o=l.LowerDistance(),a=l.LowerDistanceParameter()}catch{if(samePoint$2(e,this.firstPoint,r))return this.firstParameter;if(samePoint$2(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(o>r)throw new Error(`Point ${reprPnt(e)} not on curve ${this.repr}, ${o.toFixed(9)}`);return a}tangentAt(e){const r=getOC(),[n,i]=localGC();let o;Array.isArray(e)?o=this.parameter(e):o=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const a=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(o,a,l);const f=[l.X(),l.Y()];return i(),f}splitAt(e,r=1e-9){const n=getOC(),i=GCWithScope();let o=e.map(f=>isPoint2D(f)?this.parameter(f,r):f);o=Array.from(new Map(o.map(f=>[precisionRound(f,-Math.log10(r)),f])).values()).sort((f,d)=>f-d);const a=this.firstParameter,l=this.lastParameter;return a>l&&o.reverse(),Math.abs(o[0]-a)<r*100&&(o=o.slice(1)),o.length?(Math.abs(o[o.length-1]-l)<r*100&&(o=o.slice(0,-1)),o.length?zip([[a,...o],[...o,l]]).map(([f,d])=>{try{if(this.geomType==="BEZIER_CURVE"){const b=new n.Geom2d_BezierCurve_1(i(this.adaptor()).Bezier().get().Poles_2());return b.Segment(f,d),new Curve2D(new n.Handle_Geom2d_Curve_2(b))}if(this.geomType==="BSPLINE_CURVE"){const b=i(this.adaptor()).BSpline().get(),_=new n.Geom2d_BSplineCurve_1(b.Poles_2(),b.Knots_2(),b.Multiplicities_2(),b.Degree(),b.IsPeriodic());return _.Segment(f,d,r),new Curve2D(new n.Handle_Geom2d_Curve_2(_))}const g=new n.Geom2d_TrimmedCurve(this.wrapped,f,d,!0,!0);return new Curve2D(new n.Handle_Geom2d_Curve_2(g))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const approximateAsBSpline=(t,e=1e-8)=>{const r=getOC(),i=GCWithScope()(new r.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,r.GeomAbs_Shape.GeomAbs_C0,30,3));return new Curve2D(i.Curve())},BSplineToBezier=t=>{if(findCurveType(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=getOC(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*i(){const a=n.NbArcs();if(a)for(let l=1;l<=a;l++){const f=n.Arc(l);yield new Curve2D(f)}}const o=Array.from(i());return n.delete(),o};function*pointsIteration(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*commonSegmentsIteration(t){const e=t.NbSegments();if(!e)return;const r=getOC();for(let n=1;n<=e;n++){const i=new r.Handle_Geom2d_Curve_1,o=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,i,o)}catch{continue}yield new Curve2D(i),o.delete()}}const intersectCurves=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=getOC(),i=new n.Geom2dAPI_InterCurveCurve_1;let o,a;try{i.Init_1(t.wrapped,e.wrapped,r),o=Array.from(pointsIteration(i)),a=Array.from(commonSegmentsIteration(i))}catch(d){throw console.error(t,e,d),new Error("Intersections failed between curves")}finally{i.delete()}const l=a.filter(d=>samePoint$2(d.firstPoint,d.lastPoint,r)).map(d=>d.firstPoint);l.length&&(o.push(...l),a=a.filter(d=>!samePoint$2(d.firstPoint,d.lastPoint,r)));const f=a.flatMap(d=>[d.firstPoint,d.lastPoint]);return{intersections:o,commonSegments:a,commonSegmentsPoints:f}},selfIntersections=(t,e=1e-9)=>{const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1;let i;try{n.Init_1(t.wrapped,t.wrapped,e),i=Array.from(pointsIteration(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return i},make2dSegmentCurve=(t,e)=>{const r=getOC(),[n,i]=localGC(),o=n(new r.GCE2d_MakeSegment_1(n(pnt(t)),n(pnt(e)))).Value(),a=new Curve2D(o);return samePoint$2(a.firstPoint,t)||a.reverse(),i(),a},make2dThreePointArc=(t,e,r)=>{const n=getOC(),[i,o]=localGC(),a=i(new n.GCE2d_MakeArcOfCircle_4(i(pnt(t)),i(pnt(e)),i(pnt(r)))).Value();o();const l=new Curve2D(a);return samePoint$2(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},make2dTangentArc=(t,e,r)=>{const n=getOC(),[i,o]=localGC(),a=i(new n.GCE2d_MakeArcOfCircle_5(i(pnt(t)),i(vec(e)),i(pnt(r)))).Value();o();const l=new Curve2D(a);return samePoint$2(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},make2dCircle=(t,e=[0,0])=>{const r=getOC(),[n,i]=localGC(),o=n(new r.GCE2d_MakeCircle_7(n(pnt(e)),t,!0)).Value();return i(),new Curve2D(o)},make2dEllipse=(t,e,r=[1,0],n=[0,0],i=!0)=>{const o=getOC(),[a,l]=localGC(),f=a(new o.gp_Elips2d_2(a(axis2d(n,r)),t,e,i)),d=a(new o.GCE2d_MakeEllipse_1(f)).Value();return l(),new Curve2D(d)},make2dEllipseArc=(t,e,r,n,i=[0,0],o,a=!0)=>{const l=getOC(),[f,d]=localGC(),g=f(new l.gp_Elips2d_2(f(axis2d(i,o)),t,e,!0)),b=f(new l.GCE2d_MakeArcOfEllipse_1(g,r,n,a)).Value();return d(),new Curve2D(b)},make2dBezierCurve=(t,e,r)=>{const n=getOC(),[i,o]=localGC(),a=i(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));a.SetValue(1,i(pnt(t))),e.forEach((f,d)=>{a.SetValue(d+2,i(pnt(f)))}),a.SetValue(e.length+2,i(pnt(r)));const l=new n.Geom2d_BezierCurve_1(a);return o(),new Curve2D(new n.Handle_Geom2d_Curve_2(l))};function make2dInerpolatedBSplineCurve(t,{tolerance:e=.001,smoothing:r=null,degMax:n=3,degMin:i=1}={}){const o=GCWithScope(),a=getOC(),l=o(new a.TColgp_Array1OfPnt2d_2(1,t.length));t.forEach((d,g)=>{l.SetValue(g+1,o(pnt(d)))});let f;if(r?f=o(new a.Geom2dAPI_PointsToBSpline_6(l,r[0],r[1],r[2],n,a.GeomAbs_Shape.GeomAbs_C2,e)):f=o(new a.Geom2dAPI_PointsToBSpline_2(l,i,n,a.GeomAbs_Shape.GeomAbs_C2,e)),!f.IsDone())throw new Error("B-spline approximation failed");return new Curve2D(f.Curve())}const make2dArcFromCenter=(t,e,r)=>{const n=scalarMultiply2d(add2d(t,e),.5),i=distance2d(r,t),o=normalize2d(subtract2d(n,r));return make2dThreePointArc(t,add2d(scalarMultiply2d(o,i),r),e)},offsetEndPoints=(t,e,r)=>{const n=normalize2d(subtract2d(e,t)),i=[n[1],-n[0]],o=[i[0]*r,i[1]*r];return{firstPoint:add2d(t,o),lastPoint:add2d(e,o)}},make2dOffset=(t,e)=>{const r=GCWithScope(),n=t.geomType;if(n==="CIRCLE"){const f=r(r(t.adaptor()).Circle()),d=f.Radius(),g=f.IsDirect()?1:-1,b=e*g,_=d+b;if(_<1e-10){const M=r(f.Location()),U=[M.X(),M.Y()],R=z=>{const[X,se]=normalize2d(subtract2d(z,U));return add2d(z,[b*X,b*se])};return{collapsed:!0,firstPoint:R(t.firstPoint),lastPoint:R(t.lastPoint)}}const E=getOC(),k=new E.gp_Circ2d_3(f.Axis(),_),D=new E.Geom2d_Circle_1(k),L=new E.Geom2d_TrimmedCurve(new E.Handle_Geom2d_Curve_2(D),t.firstParameter,t.lastParameter,!0,!0);return new Curve2D(new E.Handle_Geom2d_Curve_2(L))}if(n==="LINE"){const{firstPoint:f,lastPoint:d}=offsetEndPoints(t.firstPoint,t.lastPoint,e);return make2dSegmentCurve(f,d)}const i=getOC(),o=new Curve2D(new i.Handle_Geom2d_Curve_2(new i.Geom2d_OffsetCurve(t.wrapped,e,!0))),a=approximateAsBSpline(o.adaptor());return selfIntersections(a).length?{collapsed:!0,firstPoint:a.firstPoint,lastPoint:a.lastPoint}:a};function removeCorner(t,e,r){const n=crossProduct2d(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const i=n>0?-1:1,o=Math.abs(r)*i,a=make2dOffset(t,o),l=make2dOffset(e,o);if(!(a instanceof Curve2D)||!(l instanceof Curve2D))return null;let f;try{const{intersections:E}=intersectCurves(a,l,1e-9);f=E.at(-1)}catch{return null}if(!isPoint2D(f))return null;const d=f,g=(E,k)=>{const[D,L]=k.tangentAt(d),M=normalize2d([-L,D]),U=add2d(d,scalarMultiply2d(M,o)),R=E.parameter(U,1e-6);return E.splitAt([R])},[b]=g(t,a),[,_]=g(e,l);return{first:b,second:_,center:d}}function filletCurves(t,e,r){const n=removeCorner(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:i,second:o,center:a}=n;return[i,make2dArcFromCenter(i.lastPoint,o.firstPoint,a),o]}function chamferCurves(t,e,r){const n=removeCorner(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:i,second:o}=n;return[i,make2dSegmentCurve(i.lastPoint,o.firstPoint),o]}class FlatQueue{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const i=n-1>>1,o=this.values[i];if(r>=o)break;this.ids[n]=this.ids[i],this.values[n]=o,n=i}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],i=this.length>>1;let o=0;for(;o<i;){let a=(o<<1)+1;const l=a+1;let f=this.ids[a],d=this.values[a];const g=this.values[l];if(l<this.length&&g<d&&(a=l,f=this.ids[l],d=g),d>=n)break;this.ids[o]=f,this.values[o]=d,o=a}this.ids[o]=r,this.values[o]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const ARRAY_TYPES=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],VERSION=3;class Flatbush{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==VERSION)throw new Error(`Got v${n>>4} data when expected v${VERSION}.`);const[i]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new Flatbush(o,i,ARRAY_TYPES[n&15],e)}constructor(e,r=16,n=Float64Array,i){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let o=e,a=o;this._levelBounds=[o*4];do o=Math.ceil(o/this.nodeSize),a+=o,this._levelBounds.push(a*4);while(o!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const l=ARRAY_TYPES.indexOf(this.ArrayType),f=a*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);i&&i instanceof ArrayBuffer?(this.data=i,this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+f,a),this._pos=a*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+f+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+f,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(VERSION<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new FlatQueue}add(e,r,n,i){const o=this._pos>>2;return this._indices[o]=o,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=i,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),i>this.maxY&&(this.maxY=i),o}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),i=65535;for(let o=0;o<this.numItems;o++){let a=4*o;const l=this._boxes[a++],f=this._boxes[a++],d=this._boxes[a++],g=this._boxes[a++],b=Math.floor(i*((l+d)/2-this.minX)/e),_=Math.floor(i*((f+g)/2-this.minY)/r);n[o]=hilbert(b,_)}sort(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let o=0,a=0;o<this._levelBounds.length-1;o++){const l=this._levelBounds[o];for(;a<l;){const f=a;let d=1/0,g=1/0,b=-1/0,_=-1/0;for(let E=0;E<this.nodeSize&&a<l;E++)d=Math.min(d,this._boxes[a++]),g=Math.min(g,this._boxes[a++]),b=Math.max(b,this._boxes[a++]),_=Math.max(_,this._boxes[a++]);this._indices[this._pos>>2]=f,this._boxes[this._pos++]=d,this._boxes[this._pos++]=g,this._boxes[this._pos++]=b,this._boxes[this._pos++]=_}}}search(e,r,n,i,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=[],f=[];for(;a!==void 0;){const d=Math.min(a+this.nodeSize*4,upperBound(a,this._levelBounds));for(let g=a;g<d;g+=4){if(n<this._boxes[g]||i<this._boxes[g+1]||e>this._boxes[g+2]||r>this._boxes[g+3])continue;const b=this._indices[g>>2]|0;a<this.numItems*4?(o===void 0||o(b))&&f.push(b):l.push(b)}a=l.pop()}return f}neighbors(e,r,n=1/0,i=1/0,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=this._queue,f=[],d=i*i;for(;a!==void 0;){const g=Math.min(a+this.nodeSize*4,upperBound(a,this._levelBounds));for(let b=a;b<g;b+=4){const _=this._indices[b>>2]|0,E=axisDist(e,this._boxes[b],this._boxes[b+2]),k=axisDist(r,this._boxes[b+1],this._boxes[b+3]),D=E*E+k*k;a<this.numItems*4?(o===void 0||o(_))&&l.push((_<<1)+1,D):l.push(_<<1,D)}for(;l.length&&l.peek()&1;)if(l.peekValue()>d||(f.push(l.pop()>>1),f.length===n))return l.clear(),f;a=l.pop()>>1}return l.clear(),f}}function axisDist(t,e,r){return t<e?e-t:t<=r?0:t-r}function upperBound(t,e){let r=0,n=e.length-1;for(;r<n;){const i=r+n>>1;e[i]>t?n=i:r=i+1}return e[r]}function sort(t,e,r,n,i,o){if(Math.floor(n/o)>=Math.floor(i/o))return;const a=t[n+i>>1];let l=n-1,f=i+1;for(;;){do l++;while(t[l]<a);do f--;while(t[f]>a);if(l>=f)break;swap(t,e,r,l,f)}sort(t,e,r,n,f,o),sort(t,e,r,f+1,i,o)}function swap(t,e,r,n,i){const o=t[n];t[n]=t[i],t[i]=o;const a=4*n,l=4*i,f=e[a],d=e[a+1],g=e[a+2],b=e[a+3];e[a]=e[l],e[a+1]=e[l+1],e[a+2]=e[l+2],e[a+3]=e[l+3],e[l]=f,e[l+1]=d,e[l+2]=g,e[l+3]=b;const _=r[n];r[n]=r[i],r[i]=_}function hilbert(t,e){let r=t^e,n=65535^r,i=65535^(t|e),o=t&(e^65535),a=r|n>>1,l=r>>1^r,f=i>>1^n&o>>1^i,d=r&i>>1^o>>1^o;r=a,n=l,i=f,o=d,a=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,f^=r&i>>2^n&o>>2,d^=n&i>>2^(r^n)&o>>2,r=a,n=l,i=f,o=d,a=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,f^=r&i>>4^n&o>>4,d^=n&i>>4^(r^n)&o>>4,r=a,n=l,i=f,o=d,f^=r&i>>8^n&o>>8,d^=n&i>>8^(r^n)&o>>8,r=f^f>>1,n=d^d>>1;let g=t^e,b=n|65535^(g|r);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,b=(b|b<<8)&16711935,b=(b|b<<4)&252645135,b=(b|b<<2)&858993459,b=(b|b<<1)&1431655765,(b<<1|g)>>>0}const stitchCurves=(t,e=1e-7)=>{const r=new Flatbush(t.length);t.forEach(o=>{const[a,l]=o.firstPoint;r.add(a-e,l-e,a+e,l+e)}),r.finish();const n=[],i=new Set;return t.forEach((o,a)=>{if(i.has(a))return;const l=[o];let f=a;i.add(a);let d=t.length;for(;;){if(d--<0)throw new Error("Infinite loop detected");const g=l[l.length-1].lastPoint,[b,_]=g,E=r.search(b-e,_-e,b+e,_+e),k=U=>Math.abs((f-U)%t.length),D=E.filter(U=>!i.has(U)).map(U=>[t[U],U,k(U)]).sort(([,,U],[,,R])=>k(U)-k(R));if(D.length===0){n.push(l);break}const[L,M]=D[0];l.push(L),i.add(M),f=M}}),n};function round5(t){return Math.round(t*1e5)/1e5}const fromPnt=t=>`${round2(t.X())} ${round2(t.Y())}`,adaptedCurveToPathElem=(t,e)=>{const r=getOC(),n=findCurveType(t.GetType()),[i,o]=e,a=`${round5(i)} ${round5(o)}`;if(n==="LINE")return`L ${a}`;if(n==="BEZIER_CURVE"){const d=t.Bezier().get(),g=d.Degree();if(g===1)return`L ${a}`;if(g===2)return`Q ${fromPnt(d.Pole(2))} ${a}`;if(g===3){const b=fromPnt(d.Pole(2)),_=fromPnt(d.Pole(3));return`C ${b} ${_} ${a}`}}if(n==="CIRCLE"){const d=t.Circle(),g=d.Radius(),b=t.FirstParameter(),E=(t.LastParameter()-b)*RAD2DEG,k=E!==360?a:`${round5(i)} ${round5(o+1e-4)}`;return`A ${g} ${g} 0 ${Math.abs(E)>180?"1":"0"} ${d.IsDirect()?"1":"0"} ${k}`}if(n==="ELLIPSE"){const d=t.Ellipse(),g=d.MajorRadius(),b=d.MinorRadius(),_=t.FirstParameter(),k=(t.LastParameter()-_)*RAD2DEG,D=k!==360?a:`${round5(i)} ${round5(o+1e-4)}`,L=new r.gp_Dir2d_1,M=180-d.XAxis().Direction().Angle(L)*RAD2DEG;return L.delete(),`A ${round5(g)} ${round5(b)} ${round5(M)} ${Math.abs(k)>180?"1":"0"} ${d.IsDirect()?"1":"0"} ${D}`}if(n==="BSPLINE_CURVE"&&t.BSpline().get().Degree()<4)return BSplineToBezier(t).map(b=>adaptedCurveToPathElem(b.adaptor(),b.lastPoint)).join(" ");const l=approximateAsBSpline(t);return BSplineToBezier(l.adaptor()).map(d=>adaptedCurveToPathElem(d.adaptor(),d.lastPoint)).join(" ")},DIRECTIONS={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},PLANE_TO_DIR={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Finder{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:i})=>!r.shouldKeep(i);return this.filters.push(n),this}either(e){const r=e.map(i=>{const o=new this.constructor;return i(o),o}),n=({element:i})=>r.some(o=>o.shouldKeep(i));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Finder3d extends Finder{inList(e){const r=({element:n})=>!!e.find(i=>i.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new Vector(DIRECTIONS[e]):n=new Vector(e);const i=({normal:o})=>{if(!o)return!1;const a=Math.acos(Math.abs(o.dot(n)));return Math.abs(a-DEG2RAD*r)<1e-6};return this.filters.push(i),this}atDistance(e,r=[0,0,0]){const n=asPnt(r),i=getOC(),o=new i.BRepBuilderAPI_MakeVertex(n),a=o.Vertex();o.delete();const l=new i.BRepExtrema_DistShapeShape_1;l.LoadS1(a);const f=({element:d})=>{const g=GCWithScope();l.LoadS2(d.wrapped);const b=g(new i.Message_ProgressRange_1);return l.Perform(b),Math.abs(l.Value()-e)<1e-6};return this.filters.push(f),GCWithObject(f)(l),this}containsPoint(e){return this.atDistance(0,e)}inBox(e,r){const n=getOC(),i=new n.BRepPrimAPI_MakeBox_4(asPnt(e),asPnt(r)),o=i.Solid();i.delete();const a=new n.BRepExtrema_DistShapeShape_1;a.LoadS1(o);const l=({element:d})=>{const g=GCWithScope();a.LoadS2(d.wrapped);const b=g(new n.Message_ProgressRange_1);return a.Perform(b),a.Value()<1e-6},f=GCWithObject(l);return f(o),f(a),this.filters.push(l),this}}class EdgeFinder extends Finder3d{clone(){const e=new EdgeFinder;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&PLANE_TO_DIR[e])return this.atAngleWith(PLANE_TO_DIR[e],90);if(typeof e!="string"&&e instanceof Plane)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Plane?makePlane(e):makePlane(e,r);this.parallelTo(n);const i=({element:o})=>{const a=o.startPoint,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(i),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class FaceFinder extends Finder3d{clone(){const e=new FaceFinder;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&PLANE_TO_DIR[e])return this.atAngleWith(PLANE_TO_DIR[e]);if(typeof e!="string"&&e instanceof Plane)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Plane?makePlane(e):makePlane(e,r);this.parallelTo(n);const i=({element:o})=>{const a=o.center,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(i),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(i=>i({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const blueprintCorners=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},PI_2=2*Math.PI,positiveHalfAngle=t=>{const e=t%PI_2,r=e<0?e+PI_2:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-PI_2)};class CornerFinder extends Finder{clone(){const e=new CornerFinder;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(i=>samePoint$2(i,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:i}){return Math.abs(distance2d(r,i.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return samePoint$2(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,i]=e,[o,a]=r,l=Math.min(n,o),f=Math.max(n,o),d=Math.min(i,a),g=Math.max(i,a);function b({element:_}){const[E,k]=_.point;return E>=l&&E<=f&&k>=d&&k<=g}return this.filters.push(b),this}ofAngle(e){function r({element:n}){const i=n.firstCurve.tangentAt(1),o=n.secondCurve.tangentAt(0);return Math.abs(positiveHalfAngle(angle2d(i,o))-positiveHalfAngle(DEG2RAD*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return blueprintCorners(e).filter(r=>this.shouldKeep(r))}}const combineFinderFilters=t=>[r=>{for(const{filter:n,radius:i}of t)if(n.shouldKeep(r))return i;return 0},()=>t.forEach(r=>r.filter.delete())],asTopo=t=>{const e=getOC();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},iterTopo=function*(e,r){const n=getOC(),i=new n.TopExp_Explorer_2(e,asTopo(r),asTopo("shape")),o=new Map;for(;i.More();){const a=i.Current(),l=a.HashCode(HASH_CODE_MAX);o.get(l)||(o.set(l,!0),yield a),i.Next()}i.delete()},shapeType=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class Shape extends WrappingObj{constructor(e){super(e)}clone(){return new this.constructor(downcast(this.wrapped))}get hashCode(){return this.wrapped.HashCode(HASH_CODE_MAX)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=getOC(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=cast(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const i=typeof e=="number"?[e,r,n]:e,o=cast(translate(this.wrapped,i));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const i=cast(rotate$1(this.wrapped,e,r,n));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}mirror(e,r){const n=cast(mirror(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=cast(scale(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return iterTopo(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>downcast(r))}get edges(){return this._listTopo("edge").map(e=>new Edge(e))}get faces(){return this._listTopo("face").map(e=>new Face(e))}get wires(){return this._listTopo("wire").map(e=>new Wire(e))}get boundingBox(){const e=new BoundingBox$1;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],i=[],o=[];const a=[];for(const l of this.faces){const f=l.triangulation(i.length/3);if(!f)continue;const{trianglesIndexes:d,vertices:g,verticesNormals:b}=f;a.push({start:n.length,count:d.length,faceId:l.hashCode}),n=n.concat(d),i=i.concat(g),o=o.concat(b)}return{triangles:n,vertices:i,normals:o,faceGroups:a}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const i=GCWithScope(),o=new Set,a=[],l=[],f=()=>{const g=a.length;let b=null;return[_=>{b?(a.push(...b),b=[_.X(),_.Y(),_.Z()],a.push(...b)):b=[_.X(),_.Y(),_.Z()]},_=>{l.push({start:g/3,count:(a.length-g)/3,edgeId:_}),o.add(_)}]},d=i(new this.oc.TopLoc_Location_1);for(const g of this.faces){const b=i(this.oc.BRep_Tool.Triangulation(g.wrapped,d,0));if(b.IsNull())continue;const _=b.get();for(const E of g.edges){if(i(E),o.has(E.hashCode))continue;const k=i(new this.oc.TopLoc_Location_1),D=i(this.oc.BRep_Tool.PolygonOnTriangulation_1(E.wrapped,b,k)),L=(n=D==null?void 0:D.get())==null?void 0:n.Nodes();if(!L)continue;i(L);const[M,U]=f();for(let R=L.Lower();R<=L.Upper();R++){const z=i(i(_.Node(L.Value(R))).Transformed(k.Transformation()));M(z)}U(E.hashCode)}}for(const g of this.edges){i(g);const b=g.hashCode;if(o.has(b))continue;const _=i(new this.oc.BRepAdaptor_Curve_2(g.wrapped)),E=i(new this.oc.GCPnts_TangentialDeflection_2(_,e,r,2,1e-9,1e-7)),[k,D]=f();for(let L=0;L<E.NbPoints();L++){const M=i(E.Value(L+1).Transformed(d.Transformation()));k(M)}D(b)}return{lines:a,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const i=r.Write(e);if(r.delete(),n.delete(),i===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const o=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([o],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const i="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,i,!n)){const a=this.oc.FS.readFile("/"+i);return this.oc.FS.unlink("/"+i),new Blob([a],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Vertex extends Shape{}class _1DShape extends Shape{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new Curve(this._geomAdaptor())}get startPoint(){const e=this.curve,r=e.startPoint;return e.delete(),r}get endPoint(){const e=this.curve,r=e.endPoint;return e.delete(),r}tangentAt(e=0){const r=this.curve,n=r.tangentAt(e);return r.delete(),n}get isClosed(){const e=this.curve,r=e.isClosed;return e.delete(),r}get isPeriodic(){const e=this.curve,r=e.isPeriodic;return e.delete(),r}get period(){const e=this.curve,r=e.period;return e.delete(),r}get geomType(){const e=this.curve,r=e.curveType;return e.delete(),r}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Curve extends WrappingObj{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return findCurveType(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new Vector(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new Vector(e)}tangentAt(e){let r=e;e||(r=(this.wrapped.LastParameter()-this.wrapped.FirstParameter())/2);const n=new this.oc.gp_Pnt_1,i=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,i);const o=new Vector(i);return n.delete(),i.delete(),o}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Edge extends _1DShape{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Wire extends _1DShape{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},i=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);i.Perform(e,0);const o=cast(i.Shape());if(i.delete(),this.delete(),!(o instanceof Wire))throw new Error("Could not offset with a wire");return o}}class Surface extends WrappingObj{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Face extends Shape{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Surface(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},i={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,i),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:i.current}}pointOnSurface(e,r){const{uMin:n,uMax:i,vMin:o,vMax:a}=this.UVBounds,l=this._geomAdaptor(),f=new this.oc.gp_Pnt_1,d=e*(i-n)+n,g=r*(a-o)+o;l.D0(d,g,f);const b=new Vector(f);return l.delete(),f.delete(),b}normalAt(e){let r=0,n=0;const i=GCWithScope();if(e){const d=i(this.oc.BRep_Tool.Surface_2(this.wrapped)),g=i(new this.oc.GeomAPI_ProjectPointOnSurf_2(i(asPnt(e)),d,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),b={current:0},_={current:0};g.LowerDistanceParameters(b,_),r=b.current,n=_.current}else{const{uMin:d,uMax:g,vMin:b,vMax:_}=this.UVBounds;r=.5*(d+g),n=.5*(b+_)}const o=i(new this.oc.gp_Pnt_1),a=i(new this.oc.gp_Vec_1);return i(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,o,a),new Vector(a)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new Vector(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Wire(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=GCWithScope(),n=r(new this.oc.TopLoc_Location_1),i=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(i.IsNull())return null;const o=r(n.Transformation()),a={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=i.get(),f=l.NbNodes();a.vertices=new Array(f*3);for(let k=1;k<=f;k++){const D=r(r(l.Node(k)).Transformed(o));a.vertices[(k-1)*3+0]=D.X(),a.vertices[(k-1)*3+1]=D.Y(),a.vertices[(k-1)*3+2]=D.Z()}const d=r(new this.oc.TColgp_Array1OfDir_2(1,f)),g=r(new this.oc.Poly_Connect_2(i));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,g,d),a.verticesNormals=new Array(d.Length()*3);for(let k=d.Lower();k<=d.Upper();k++){const D=r(r(d.Value(k)).Transformed(o));a.verticesNormals[(k-1)*3+0]=D.X(),a.verticesNormals[(k-1)*3+1]=D.Y(),a.verticesNormals[(k-1)*3+2]=D.Z()}const b=this.orientation,_=l.NbTriangles();a.trianglesIndexes=new Array(_*3);let E=0;for(let k=1;k<=_;k++){const D=r(l.Triangle(k));let L=D.Value(1),M=D.Value(2);const U=D.Value(3);if(b==="backward"){const R=L;L=M,M=R}a.trianglesIndexes[E*3+0]=L-1+e,a.trianglesIndexes[E*3+1]=M-1+e,a.trianglesIndexes[E*3+2]=U-1+e,E++}return a}}class _3DShape extends Shape{fuse(e,{optimisation:r="none"}={}){const n=GCWithScope(),i=n(new this.oc.Message_ProgressRange_1),o=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,i));r==="commonFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),o.Build(i),o.SimplifyResult(!0,!0,.001);const a=cast(o.Shape());if(!isShape3D(a))throw new Error("Could not fuse as a 3d shape");return a}cut(e,{optimisation:r="none"}={}){const n=GCWithScope(),i=n(new this.oc.Message_ProgressRange_1),o=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,i));r==="commonFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),o.Build(i),o.SimplifyResult(!0,!0,.001);const a=cast(o.Shape());if(!isShape3D(a))throw new Error("Could not cut as a 3d shape");return a}intersect(e){const r=GCWithScope(),n=r(new this.oc.Message_ProgressRange_1),i=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));i.Build(n),i.SimplifyResult(!0,!0,.001);const o=cast(i.Shape());if(!isShape3D(o))throw new Error("Could not intersect as a 3d shape");return o}shell(e,r=null,n=.001){const i=typeof r=="number"?r:n;let o,a;if(typeof e=="number"){a=e;const E=new FaceFinder;o=typeof r=="function"?r(E):E}else a=e.thickness,o=e.filter;const l=GCWithScope(),f=o.find(this),d=l(new this.oc.TopTools_ListOfShape_1);f.forEach(E=>{d.Append_1(E.wrapped)});const g=l(new this.oc.Message_ProgressRange_1),b=l(new this.oc.BRepOffsetAPI_MakeThickSolid);b.MakeThickSolidByJoin(this.wrapped,d,-a,i,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,g);const _=cast(b.Shape());if(!isShape3D(_))throw new Error("Could not shell as a 3d shape");return _}_builderIter(e,r){if(typeof e=="number"){let a=0;for(const l of this._iterTopo("edge"))r(e,downcast(l)),a+=1;return a}let n,i=null;typeof e=="function"?n=e:(n=a=>e.filter.shouldKeep(a)?e.radius||1:0,e.filter&&!e.keep&&(i=()=>e.filter.delete()));let o=0;for(const a of this._iterTopo("edge")){const l=downcast(a),f=new Edge(l),d=n(f);d&&(r(d,l),o+=1),f.delete()}return i&&i(),o}fillet(e,r){const i=GCWithScope()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let o=e;if(typeof e=="number"&&r&&(o={radius:e,filter:r(new EdgeFinder)}),!this._builderIter(o,(f,d)=>i.Add_2(f,d)))throw new Error("Could not fillet, no edge was selected");const l=cast(i.Shape());if(!isShape3D(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const i=GCWithScope()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let o=e;if(typeof e=="number"&&r&&(o={radius:e,filter:r(new EdgeFinder)}),!this._builderIter(o,(f,d)=>i.Add_2(f,d)))throw new Error("Could not chamfer, no edge was selected");const l=cast(i.Shape());if(!isShape3D(l))throw new Error("Could not chamfer as a 3d shape");return l}}class Shell extends _3DShape{}class Solid extends _3DShape{}class CompSolid extends _3DShape{}class Compound extends _3DShape{}function isShape3D(t){return t instanceof Shell||t instanceof Solid||t instanceof CompSolid||t instanceof Compound}function isWire(t){return t instanceof Wire}function downcast(t){const e=getOC(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),i=shapeType(t),o=n.get(i);if(!o)throw new Error("Could not find a wrapper for this shape type");return o(t)}function cast(t){const r=getOC().TopAbs_ShapeEnum,i=new Map([[r.TopAbs_VERTEX,Vertex],[r.TopAbs_EDGE,Edge],[r.TopAbs_WIRE,Wire],[r.TopAbs_FACE,Face],[r.TopAbs_SHELL,Shell],[r.TopAbs_SOLID,Solid],[r.TopAbs_COMPSOLID,CompSolid],[r.TopAbs_COMPOUND,Compound]]).get(shapeType(t));if(!i)throw new Error("Could not find a wrapper for this shape type");return new i(downcast(t))}const makeLine=(t,e)=>{const r=getOC();return new Edge(new r.BRepBuilderAPI_MakeEdge_3(asPnt(t),asPnt(e)).Edge())},makeCircle=(t,e=[0,0,0],r=[0,0,1])=>{const n=getOC(),[i,o]=localGC(),a=i(makeAx2(e,r)),l=i(new n.gp_Circ_2(a,t)),f=i(new n.BRepBuilderAPI_MakeEdge_8(l)),d=new Edge(f.Edge());return o(),d},makeEllipse=(t,e,r=[0,0,0],n=[0,0,1],i)=>{const o=getOC(),[a,l]=localGC(),f=a(makeAx2(r,n,i));if(e>t)throw new Error("The minor radius must be smaller than the major one");const d=a(new o.gp_Elips_2(f,t,e)),g=a(new o.BRepBuilderAPI_MakeEdge_12(d)),b=new Edge(g.Edge());return l(),b},makeHelix=(t,e,r,n=[0,0,0],i=[0,0,1],o=!1)=>{const a=getOC(),[l,f]=localGC();let d=2*Math.PI;o&&(d=-2*Math.PI);const g=l(new a.Geom2d_Line_3(l(new a.gp_Pnt2d_3(0,0)),l(new a.gp_Dir2d_4(d,t)))),b=e/t,_=g.Value(0),E=g.Value(b*Math.sqrt((2*Math.PI)**2+t**2)),k=l(new a.GCE2d_MakeSegment_1(_,E)),D=new a.Geom_CylindricalSurface_1(l(makeAx3(n,i)),r),L=l(new a.BRepBuilderAPI_MakeEdge_30(l(new a.Handle_Geom2d_Curve_2(k.Value().get())),l(new a.Handle_Geom_Surface_2(D)))).Edge(),M=l(new a.BRepBuilderAPI_MakeWire_2(L)).Wire();return a.BRepLib.BuildCurves3d_2(M),f(),new Edge(M)},makeThreePointArc=(t,e,r)=>{const n=getOC(),i=new n.GC_MakeArcOfCircle_4(asPnt(t),asPnt(e),asPnt(r)).Value(),o=new n.Handle_Geom_Curve_2(i.get());return new Edge(new n.BRepBuilderAPI_MakeEdge_24(o).Edge())},makeEllipseArc=(t,e,r,n,i=[0,0,0],o=[0,0,1],a)=>{const l=getOC(),[f,d]=localGC(),g=f(makeAx2(i,o,a));if(e>t)throw new Error("The minor radius must be smaller than the major one");const b=f(new l.gp_Elips_2(g,t,e)),_=f(new l.BRepBuilderAPI_MakeEdge_13(b,r,n)),E=new Edge(_.Edge());return d(),E},makeBSplineApproximation=function(e,{tolerance:r=.001,smoothing:n=null,degMax:i=6,degMin:o=1}={}){const a=getOC(),[l,f]=localGC(),d=l(new a.TColgp_Array1OfPnt_2(1,e.length));e.forEach((k,D)=>{d.SetValue(D+1,l(asPnt(k)))});let g;if(n?g=l(new a.GeomAPI_PointsToBSpline_5(d,n[0],n[1],n[2],i,a.GeomAbs_Shape.GeomAbs_C2,r)):g=l(new a.GeomAPI_PointsToBSpline_2(d,o,i,a.GeomAbs_Shape.GeomAbs_C2,r)),!g.IsDone())throw f(),new Error("B-spline approximation failed");const b=l(g.Curve()),_=l(new a.Handle_Geom_Curve_2(b.get())),E=new Edge(new a.BRepBuilderAPI_MakeEdge_24(_).Edge());return f(),E},makeBezierCurve=t=>{const e=getOC(),r=new e.TColgp_Array1OfPnt_2(1,t.length);t.forEach((o,a)=>{r.SetValue(a+1,asPnt(o))});const n=new e.Geom_BezierCurve_1(r),i=new e.Handle_Geom_Curve_2(n);return new Edge(new e.BRepBuilderAPI_MakeEdge_24(i).Edge())},makeTangentArc=(t,e,r)=>{const n=getOC(),[i,o]=localGC(),a=i(new n.GC_MakeArcOfCircle_5(i(asPnt(t)),new Vector(e).wrapped,i(asPnt(r))).Value()),l=i(new n.Handle_Geom_Curve_2(a.get())),f=new Edge(i(new n.BRepBuilderAPI_MakeEdge_24(l)).Edge());return o(),f},assembleWire=t=>{const e=getOC(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(a=>{a instanceof Edge&&r.Add_1(a.wrapped),a instanceof Wire&&r.Add_2(a.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const i=r.Error();if(i!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const a=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${a.get(i)||"unknown error"}`)}const o=new Wire(r.Wire());return r.delete(),n.delete(),o},makeFace=(t,e)=>{const r=getOC(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(o=>{n.Add(o.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const i=n.Face();return n.delete(),new Face(i)},makeNewFaceWithinFace=(t,e)=>{const r=getOC(),[n,i]=localGC(),o=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(o,e.wrapped,!0)).Face();return i(),new Face(l)},makeNonPlanarFace=t=>{const e=getOC(),[r,n]=localGC(),i=r(new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9));t.edges.forEach(l=>{i.Add_1(r(l).wrapped,e.GeomAbs_Shape.GeomAbs_C0,!0)});const o=r(new e.Message_ProgressRange_1);i.Build(o);const a=cast(i.Shape());if(n(),!(a instanceof Face))throw new Error("Failed to create a face");return a},makeCylinder=(t,e,r=[0,0,0],n=[0,0,1])=>{const i=getOC(),o=makeAx2(r,n),a=new i.BRepPrimAPI_MakeCylinder_3(o,t,e),l=new Solid(a.Shape());return o.delete(),a.delete(),l},makeSphere=t=>{const e=getOC(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new Solid(r.Shape());return r.delete(),n},makeVertex=t=>{const e=getOC(),r=asPnt(t),n=new e.BRepBuilderAPI_MakeVertex(r),i=n.Vertex();return n.delete(),new Vertex(i)},makeOffset=(t,e,r=1e-6)=>{const n=getOC(),i=new n.Message_ProgressRange_1,o=new n.BRepOffsetAPI_MakeOffsetShape;o.PerformByJoin(t.wrapped,e,r,n.BRepOffset_Mode.BRepOffset_Skin,!1,!1,n.GeomAbs_JoinType.GeomAbs_Arc,!1,i);const a=cast(downcast(o.Shape()));if(o.delete(),i.delete(),!isShape3D(a))throw new Error("Could not offset to a 3d shape");return a},compoundShapes=t=>{const e=getOC(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(o=>{r.Add(n,o.wrapped),o.delete()}),cast(n)},makeCompound=compoundShapes;function makeSolid(t){const e=getOC(),[r,n]=localGC(),i=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));t.forEach(({wrapped:l})=>{i.Add(l)}),i.Perform(r(new e.Message_ProgressRange_1));const o=r(downcast(i.SewedShape())),a=cast(r(new e.ShapeFix_Solid_1).SolidFromShell(o));if(n(),!(a instanceof Solid))throw new Error("Could not make a solid of faces and shells");return a}const addHolesInFace=(t,e)=>{const r=getOC(),[n,i]=localGC(),o=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(d=>{o.Add(d.wrapped)});const a=n(o.Face()),l=n(new r.ShapeFix_Face_2(a));l.FixOrientation_1();const f=l.Face();return i(),new Face(f)},makePolygon=t=>{if(t.length<3)throw new Error("You need at least 3 points to make a polygon");const e=zip([t,[...t.slice(1),t[0]]]).map(([r,n])=>makeLine(r,n));return makeFace(assembleWire(e))},isTangent=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,defaultsSplineConfig=t=>{let e;t?isTangent(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:i=1,startTangent:o}=e;let a;typeof r=="number"?a=polarToCartesian(1,r*DEG2RAD):a=r;let l;return typeof o=="number"?l=polarToCartesian(1,o*DEG2RAD):l=o,{endTangent:a,startFactor:n,endFactor:i,startTangent:l}};function radianAngle(t,e,r,n){const i=t*r+e*n,o=Math.sqrt((t*t+e*e)*(r*r+n*n));let a=Math.acos(i/o);return t*n-e*r<0&&(a=-a),a}function convertSvgEllipseParams([t,e],[r,n],i,o,a,l,f){const d=Math.PI*2;if(i<0&&(i=-i),o<0&&(o=-o),i==0||o==0)throw Error("rx and ry can not be 0");const g=Math.sin(a),b=Math.cos(a),_=(t-r)/2,E=(e-n)/2,k=(t+r)/2,D=(e+n)/2,L=b*_+g*E,M=b*E-g*_,U=L*L/(i*i)+M*M/(o*o);U>1&&(i=i*Math.sqrt(U),o=o*Math.sqrt(U));const R=i*o,z=i*M,X=o*L,se=z*z+X*X;if(!se)throw Error("start point can not be same as end point");let $=Math.sqrt(Math.abs((R*R-se)/se));l==f&&($=-$);const q=$*z/o,ee=-$*X/i,Pe=b*q-g*ee+k,ce=g*q+b*ee+D,ve=(L-q)/i,we=(L+q)/i,ue=(M-ee)/o,pe=(M+ee)/o,Q=radianAngle(1,0,ve,ue);let re=radianAngle(ve,ue,-we,-pe);for(;re>d;)re-=d;for(;re<0;)re+=d;f||(re-=d);let ye=Q+re;for(;ye>d;)ye-=d;for(;ye<0;)ye+=d;return{cx:Pe,cy:ce,startAngle:Q,deltaAngle:re,endAngle:ye,clockwise:!!f,rx:i,ry:o}}const basicFaceExtrusion=(t,e)=>{const r=getOC(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),i=new Solid(downcast(n.Shape()));return n.delete(),i},revolution=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const i=getOC(),o=makeAx1(e,r),a=new i.BRepPrimAPI_MakeRevol_1(t.wrapped,o,n*DEG2RAD,!1),l=cast(a.Shape());if(o.delete(),a.delete(),!isShape3D(l))throw new Error("Could not revolve to a 3d shape");return l};function genericSweep(t,e,{frenet:r=!1,auxiliarySpine:n,law:i=null,transitionMode:o="right",withContact:a,support:l,forceProfileSpineOthogonality:f}={},d=!1){const g=getOC(),b=o==="round"?!0:!!f,_=new g.BRepOffsetAPI_MakePipeShell(e.wrapped);if(o){const D={transformed:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[o];D&&_.SetTransitionMode(D)}l?_.SetMode_4(l):r&&_.SetMode_1(r),n&&_.SetMode_5(n.wrapped,!1,g.BRepFill_TypeOfContact.BRepFill_NoContact),i?_.SetLaw_1(t.wrapped,i,!!a,b):_.Add_1(t.wrapped,!!a,b);const E=new g.Message_ProgressRange_1;_.Build(E),d||_.MakeSolid();const k=cast(_.Shape());if(!isShape3D(k))throw new Error("Could not sweep to a 3d shape");if(d){const D=cast(_.FirstShape()),L=cast(_.LastShape());if(!isWire(D))throw new Error("Could not sweep with one start wire");if(!isWire(L))throw new Error("Could not sweep with one end wire");return _.delete(),[k,D,L]}return _.delete(),E.delete(),k}const buildLawFromProfile=(t,{profile:e,endFactor:r=1})=>{let n;const i=getOC();if(e==="s-curve")n=new i.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new i.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)},supportExtrude=(t,e,r,n)=>{const i=new Vector(e),o=new Vector(r),a=makeLine(i,i.add(o)),l=assembleWire([a]);return genericSweep(t,l,{support:n})};function complexExtrude(t,e,r,n,i=!1){const o=new Vector(e),a=new Vector(r),l=makeLine(o,o.add(a)),f=assembleWire([l]),d=n?buildLawFromProfile(a.Length,n):null;return i?genericSweep(t,f,{law:d},i):genericSweep(t,f,{law:d},i)}function twistExtrude(t,e,r,n,i,o=!1){const a=new Vector(r),l=new Vector(n),f=makeLine(a,a.add(l)),d=assembleWire([f]),g=360/e*l.Length,_=makeHelix(g,l.Length,1,r,n),E=i?buildLawFromProfile(l.Length,i):null;return o?genericSweep(t,d,{auxiliarySpine:_,law:E},o):genericSweep(t,d,{auxiliarySpine:_,law:E},o)}const loft=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},i=!1)=>{const o=getOC(),[a,l]=localGC(),f=a(new o.BRepOffsetAPI_ThruSections(!i,e,1e-6));r&&f.AddVertex(a(makeVertex(r)).wrapped),t.forEach(b=>f.AddWire(b.wrapped)),n&&f.AddVertex(a(makeVertex(n)).wrapped);const d=a(new o.Message_ProgressRange_1);f.Build(d);const g=cast(f.Shape());if(l(),!isShape3D(g))throw new Error("Could not loft to a 3d shape");return g};class Sketch{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Sketch(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new Vector(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new Vector(e)}face(){let e;return this.baseFace?e=makeNewFaceWithinFace(this.baseFace,this.wire):e=makeFace(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=makeFace(this.wire),i=revolution(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),i}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:i,origin:o}={}){const[a,l]=localGC(),f=a(new Vector(r||this.defaultDirection).normalized().multiply(e));if(n&&!i){const b=complexExtrude(this.wire,o||this.defaultOrigin,f,n);return l(),this.delete(),b}if(i){const b=twistExtrude(this.wire,i,o||this.defaultOrigin,f,n);return l(),this.delete(),b}const d=makeFace(this.wire),g=basicFaceExtrusion(d,f);return l(),this.delete(),g}sweepSketch(e,r={}){const n=this.wire.startPoint,i=this.wire.tangentAt(1e-9).multiply(-1).normalize(),o=i.cross(this.defaultDirection).multiply(-1),a=e(new Plane(n,o,i),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const f=genericSweep(a.wire,this.wire,l);return this.delete(),f}loftWith(e,r={},n=!1){const i=Array.isArray(e)?[this,...e]:[this,e],o=loft(i.map(a=>a.wire),r,n);return i.forEach(a=>a.delete()),o}}class Sketcher{constructor(e,r){this.plane=e instanceof Plane?makePlane(e):makePlane(e,r),this.pointer=new Vector(this.plane.origin),this.firstPoint=new Vector(this.plane.origin),this.pendingEdges=[],this._mirrorWire=!1}delete(){this.plane.delete()}_updatePointer(e){this.pointer=e}movePointerTo([e,r]){if(this.pendingEdges.length)throw new Error("You can only move the pointer if there is no edge defined");return this._updatePointer(this.plane.toWorldCoords([e,r])),this.firstPoint=new Vector(this.pointer),this}lineTo([e,r]){const n=this.plane.toWorldCoords([e,r]);return this.pendingEdges.push(makeLine(this.pointer,n)),this._updatePointer(n),this}line(e,r){const n=this.plane.toLocalCoords(this.pointer);return this.lineTo([e+n.x,r+n.y])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){const r=this.plane.toLocalCoords(this.pointer);return this.lineTo([r.x,e])}hLineTo(e){const r=this.plane.toLocalCoords(this.pointer);return this.lineTo([e,r.y])}polarLine(e,r){const n=r*DEG2RAD,[i,o]=polarToCartesian(e,n);return this.line(i,o)}polarLineTo([e,r]){const n=r*DEG2RAD,i=polarToCartesian(e,n);return this.lineTo(i)}tangentLine(e){const[r,n]=localGC(),i=this.pendingEdges.length?this.pendingEdges[this.pendingEdges.length-1]:null;if(!i)throw new Error("you need a previous edge to create a tangent line");const o=r(i.tangentAt(1)),a=r(o.normalized().multiply(e)).add(this.pointer);return this.pendingEdges.push(makeLine(this.pointer,a)),this._updatePointer(a),n(),this}threePointsArcTo(e,r){const n=this.plane.toWorldCoords(r),i=this.plane.toWorldCoords(e);return this.pendingEdges.push(makeThreePointArc(this.pointer,n,i)),this._updatePointer(i),this}threePointsArc(e,r,n,i){const o=this.plane.toLocalCoords(this.pointer);return this.threePointsArcTo([o.x+e,o.y+r],[o.x+n,o.y+i])}tangentArcTo(e){const r=this.plane.toWorldCoords(e),n=this.pendingEdges[this.pendingEdges.length-1];return this.pendingEdges.push(makeTangentArc(n.endPoint,n.tangentAt(1),r)),this._updatePointer(r),this}tangentArc(e,r){const n=this.plane.toLocalCoords(this.pointer);return this.tangentArcTo([e+n.x,r+n.y])}sagittaArcTo(e,r){const n=this.pointer,i=this.plane.toWorldCoords(e);let o=i.add(n);const a=o.multiply(.5);o=i.sub(n);const f=o.cross(this.plane.zDir).normalized().multiply(r),d=a.add(f);return this.pendingEdges.push(makeThreePointArc(this.pointer,d,i)),this._updatePointer(i),this}sagittaArc(e,r,n){const i=this.plane.toLocalCoords(this.pointer);return this.sagittaArcTo([e+i.x,r+i.y],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=this.plane.toLocalCoords(this.pointer),i=distance2d([n.x,n.y],e)/2,o=-r*i;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){const i=this.plane.toLocalCoords(this.pointer);return this.bulgeArcTo([e+i.x,r+this.pointer.y],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}ellipseTo(e,r,n,i=0,o=!1,a=!1){const[l,f]=localGC(),d=this.plane.toLocalCoords(this.pointer);let g=i,b=r,_=n;r<n&&(g=i+90,b=n,_=r);const{cx:E,cy:k,rx:D,ry:L,startAngle:M,endAngle:U,clockwise:R}=convertSvgEllipseParams([d.x,d.y],e,b,_,g*DEG2RAD,o,a),z=l(new Vector(this.plane.xDir).rotate(g,this.plane.origin,this.plane.zDir)),X=makeEllipseArc(D,L,R?M:U,R?U:M,l(this.plane.toWorldCoords([E,k])),this.plane.zDir,z);return R||X.wrapped.Reverse(),this.pendingEdges.push(X),this._updatePointer(this.plane.toWorldCoords(e)),f(),this}ellipse(e,r,n,i,o=0,a=!1,l=!1){const f=this.plane.toLocalCoords(this.pointer);return this.ellipseTo([e+f.x,r+f.y],n,i,o,a,l)}halfEllipseTo(e,r,n=!1){const i=this.plane.toLocalCoords(this.pointer),o=[i.x,i.y],a=polarAngle2d(e,o),l=distance2d(e,o);return this.ellipseTo(e,l/2,r,a*RAD2DEG,!1,n)}halfEllipse(e,r,n,i=!1){const o=this.plane.toLocalCoords(this.pointer);return this.halfEllipseTo([e+o.x,r+o.y],n,i)}bezierCurveTo(e,r){let n;r.length===2&&!Array.isArray(r[0])?n=[r]:n=r;const i=n.map(a=>this.plane.toWorldCoords(a)),o=this.plane.toWorldCoords(e);return this.pendingEdges.push(makeBezierCurve([this.pointer,...i,o])),this._updatePointer(o),this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const[n,i]=localGC(),{endTangent:o,startTangent:a,startFactor:l,endFactor:f}=defaultsSplineConfig(r),d=this.plane.toWorldCoords(e),g=this.pendingEdges.length?this.pendingEdges[this.pendingEdges.length-1]:null,b=n(d.sub(this.pointer)).Length*.25;let _;if(a)_=this.plane.toWorldCoords(a);else if(!g)_=this.plane.toWorldCoords([1,0]);else if(g.geomType==="BEZIER_CURVE"){const U=n(g.curve).wrapped.Bezier().get(),R=n(new Vector(U.Pole(U.NbPoles()-1)));_=n(this.pointer.sub(R))}else _=n(g.tangentAt(1));const E=n(_.normalized().multiply(l*b)),k=n(this.pointer.add(E));let D;o==="symmetric"?D=n(_.multiply(-1)):D=n(this.plane.toWorldCoords(o));const L=n(D.normalized().multiply(f*b)),M=n(d.sub(L));return this.pendingEdges.push(makeBezierCurve([this.pointer,k,M,d])),this._updatePointer(d),i(),this}smoothSpline(e,r,n={}){const i=this.plane.toLocalCoords(this.pointer);return this.smoothSplineTo([e+i.x,r+i.y],n)}_mirrorWireOnStartEnd(e){const n=this.pointer.sub(this.firstPoint).normalize().cross(this.plane.zDir),i=e.clone().mirror(n,this.pointer);return assembleWire([e,i])}buildWire(){if(!this.pendingEdges.length)throw new Error("No lines to convert into a wire");let e=assembleWire(this.pendingEdges);return this._mirrorWire&&(e=this._mirrorWireOnStartEnd(e)),e}_closeSketch(){if(!this.pointer.equals(this.firstPoint)&&!this._mirrorWire){const e=this.plane.toLocalCoords(this.firstPoint);this.lineTo([e.x,e.y])}}done(){return new Sketch(this.buildWire(),{defaultOrigin:this.plane.origin,defaultDirection:this.plane.zDir})}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._mirrorWire=!0,this.close()}}const curvesBoundingBox=t=>{const e=getOC(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new BoundingBox2d(r)};function curvesAsEdgesOnPlane(t,e){const[r,n]=localGC(),i=r(makeAx2(e.origin,e.zDir,e.xDir)),o=getOC(),a=t.map(l=>{const f=o.GeomLib.To3d(i,l.wrapped);return new Edge(new o.BRepBuilderAPI_MakeEdge_24(f).Edge())});return n(),a}const curvesAsEdgesOnSurface=(t,e)=>{const[r,n]=localGC(),i=getOC(),o=t.map(a=>{const l=r(new i.BRepBuilderAPI_MakeEdge_30(a.wrapped,e));return new Edge(l.Edge())});return n(),o},transformCurves=(t,e)=>{const r=getOC();return t.map(i=>e?new Curve2D(r.GeomLib.GTransform(i.wrapped,e)):i.clone())};class Transformation2D extends WrappingObj{transformCurves(e){return transformCurves(e,this.wrapped)}}const stretchTransform2d=(t,e,r=[0,0])=>{const n=getOC(),i=axis2d(r,e),o=new n.gp_GTrsf2d_1;return o.SetAffinity(i,t),i.delete(),new Transformation2D(o)},translationTransform2d=t=>{const e=getOC(),[r,n]=localGC(),i=new e.gp_Trsf2d_1;i.SetTranslation_1(r(vec(t)));const o=new e.gp_GTrsf2d_2(i);return n(),new Transformation2D(o)},mirrorTransform2d=(t,e=[0,0],r="center")=>{const n=getOC(),[i,o]=localGC(),a=new n.gp_Trsf2d_1;r==="center"?a.SetMirror_1(i(pnt(t))):a.SetMirror_2(i(axis2d(e,t)));const l=new n.gp_GTrsf2d_2(a);return o(),new Transformation2D(l)},rotateTransform2d=(t,e=[0,0])=>{const r=getOC(),[n,i]=localGC(),o=new r.gp_Trsf2d_1;o.SetRotation(n(pnt(e)),t);const a=new r.gp_GTrsf2d_2(o);return i(),new Transformation2D(a)},scaleTransform2d=(t,e=[0,0])=>{const r=getOC(),[n,i]=localGC(),o=new r.gp_Trsf2d_1;o.SetScale(n(pnt(e)),t);const a=new r.gp_GTrsf2d_2(o);return i(),new Transformation2D(a)};function curvesAsEdgesOnFace(t,e,r="original"){const[n,i]=localGC(),o=getOC();let a=n(o.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let f=null;const d=n(axis2d([0,0],[0,1])),g=n(axis2d([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const E=n(a.get().Cylinder());E.Direct()||(a=a.get().UReversed());const k=E.Radius();f=stretchTransform2d(1/k,[0,1]).wrapped}if(r==="bounds"){if(f=n(new o.gp_GTrsf2d_1),f.SetAffinity(d,l.uMax-l.uMin),l.uMin!==0){const k=n(new o.gp_GTrsf2d_1);k.SetTranslationPart(new o.gp_XY_2(0,-l.uMin)),f.Multiply(k)}const E=n(new o.gp_GTrsf2d_1);if(E.SetAffinity(g,l.vMax-l.vMin),f.Multiply(E),l.vMin!==0){const k=n(new o.gp_GTrsf2d_1);k.SetTranslationPart(n(new o.gp_XY_2(0,-l.vMin))),f.Multiply(k)}}const b=transformCurves(t,f),_=curvesAsEdgesOnSurface(b,a);return i(),_}function edgeToCurve(t,e){const r=getOC(),i=GCWithScope()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),o=new r.Geom2d_TrimmedCurve(i.Curve(),i.FirstParameter(),i.LastParameter(),!0,!0);return t.orientation==="backward"&&o.Reverse(),new Curve2D(new r.Handle_Geom2d_Curve_2(o))}const viewbox=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},asSVG=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${viewbox(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class Blueprint{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new Blueprint(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=curvesBoundingBox(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,i)=>{const o=e[(i+1)%e.length];return(o[0]-n[0])*(o[1]+n[1])}).reduce((n,i)=>n+i,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const i=stretchTransform2d(e,r,n).transformCurves(this.curves);return new Blueprint(i)}scale(e,r){const n=r||this.boundingBox.center,i=scaleTransform2d(e,n).transformCurves(this.curves);return new Blueprint(i)}rotate(e,r){const n=rotateTransform2d(e*DEG2RAD,r).transformCurves(this.curves);return new Blueprint(n)}translate(e,r=0){const n=isPoint2D(e)?e:[e,r],i=translationTransform2d(n).transformCurves(this.curves);return new Blueprint(i)}mirror(e,r=[0,0],n="center"){const i=mirrorTransform2d(e,r,n).transformCurves(this.curves);return new Blueprint(i)}sketchOnPlane(e,r){const n=e instanceof Plane?makePlane(e):makePlane(e,r),i=curvesAsEdgesOnPlane(this.curves,n),o=assembleWire(i);return new Sketch(o,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=getOC(),i=curvesAsEdgesOnFace(this.curves,e,r),o=assembleWire(i);n.BRepLib.BuildCurves3d_2(o.wrapped);const a=new n.ShapeFix_Wire_2(o.wrapped,e.wrapped,1e-9);a.FixEdgeCurves(),a.delete();const l=new Sketch(o);if(o.isClosed){const f=l.clone().face();l.defaultOrigin=f.pointOnSurface(.5,.5),l.defaultDirection=f.normalAt(),f.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const f=o.startPoint;l.defaultOrigin=f,l.defaultDirection=e.normalAt(f),l.baseFace=e}return l}toSVGPathD(){const e=GCWithScope(),r=this.clone().mirror([1,0],[0,0],"plane"),n=r.curves.flatMap(a=>{if((a.geomType==="ELLIPSE"||a.geomType==="CIRCLE")&&samePoint$2(a.firstPoint,a.lastPoint)){const[l,f]=a.splitAt([.5]);return[adaptedCurveToPathElem(e(l.adaptor()),l.lastPoint),adaptedCurveToPathElem(e(f.adaptor()),f.lastPoint)]}return adaptedCurveToPathElem(e(a.adaptor()),a.lastPoint)}),[i,o]=r.curves[0].firstPoint;return`M ${round5(i)} ${round5(o)} ${n.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return asSVG(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1,i=make2dSegmentCurve(e,this.boundingBox.outsidePoint());let o=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(i.boundingBox)||(n.Init_1(i.wrapped,l.wrapped,1e-9),o+=n.NbPoints())}),n.delete(),!!(o%2))}isClosed(){return samePoint$2(this.firstPoint,this.lastPoint)}intersects(e){const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const i of this.curves)for(const o of e.curves)if(!i.boundingBox.isOut(o.boundingBox)&&(n.Init_1(i.wrapped,o.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class BaseSketcher2d{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?chamferCurves:filletCurves;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=make2dSegmentCurve(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*DEG2RAD,i=polarToCartesian(e,n);return this.lineTo(i)}polarLine(e,r){const n=r*DEG2RAD,[i,o]=polarToCartesian(e,n);return this.line(i,o)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=normalize2d(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(make2dThreePointArc(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,i){const[o,a]=this.pointer;return this.threePointsArcTo([o+e,a+r],[o+n,a+i])}sagittaArcTo(e,r){const[n,i]=this.pointer,[o,a]=e,l=[(n+o)/2,(i+a)/2],f=[-(a-i),o-n],d=Math.sqrt(f[0]**2+f[1]**2),g=[l[0]+f[0]/d*r,l[1]+f[1]/d*r];return this.saveCurve(make2dThreePointArc(this._convertToUV(this.pointer),this._convertToUV(g),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=distance2d(this.pointer,e)/2,i=-r*n;return this.sagittaArcTo(e,i)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(make2dTangentArc(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,i]=this.pointer;return this.tangentArcTo([e+n,r+i])}ellipseTo(e,r,n,i=0,o=!1,a=!1){let l=i,f=r,d=n;r<n&&(l=i+90,f=n,d=r);const g=l*DEG2RAD,b=q=>distance2d(this._convertToUV(q)),_=b(polarToCartesian(f,g)),E=b(polarToCartesian(d,g+Math.PI/2)),k=normalize2d(this._convertToUV(rotate2d([1,0],g))),[,D]=cartesianToPolar(k),{cx:L,cy:M,startAngle:U,endAngle:R,clockwise:z,rx:X,ry:se}=convertSvgEllipseParams(this._convertToUV(this.pointer),this._convertToUV(e),_,E,D,o,a),$=make2dEllipseArc(X,se,z?U:R,z?R:U,[L,M],k);return z||$.reverse(),this.saveCurve($),this.pointer=e,this}ellipse(e,r,n,i,o=0,a=!1,l=!1){const[f,d]=this.pointer;return this.ellipseTo([e+f,r+d],n,i,o,a,l)}halfEllipseTo(e,r,n=!1){const i=polarAngle2d(e,this.pointer),o=distance2d(e,this.pointer);return this.ellipseTo(e,o/2,r,i*RAD2DEG,!0,n)}halfEllipse(e,r,n,i=!1){const[o,a]=this.pointer;return this.halfEllipseTo([o+e,a+r],n,i)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(make2dBezierCurve(this._convertToUV(this.pointer),n.map(i=>this._convertToUV(i)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:i,startFactor:o,endFactor:a}=defaultsSplineConfig(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,f=distance2d(this.pointer,e)*.25;let d;i?d=i:l?d=this._convertFromUV(l.tangentAt(1)):d=[1,0],d=normalize2d(d);const g=[this.pointer[0]+d[0]*o*f,this.pointer[1]+d[1]*o*f];let b;n==="symmetric"?b=[-d[0],-d[1]]:b=n,b=normalize2d(b);const _=[e[0]-b[0]*a*f,e[1]-b[1]*a*f];return this.cubicBezierCurveTo(e,g,_)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),i=this.pendingCurves.shift();if(!n||!i)throw new Error("Not enough curves to close and fillet");const o=r==="chamfer"?chamferCurves:filletCurves;this.pendingCurves.push(...o(n,i,e))}_closeSketch(){samePoint$2(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(samePoint$2(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=axis2d(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(i=>new Curve2D(i.innerCurve.Mirrored_2(r)));n.reverse(),n.map(i=>i.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class FaceSketcher extends BaseSketcher2d{constructor(e,r=[0,0]){super(r),this.face=e.clone(),this._bounds=e.UVBounds}_convertToUV([e,r]){const{uMin:n,uMax:i,vMin:o,vMax:a}=this._bounds;return[n+e*(i-n),o+r*(a-o)]}_convertFromUV([e,r]){const{uMin:n,uMax:i,vMin:o,vMax:a}=this._bounds;return[(e-n)/(i-n),(r-o)/(a-o)]}_adaptSurface(){return getOC().BRep_Tool.Surface_2(this.face.wrapped)}buildWire(){const[e,r]=localGC(),n=getOC(),i=e(this._adaptSurface()),o=this.pendingCurves.map(l=>e(new Edge(e(new n.BRepBuilderAPI_MakeEdge_30(l.wrapped,i)).Edge()))),a=assembleWire(o);return n.BRepLib.BuildCurves3d_2(a.wrapped),r(),a}done(){const[e,r]=localGC(),n=this.buildWire(),i=new Sketch(n);if(n.isClosed){const o=e(i.clone().face());i.defaultOrigin=e(o.pointOnSurface(.5,.5)),i.defaultDirection=e(e(o.normalAt()).multiply(-1))}else{const o=e(n.startPoint);i.defaultOrigin=o,i.defaultDirection=e(this.face.normalAt(o))}return i.baseFace=this.face,r(),i}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}class BlueprintSketcher extends BaseSketcher2d{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Blueprint(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}class PhysicalProperties extends WrappingObj{get centerOfMass(){const r=GCWithScope()(this.wrapped.CentreOfMass());return[r.X(),r.Y(),r.Z()]}}class VolumePhysicalProperties extends PhysicalProperties{get volume(){return this.wrapped.Mass()}}class SurfacePhysicalProperties extends PhysicalProperties{get area(){return this.wrapped.Mass()}}class LinearPhysicalProperties extends PhysicalProperties{get length(){return this.wrapped.Mass()}}function measureShapeSurfaceProperties(t){const e=getOC(),r=new e.GProp_GProps_1;return e.BRepGProp.SurfaceProperties_1(t.wrapped,r,!1,!1),new SurfacePhysicalProperties(r)}function measureShapeLinearProperties(t){const e=getOC(),r=new e.GProp_GProps_1;return e.BRepGProp.LinearProperties(t.wrapped,r,!1,!1),new LinearPhysicalProperties(r)}function measureShapeVolumeProperties(t){const e=getOC(),r=new e.GProp_GProps_1;return e.BRepGProp.VolumeProperties_1(t.wrapped,r,!1,!1,!1),new VolumePhysicalProperties(r)}function measureVolume(t){return measureShapeVolumeProperties(t).volume}function measureArea(t){return measureShapeSurfaceProperties(t).area}function measureLength(t){return measureShapeLinearProperties(t).length}const makeBaseBox=(t,e,r)=>new Sketcher().movePointerTo([-t/2,e/2]).hLine(t).vLine(-e).hLine(-t).close().extrude(r),guessFaceFromWires=t=>{const e=getOC(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((o,a)=>{o.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,a===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const i=cast(r.Shape());if(r.delete(),!(i instanceof Face))throw new Error("Failed to create a face");return i},fixWire=(t,e)=>{const r=getOC(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},faceFromWires=t=>{let e,r;try{e=makeFace(t[0]),r=t.slice(1)}catch{e=guessFaceFromWires(t),r=t.slice(1).map(i=>fixWire(i,e))}return addHolesInFace(e,r)},solidFromShellGenerator=(t,e)=>{const r=[],n=[],i=[];t.forEach(f=>{const[d,g,b]=e(f);r.push(d),n.push(g),i.push(b)});const o=faceFromWires(n),a=faceFromWires(i);return makeSolid([o,...r,a])};class CompoundSketch{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return compoundShapes(e)}face(){const e=this.outerSketch.face();return addHolesInFace(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:i,origin:o}={}){const a=new Vector(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!i?solidFromShellGenerator(this.sketches,d=>complexExtrude(d.wire,o||this.outerSketch.defaultOrigin,a,n,!0)):i?solidFromShellGenerator(this.sketches,d=>twistExtrude(d.wire,i,o||this.outerSketch.defaultOrigin,a,n,!0)):basicFaceExtrusion(this.face(),a)}revolve(e,{origin:r}={}){return revolution(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((o,a)=>{const l=e.sketches[a];return o.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),i=this.face().clone();return n.push(i,e.face()),makeSolid(n)}}class CompoundBlueprint{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new CompoundBlueprint(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new BoundingBox2d;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new CompoundBlueprint(this.blueprints.map(i=>i.stretch(e,r,n)))}rotate(e,r){return new CompoundBlueprint(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new CompoundBlueprint(this.blueprints.map(i=>i.scale(e,n)))}translate(e,r=0){return new CompoundBlueprint(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new CompoundBlueprint(this.blueprints.map(i=>i.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(i=>i.sketchOnPlane(e,r));return new CompoundSketch(n)}sketchOnFace(e,r){const n=this.blueprints.map(i=>i.sketchOnFace(e,r));return new CompoundSketch(n)}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return asSVG(this.toSVGGroup(),this.boundingBox,e)}}class Sketches{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof Sketch?r.wire:r.wires);return compoundShapes(e)}faces(){const e=this.sketches.map(r=>r.face());return compoundShapes(e)}extrude(e,r={}){const n=this.sketches.map(i=>i.extrude(e,r));return compoundShapes(n)}revolve(e,r){return compoundShapes(this.sketches.map(n=>n.revolve(e,r)))}}class Blueprints{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new Blueprints(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new BoundingBox2d;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new Blueprints(this.blueprints.map(i=>i.stretch(e,r,n)))}rotate(e,r){return new Blueprints(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new Blueprints(this.blueprints.map(i=>i.scale(e,n)))}translate(e,r=0){return new Blueprints(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new Blueprints(this.blueprints.map(i=>i.mirror(e,r,n)))}sketchOnPlane(e,r){return new Sketches(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new Sketches(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof Blueprint?n.toSVGPath():n.toSVGGroup());return asSVG(r.join(`
    `),this.boundingBox,e)}}const groupByBoundingBoxOverlap=t=>{const e=t.map((i,o)=>t.slice(o+1).map((a,l)=>[l+o+1,a]).filter(([,a])=>!i.boundingBox.isOut(a.boundingBox)).map(([a])=>a)),r=[],n=Array(e.length);return e.forEach((i,o)=>{let a=n[o];a||(a=[],r.push(a)),a.push(t[o]),i.length&&i.forEach(l=>{n[l]=a})}),r},addContainmentInfo=t=>t.map((e,r)=>{const n=e.curves[0],i=n.value((n.lastParameter+n.firstParameter)/2),o=t.filter((a,l)=>r===l?!1:a.isInside(i));return{blueprint:e,isIn:o}}),splitMultipleOuterBlueprints=(t,e)=>t.flatMap(({blueprint:r})=>cleanEdgeCases(e.filter(({blueprint:n,isIn:i})=>n===r||i.indexOf(r)!==-1))),handleNestedBlueprints=(t,e)=>{const r=e.filter(({isIn:i})=>i.length<=1),n=cleanEdgeCases(addContainmentInfo(t.map(({blueprint:i})=>i)));return[r,...n]},cleanEdgeCases=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?splitMultipleOuterBlueprints(e,t):handleNestedBlueprints(r,t)},organiseBlueprints=t=>{const e=groupByBoundingBoxOverlap(t).map(addContainmentInfo);return new Blueprints(e.flatMap(cleanEdgeCases).map(r=>r.length===1?r[0].blueprint:(r.sort((n,i)=>n.isIn.length-i.isIn.length),new CompoundBlueprint(r.map(({blueprint:n})=>n)))))},polysidesBlueprint=(t,e,r=0)=>{const n=[...Array(e).keys()].map(o=>{const a=-(Math.PI*2/e)*o;return[t*Math.sin(a),t*Math.cos(a)]}),i=new BlueprintSketcher().movePointerTo([n[n.length-1][0],n[n.length-1][1]]);return r?n.forEach(([o,a])=>i.sagittaArcTo([o,a],r)):n.forEach(([o,a])=>i.lineTo([o,a])),i.done()},roundedRectangleBlueprint$1=(t,e,r=0)=>{const{rx:n=0,ry:i=0}=typeof r=="number"?{ry:r,rx:r}:r;let o=Math.min(n,t/2),a=Math.min(i,e/2);const l=o&&a;l||(o=0,a=0);const f=o===a,d=new BlueprintSketcher([Math.min(0,-(t/2-o)),-e/2]),g=(b,_)=>{l&&(f?d.tangentArc(b,_):d.ellipse(b,_,o,a,0,!1,!0))};return o<t/2&&d.hLine(t-2*o),g(o,a),a<e/2&&d.vLine(e-2*a),g(-o,a),o<t/2&&d.hLine(-(t-2*o)),g(-o,-a),a<e/2&&d.vLine(-(e-2*a)),g(o,-a),d.close()},PRECISION$1=1e-9,samePoint$1=(t,e)=>samePoint$2(t,e,PRECISION$1),curveMidPoint=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},rotateToStartAt=(t,e)=>{const r=t.findIndex(o=>samePoint$1(e,o.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},rotateToStartAtSegment=(t,e)=>{const r=a=>samePoint$1(e.firstPoint,a.firstPoint)&&samePoint$1(e.lastPoint,a.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=reverseSegment(t),n=t.findIndex(r),n===-1))throw console.error(t.map(a=>a.repr),e.repr),new Error("Failed to rotate to segment start");const i=t.slice(0,n);return t.slice(n).concat(i)};function*createSegmentOnPoints(t,e,r){const n=a=>!!e.find(l=>samePoint$1(l,a.lastPoint)),i=a=>!!r.find(l=>samePoint$1(l.firstPoint,a.firstPoint)&&samePoint$1(l.lastPoint,a.lastPoint)||samePoint$1(l.firstPoint,a.lastPoint)&&samePoint$1(l.lastPoint,a.firstPoint));let o=[];for(const a of t)n(a)?(o.push(a),yield o,o=[]):i(a)?(o.length&&(yield o,o=[]),yield[a]):o.push(a);o.length&&(yield o)}const startOfSegment=t=>t[0].firstPoint,endOfSegment=t=>t[t.length-1].lastPoint,reverseSegment=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),reverseSegments=t=>(t.reverse(),t.map(reverseSegment));function removeNonCrossingPoint(t,e,r){return t.filter(n=>{const i=e.filter(l=>samePoint$1(l.firstPoint,n)||samePoint$1(l.lastPoint,n));if(i.length%2)throw console.error(i,n),new Error("Bug in the intersection algo on non crossing point");const o=i.map(l=>r.isInside(curveMidPoint(l)));return!(o.every(l=>l)||!o.some(l=>l))})}function blueprintsIntersectionSegments(t,e){let r=[];const n=[],i=new Array(t.curves.length).fill(0).map(()=>[]),o=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((_,E)=>{e.curves.forEach((k,D)=>{const{intersections:L,commonSegments:M,commonSegmentsPoints:U}=intersectCurves(_,k,PRECISION$1/100);r.push(...L),i[E].push(...L),o[D].push(...L),n.push(...M),r.push(...U),i[E].push(...U),o[D].push(...U)})}),r=removeDuplicatePoints(r,PRECISION$1),!r.length||r.length===1)return null;const a=([_,E])=>E.length?_.splitAt(E,PRECISION$1/100):[_];let l=zip([t.curves,i]).flatMap(a),f=zip([e.curves,o]).flatMap(a);const d=n.map(_=>[_.firstPoint,_.lastPoint]);if(r=removeNonCrossingPoint(r,l,e),!r.length&&!n.length)return null;if(n.length){const _=n[0];l=rotateToStartAtSegment(l,_),f=rotateToStartAtSegment(f,_)}else{const _=r[0];l=rotateToStartAt(l,_),f=rotateToStartAt(f,_)}const g=Array.from(createSegmentOnPoints(l,r,n));let b=Array.from(createSegmentOnPoints(f,r,n));return(!samePoint$1(endOfSegment(b[0]),endOfSegment(g[0]))||n.length>0&&b[0].length!==1)&&(b=reverseSegments(b)),zip([g,b]).map(([_,E])=>{const k=startOfSegment(_),D=endOfSegment(_);return d.find(([L,M])=>samePoint$1(L,k)&&samePoint$1(M,D)||samePoint$1(L,D)&&samePoint$1(L,k))?[_,"same"]:[_,E]})}const splitPaths=t=>{const e=t.map(a=>a.firstPoint);let r=t.map(a=>a.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=zip([e,r]).map(([a,l],f)=>samePoint$1(a,l)?null:f).filter(a=>a!==null);if(!n.length)return[t];const i=zip([n.slice(0,-1),n.slice(1)]).map(([a,l])=>t.slice(a,l));let o=t.slice(n[n.length-1]);return n[0]!==0&&(o=o.concat(t.slice(0,n[0]))),i.push(o),i};function booleanOperation(t,e,{firstInside:r,secondInside:n}){const i=blueprintsIntersectionSegments(t,e);if(!i){const d=curveMidPoint(t.curves[0]),g=e.isInside(d),b=curveMidPoint(e.curves[0]),_=t.isInside(b);return{identical:!1,firstCurveInSecond:g,secondCurveInFirst:_}}if(i.every(([,d])=>d==="same"))return{identical:!0};let o=null,a=null;const l=i.flatMap(([d,g])=>{let b=[],_=0;if(g==="same")return a===1?(a=1,[...d]):a===2||a===0?(a=null,[]):a===null?(o?o=[...o,...d]:o=d,[]):(console.error("weird situation"),[]);const E=curveMidPoint(d[0]),k=e.isInside(E);(r==="keep"&&k||r==="remove"&&!k)&&(_+=1,b.push(...d));const D=curveMidPoint(g[0]),L=t.isInside(D);if(n==="keep"&&L||n==="remove"&&!L){let M=g;_===1&&(M=reverseSegment(g)),_+=1,b.push(...M)}return a===null&&_===1&&o&&(b=[...o,...b]),_===1&&(a=_,o=null),b}),f=splitPaths(l).filter(d=>d.length).map(d=>new Blueprint(d));return f.length===0?null:f.length===1?f[0]:organiseBlueprints(f)}const fuseBlueprints=(t,e)=>{const r=booleanOperation(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new Blueprints([t,e])},cutBlueprints=(t,e)=>{const r=booleanOperation(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new Blueprints([new CompoundBlueprint([t,e])]):t.clone()},intersectBlueprints=(t,e)=>{const r=booleanOperation(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},genericIntersects=(t,e)=>{if(t instanceof Blueprint&&e instanceof Blueprint){let r=[];return t.curves.forEach(n=>{e.curves.forEach(i=>{const{intersections:o,commonSegmentsPoints:a}=intersectCurves(n,i);r.push(...o),r.push(...a)})}),r=removeDuplicatePoints(r),r.length>1}if(t instanceof CompoundBlueprint||t instanceof Blueprints)return t.blueprints.some(r=>genericIntersects(r,e));if(e instanceof CompoundBlueprint||e instanceof Blueprints)return e.blueprints.some(r=>genericIntersects(t,r));throw new Error("Bug in the generic intersects algorithm")},genericFuse=(t,e)=>{if(t instanceof CompoundBlueprint){if(e instanceof Blueprint)return fuseBlueprintWithCompound(e,t);if(e instanceof CompoundBlueprint)return fuseCompoundWithCompound(t,e)}if(e instanceof CompoundBlueprint){if(t instanceof Blueprint)return fuseBlueprintWithCompound(t,e);if(t instanceof CompoundBlueprint)return fuseCompoundWithCompound(t,e)}if(t instanceof Blueprint&&e instanceof Blueprint)return fuseBlueprints(t,e);throw new Error("Bug in the generic fuse algorithm")},fuseIntersectingBlueprints$1=t=>{const e=new Map,r=[];return t.forEach((n,i)=>{let o;e.has(i)?o=e.get(i):(o={current:n,fusedWith:new Set([i])},r.push(o)),t.slice(i+1).forEach((a,l)=>{const f=o.current,d=i+l+1;if(o.fusedWith.has(d))return;let g=a,b=!1;if(e.has(d)&&(g=e.get(d).current,b=!0),f.boundingBox.isOut(g.boundingBox)||!genericIntersects(f,g))return;let _;if(f instanceof Blueprints||g instanceof Blueprints?_=fuse2D(f,g):_=genericFuse(f,g),!(_ instanceof Blueprint||_ instanceof CompoundBlueprint)){if(_ instanceof Blueprints&&_.blueprints.length===2)return;if(_ instanceof Blueprints&&_.blueprints.length===1)_=_.blueprints[0];else if(!(_ instanceof Blueprints))throw console.error(_),new Error("Bug in blueprint fusing algorigthm")}o.fusedWith.add(d),o.current=_,b||e.set(d,o)})}),organiseBlueprints(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>allBlueprints(n)))},allBlueprints=t=>t instanceof Blueprint?[t]:t instanceof CompoundBlueprint?t.blueprints:t instanceof Blueprints?t.blueprints.flatMap(e=>allBlueprints(e)):[],fuseBlueprintWithCompound=(t,e)=>{const r=fuseBlueprints(t,e.blueprints[0]),n=e.blueprints.slice(1).map(i=>cutBlueprints(i,t));return organiseBlueprints([...allBlueprints(r),...n.flatMap(i=>allBlueprints(i))])};function allPairs(t,e){const r=[];for(const n of t)for(const i of e)r.push([n,i]);return r}const fuseCompoundWithCompound=(t,e)=>{const r=fuseBlueprints(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(a=>cutBlueprints(a,t.blueprints[0])),i=t.blueprints.slice(1).map(a=>cutBlueprints(a,e.blueprints[0])),o=allPairs(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([a,l])=>allBlueprints(intersectBlueprints(a,l)));return organiseBlueprints([...allBlueprints(r),...n.flatMap(a=>allBlueprints(a)),...i.flatMap(a=>allBlueprints(a)),...o])},fuse2D=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof Blueprints)&&e instanceof Blueprints)return fuseIntersectingBlueprints$1([t,...e.blueprints]);if(!(e instanceof Blueprints)&&t instanceof Blueprints)return fuseIntersectingBlueprints$1([e,...t.blueprints]);if(t instanceof Blueprints&&e instanceof Blueprints){let r=fuse2D(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=fuse2D(n,r)}),r}if(t instanceof CompoundBlueprint){if(e instanceof Blueprints)return fuse2D(e,t);if(e instanceof Blueprint)return fuseBlueprintWithCompound(e,t);if(e instanceof CompoundBlueprint)return fuseCompoundWithCompound(t,e)}if(e instanceof CompoundBlueprint){if(t instanceof Blueprints)return fuse2D(t,e);if(t instanceof Blueprint)return fuseBlueprintWithCompound(t,e);if(t instanceof CompoundBlueprint)return fuseCompoundWithCompound(t,e)}return t instanceof Blueprint&&e instanceof Blueprint?fuseBlueprints(t,e):null},mergeNonIntersecting=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof Blueprints?r.blueprints:r);return e.length===1?e[0]:new Blueprints(e)},cut2D=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof Blueprints)return mergeNonIntersecting(t.blueprints.map(n=>cut2D(n,e)));if(t instanceof CompoundBlueprint){const n=t.blueprints[0];if(e instanceof Blueprint&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const i=fuse2D(e,new Blueprints(t.blueprints.slice(1)));return organiseBlueprints([n,...allBlueprints(i)])}else{let i=cut2D(t.blueprints[0],e);return t.blueprints.slice(1).forEach(o=>{i=cut2D(i,o)}),i}}if(e instanceof Blueprints)return mergeNonIntersecting(e.blueprints.map(n=>cut2D(t,n)));if(e instanceof CompoundBlueprint){let n=cutBlueprints(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(i=>{n=fuse2D(n,intersectBlueprints(i,t))}),n}return cutBlueprints(t,e)};function intersect2D(t,e){if(t===null||e===null)return null;if(t instanceof Blueprint&&e instanceof Blueprint)return intersectBlueprints(t,e);if(t instanceof Blueprints)return mergeNonIntersecting(t.blueprints.map(r=>intersect2D(r,e)));if(t instanceof CompoundBlueprint){const r=t.blueprints[0],n=t.blueprints[1];return cut2D(intersect2D(r,e),n)}if(e instanceof Blueprints)return mergeNonIntersecting(e.blueprints.map(r=>intersect2D(t,r)));if(e instanceof CompoundBlueprint){const r=e.blueprints[0],n=e.blueprints[1];return cut2D(intersect2D(r,t),n)}throw new Error("intersct 2D algorithm error")}const sketchCircle=(t,e={})=>{const r=e.plane instanceof Plane?makePlane(e.plane):makePlane(e.plane,e.origin),n=assembleWire([makeCircle(t,r.origin,r.zDir)]),i=new Sketch(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),i},sketchEllipse=(t=1,e=2,r={})=>{const n=r.plane instanceof Plane?makePlane(r.plane):makePlane(r.plane,r.origin),i=new Vector(n.xDir);let o=t,a=e;e>t&&(i.rotate(90,n.origin,n.zDir),o=e,a=t);const l=assembleWire([makeEllipse(o,a,n.origin,n.zDir,i)]);i.delete();const f=new Sketch(l,{defaultOrigin:n.origin,defaultDirection:n.zDir});return n.delete(),f},sketchRectangle=(t,e,r={})=>(r.plane instanceof Plane?new Sketcher(r.plane):new Sketcher(r.plane,r.origin)).movePointerTo([-t/2,-e/2]).hLine(t).vLine(e).hLine(-t).vLine(-e).done(),sketchRoundedRectangle=(t,e,r=0,n={})=>roundedRectangleBlueprint$1(t,e,r).sketchOnPlane(n.plane,n.origin),sketchPolysides=(t,e,r=0,n={})=>{const i=[...Array(e).keys()].map(l=>{const f=-(Math.PI*2/e)*l;return[t*Math.sin(f),t*Math.cos(f)]}),a=(n.plane instanceof Plane?new Sketcher(n.plane):new Sketcher(n.plane,n.origin)).movePointerTo([i[i.length-1][0],i[i.length-1][1]]);return r?i.forEach(([l,f])=>a.sagittaArcTo([l,f],r)):i.forEach(([l,f])=>a.lineTo([l,f])),a.done()},polysideInnerRadius=(t,e,r=0)=>{const n=Math.PI/e,i=Math.cos(n)*t;return r>=0?i:i+r},sketchFaceOffset=(t,e)=>{const r=t.center,n=t.normalAt(),i=t.outerWire().offset2D(e),o=new Sketch(i,{defaultOrigin:r,defaultDirection:n});return r.delete(),n.delete(),o},sketchParametricFunction=(t,e={},{pointsCount:r=400,start:n=0,stop:i=1}={},o={})=>{const[a,l]=localGC(),f=a(e.plane instanceof Plane?makePlane(e.plane):makePlane(e.plane,e.origin)),d=(i-n)/r,g=[...Array(r+1).keys()].map(E=>{const k=t(n+E*d);return a(f.toWorldCoords(k))}),b=assembleWire([a(makeBSplineApproximation(g,o))]),_=new Sketch(b,{defaultOrigin:f.origin,defaultDirection:f.zDir});return l(),_},sketchHelix=(t,e,r,n=[0,0,0],i=[0,0,1],o=!1)=>new Sketch(assembleWire(makeHelix(t,e,r,n,i,o).wires));/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,i=n(r,r,r)&&n}catch{}return i}(),e=function(r){if(this==null)throw TypeError();var n=String(this),i=n.length,o=r?Number(r):0;if(o!=o&&(o=0),!(o<0||o>=i)){var a=n.charCodeAt(o),l;return a>=55296&&a<=56319&&i>o+1&&(l=n.charCodeAt(o+1),l>=56320&&l<=57343)?(a-55296)*1024+l-56320+65536:a}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();var TINF_OK=0,TINF_DATA_ERROR=-3;function Tree(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Data(t,e){this.source=t,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new Tree,this.dtree=new Tree}var sltree=new Tree,sdtree=new Tree,length_bits=new Uint8Array(30),length_base=new Uint16Array(30),dist_bits=new Uint8Array(30),dist_base=new Uint16Array(30),clcidx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),code_tree=new Tree,lengths=new Uint8Array(320);function tinf_build_bits_base(t,e,r,n){var i,o;for(i=0;i<r;++i)t[i]=0;for(i=0;i<30-r;++i)t[i+r]=i/r|0;for(o=n,i=0;i<30;++i)e[i]=o,o+=1<<t[i]}function tinf_build_fixed_trees(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[168+r]=280+r;for(r=0;r<112;++r)t.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}var offs=new Uint16Array(16);function tinf_build_tree(t,e,r,n){var i,o;for(i=0;i<16;++i)t.table[i]=0;for(i=0;i<n;++i)t.table[e[r+i]]++;for(t.table[0]=0,o=0,i=0;i<16;++i)offs[i]=o,o+=t.table[i];for(i=0;i<n;++i)e[r+i]&&(t.trans[offs[e[r+i]]++]=i)}function tinf_getbit(t){t.bitcount--||(t.tag=t.source[t.sourceIndex++],t.bitcount=7);var e=t.tag&1;return t.tag>>>=1,e}function tinf_read_bits(t,e,r){if(!e)return r;for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var n=t.tag&65535>>>16-e;return t.tag>>>=e,t.bitcount-=e,n+r}function tinf_decode_symbol(t,e){for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var r=0,n=0,i=0,o=t.tag;do n=2*n+(o&1),o>>>=1,++i,r+=e.table[i],n-=e.table[i];while(n>=0);return t.tag=o,t.bitcount-=i,e.trans[r+n]}function tinf_decode_trees(t,e,r){var n,i,o,a,l,f;for(n=tinf_read_bits(t,5,257),i=tinf_read_bits(t,5,1),o=tinf_read_bits(t,4,4),a=0;a<19;++a)lengths[a]=0;for(a=0;a<o;++a){var d=tinf_read_bits(t,3,0);lengths[clcidx[a]]=d}for(tinf_build_tree(code_tree,lengths,0,19),l=0;l<n+i;){var g=tinf_decode_symbol(t,code_tree);switch(g){case 16:var b=lengths[l-1];for(f=tinf_read_bits(t,2,3);f;--f)lengths[l++]=b;break;case 17:for(f=tinf_read_bits(t,3,3);f;--f)lengths[l++]=0;break;case 18:for(f=tinf_read_bits(t,7,11);f;--f)lengths[l++]=0;break;default:lengths[l++]=g;break}}tinf_build_tree(e,lengths,0,n),tinf_build_tree(r,lengths,n,i)}function tinf_inflate_block_data(t,e,r){for(;;){var n=tinf_decode_symbol(t,e);if(n===256)return TINF_OK;if(n<256)t.dest[t.destLen++]=n;else{var i,o,a,l;for(n-=257,i=tinf_read_bits(t,length_bits[n],length_base[n]),o=tinf_decode_symbol(t,r),a=t.destLen-tinf_read_bits(t,dist_bits[o],dist_base[o]),l=a;l<a+i;++l)t.dest[t.destLen++]=t.dest[l]}}}function tinf_inflate_uncompressed_block(t){for(var e,r,n;t.bitcount>8;)t.sourceIndex--,t.bitcount-=8;if(e=t.source[t.sourceIndex+1],e=256*e+t.source[t.sourceIndex],r=t.source[t.sourceIndex+3],r=256*r+t.source[t.sourceIndex+2],e!==(~r&65535))return TINF_DATA_ERROR;for(t.sourceIndex+=4,n=e;n;--n)t.dest[t.destLen++]=t.source[t.sourceIndex++];return t.bitcount=0,TINF_OK}function tinf_uncompress(t,e){var r=new Data(t,e),n,i,o;do{switch(n=tinf_getbit(r),i=tinf_read_bits(r,2,0),i){case 0:o=tinf_inflate_uncompressed_block(r);break;case 1:o=tinf_inflate_block_data(r,sltree,sdtree);break;case 2:tinf_decode_trees(r,r.ltree,r.dtree),o=tinf_inflate_block_data(r,r.ltree,r.dtree);break;default:o=TINF_DATA_ERROR}if(o!==TINF_OK)throw new Error("Data error")}while(!n);return r.destLen<r.dest.length?typeof r.dest.slice=="function"?r.dest.slice(0,r.destLen):r.dest.subarray(0,r.destLen):r.dest}tinf_build_fixed_trees(sltree,sdtree),tinf_build_bits_base(length_bits,length_base,4,3),tinf_build_bits_base(dist_bits,dist_base,2,1),length_bits[28]=0,length_base[28]=258;var tinyInflate=tinf_uncompress;function derive(t,e,r,n,i){return Math.pow(1-i,3)*t+3*Math.pow(1-i,2)*i*e+3*(1-i)*Math.pow(i,2)*r+Math.pow(i,3)*n}function BoundingBox2(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}BoundingBox2.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},BoundingBox2.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},BoundingBox2.prototype.addX=function(t){this.addPoint(t,null)},BoundingBox2.prototype.addY=function(t){this.addPoint(null,t)},BoundingBox2.prototype.addBezier=function(t,e,r,n,i,o,a,l){var f=[t,e],d=[r,n],g=[i,o],b=[a,l];this.addPoint(t,e),this.addPoint(a,l);for(var _=0;_<=1;_++){var E=6*f[_]-12*d[_]+6*g[_],k=-3*f[_]+9*d[_]-9*g[_]+3*b[_],D=3*d[_]-3*f[_];if(k===0){if(E===0)continue;var L=-D/E;0<L&&L<1&&(_===0&&this.addX(derive(f[_],d[_],g[_],b[_],L)),_===1&&this.addY(derive(f[_],d[_],g[_],b[_],L)));continue}var M=Math.pow(E,2)-4*D*k;if(!(M<0)){var U=(-E+Math.sqrt(M))/(2*k);0<U&&U<1&&(_===0&&this.addX(derive(f[_],d[_],g[_],b[_],U)),_===1&&this.addY(derive(f[_],d[_],g[_],b[_],U)));var R=(-E-Math.sqrt(M))/(2*k);0<R&&R<1&&(_===0&&this.addX(derive(f[_],d[_],g[_],b[_],R)),_===1&&this.addY(derive(f[_],d[_],g[_],b[_],R)))}}},BoundingBox2.prototype.addQuad=function(t,e,r,n,i,o){var a=t+.6666666666666666*(r-t),l=e+2/3*(n-e),f=a+1/3*(i-t),d=l+1/3*(o-e);this.addBezier(t,e,a,l,f,d,i,o)};function Path(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Path.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},Path.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(t,e,r,n,i,o){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:i,y:o})},Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})},Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})},Path.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof BoundingBox2){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)},Path.prototype.getBoundingBox=function(){for(var t=new BoundingBox2,e=0,r=0,n=0,i=0,o=0;o<this.commands.length;o++){var a=this.commands[o];switch(a.type){case"M":t.addPoint(a.x,a.y),e=n=a.x,r=i=a.y;break;case"L":t.addPoint(a.x,a.y),n=a.x,i=a.y;break;case"Q":t.addQuad(n,i,a.x1,a.y1,a.x,a.y),n=a.x,i=a.y;break;case"C":t.addBezier(n,i,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,i=a.y;break;case"Z":n=e,i=r;break;default:throw new Error("Unexpected path command "+a.type)}}return t.isEmpty()&&t.addPoint(0,0),t},Path.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},Path.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(t)}function r(){for(var a=arguments,l="",f=0;f<arguments.length;f+=1){var d=a[f];d>=0&&f>0&&(l+=" "),l+=e(d)}return l}for(var n="",i=0;i<this.commands.length;i+=1){var o=this.commands[i];o.type==="M"?n+="M"+r(o.x,o.y):o.type==="L"?n+="L"+r(o.x,o.y):o.type==="C"?n+="C"+r(o.x1,o.y1,o.x2,o.y2,o.x,o.y):o.type==="Q"?n+="Q"+r(o.x1,o.y1,o.x,o.y):o.type==="Z"&&(n+="Z")}return n},Path.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Path.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function fail(t){throw new Error(t)}function argument(t,e){t||fail(e)}var check={fail,argument,assert:argument},LIMIT16=32768,LIMIT32=2147483648,decode={},encode={},sizeOf={};function constant(t){return function(){return t}}encode.BYTE=function(t){return check.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},sizeOf.BYTE=constant(1),encode.CHAR=function(t){return[t.charCodeAt(0)]},sizeOf.CHAR=constant(1),encode.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e},sizeOf.CHARARRAY=function(t){return typeof t>"u"?0:t.length},encode.USHORT=function(t){return[t>>8&255,t&255]},sizeOf.USHORT=constant(2),encode.SHORT=function(t){return t>=LIMIT16&&(t=-(2*LIMIT16-t)),[t>>8&255,t&255]},sizeOf.SHORT=constant(2),encode.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]},sizeOf.UINT24=constant(3),encode.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]},sizeOf.ULONG=constant(4),encode.LONG=function(t){return t>=LIMIT32&&(t=-(2*LIMIT32-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]},sizeOf.LONG=constant(4),encode.FIXED=encode.ULONG,sizeOf.FIXED=sizeOf.ULONG,encode.FWORD=encode.SHORT,sizeOf.FWORD=sizeOf.SHORT,encode.UFWORD=encode.USHORT,sizeOf.UFWORD=sizeOf.USHORT,encode.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]},sizeOf.LONGDATETIME=constant(8),encode.TAG=function(t){return check.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},sizeOf.TAG=constant(4),encode.Card8=encode.BYTE,sizeOf.Card8=sizeOf.BYTE,encode.Card16=encode.USHORT,sizeOf.Card16=sizeOf.USHORT,encode.OffSize=encode.BYTE,sizeOf.OffSize=sizeOf.BYTE,encode.SID=encode.USHORT,sizeOf.SID=sizeOf.USHORT,encode.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?encode.NUMBER16(t):encode.NUMBER32(t)},sizeOf.NUMBER=function(t){return encode.NUMBER(t).length},encode.NUMBER16=function(t){return[28,t>>8&255,t&255]},sizeOf.NUMBER16=constant(3),encode.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]},sizeOf.NUMBER32=constant(5),encode.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var i="",o=0,a=e.length;o<a;o+=1){var l=e[o];l==="e"?i+=e[++o]==="-"?"c":"b":l==="."?i+="a":l==="-"?i+="e":i+=l}i+=i.length&1?"f":"ff";for(var f=[30],d=0,g=i.length;d<g;d+=2)f.push(parseInt(i.substr(d,2),16));return f},sizeOf.REAL=function(t){return encode.REAL(t).length},encode.NAME=encode.CHARARRAY,sizeOf.NAME=sizeOf.CHARARRAY,encode.STRING=encode.CHARARRAY,sizeOf.STRING=sizeOf.CHARARRAY,decode.UTF8=function(t,e,r){for(var n=[],i=r,o=0;o<i;o++,e+=1)n[o]=t.getUint8(e);return String.fromCharCode.apply(null,n)},decode.UTF16=function(t,e,r){for(var n=[],i=r/2,o=0;o<i;o++,e+=2)n[o]=t.getUint16(e);return String.fromCharCode.apply(null,n)},encode.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e},sizeOf.UTF16=function(t){return t.length*2};var eightBitMacEncodings={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};decode.MACSTRING=function(t,e,r,n){var i=eightBitMacEncodings[n];if(i!==void 0){for(var o="",a=0;a<r;a++){var l=t.getUint8(e+a);l<=127?o+=String.fromCharCode(l):o+=i[l&127]}return o}};var macEncodingTableCache=typeof WeakMap=="function"&&new WeakMap,macEncodingCacheKeys,getMacEncodingTable=function(t){if(!macEncodingCacheKeys){macEncodingCacheKeys={};for(var e in eightBitMacEncodings)macEncodingCacheKeys[e]=new String(e)}var r=macEncodingCacheKeys[t];if(r!==void 0){if(macEncodingTableCache){var n=macEncodingTableCache.get(r);if(n!==void 0)return n}var i=eightBitMacEncodings[t];if(i!==void 0){for(var o={},a=0;a<i.length;a++)o[i.charCodeAt(a)]=a+128;return macEncodingTableCache&&macEncodingTableCache.set(r,o),o}}};encode.MACSTRING=function(t,e){var r=getMacEncodingTable(e);if(r!==void 0){for(var n=[],i=0;i<t.length;i++){var o=t.charCodeAt(i);if(o>=128&&(o=r[o],o===void 0))return;n[i]=o}return n}},sizeOf.MACSTRING=function(t,e){var r=encode.MACSTRING(t,e);return r!==void 0?r.length:0};function isByteEncodable(t){return t>=-128&&t<=127}function encodeVarDeltaRunAsZeroes(t,e,r){for(var n=0,i=t.length;e<i&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function encodeVarDeltaRunAsBytes(t,e,r){for(var n=0,i=t.length,o=e;o<i&&n<64;){var a=t[o];if(!isByteEncodable(a)||a===0&&o+1<i&&t[o+1]===0)break;++o,++n}r.push(n-1);for(var l=e;l<o;++l)r.push(t[l]+256&255);return o}function encodeVarDeltaRunAsWords(t,e,r){for(var n=0,i=t.length,o=e;o<i&&n<64;){var a=t[o];if(a===0||isByteEncodable(a)&&o+1<i&&isByteEncodable(t[o+1]))break;++o,++n}r.push(64|n-1);for(var l=e;l<o;++l){var f=t[l];r.push(f+65536>>8&255,f+256&255)}return o}encode.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=encodeVarDeltaRunAsZeroes(t,e,r):n>=-128&&n<=127?e=encodeVarDeltaRunAsBytes(t,e,r):e=encodeVarDeltaRunAsWords(t,e,r)}return r},encode.INDEX=function(t){for(var e=1,r=[e],n=[],i=0;i<t.length;i+=1){var o=encode.OBJECT(t[i]);Array.prototype.push.apply(n,o),e+=o.length,r.push(e)}if(n.length===0)return[0,0];for(var a=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][l],d=0;d<r.length;d+=1){var g=f(r[d]);Array.prototype.push.apply(a,g)}return Array.prototype.concat(encode.Card16(t.length),encode.OffSize(l),a,n)},sizeOf.INDEX=function(t){return encode.INDEX(t).length},encode.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,i=0;i<n;i+=1){var o=parseInt(r[i],0),a=t[o];e=e.concat(encode.OPERAND(a.value,a.type)),e=e.concat(encode.OPERATOR(o))}return e},sizeOf.DICT=function(t){return encode.DICT(t).length},encode.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},encode.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)check.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(encode.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(encode.NUMBER(t));else if(e==="offset")r=r.concat(encode.NUMBER32(t));else if(e==="number")r=r.concat(encode.NUMBER(t));else if(e==="real")r=r.concat(encode.REAL(t));else throw new Error("Unknown operand type "+e);return r},encode.OP=encode.BYTE,sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap=="function"&&new WeakMap;encode.CHARSTRING=function(t){if(wmm){var e=wmm.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,i=0;i<n;i+=1){var o=t[i];r=r.concat(encode[o.type](o.value))}return wmm&&wmm.set(t,r),r},sizeOf.CHARSTRING=function(t){return encode.CHARSTRING(t).length},encode.OBJECT=function(t){var e=encode[t.type];return check.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)},sizeOf.OBJECT=function(t){var e=sizeOf[t.type];return check.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)},encode.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],i=[],o=0;o<r;o+=1){var a=t.fields[o],l=encode[a.type];check.argument(l!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var f=t[a.name];f===void 0&&(f=a.value);var d=l(f);a.type==="TABLE"?(i.push(e.length),e=e.concat([0,0]),n.push(d)):e=e.concat(d)}for(var g=0;g<n.length;g+=1){var b=i[g],_=e.length;check.argument(_<65536,"Table "+t.tableName+" too big."),e[b]=_>>8,e[b+1]=_&255,e=e.concat(n[g])}return e},sizeOf.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var i=t.fields[n],o=sizeOf[i.type];check.argument(o!==void 0,"No sizeOf function for field type "+i.type+" ("+i.name+")");var a=t[i.name];a===void 0&&(a=i.value),e+=o(a),i.type==="TABLE"&&(e+=2)}return e},encode.RECORD=encode.TABLE,sizeOf.RECORD=sizeOf.TABLE,encode.LITERAL=function(t){return t},sizeOf.LITERAL=function(t){return t.length};function Table(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var i=e[n];this[i.name]=i.value}if(this.tableName=t,this.fields=e,r)for(var o=Object.keys(r),a=0;a<o.length;a+=1){var l=o[a],f=r[l];this[l]!==void 0&&(this[l]=f)}}Table.prototype.encode=function(){return encode.TABLE(this)},Table.prototype.sizeOf=function(){return sizeOf.TABLE(this)};function ushortList(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var i=0;i<e.length;i++)n[i+1]={name:t+i,type:"USHORT",value:e[i]};return n}function tableList(t,e,r){var n=e.length,i=new Array(n+1);i[0]={name:t+"Count",type:"USHORT",value:n};for(var o=0;o<n;o++)i[o+1]={name:t+o,type:"TABLE",value:r(e[o],o)};return i}function recordList(t,e,r){var n=e.length,i=[];i[0]={name:t+"Count",type:"USHORT",value:n};for(var o=0;o<n;o++)i=i.concat(r(e[o],o));return i}function Coverage(t){t.format===1?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(ushortList("glyph",t.glyphs))):t.format===2?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(recordList("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):check.assert(!1,"Coverage format must be 1 or 2.")}Coverage.prototype=Object.create(Table.prototype),Coverage.prototype.constructor=Coverage;function ScriptList(t){Table.call(this,"scriptListTable",recordList("scriptRecord",t,function(e,r){var n=e.script,i=n.defaultLangSys;return check.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Table("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Table("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(ushortList("featureIndex",i.featureIndexes)))}].concat(recordList("langSys",n.langSysRecords,function(o,a){var l=o.langSys;return[{name:"langSysTag"+a,type:"TAG",value:o.tag},{name:"langSys"+a,type:"TABLE",value:new Table("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(ushortList("featureIndex",l.featureIndexes)))}]})))}]}))}ScriptList.prototype=Object.create(Table.prototype),ScriptList.prototype.constructor=ScriptList;function FeatureList(t){Table.call(this,"featureListTable",recordList("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Table("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(ushortList("lookupListIndex",n.lookupListIndexes)))}]}))}FeatureList.prototype=Object.create(Table.prototype),FeatureList.prototype.constructor=FeatureList;function LookupList(t,e){Table.call(this,"lookupListTable",tableList("lookup",t,function(r){var n=e[r.lookupType];return check.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Table("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(tableList("subtable",r.subtables,n)))}))}LookupList.prototype=Object.create(Table.prototype),LookupList.prototype.constructor=LookupList;var table={Table,Record:Table,Coverage,ScriptList,FeatureList,LookupList,ushortList,tableList,recordList};function getByte(t,e){return t.getUint8(e)}function getUShort(t,e){return t.getUint16(e,!1)}function getShort(t,e){return t.getInt16(e,!1)}function getULong(t,e){return t.getUint32(e,!1)}function getFixed(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function getTag(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function getOffset(t,e,r){for(var n=0,i=0;i<r;i+=1)n<<=8,n+=t.getUint8(e+i);return n}function getBytes(t,e,r){for(var n=[],i=e;i<r;i+=1)n.push(t.getUint8(i));return n}function bytesToString(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var typeOffsets={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(t,e){this.data=t,this.offset=e,this.relativeOffset=0}Parser.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},Parser.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},Parser.prototype.parseCard8=Parser.prototype.parseByte,Parser.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},Parser.prototype.parseCard16=Parser.prototype.parseUShort,Parser.prototype.parseSID=Parser.prototype.parseUShort,Parser.prototype.parseOffset16=Parser.prototype.parseUShort,Parser.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},Parser.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},Parser.prototype.parseULong=function(){var t=getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},Parser.prototype.parseOffset32=Parser.prototype.parseULong,Parser.prototype.parseFixed=function(){var t=getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},Parser.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var i=0;i<t;i++)n+=String.fromCharCode(e.getUint8(r+i));return n},Parser.prototype.parseTag=function(){return this.parseString(4)},Parser.prototype.parseLongDateTime=function(){var t=getULong(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},Parser.prototype.parseVersion=function(t){var e=getUShort(this.data,this.offset+this.relativeOffset),r=getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10},Parser.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=typeOffsets[t]*e},Parser.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e},Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e},Parser.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e},Parser.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint8(n++);return this.relativeOffset+=t,e},Parser.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},Parser.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},Parser.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var o={},a=0;a<n.length;a++){var l=n[a],f=e[l];o[l]=f.call(this)}r[i]=o}return r},Parser.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var o={},a=0;a<n.length;a++){var l=n[a],f=e[l];o[l]=f.call(this)}r[i]=o}return r},Parser.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var i=e[n],o=t[i];r[i]=o.call(this)}return r},Parser.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},Parser.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r},Parser.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new Parser(this.data,this.offset+e).parseStruct(t)},Parser.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new Parser(this.data,this.offset+e).parseStruct(t)},Parser.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,i=new Array(r),o=0;o<r;o++){var a=e[o];if(a===0){i[o]=void 0;continue}if(this.relativeOffset=a,t){for(var l=this.parseOffset16List(),f=new Array(l.length),d=0;d<l.length;d++)this.relativeOffset=a+l[d],f[d]=t.call(this);i[o]=f}else i[o]=this.parseUShortList()}return this.relativeOffset=n,i},Parser.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),i=0;i<r;i++)n[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},Parser.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:Parser.uShort,end:Parser.uShort,classId:Parser.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},Parser.list=function(t,e){return function(){return this.parseList(t,e)}},Parser.list32=function(t,e){return function(){return this.parseList32(t,e)}},Parser.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},Parser.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},Parser.pointer=function(t){return function(){return this.parsePointer(t)}},Parser.pointer32=function(t){return function(){return this.parsePointer32(t)}},Parser.tag=Parser.prototype.parseTag,Parser.byte=Parser.prototype.parseByte,Parser.uShort=Parser.offset16=Parser.prototype.parseUShort,Parser.uShortList=Parser.prototype.parseUShortList,Parser.uLong=Parser.offset32=Parser.prototype.parseULong,Parser.uLongList=Parser.prototype.parseULongList,Parser.struct=Parser.prototype.parseStruct,Parser.coverage=Parser.prototype.parseCoverage,Parser.classDef=Parser.prototype.parseClassDef;var langSysTable={reserved:Parser.uShort,reqFeatureIndex:Parser.uShort,featureIndexes:Parser.uShortList};Parser.prototype.parseScriptList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,script:Parser.pointer({defaultLangSys:Parser.pointer(langSysTable),langSysRecords:Parser.recordList({tag:Parser.tag,langSys:Parser.pointer(langSysTable)})})}))||[]},Parser.prototype.parseFeatureList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,feature:Parser.pointer({featureParams:Parser.offset16,lookupListIndexes:Parser.uShortList})}))||[]},Parser.prototype.parseLookupList=function(t){return this.parsePointer(Parser.list(Parser.pointer(function(){var e=this.parseUShort();check.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(Parser.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},Parser.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();check.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:Parser.offset32,featureTableSubstitutionOffset:Parser.offset32});return r})||[]};var parse$1={getByte,getCard8:getByte,getUShort,getCard16:getUShort,getShort,getULong,getFixed,getTag,getOffset,getBytes,bytesToString,Parser};function parseCmapTableFormat12(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var i=e.parseULong(),o=e.parseULong(),a=e.parseULong(),l=i;l<=o;l+=1)t.glyphIndexMap[l]=a,a++}function parseCmapTableFormat4(t,e,r,n,i){t.length=e.parseUShort(),t.language=e.parseUShort();var o;t.segCount=o=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var a=new parse$1.Parser(r,n+i+14),l=new parse$1.Parser(r,n+i+16+o*2),f=new parse$1.Parser(r,n+i+16+o*4),d=new parse$1.Parser(r,n+i+16+o*6),g=n+i+16+o*8,b=0;b<o-1;b+=1)for(var _=void 0,E=a.parseUShort(),k=l.parseUShort(),D=f.parseShort(),L=d.parseUShort(),M=k;M<=E;M+=1)L!==0?(g=d.offset+d.relativeOffset-2,g+=L,g+=(M-k)*2,_=parse$1.getUShort(r,g),_!==0&&(_=_+D&65535)):_=M+D&65535,t.glyphIndexMap[M]=_}function parseCmapTable(t,e){var r={};r.version=parse$1.getUShort(t,e),check.argument(r.version===0,"cmap table version should be 0."),r.numTables=parse$1.getUShort(t,e+2);for(var n=-1,i=r.numTables-1;i>=0;i-=1){var o=parse$1.getUShort(t,e+4+i*8),a=parse$1.getUShort(t,e+4+i*8+2);if(o===3&&(a===0||a===1||a===10)||o===0&&(a===0||a===1||a===2||a===3||a===4)){n=parse$1.getULong(t,e+4+i*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new parse$1.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)parseCmapTableFormat12(r,l);else if(r.format===4)parseCmapTableFormat4(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function addSegment(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function addTerminatorSegment(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var o=new table.Table("cmap",i);for(o.segments=[],r=0;r<t.length;r+=1){for(var a=t.get(r),l=0;l<a.unicodes.length;l+=1)addSegment(o,a.unicodes[l],r);o.segments=o.segments.sort(function(U,R){return U.start-R.start})}addTerminatorSegment(o);var f=o.segments.length,d=0,g=[],b=[],_=[],E=[],k=[],D=[];for(r=0;r<f;r+=1){var L=o.segments[r];L.end<=65535&&L.start<=65535?(g=g.concat({name:"end_"+r,type:"USHORT",value:L.end}),b=b.concat({name:"start_"+r,type:"USHORT",value:L.start}),_=_.concat({name:"idDelta_"+r,type:"SHORT",value:L.delta}),E=E.concat({name:"idRangeOffset_"+r,type:"USHORT",value:L.offset}),L.glyphId!==void 0&&(k=k.concat({name:"glyph_"+r,type:"USHORT",value:L.glyphId}))):d+=1,!e&&L.glyphIndex!==void 0&&(D=D.concat({name:"cmap12Start_"+r,type:"ULONG",value:L.start}),D=D.concat({name:"cmap12End_"+r,type:"ULONG",value:L.end}),D=D.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:L.glyphIndex}))}if(o.segCountX2=(f-d)*2,o.searchRange=Math.pow(2,Math.floor(Math.log(f-d)/Math.log(2)))*2,o.entrySelector=Math.log(o.searchRange/2)/Math.log(2),o.rangeShift=o.segCountX2-o.searchRange,o.fields=o.fields.concat(g),o.fields.push({name:"reservedPad",type:"USHORT",value:0}),o.fields=o.fields.concat(b),o.fields=o.fields.concat(_),o.fields=o.fields.concat(E),o.fields=o.fields.concat(k),o.cmap4Length=14+g.length*2+2+b.length*2+_.length*2+E.length*2+k.length*2,!e){var M=16+D.length*4;o.cmap12Offset=12+2*2+4+o.cmap4Length,o.fields=o.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:M},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:D.length/3}]),o.fields=o.fields.concat(D)}return o}var cmap={parse:parseCmapTable,make:makeCmapTable},cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(t){this.font=t}DefaultEncoding.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var i=r.get(n),o=0;o<i.unicodes.length;o+=1)if(i.unicodes[o]===e)return n}return null};function CmapEncoding(t){this.cmap=t}CmapEncoding.prototype.charToGlyphIndex=function(t){return this.cmap.glyphIndexMap[t.codePointAt(0)]||0};function CffEncoding(t,e){this.encoding=t,this.charset=e}CffEncoding.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function GlyphNames(t){switch(t.version){case 1:this.names=standardNames.slice();break;case 2:this.names=new Array(t.numberOfGlyphs);for(var e=0;e<t.numberOfGlyphs;e++)t.glyphNameIndex[e]<standardNames.length?this.names[e]=standardNames[t.glyphNameIndex[e]]:this.names[e]=t.names[t.glyphNameIndex[e]-standardNames.length];break;case 2.5:this.names=new Array(t.numberOfGlyphs);for(var r=0;r<t.numberOfGlyphs;r++)this.names[r]=standardNames[r+t.glyphNameIndex[r]];break;case 3:this.names=[];break;default:this.names=[];break}}GlyphNames.prototype.nameToGlyphIndex=function(t){return this.names.indexOf(t)},GlyphNames.prototype.glyphIndexToName=function(t){return this.names[t]};function addGlyphNamesAll(t){for(var e,r=t.tables.cmap.glyphIndexMap,n=Object.keys(r),i=0;i<n.length;i+=1){var o=n[i],a=r[o];e=t.glyphs.get(a),e.addUnicode(parseInt(o))}for(var l=0;l<t.glyphs.length;l+=1)e=t.glyphs.get(l),t.cffEncoding?t.isCIDFont?e.name="gid"+l:e.name=t.cffEncoding.charset[l]:t.glyphNames.names&&(e.name=t.glyphNames.glyphIndexToName(l))}function addGlyphNamesToUnicodeMap(t){t._IndexToUnicodeMap={};for(var e=t.tables.cmap.glyphIndexMap,r=Object.keys(e),n=0;n<r.length;n+=1){var i=r[n],o=e[i];t._IndexToUnicodeMap[o]===void 0?t._IndexToUnicodeMap[o]={unicodes:[parseInt(i)]}:t._IndexToUnicodeMap[o].unicodes.push(parseInt(i))}}function addGlyphNames(t,e){e.lowMemory?addGlyphNamesToUnicodeMap(t):addGlyphNamesAll(t)}function line(t,e,r,n,i){t.beginPath(),t.moveTo(e,r),t.lineTo(n,i),t.stroke()}var draw$1={line};function getPathDefinition(t,e){var r=e||new Path;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function Glyph(t){this.bindConstructorValues(t)}Glyph.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",getPathDefinition(this,t.path))},Glyph.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)},Glyph.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Glyph.prototype.getPath=function(t,e,r,n,i){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var o,a;n||(n={});var l=n.xScale,f=n.yScale;if(n.hinting&&i&&i.hinting&&(a=this.path&&i.hinting.exec(this,r)),a)o=i.hinting.getCommands(a),t=Math.round(t),e=Math.round(e),l=f=1;else{o=this.path.commands;var d=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=d),f===void 0&&(f=d)}for(var g=new Path,b=0;b<o.length;b+=1){var _=o[b];_.type==="M"?g.moveTo(t+_.x*l,e+-_.y*f):_.type==="L"?g.lineTo(t+_.x*l,e+-_.y*f):_.type==="Q"?g.quadraticCurveTo(t+_.x1*l,e+-_.y1*f,t+_.x*l,e+-_.y*f):_.type==="C"?g.curveTo(t+_.x1*l,e+-_.y1*f,t+_.x2*l,e+-_.y2*f,t+_.x*l,e+-_.y*f):_.type==="Z"&&g.closePath()}return g},Glyph.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return check.argument(e.length===0,"There are still points left in the current contour."),t},Glyph.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];i.type!=="Z"&&(e.push(i.x),r.push(i.y)),(i.type==="Q"||i.type==="C")&&(e.push(i.x1),r.push(i.y1)),i.type==="C"&&(e.push(i.x2),r.push(i.y2))}var o={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(o.xMin)||(o.xMin=0),isFinite(o.xMax)||(o.xMax=this.advanceWidth),isFinite(o.yMin)||(o.yMin=0),isFinite(o.yMax)||(o.yMax=0),o.rightSideBearing=this.advanceWidth-o.leftSideBearing-(o.xMax-o.xMin),o},Glyph.prototype.draw=function(t,e,r,n,i){this.getPath(e,r,n,i).draw(t)},Glyph.prototype.drawPoints=function(t,e,r,n){function i(b,_,E,k){t.beginPath();for(var D=0;D<b.length;D+=1)t.moveTo(_+b[D].x*k,E+b[D].y*k),t.arc(_+b[D].x*k,E+b[D].y*k,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var o=1/this.path.unitsPerEm*n,a=[],l=[],f=this.path,d=0;d<f.commands.length;d+=1){var g=f.commands[d];g.x!==void 0&&a.push({x:g.x,y:-g.y}),g.x1!==void 0&&l.push({x:g.x1,y:-g.y1}),g.x2!==void 0&&l.push({x:g.x2,y:-g.y2})}t.fillStyle="blue",i(a,e,r,o),t.fillStyle="red",i(l,e,r,o)},Glyph.prototype.drawMetrics=function(t,e,r,n){var i;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,i=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",draw$1.line(t,e,-1e4,e,1e4),draw$1.line(t,-1e4,r,1e4,r);var o=this.xMin||0,a=this.yMin||0,l=this.xMax||0,f=this.yMax||0,d=this.advanceWidth||0;t.strokeStyle="blue",draw$1.line(t,e+o*i,-1e4,e+o*i,1e4),draw$1.line(t,e+l*i,-1e4,e+l*i,1e4),draw$1.line(t,-1e4,r+-a*i,1e4,r+-a*i),draw$1.line(t,-1e4,r+-f*i,1e4,r+-f*i),t.strokeStyle="green",draw$1.line(t,e+d*i,-1e4,e+d*i,1e4)};function defineDependentProperty(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function GlyphSet(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}GlyphSet.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},GlyphSet.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function glyphLoader(t,e){return new Glyph({index:e,font:t})}function ttfGlyphLoader(t,e,r,n,i,o){return function(){var a=new Glyph({index:e,font:t});return a.path=function(){r(a,n,i);var l=o(t.glyphs,a);return l.unitsPerEm=t.unitsPerEm,l},defineDependentProperty(a,"xMin","_xMin"),defineDependentProperty(a,"xMax","_xMax"),defineDependentProperty(a,"yMin","_yMin"),defineDependentProperty(a,"yMax","_yMax"),a}}function cffGlyphLoader(t,e,r,n){return function(){var i=new Glyph({index:e,font:t});return i.path=function(){var o=r(t,i,n);return o.unitsPerEm=t.unitsPerEm,o},i}}var glyphset={GlyphSet,glyphLoader,ttfGlyphLoader,cffGlyphLoader};function equals(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!equals(t[r],e[r]))return!1;return!0}else return!1}function calcCFFSubroutineBias(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function parseCFFIndex(t,e,r){var n=[],i=[],o=parse$1.getCard16(t,e),a,l;if(o!==0){var f=parse$1.getByte(t,e+2);a=e+(o+1)*f+2;for(var d=e+3,g=0;g<o+1;g+=1)n.push(parse$1.getOffset(t,d,f)),d+=f;l=a+n[o]}else l=e+2;for(var b=0;b<n.length-1;b+=1){var _=parse$1.getBytes(t,a+n[b],a+n[b+1]);r&&(_=r(_)),i.push(_)}return{objects:i,startOffset:e,endOffset:l}}function parseCFFIndexLowMemory(t,e){var r=[],n=parse$1.getCard16(t,e),i,o;if(n!==0){var a=parse$1.getByte(t,e+2);i=e+(n+1)*a+2;for(var l=e+3,f=0;f<n+1;f+=1)r.push(parse$1.getOffset(t,l,a)),l+=a;o=i+r[n]}else o=e+2;return{offsets:r,startOffset:e,endOffset:o}}function getCffIndexObject(t,e,r,n,i){var o=parse$1.getCard16(r,n),a=0;if(o!==0){var l=parse$1.getByte(r,n+2);a=n+(o+1)*l+2}var f=parse$1.getBytes(r,a+e[t],a+e[t+1]);return f}function parseFloatOperand(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=t.parseByte(),o=i>>4,a=i&15;if(o===r||(e+=n[o],a===r))break;e+=n[a]}return parseFloat(e)}function parseOperand(t,e){var r,n,i,o;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),i=t.parseByte(),o=t.parseByte(),r<<24|n<<16|i<<8|o;if(e===30)return parseFloatOperand(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function entriesToObject(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],i=t[r][1],o=void 0;if(i.length===1?o=i[0]:o=i,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=o}return e}function parseCFFDict(t,e,r){e=e!==void 0?e:0;var n=new parse$1.Parser(t,e),i=[],o=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var a=n.parseByte();a<=21?(a===12&&(a=1200+n.parseByte()),i.push([a,o]),o=[]):o.push(parseOperand(n,a))}return entriesToObject(i)}function getCFFString(t,e){return e<=390?e=cffStandardStrings[e]:e=t[e-391],e}function interpretDict(t,e,r){for(var n={},i,o=0;o<e.length;o+=1){var a=e[o];if(Array.isArray(a.type)){var l=[];l.length=a.type.length;for(var f=0;f<a.type.length;f++)i=t[a.op]!==void 0?t[a.op][f]:void 0,i===void 0&&(i=a.value!==void 0&&a.value[f]!==void 0?a.value[f]:null),a.type[f]==="SID"&&(i=getCFFString(r,i)),l[f]=i;n[a.name]=l}else i=t[a.op],i===void 0&&(i=a.value!==void 0?a.value:null),a.type==="SID"&&(i=getCFFString(r,i)),n[a.name]=i}return n}function parseCFFHeader(t,e){var r={};return r.formatMajor=parse$1.getCard8(t,e),r.formatMinor=parse$1.getCard8(t,e+1),r.size=parse$1.getCard8(t,e+2),r.offsetSize=parse$1.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(t,e){var r=parseCFFDict(t,0,t.byteLength);return interpretDict(r,TOP_DICT_META,e)}function parseCFFPrivateDict(t,e,r,n){var i=parseCFFDict(t,e,r);return interpretDict(i,PRIVATE_DICT_META,n)}function gatherCFFTopDicts(t,e,r,n){for(var i=[],o=0;o<r.length;o+=1){var a=new DataView(new Uint8Array(r[o]).buffer),l=parseCFFTopDict(a,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var f=l.private[0],d=l.private[1];if(f!==0&&d!==0){var g=parseCFFPrivateDict(t,d+e,f,n);if(l._defaultWidthX=g.defaultWidthX,l._nominalWidthX=g.nominalWidthX,g.subrs!==0){var b=d+g.subrs,_=parseCFFIndex(t,b+e);l._subrs=_.objects,l._subrsBias=calcCFFSubroutineBias(l._subrs)}l._privateDict=g}i.push(l)}return i}function parseCFFCharset(t,e,r,n){var i,o,a=new parse$1.Parser(t,e);r-=1;var l=[".notdef"],f=a.parseCard8();if(f===0)for(var d=0;d<r;d+=1)i=a.parseSID(),l.push(getCFFString(n,i));else if(f===1)for(;l.length<=r;){i=a.parseSID(),o=a.parseCard8();for(var g=0;g<=o;g+=1)l.push(getCFFString(n,i)),i+=1}else if(f===2)for(;l.length<=r;){i=a.parseSID(),o=a.parseCard16();for(var b=0;b<=o;b+=1)l.push(getCFFString(n,i)),i+=1}else throw new Error("Unknown charset format "+f);return l}function parseCFFEncoding(t,e,r){var n,i={},o=new parse$1.Parser(t,e),a=o.parseCard8();if(a===0)for(var l=o.parseCard8(),f=0;f<l;f+=1)n=o.parseCard8(),i[n]=f;else if(a===1){var d=o.parseCard8();n=1;for(var g=0;g<d;g+=1)for(var b=o.parseCard8(),_=o.parseCard8(),E=b;E<=b+_;E+=1)i[E]=n,n+=1}else throw new Error("Unknown encoding format "+a);return new CffEncoding(i,r)}function parseCFFCharstring(t,e,r){var n,i,o,a,l=new Path,f=[],d=0,g=!1,b=!1,_=0,E=0,k,D,L,M;if(t.isCIDFont){var U=t.tables.cff.topDict._fdSelect[e.index],R=t.tables.cff.topDict._fdArray[U];k=R._subrs,D=R._subrsBias,L=R._defaultWidthX,M=R._nominalWidthX}else k=t.tables.cff.topDict._subrs,D=t.tables.cff.topDict._subrsBias,L=t.tables.cff.topDict._defaultWidthX,M=t.tables.cff.topDict._nominalWidthX;var z=L;function X(q,ee){b&&l.closePath(),l.moveTo(q,ee),b=!0}function se(){var q;q=f.length%2!==0,q&&!g&&(z=f.shift()+M),d+=f.length>>1,f.length=0,g=!0}function $(q){for(var ee,Pe,ce,ve,we,ue,pe,Q,re,ye,me,ae,fe=0;fe<q.length;){var Ae=q[fe];switch(fe+=1,Ae){case 1:se();break;case 3:se();break;case 4:f.length>1&&!g&&(z=f.shift()+M,g=!0),E+=f.pop(),X(_,E);break;case 5:for(;f.length>0;)_+=f.shift(),E+=f.shift(),l.lineTo(_,E);break;case 6:for(;f.length>0&&(_+=f.shift(),l.lineTo(_,E),f.length!==0);)E+=f.shift(),l.lineTo(_,E);break;case 7:for(;f.length>0&&(E+=f.shift(),l.lineTo(_,E),f.length!==0);)_+=f.shift(),l.lineTo(_,E);break;case 8:for(;f.length>0;)n=_+f.shift(),i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),_=o+f.shift(),E=a+f.shift(),l.curveTo(n,i,o,a,_,E);break;case 10:we=f.pop()+D,ue=k[we],ue&&$(ue);break;case 11:return;case 12:switch(Ae=q[fe],fe+=1,Ae){case 35:n=_+f.shift(),i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),pe=o+f.shift(),Q=a+f.shift(),re=pe+f.shift(),ye=Q+f.shift(),me=re+f.shift(),ae=ye+f.shift(),_=me+f.shift(),E=ae+f.shift(),f.shift(),l.curveTo(n,i,o,a,pe,Q),l.curveTo(re,ye,me,ae,_,E);break;case 34:n=_+f.shift(),i=E,o=n+f.shift(),a=i+f.shift(),pe=o+f.shift(),Q=a,re=pe+f.shift(),ye=a,me=re+f.shift(),ae=E,_=me+f.shift(),l.curveTo(n,i,o,a,pe,Q),l.curveTo(re,ye,me,ae,_,E);break;case 36:n=_+f.shift(),i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),pe=o+f.shift(),Q=a,re=pe+f.shift(),ye=a,me=re+f.shift(),ae=ye+f.shift(),_=me+f.shift(),l.curveTo(n,i,o,a,pe,Q),l.curveTo(re,ye,me,ae,_,E);break;case 37:n=_+f.shift(),i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),pe=o+f.shift(),Q=a+f.shift(),re=pe+f.shift(),ye=Q+f.shift(),me=re+f.shift(),ae=ye+f.shift(),Math.abs(me-_)>Math.abs(ae-E)?_=me+f.shift():E=ae+f.shift(),l.curveTo(n,i,o,a,pe,Q),l.curveTo(re,ye,me,ae,_,E);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+Ae),f.length=0}break;case 14:f.length>0&&!g&&(z=f.shift()+M,g=!0),b&&(l.closePath(),b=!1);break;case 18:se();break;case 19:case 20:se(),fe+=d+7>>3;break;case 21:f.length>2&&!g&&(z=f.shift()+M,g=!0),E+=f.pop(),_+=f.pop(),X(_,E);break;case 22:f.length>1&&!g&&(z=f.shift()+M,g=!0),_+=f.pop(),X(_,E);break;case 23:se();break;case 24:for(;f.length>2;)n=_+f.shift(),i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),_=o+f.shift(),E=a+f.shift(),l.curveTo(n,i,o,a,_,E);_+=f.shift(),E+=f.shift(),l.lineTo(_,E);break;case 25:for(;f.length>6;)_+=f.shift(),E+=f.shift(),l.lineTo(_,E);n=_+f.shift(),i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),_=o+f.shift(),E=a+f.shift(),l.curveTo(n,i,o,a,_,E);break;case 26:for(f.length%2&&(_+=f.shift());f.length>0;)n=_,i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),_=o,E=a+f.shift(),l.curveTo(n,i,o,a,_,E);break;case 27:for(f.length%2&&(E+=f.shift());f.length>0;)n=_+f.shift(),i=E,o=n+f.shift(),a=i+f.shift(),_=o+f.shift(),E=a,l.curveTo(n,i,o,a,_,E);break;case 28:ee=q[fe],Pe=q[fe+1],f.push((ee<<24|Pe<<16)>>16),fe+=2;break;case 29:we=f.pop()+t.gsubrsBias,ue=t.gsubrs[we],ue&&$(ue);break;case 30:for(;f.length>0&&(n=_,i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),_=o+f.shift(),E=a+(f.length===1?f.shift():0),l.curveTo(n,i,o,a,_,E),f.length!==0);)n=_+f.shift(),i=E,o=n+f.shift(),a=i+f.shift(),E=a+f.shift(),_=o+(f.length===1?f.shift():0),l.curveTo(n,i,o,a,_,E);break;case 31:for(;f.length>0&&(n=_+f.shift(),i=E,o=n+f.shift(),a=i+f.shift(),E=a+f.shift(),_=o+(f.length===1?f.shift():0),l.curveTo(n,i,o,a,_,E),f.length!==0);)n=_,i=E+f.shift(),o=n+f.shift(),a=i+f.shift(),_=o+f.shift(),E=a+(f.length===1?f.shift():0),l.curveTo(n,i,o,a,_,E);break;default:Ae<32?console.log("Glyph "+e.index+": unknown operator "+Ae):Ae<247?f.push(Ae-139):Ae<251?(ee=q[fe],fe+=1,f.push((Ae-247)*256+ee+108)):Ae<255?(ee=q[fe],fe+=1,f.push(-(Ae-251)*256-ee-108)):(ee=q[fe],Pe=q[fe+1],ce=q[fe+2],ve=q[fe+3],fe+=4,f.push((ee<<24|Pe<<16|ce<<8|ve)/65536))}}}return $(r),e.advanceWidth=z,l}function parseCFFFDSelect(t,e,r,n){var i=[],o,a=new parse$1.Parser(t,e),l=a.parseCard8();if(l===0)for(var f=0;f<r;f++){if(o=a.parseCard8(),o>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+n+")");i.push(o)}else if(l===3){var d=a.parseCard16(),g=a.parseCard16();if(g!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+g);for(var b,_=0;_<d;_++){if(o=a.parseCard8(),b=a.parseCard16(),o>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+n+")");if(b>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+b);for(;g<b;g++)i.push(o);g=b}if(b!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+b)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return i}function parseCFFTable(t,e,r,n){r.tables.cff={};var i=parseCFFHeader(t,e),o=parseCFFIndex(t,i.endOffset,parse$1.bytesToString),a=parseCFFIndex(t,o.endOffset),l=parseCFFIndex(t,a.endOffset,parse$1.bytesToString),f=parseCFFIndex(t,l.endOffset);r.gsubrs=f.objects,r.gsubrsBias=calcCFFSubroutineBias(r.gsubrs);var d=gatherCFFTopDicts(t,e,a.objects,l.objects);if(d.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+d.length);var g=d[0];if(r.tables.cff.topDict=g,g._privateDict&&(r.defaultWidthX=g._privateDict.defaultWidthX,r.nominalWidthX=g._privateDict.nominalWidthX),g.ros[0]!==void 0&&g.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var b=g.fdArray,_=g.fdSelect;if(b===0||_===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");b+=e;var E=parseCFFIndex(t,b),k=gatherCFFTopDicts(t,e,E.objects,l.objects);g._fdArray=k,_+=e,g._fdSelect=parseCFFFDSelect(t,_,r.numGlyphs,k.length)}var D=e+g.private[1],L=parseCFFPrivateDict(t,D,g.private[0],l.objects);if(r.defaultWidthX=L.defaultWidthX,r.nominalWidthX=L.nominalWidthX,L.subrs!==0){var M=D+L.subrs,U=parseCFFIndex(t,M);r.subrs=U.objects,r.subrsBias=calcCFFSubroutineBias(r.subrs)}else r.subrs=[],r.subrsBias=0;var R;n.lowMemory?(R=parseCFFIndexLowMemory(t,e+g.charStrings),r.nGlyphs=R.offsets.length):(R=parseCFFIndex(t,e+g.charStrings),r.nGlyphs=R.objects.length);var z=parseCFFCharset(t,e+g.charset,r.nGlyphs,l.objects);if(g.encoding===0?r.cffEncoding=new CffEncoding(cffStandardEncoding,z):g.encoding===1?r.cffEncoding=new CffEncoding(cffExpertEncoding,z):r.cffEncoding=parseCFFEncoding(t,e+g.encoding,z),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new glyphset.GlyphSet(r),n.lowMemory)r._push=function($){var q=getCffIndexObject($,R.offsets,t,e+g.charStrings);r.glyphs.push($,glyphset.cffGlyphLoader(r,$,parseCFFCharstring,q))};else for(var X=0;X<r.nGlyphs;X+=1){var se=R.objects[X];r.glyphs.push(X,glyphset.cffGlyphLoader(r,X,parseCFFCharstring,se))}}function encodeString(t,e){var r,n=cffStandardStrings.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+cffStandardStrings.length:(r=cffStandardStrings.length+e.length,e.push(t)),r}function makeHeader(){return new table.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(t){var e=new table.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function makeDict(t,e,r){for(var n={},i=0;i<t.length;i+=1){var o=t[i],a=e[o.name];a!==void 0&&!equals(a,o.value)&&(o.type==="SID"&&(a=encodeString(a,r)),n[o.op]={name:o.name,type:o.type,value:a})}return n}function makeTopDict(t,e){var r=new table.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=makeDict(TOP_DICT_META,t,e),r}function makeTopDictIndex(t){var e=new table.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function makeStringIndex(t){var e=new table.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function makeGlobalSubrIndex(){return new table.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(t,e){for(var r=new table.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var i=t[n],o=encodeString(i,e);r.fields.push({name:"glyph_"+n,type:"SID",value:o})}return r}function glyphToOps(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,i=0,o=0;o<r.commands.length;o+=1){var a=void 0,l=void 0,f=r.commands[o];if(f.type==="Q"){var d=.3333333333333333,g=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(d*n+g*f.x1),y1:Math.round(d*i+g*f.y1),x2:Math.round(d*f.x+g*f.x1),y2:Math.round(d*f.y+g*f.y1)}}if(f.type==="M")a=Math.round(f.x-n),l=Math.round(f.y-i),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(f.x),i=Math.round(f.y);else if(f.type==="L")a=Math.round(f.x-n),l=Math.round(f.y-i),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(f.x),i=Math.round(f.y);else if(f.type==="C"){var b=Math.round(f.x1-n),_=Math.round(f.y1-i),E=Math.round(f.x2-f.x1),k=Math.round(f.y2-f.y1);a=Math.round(f.x-f.x2),l=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:b}),e.push({name:"dy1",type:"NUMBER",value:_}),e.push({name:"dx2",type:"NUMBER",value:E}),e.push({name:"dy2",type:"NUMBER",value:k}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(f.x),i=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function makeCharStringsIndex(t){for(var e=new table.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),i=glyphToOps(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:i})}return e}function makePrivateDict(t,e){var r=new table.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=makeDict(PRIVATE_DICT_META,t,e),r}function makeCFFTable(t,e){for(var r=new table.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,i={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o={},a=[],l,f=1;f<t.length;f+=1)l=t.get(f),a.push(l.name);var d=[];r.header=makeHeader(),r.nameIndex=makeNameIndex([e.postScriptName]);var g=makeTopDict(i,d);r.topDictIndex=makeTopDictIndex(g),r.globalSubrIndex=makeGlobalSubrIndex(),r.charsets=makeCharsets(a,d),r.charStringsIndex=makeCharStringsIndex(t),r.privateDict=makePrivateDict(o,d),r.stringIndex=makeStringIndex(d);var b=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return i.charset=b,i.encoding=0,i.charStrings=i.charset+r.charsets.sizeOf(),i.private[1]=i.charStrings+r.charStringsIndex.sizeOf(),g=makeTopDict(i,d),r.topDictIndex=makeTopDictIndex(g),r}var cff={parse:parseCFFTable,make:makeCFFTable};function parseHeadTable(t,e){var r={},n=new parse$1.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),check.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function makeHeadTable(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var head={parse:parseHeadTable,make:makeHeadTable};function parseHheaTable(t,e){var r={},n=new parse$1.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function makeHheaTable(t){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var hhea={parse:parseHheaTable,make:makeHheaTable};function parseHmtxTableAll(t,e,r,n,i){for(var o,a,l=new parse$1.Parser(t,e),f=0;f<n;f+=1){f<r&&(o=l.parseUShort(),a=l.parseShort());var d=i.get(f);d.advanceWidth=o,d.leftSideBearing=a}}function parseHmtxTableOnLowMemory(t,e,r,n,i){t._hmtxTableData={};for(var o,a,l=new parse$1.Parser(e,r),f=0;f<i;f+=1)f<n&&(o=l.parseUShort(),a=l.parseShort()),t._hmtxTableData[f]={advanceWidth:o,leftSideBearing:a}}function parseHmtxTable(t,e,r,n,i,o,a){a.lowMemory?parseHmtxTableOnLowMemory(t,e,r,n,i):parseHmtxTableAll(e,r,n,i,o)}function makeHmtxTable(t){for(var e=new table.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),i=n.advanceWidth||0,o=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:i}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:o})}return e}var hmtx={parse:parseHmtxTable,make:makeHmtxTable};function makeLtagTable(t){for(var e=new table.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,i=0;i<t.length;++i){var o=r.indexOf(t[i]);o<0&&(o=r.length,r+=t[i]),e.fields.push({name:"offset "+i,type:"USHORT",value:n+o}),e.fields.push({name:"length "+i,type:"USHORT",value:t[i].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function parseLtagTable(t,e){var r=new parse$1.Parser(t,e),n=r.parseULong();check.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var i=r.parseULong(),o=[],a=0;a<i;a++){for(var l="",f=e+r.parseUShort(),d=r.parseUShort(),g=f;g<f+d;++g)l+=String.fromCharCode(t.getInt8(g));o.push(l)}return o}var ltag={make:makeLtagTable,parse:parseLtagTable};function parseMaxpTable(t,e){var r={},n=new parse$1.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function makeMaxpTable(t){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var maxp={parse:parseMaxpTable,make:makeMaxpTable},nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],macLanguages={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},macLanguageToScript={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},windowsLanguages={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function getLanguageCode(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return macLanguages[e];case 3:return windowsLanguages[e]}}var utf16="utf-16",macScriptEncodings={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},macLanguageEncodings={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function getEncoding(t,e,r){switch(t){case 0:return utf16;case 1:return macLanguageEncodings[r]||macScriptEncodings[e];case 3:if(e===1||e===10)return utf16;break}}function parseNameTable(t,e,r){for(var n={},i=new parse$1.Parser(t,e),o=i.parseUShort(),a=i.parseUShort(),l=i.offset+i.parseUShort(),f=0;f<a;f++){var d=i.parseUShort(),g=i.parseUShort(),b=i.parseUShort(),_=i.parseUShort(),E=nameTableNames[_]||_,k=i.parseUShort(),D=i.parseUShort(),L=getLanguageCode(d,b,r),M=getEncoding(d,g,b);if(M!==void 0&&L!==void 0){var U=void 0;if(M===utf16?U=decode.UTF16(t,l+D,k):U=decode.MACSTRING(t,l+D,k,M),U){var R=n[E];R===void 0&&(R=n[E]={}),R[L]=U}}}return o===1&&i.parseUShort(),n}function reverseDict(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function makeNameRecord(t,e,r,n,i,o){return new table.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:o}])}function findSubArray(t,e){var r=t.length,n=e.length-r+1;e:for(var i=0;i<n;i++)for(;i<n;i++){for(var o=0;o<r;o++)if(e[i+o]!==t[o])continue e;return i}return-1}function addStringToPool(t,e){var r=findSubArray(t,e);if(r<0){r=e.length;for(var n=0,i=t.length;n<i;++n)e.push(t[n])}return r}function makeNameTable(t,e){var r,n=[],i={},o=reverseDict(nameTableNames);for(var a in t){var l=o[a];if(l===void 0&&(l=a),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');i[r]=t[a],n.push(r)}for(var f=reverseDict(macLanguages),d=reverseDict(windowsLanguages),g=[],b=[],_=0;_<n.length;_++){r=n[_];var E=i[r];for(var k in E){var D=E[k],L=1,M=f[k],U=macLanguageToScript[M],R=getEncoding(L,U,M),z=encode.MACSTRING(D,R);z===void 0&&(L=0,M=e.indexOf(k),M<0&&(M=e.length,e.push(k)),U=4,z=encode.UTF16(D));var X=addStringToPool(z,b);g.push(makeNameRecord(L,U,M,r,z.length,X));var se=d[k];if(se!==void 0){var $=encode.UTF16(D),q=addStringToPool($,b);g.push(makeNameRecord(3,1,se,r,$.length,q))}}}g.sort(function(ce,ve){return ce.platformID-ve.platformID||ce.encodingID-ve.encodingID||ce.languageID-ve.languageID||ce.nameID-ve.nameID});for(var ee=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:g.length},{name:"stringOffset",type:"USHORT",value:6+g.length*12}]),Pe=0;Pe<g.length;Pe++)ee.fields.push({name:"record_"+Pe,type:"RECORD",value:g[Pe]});return ee.fields.push({name:"strings",type:"LITERAL",value:b}),ee}var _name={parse:parseNameTable,make:makeNameTable},unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(t){for(var e=0;e<unicodeRanges.length;e+=1){var r=unicodeRanges[e];if(t>=r.begin&&t<r.end)return e}return-1}function parseOS2Table(t,e){var r={},n=new parse$1.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var i=0;i<10;i++)r.panose[i]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function makeOS2Table(t){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var os2={parse:parseOS2Table,make:makeOS2Table,unicodeRanges,getUnicodeRange};function parsePostTable(t,e){var r={},n=new parse$1.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=standardNames.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.glyphNameIndex[i]=n.parseUShort();r.names=[];for(var o=0;o<r.numberOfGlyphs;o++)if(r.glyphNameIndex[o]>=standardNames.length){var a=n.parseChar();r.names.push(n.parseString(a))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var post={parse:parsePostTable,make:makePostTable},subtableParsers=new Array(9);subtableParsers[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),substitute:this.parseOffset16List()};check.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},subtableParsers[2]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),sequences:this.parseListOfLists()}},subtableParsers[3]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),alternateSets:this.parseListOfLists()}},subtableParsers[4]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var lookupRecordDesc={sequenceIndex:Parser.uShort,lookupListIndex:Parser.uShort};subtableParsers[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(Parser.coverage),ruleSets:this.parseListOfLists(function(){var o=this.parseUShort(),a=this.parseUShort();return{input:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(a,lookupRecordDesc)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(Parser.coverage),classDef:this.parsePointer(Parser.classDef),classSets:this.parseListOfLists(function(){var o=this.parseUShort(),a=this.parseUShort();return{classes:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(a,lookupRecordDesc)}})};if(r===3){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(i,lookupRecordDesc)}}check.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},subtableParsers[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),backtrackClassDef:this.parsePointer(Parser.classDef),inputClassDef:this.parsePointer(Parser.classDef),lookaheadClassDef:this.parsePointer(Parser.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),inputCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(lookupRecordDesc)};check.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},subtableParsers[7]=function(){var e=this.parseUShort();check.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new Parser(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:subtableParsers[r].call(n)}},subtableParsers[8]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),substitutes:this.parseUShortList()}};function parseGsubTable(t,e){e=e||0;var r=new Parser(t,e),n=r.parseVersion(1);return check.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers),variations:r.parseFeatureVariationsList()}}var subtableMakers=new Array(9);subtableMakers[1]=function(e){return e.substFormat===1?new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.ushortList("substitute",e.substitute)))},subtableMakers[2]=function(e){return check.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("seqSet",e.sequences,function(r){return new table.Table("sequenceSetTable",table.ushortList("sequence",r))})))},subtableMakers[3]=function(e){return check.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("altSet",e.alternateSets,function(r){return new table.Table("alternateSetTable",table.ushortList("alternate",r))})))},subtableMakers[4]=function(e){return check.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("ligSet",e.ligatureSets,function(r){return new table.Table("ligatureSetTable",table.tableList("ligature",r,function(n){return new table.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(table.ushortList("component",n.components,n.components.length+1)))}))})))},subtableMakers[6]=function(e){if(e.substFormat===1){var r=new table.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("chainRuleSet",e.chainRuleSets,function(o){return new table.Table("chainRuleSetTable",table.tableList("chainRule",o,function(a){var l=table.ushortList("backtrackGlyph",a.backtrack,a.backtrack.length).concat(table.ushortList("inputGlyph",a.input,a.input.length+1)).concat(table.ushortList("lookaheadGlyph",a.lookahead,a.lookahead.length)).concat(table.ushortList("substitution",[],a.lookupRecords.length));return a.lookupRecords.forEach(function(f,d){l=l.concat({name:"sequenceIndex"+d,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+d,type:"USHORT",value:f.lookupListIndex})}),new table.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)check.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(o,a){n.push({name:"backtrackCoverage"+a,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(o,a){n.push({name:"inputCoverage"+a,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(o,a){n.push({name:"lookaheadCoverage"+a,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(o,a){n=n.concat({name:"sequenceIndex"+a,type:"USHORT",value:o.sequenceIndex}).concat({name:"lookupListIndex"+a,type:"USHORT",value:o.lookupListIndex})});var i=new table.Table("chainContextTable",n);return i}check.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function makeGsubTable(t){return new table.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(t.lookups,subtableMakers)}])}var gsub={parse:parseGsubTable,make:makeGsubTable};function parseMetaTable(t,e){var r=new parse$1.Parser(t,e),n=r.parseULong();check.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var i=r.parseULong(),o={},a=0;a<i;a++){var l=r.parseTag(),f=r.parseULong(),d=r.parseULong(),g=decode.UTF8(t,e+f,d);o[l]=g}return o}function makeMetaTable(t){var e=Object.keys(t).length,r="",n=16+e*12,i=new table.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var o in t){var a=r.length;r+=t[o],i.fields.push({name:"tag "+o,type:"TAG",value:o}),i.fields.push({name:"offset "+o,type:"ULONG",value:n+a}),i.fields.push({name:"length "+o,type:"ULONG",value:t[o].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),i}var meta={parse:parseMetaTable,make:makeMetaTable};function log2(t){return Math.log(t)/Math.log(2)|0}function computeCheckSum(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function makeTableRecord(t,e,r,n){return new table.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function makeSfntTable(t){var e=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,log2(e.numTables));e.searchRange=16*r,e.entrySelector=log2(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],i=[],o=e.sizeOf()+makeTableRecord().sizeOf()*e.numTables;o%4!==0;)o+=1,i.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<t.length;a+=1){var l=t[a];check.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var f=l.sizeOf(),d=makeTableRecord(l.tableName,computeCheckSum(l.encode()),o,f);for(n.push({name:d.tag+" Table Record",type:"RECORD",value:d}),i.push({name:l.tableName+" table",type:"RECORD",value:l}),o+=f,check.argument(!isNaN(o),"Something went wrong calculating the offset.");o%4!==0;)o+=1,i.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(g,b){return g.value.tag>b.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(i),e}function metricsForChar(t,e,r){for(var n=0;n<e.length;n+=1){var i=t.charToGlyphIndex(e[n]);if(i>0){var o=t.glyphs.get(i);return o.getMetrics()}}return r}function average(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function fontToSfntTable(t){for(var e=[],r=[],n=[],i=[],o=[],a=[],l=[],f,d=0,g=0,b=0,_=0,E=0,k=0;k<t.glyphs.length;k+=1){var D=t.glyphs.get(k),L=D.unicode|0;if(isNaN(D.advanceWidth))throw new Error("Glyph "+D.name+" ("+k+"): advanceWidth is not a number.");(f>L||f===void 0)&&L>0&&(f=L),d<L&&(d=L);var M=os2.getUnicodeRange(L);if(M<32)g|=1<<M;else if(M<64)b|=1<<M-32;else if(M<96)_|=1<<M-64;else if(M<123)E|=1<<M-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(D.name!==".notdef"){var U=D.getMetrics();e.push(U.xMin),r.push(U.yMin),n.push(U.xMax),i.push(U.yMax),a.push(U.leftSideBearing),l.push(U.rightSideBearing),o.push(D.advanceWidth)}}var R={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,i),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:average(o),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,l)};R.ascender=t.ascender,R.descender=t.descender;var z=head.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:R.xMin,yMin:R.yMin,xMax:R.xMax,yMax:R.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),X=hhea.make({ascender:R.ascender,descender:R.descender,advanceWidthMax:R.advanceWidthMax,minLeftSideBearing:R.minLeftSideBearing,minRightSideBearing:R.minRightSideBearing,xMaxExtent:R.maxLeftSideBearing+(R.xMax-R.xMin),numberOfHMetrics:t.glyphs.length}),se=maxp.make(t.glyphs.length),$=os2.make(Object.assign({xAvgCharWidth:Math.round(R.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:d,ulUnicodeRange1:g,ulUnicodeRange2:b,ulUnicodeRange3:_,ulUnicodeRange4:E,sTypoAscender:R.ascender,sTypoDescender:R.descender,sTypoLineGap:0,usWinAscent:R.yMax,usWinDescent:Math.abs(R.yMin),ulCodePageRange1:1,sxHeight:metricsForChar(t,"xyvw",{yMax:Math.round(R.ascender/2)}).yMax,sCapHeight:metricsForChar(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",R).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),q=hmtx.make(t.glyphs),ee=cmap.make(t.glyphs),Pe=t.getEnglishName("fontFamily"),ce=t.getEnglishName("fontSubfamily"),ve=Pe+" "+ce,we=t.getEnglishName("postScriptName");we||(we=Pe.replace(/\s/g,"")+"-"+ce);var ue={};for(var pe in t.names)ue[pe]=t.names[pe];ue.uniqueID||(ue.uniqueID={en:t.getEnglishName("manufacturer")+":"+ve}),ue.postScriptName||(ue.postScriptName={en:we}),ue.preferredFamily||(ue.preferredFamily=t.names.fontFamily),ue.preferredSubfamily||(ue.preferredSubfamily=t.names.fontSubfamily);var Q=[],re=_name.make(ue,Q),ye=Q.length>0?ltag.make(Q):void 0,me=post.make(),ae=cff.make(t.glyphs,{version:t.getEnglishName("version"),fullName:ve,familyName:Pe,weightName:ce,postScriptName:we,unitsPerEm:t.unitsPerEm,fontBBox:[0,R.yMin,R.ascender,R.advanceWidthMax]}),fe=t.metas&&Object.keys(t.metas).length>0?meta.make(t.metas):void 0,Ae=[z,X,se,$,re,ee,me,ae,q];ye&&Ae.push(ye),t.tables.gsub&&Ae.push(gsub.make(t.tables.gsub)),fe&&Ae.push(fe);for(var De=makeSfntTable(Ae),Re=De.encode(),qe=computeCheckSum(Re),Ke=De.fields,$e=!1,He=0;He<Ke.length;He+=1)if(Ke[He].name==="head table"){Ke[He].value.checkSumAdjustment=2981146554-qe,$e=!0;break}if(!$e)throw new Error("Could not find head table with checkSum to adjust.");return De}var sfnt={make:makeSfntTable,fontToTable:fontToSfntTable,computeCheckSum};function searchTag(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,o=t[i].tag;if(o===e)return i;o<e?r=i+1:n=i-1}return-r-1}function binSearch(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,o=t[i];if(o===e)return i;o<e?r=i+1:n=i-1}return-r-1}function searchRange(t,e){for(var r,n=0,i=t.length-1;n<=i;){var o=n+i>>>1;r=t[o];var a=r.start;if(a===e)return r;a<e?n=o+1:i=o-1}if(n>0)return r=t[n-1],e>r.end?0:r}function Layout(t,e){this.font=t,this.tableName=e}Layout.prototype={searchTag,binSearch,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,i=searchTag(r.scripts,t);if(i>=0)return n[i].script;if(e){var o={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,o),o.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var i=searchTag(n.langSysRecords,e);if(i>=0)return n.langSysRecords[i].langSys;if(r){var o={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,o),o.langSys}}},getFeatureTable:function(t,e,r,n){var i=this.getLangSysTable(t,e,n);if(i){for(var o,a=i.featureIndexes,l=this.font.tables[this.tableName].features,f=0;f<a.length;f++)if(o=l[a[f]],o.tag===r)return o.feature;if(n){var d=l.length;return check.assert(d===0||r>=l[d-1].tag,"Features must be added in alphabetical order."),o={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(o),a.push(d),o.feature}}},getLookupTables:function(t,e,r,n,i){var o=this.getFeatureTable(t,e,r,i),a=[];if(o){for(var l,f=o.lookupListIndexes,d=this.font.tables[this.tableName].lookups,g=0;g<f.length;g++)l=d[f[g]],l.lookupType===n&&a.push(l);if(a.length===0&&i){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var b=d.length;return d.push(l),f.push(b),[l]}}return a},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=searchRange(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=binSearch(t.glyphs,e);return r>=0?r:-1;case 2:var n=searchRange(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var i=r[n],o=i.start,a=i.end,l=o;l<=a;l++)e.push(l);return e}};function Position(t){Layout.call(this,t,"gpos")}Position.prototype=Layout.prototype,Position.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},Position.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var i=t[n].subtables,o=0;o<i.length;o++){var a=i[o],l=this.getCoverageIndex(a.coverage,e);if(!(l<0))switch(a.posFormat){case 1:for(var f=a.pairSets[l],d=0;d<f.length;d++){var g=f[d];if(g.secondGlyph===r)return g.value1&&g.value1.xAdvance||0}break;case 2:var b=this.getGlyphClass(a.classDef1,e),_=this.getGlyphClass(a.classDef2,r),E=a.classRecords[b][_];return E.value1&&E.value1.xAdvance||0}}return 0},Position.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function Substitution(t){Layout.call(this,t,"gsub")}function arraysEqual(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function getSubstFormat(t,e,r){for(var n=t.subtables,i=0;i<n.length;i++){var o=n[i];if(o.substFormat===e)return o}if(r)return n.push(r),r}Substitution.prototype=Layout.prototype,Substitution.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Substitution.prototype.getSingle=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,1),o=0;o<i.length;o++)for(var a=i[o].subtables,l=0;l<a.length;l++){var f=a[l],d=this.expandCoverage(f.coverage),g=void 0;if(f.substFormat===1){var b=f.deltaGlyphId;for(g=0;g<d.length;g++){var _=d[g];n.push({sub:_,by:_+b})}}else{var E=f.substitute;for(g=0;g<d.length;g++)n.push({sub:d[g],by:E[g]})}}return n},Substitution.prototype.getMultiple=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,2),o=0;o<i.length;o++)for(var a=i[o].subtables,l=0;l<a.length;l++){var f=a[l],d=this.expandCoverage(f.coverage),g=void 0;for(g=0;g<d.length;g++){var b=d[g],_=f.sequences[g];n.push({sub:b,by:_})}}return n},Substitution.prototype.getAlternates=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,3),o=0;o<i.length;o++)for(var a=i[o].subtables,l=0;l<a.length;l++)for(var f=a[l],d=this.expandCoverage(f.coverage),g=f.alternateSets,b=0;b<d.length;b++)n.push({sub:d[b],by:g[b]});return n},Substitution.prototype.getLigatures=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,4),o=0;o<i.length;o++)for(var a=i[o].subtables,l=0;l<a.length;l++)for(var f=a[l],d=this.expandCoverage(f.coverage),g=f.ligatureSets,b=0;b<d.length;b++)for(var _=d[b],E=g[b],k=0;k<E.length;k++){var D=E[k];n.push({sub:[_].concat(D.components),by:D.ligGlyph})}return n},Substitution.prototype.addSingle=function(t,e,r,n){var i=this.getLookupTables(r,n,t,1,!0)[0],o=getSubstFormat(i,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});check.assert(o.coverage.format===1,"Single: unable to modify coverage table format "+o.coverage.format);var a=e.sub,l=this.binSearch(o.coverage.glyphs,a);l<0&&(l=-1-l,o.coverage.glyphs.splice(l,0,a),o.substitute.splice(l,0,0)),o.substitute[l]=e.by},Substitution.prototype.addMultiple=function(t,e,r,n){check.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=this.getLookupTables(r,n,t,2,!0)[0],o=getSubstFormat(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});check.assert(o.coverage.format===1,"Multiple: unable to modify coverage table format "+o.coverage.format);var a=e.sub,l=this.binSearch(o.coverage.glyphs,a);l<0&&(l=-1-l,o.coverage.glyphs.splice(l,0,a),o.sequences.splice(l,0,0)),o.sequences[l]=e.by},Substitution.prototype.addAlternate=function(t,e,r,n){var i=this.getLookupTables(r,n,t,3,!0)[0],o=getSubstFormat(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});check.assert(o.coverage.format===1,"Alternate: unable to modify coverage table format "+o.coverage.format);var a=e.sub,l=this.binSearch(o.coverage.glyphs,a);l<0&&(l=-1-l,o.coverage.glyphs.splice(l,0,a),o.alternateSets.splice(l,0,0)),o.alternateSets[l]=e.by},Substitution.prototype.addLigature=function(t,e,r,n){var i=this.getLookupTables(r,n,t,4,!0)[0],o=i.subtables[0];o||(o={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=o),check.assert(o.coverage.format===1,"Ligature: unable to modify coverage table format "+o.coverage.format);var a=e.sub[0],l=e.sub.slice(1),f={ligGlyph:e.by,components:l},d=this.binSearch(o.coverage.glyphs,a);if(d>=0){for(var g=o.ligatureSets[d],b=0;b<g.length;b++)if(arraysEqual(g[b].components,l))return;g.push(f)}else d=-1-d,o.coverage.glyphs.splice(d,0,a),o.ligatureSets.splice(d,0,[f])},Substitution.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}},Substitution.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function isBrowser(){return typeof window<"u"}function nodeBufferToArrayBuffer(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;++n)r[n]=t[n];return e}function arrayBufferToNodeBuffer(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function checkArgument(t,e){if(!t)throw e}function parseGlyphCoordinate(t,e,r,n,i){var o;return(e&n)>0?(o=t.parseByte(),e&i||(o=-o),o=r+o):(e&i)>0?o=r:o=r+t.parseShort(),o}function parseGlyph(t,e,r){var n=new parse$1.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var i,o;if(t.numberOfContours>0){for(var a=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)a.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var f=0;f<t.instructionLength;f+=1)t.instructions.push(n.parseByte());var d=a[a.length-1]+1;i=[];for(var g=0;g<d;g+=1)if(o=n.parseByte(),i.push(o),(o&8)>0)for(var b=n.parseByte(),_=0;_<b;_+=1)i.push(o),g+=1;if(check.argument(i.length===d,"Bad flags."),a.length>0){var E=[],k;if(d>0){for(var D=0;D<d;D+=1)o=i[D],k={},k.onCurve=!!(o&1),k.lastPointOfContour=a.indexOf(D)>=0,E.push(k);for(var L=0,M=0;M<d;M+=1)o=i[M],k=E[M],k.x=parseGlyphCoordinate(n,o,L,2,16),L=k.x;for(var U=0,R=0;R<d;R+=1)o=i[R],k=E[R],k.y=parseGlyphCoordinate(n,o,U,4,32),U=k.y}t.points=E}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var z=!0;z;){i=n.parseUShort();var X={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(i&1)>0?(i&2)>0?(X.dx=n.parseShort(),X.dy=n.parseShort()):X.matchedPoints=[n.parseUShort(),n.parseUShort()]:(i&2)>0?(X.dx=n.parseChar(),X.dy=n.parseChar()):X.matchedPoints=[n.parseByte(),n.parseByte()],(i&8)>0?X.xScale=X.yScale=n.parseF2Dot14():(i&64)>0?(X.xScale=n.parseF2Dot14(),X.yScale=n.parseF2Dot14()):(i&128)>0&&(X.xScale=n.parseF2Dot14(),X.scale01=n.parseF2Dot14(),X.scale10=n.parseF2Dot14(),X.yScale=n.parseF2Dot14()),t.components.push(X),z=!!(i&32)}if(i&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var se=0;se<t.instructionLength;se+=1)t.instructions.push(n.parseByte())}}}function transformPoints(t,e){for(var r=[],n=0;n<t.length;n+=1){var i=t[n],o={x:e.xScale*i.x+e.scale01*i.y+e.dx,y:e.scale10*i.x+e.yScale*i.y+e.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};r.push(o)}return r}function getContours(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];r.push(i),i.lastPointOfContour&&(e.push(r),r=[])}return check.argument(r.length===0,"There are still points left in the current contour."),e}function getPath(t){var e=new Path;if(!t)return e;for(var r=getContours(t),n=0;n<r.length;++n){var i=r[n],o=null,a=i[i.length-1],l=i[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var f={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5};e.moveTo(f.x,f.y)}for(var d=0;d<i.length;++d)if(o=a,a=l,l=i[(d+1)%i.length],a.onCurve)e.lineTo(a.x,a.y);else{var g=l;o.onCurve||((a.x+o.x)*.5,(a.y+o.y)*.5),l.onCurve||(g={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5}),e.quadraticCurveTo(a.x,a.y,g.x,g.y)}e.closePath()}return e}function buildPath(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],i=t.get(n.glyphIndex);if(i.getPath(),i.points){var o=void 0;if(n.matchedPoints===void 0)o=transformPoints(i.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[n.matchedPoints[0]],l=i.points[n.matchedPoints[1]],f={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=transformPoints([l],f)[0],f.dx=a.x-l.x,f.dy=a.y-l.y,o=transformPoints(i.points,f)}e.points=e.points.concat(o)}}return getPath(e.points)}function parseGlyfTableAll(t,e,r,n){for(var i=new glyphset.GlyphSet(n),o=0;o<r.length-1;o+=1){var a=r[o],l=r[o+1];a!==l?i.push(o,glyphset.ttfGlyphLoader(n,o,parseGlyph,t,e+a,buildPath)):i.push(o,glyphset.glyphLoader(n,o))}return i}function parseGlyfTableOnLowMemory(t,e,r,n){var i=new glyphset.GlyphSet(n);return n._push=function(o){var a=r[o],l=r[o+1];a!==l?i.push(o,glyphset.ttfGlyphLoader(n,o,parseGlyph,t,e+a,buildPath)):i.push(o,glyphset.glyphLoader(n,o))},i}function parseGlyfTable(t,e,r,n,i){return i.lowMemory?parseGlyfTableOnLowMemory(t,e,r,n):parseGlyfTableAll(t,e,r,n)}var glyf={getPath,parse:parseGlyfTable},instructionTable,exec,execGlyph,execComponent;function Hinting(t){this.font=t,this.getCommands=function(e){return glyf.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function roundOff(t){return t}function roundToGrid(t){return Math.sign(t)*Math.round(Math.abs(t))}function roundToDoubleGrid(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function roundToHalfGrid(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function roundUpToGrid(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function roundDownToGrid(t){return Math.sign(t)*Math.floor(Math.abs(t))}var roundSuper=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,i=1;return t<0&&(t=-t,i=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*i:t*i},xUnitVector={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var i,o,a,l,f,d,g;if(!n||n===this){if(i=t.xo-e.xo,o=t.xo-r.xo,f=e.x-e.xo,d=r.x-r.xo,a=Math.abs(i),l=Math.abs(o),g=a+l,g===0){t.x=t.xo+(f+d)/2;return}t.x=t.xo+(f*l+d*a)/g;return}if(i=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),d=n.distance(r,r,!1,!0),a=Math.abs(i),l=Math.abs(o),g=a+l,g===0){xUnitVector.setRelative(t,t,(f+d)/2,n,!0);return}xUnitVector.setRelative(t,t,(f*l+d*a)/g,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,i){if(!n||n===this){t.x=(i?e.xo:e.x)+r;return}var o=i?e.xo:e.x,a=i?e.yo:e.y,l=o+r*n.x,f=a+r*n.y;t.x=l+(t.y-f)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},yUnitVector={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var i,o,a,l,f,d,g;if(!n||n===this){if(i=t.yo-e.yo,o=t.yo-r.yo,f=e.y-e.yo,d=r.y-r.yo,a=Math.abs(i),l=Math.abs(o),g=a+l,g===0){t.y=t.yo+(f+d)/2;return}t.y=t.yo+(f*l+d*a)/g;return}if(i=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),d=n.distance(r,r,!1,!0),a=Math.abs(i),l=Math.abs(o),g=a+l,g===0){yUnitVector.setRelative(t,t,(f+d)/2,n,!0);return}yUnitVector.setRelative(t,t,(f*l+d*a)/g,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,i){if(!n||n===this){t.y=(i?e.yo:e.y)+r;return}var o=i?e.xo:e.x,a=i?e.yo:e.y,l=o+r*n.x,f=a+r*n.y;t.y=f+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(xUnitVector),Object.freeze(yUnitVector);function UnitVector(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}UnitVector.prototype.distance=function(t,e,r,n){return this.x*xUnitVector.distance(t,e,r,n)+this.y*yUnitVector.distance(t,e,r,n)},UnitVector.prototype.interpolate=function(t,e,r,n){var i,o,a,l,f,d,g;if(a=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),i=n.distance(e,e,!1,!0),o=n.distance(r,r,!1,!0),f=Math.abs(a),d=Math.abs(l),g=f+d,g===0){this.setRelative(t,t,(i+o)/2,n,!0);return}this.setRelative(t,t,(i*d+o*f)/g,n,!0)},UnitVector.prototype.setRelative=function(t,e,r,n,i){n=n||this;var o=i?e.xo:e.x,a=i?e.yo:e.y,l=o+r*n.x,f=a+r*n.y,d=n.normalSlope,g=this.slope,b=t.x,_=t.y;t.x=(g*b-d*l+f-_)/(g-d),t.y=g*(t.x-b)+_},UnitVector.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function getUnitVector(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?xUnitVector:t===0&&e===1?yUnitVector:new UnitVector(t,e)}function HPoint(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}HPoint.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},HPoint.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var HPZero=Object.freeze(new HPoint(0,0)),defaultState={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function State(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=xUnitVector,this.round=roundToGrid}}Hinting.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var i=this._fpgmState;if(!i){State.prototype=defaultState,i=this._fpgmState=new State("fpgm",r.tables.fpgm),i.funcs=[],i.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),i.step=-1);try{exec(i)}catch(d){console.log("Hinting error in FPGM:"+d),this._errorState=3;return}}State.prototype=i,n=this._prepState=new State("prep",r.tables.prep),n.ppem=e;var o=r.tables.cvt;if(o)for(var a=n.cvt=new Array(o.length),l=e/r.unitsPerEm,f=0;f<o.length;f++)a[f]=o[f]*l;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{exec(n)}catch(d){this._errorState<2&&console.log("Hinting error in PREP:"+d),this._errorState=2}}if(!(this._errorState>1))try{return execGlyph(t,n)}catch(d){this._errorState<1&&(console.log("Hinting error:"+d),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},execGlyph=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,i=t.components,o,a,l;if(State.prototype=e,!i)l=new State("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),execComponent(t,l,r,n),a=l.gZone;else{var f=e.font;a=[],o=[];for(var d=0;d<i.length;d++){var g=i[d],b=f.glyphs.get(g.glyphIndex);l=new State("glyf",b.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+d+"---"),l.step=-1),execComponent(b,l,r,n);for(var _=Math.round(g.dx*r),E=Math.round(g.dy*n),k=l.gZone,D=l.contours,L=0;L<k.length;L++){var M=k[L];M.xTouched=M.yTouched=!1,M.xo=M.x=M.x+_,M.yo=M.y=M.y+E}var U=a.length;a.push.apply(a,k);for(var R=0;R<D.length;R++)o.push(D[R]+U)}t.instructions&&!l.inhibitGridFit&&(l=new State("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=a,l.contours=o,a.push(new HPoint(0,0),new HPoint(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),exec(l),a.length-=2)}return a},execComponent=function(t,e,r,n){for(var i=t.points||[],o=i.length,a=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],f,d=0;d<o;d++)f=i[d],a[d]=new HPoint(f.x*r,f.y*n,f.lastPointOfContour,f.onCurve);for(var g,b,_=0;_<o;_++)f=a[_],g||(g=f,l.push(_)),f.lastPointOfContour?(f.nextPointOnContour=g,g.prevPointOnContour=f,g=void 0):(b=a[_+1],f.nextPointOnContour=b,b.prevPointOnContour=f);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var E=0;E<o;E++)console.log(E,a[E].x,a[E].y)}if(a.push(new HPoint(0,0),new HPoint(Math.round(t.advanceWidth*r),0)),exec(e),a.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var k=0;k<o;k++)console.log(k,a[k].x,a[k].y)}}},exec=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=instructionTable[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function initTZone(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new HPoint(0,0)}function skip(t,e){var r=t.prog,n=t.ip,i=1,o;do if(o=r[++n],o===88)i++;else if(o===89)i--;else if(o===64)n+=r[n+1]+1;else if(o===65)n+=2*r[n+1]+1;else if(o>=176&&o<=183)n+=o-176+1;else if(o>=184&&o<=191)n+=(o-184+1)*2;else if(e&&i===1&&o===27)break;while(i>0);t.ip=n}function SVTCA(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function SPVTCA(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function SFVTCA(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function SPVTL(t,e){var r=e.stack,n=r.pop(),i=r.pop(),o=e.z2[n],a=e.z1[i];exports.DEBUG&&console.log("SPVTL["+t+"]",n,i);var l,f;t?(l=o.y-a.y,f=a.x-o.x):(l=a.x-o.x,f=a.y-o.y),e.pv=e.dpv=getUnitVector(l,f)}function SFVTL(t,e){var r=e.stack,n=r.pop(),i=r.pop(),o=e.z2[n],a=e.z1[i];exports.DEBUG&&console.log("SFVTL["+t+"]",n,i);var l,f;t?(l=o.y-a.y,f=a.x-o.x):(l=a.x-o.x,f=a.y-o.y),e.fv=getUnitVector(l,f)}function SPVFS(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=getUnitVector(n,r)}function SFVFS(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=getUnitVector(n,r)}function GPV(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function GFV(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function SFVTPV(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function ISECT(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop(),o=e.pop(),a=e.pop(),l=t.z0,f=t.z1,d=l[r],g=l[n],b=f[i],_=f[o],E=t.z2[a];exports.DEBUG&&console.log("ISECT[], ",r,n,i,o,a);var k=d.x,D=d.y,L=g.x,M=g.y,U=b.x,R=b.y,z=_.x,X=_.y,se=(k-L)*(R-X)-(D-M)*(U-z),$=k*M-D*L,q=U*X-R*z;E.x=($*(U-z)-q*(k-L))/se,E.y=($*(R-X)-q*(D-M))/se}function SRP0(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function SRP1(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function SRP2(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function SZP0(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||initTZone(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP1(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||initTZone(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP2(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||initTZone(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZPS(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||initTZone(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function SLOOP(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function RTG(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=roundToGrid}function RTHG(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=roundToHalfGrid}function SMD(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function ELSE(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),skip(t,!1)}function JMPR(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function SCVTCI(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function DUP(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function POP(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function CLEAR(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function SWAP(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function DEPTH(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function LOOPCALL(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var i=t.ip,o=t.prog;t.prog=t.funcs[r];for(var a=0;a<n;a++)exec(t),exports.DEBUG&&console.log(++t.step,a+1<n?"next loopcall":"done loopcall",a);t.ip=i,t.prog=o}function CALL(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],exec(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function CINDEX(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function MINDEX(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function FDEF(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,i=e.pop(),o=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",i);r[++n]!==45;);t.ip=n,t.funcs[i]=r.slice(o+1,n)}function MDAP(t,e){var r=e.stack.pop(),n=e.z0[r],i=e.fv,o=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var a=o.distance(n,HPZero);t&&(a=e.round(a)),i.setRelative(n,HPZero,a,o),i.touch(n),e.rp0=e.rp1=r}function IUP(t,e){var r=e.z2,n=r.length-2,i,o,a;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)i=r[l],!t.touched(i)&&(o=i.prevTouched(t),o!==i&&(a=i.nextTouched(t),o===a&&t.setRelative(i,i,t.distance(o,o,!1,!0),t,!0),t.interpolate(i,o,a,t)))}function SHP(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],o=e.fv,a=e.pv,l=e.loop,f=e.z2;l--;){var d=r.pop(),g=f[d],b=a.distance(i,i,!1,!0);o.setRelative(g,g,b,a),o.touch(g),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",d)}e.loop=1}function SHC(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],o=e.fv,a=e.pv,l=r.pop(),f=e.z2[e.contours[l]],d=f;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var g=a.distance(i,i,!1,!0);do d!==i&&o.setRelative(d,d,g,a),d=d.nextPointOnContour;while(d!==f)}function SHZ(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],o=e.fv,a=e.pv,l=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var f;switch(l){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var d,g=a.distance(i,i,!1,!0),b=f.length-2,_=0;_<b;_++)d=f[_],o.setRelative(d,d,g,a)}function SHPIX(t){for(var e=t.stack,r=t.loop,n=t.fv,i=e.pop()/64,o=t.z2;r--;){var a=e.pop(),l=o[a];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",a,i),n.setRelative(l,l,i),n.touch(l)}t.loop=1}function IP(t){for(var e=t.stack,r=t.rp1,n=t.rp2,i=t.loop,o=t.z0[r],a=t.z1[n],l=t.fv,f=t.dpv,d=t.z2;i--;){var g=e.pop(),b=d[g];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"IP[]",g,r,"<->",n),l.interpolate(b,o,a,f),l.touch(b)}t.loop=1}function MSIRP(t,e){var r=e.stack,n=r.pop()/64,i=r.pop(),o=e.z1[i],a=e.z0[e.rp0],l=e.fv,f=e.pv;l.setRelative(o,a,n,f),l.touch(o),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,i),e.rp1=e.rp0,e.rp2=i,t&&(e.rp0=i)}function ALIGNRP(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],i=t.loop,o=t.fv,a=t.pv,l=t.z1;i--;){var f=e.pop(),d=l[f];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"ALIGNRP[]",f),o.setRelative(d,n,0,a),o.touch(d)}t.loop=1}function RTDG(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=roundToDoubleGrid}function MIAP(t,e){var r=e.stack,n=r.pop(),i=r.pop(),o=e.z0[i],a=e.fv,l=e.pv,f=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",f,")",i);var d=l.distance(o,HPZero);t&&(Math.abs(d-f)<e.cvCutIn&&(d=f),d=e.round(d)),a.setRelative(o,HPZero,d,l),e.zp0===0&&(o.xo=o.x,o.yo=o.y),a.touch(o),e.rp0=e.rp1=i}function NPUSHB(t){var e=t.prog,r=t.ip,n=t.stack,i=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",i);for(var o=0;o<i;o++)n.push(e[++r]);t.ip=r}function NPUSHW(t){var e=t.ip,r=t.prog,n=t.stack,i=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",i);for(var o=0;o<i;o++){var a=r[++e]<<8|r[++e];a&32768&&(a=-((a^65535)+1)),n.push(a)}t.ip=e}function WS(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),i=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,i),r[i]=n}function RS(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var i=r&&r[n]||0;e.push(i)}function WCVTP(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function RCVT(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function GC(t,e){var r=e.stack,n=r.pop(),i=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(i,HPZero,t,!1)*64)}function MD(t,e){var r=e.stack,n=r.pop(),i=r.pop(),o=e.z1[n],a=e.z0[i],l=e.dpv.distance(a,o,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,i,"->",l),e.stack.push(Math.round(l*64))}function MPPEM(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function FLIPON(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function LT(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function LTEQ(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function GT(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function GTEQ(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function EQ(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function NEQ(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function ODD(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function EVEN(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function IF(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(skip(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function EIF(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function AND(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function OR(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function NOT(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function DELTAP123(t,e){var r=e.stack,n=r.pop(),i=e.fv,o=e.pv,a=e.ppem,l=e.deltaBase+(t-1)*16,f=e.deltaShift,d=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var g=0;g<n;g++){var b=r.pop(),_=r.pop(),E=l+((_&240)>>4);if(E===a){var k=(_&15)-8;k>=0&&k++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",b,"by",k*f);var D=d[b];i.setRelative(D,D,k*f,o)}}}function SDB(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function SDS(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function ADD(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function SUB(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function DIV(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function MUL(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function ABS(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function NEG(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function FLOOR(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function CEILING(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function ROUND(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function WCVTF(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function DELTAC123(t,e){var r=e.stack,n=r.pop(),i=e.ppem,o=e.deltaBase+(t-1)*16,a=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var f=r.pop(),d=r.pop(),g=o+((d&240)>>4);if(g===i){var b=(d&15)-8;b>=0&&b++;var _=b*a;exports.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",_),e.cvt[f]+=_}}}function SROUND(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=roundSuper;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function S45ROUND(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=roundSuper;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function ROFF(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=roundOff}function RUTG(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=roundUpToGrid}function RDTG(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=roundDownToGrid}function SCANCTRL(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function SDPVTL(t,e){var r=e.stack,n=r.pop(),i=r.pop(),o=e.z2[n],a=e.z1[i];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,i);var l,f;t?(l=o.y-a.y,f=a.x-o.x):(l=a.x-o.x,f=a.y-o.y),e.dpv=getUnitVector(l,f)}function GETINFO(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function ROLL(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(i)}function MAX(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function MIN(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function SCANTYPE(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function INSTCTRL(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function PUSHB(t,e){var r=e.stack,n=e.prog,i=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var o=0;o<t;o++)r.push(n[++i]);e.ip=i}function PUSHW(t,e){var r=e.ip,n=e.prog,i=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var o=0;o<t;o++){var a=n[++r]<<8|n[++r];a&32768&&(a=-((a^65535)+1)),i.push(a)}e.ip=r}function MDRP_MIRP(t,e,r,n,i,o){var a=o.stack,l=t&&a.pop(),f=a.pop(),d=o.rp0,g=o.z0[d],b=o.z1[f],_=o.minDis,E=o.fv,k=o.dpv,D,L,M,U;L=D=k.distance(b,g,!0,!0),M=L>=0?1:-1,L=Math.abs(L),t&&(U=o.cvt[l],n&&Math.abs(L-U)<o.cvCutIn&&(L=U)),r&&L<_&&(L=_),n&&(L=o.round(L)),E.setRelative(b,g,M*L,k),E.touch(b),exports.DEBUG&&console.log(o.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(i===0?"Gr":i===1?"Bl":i===2?"Wh":"")+"]",t?l+"("+o.cvt[l]+","+U+")":"",f,"(d =",D,"->",M*L,")"),o.rp1=o.rp0,o.rp2=f,e&&(o.rp0=f)}instructionTable=[SVTCA.bind(void 0,yUnitVector),SVTCA.bind(void 0,xUnitVector),SPVTCA.bind(void 0,yUnitVector),SPVTCA.bind(void 0,xUnitVector),SFVTCA.bind(void 0,yUnitVector),SFVTCA.bind(void 0,xUnitVector),SPVTL.bind(void 0,0),SPVTL.bind(void 0,1),SFVTL.bind(void 0,0),SFVTL.bind(void 0,1),SPVFS,SFVFS,GPV,GFV,SFVTPV,ISECT,SRP0,SRP1,SRP2,SZP0,SZP1,SZP2,SZPS,SLOOP,RTG,RTHG,SMD,ELSE,JMPR,SCVTCI,void 0,void 0,DUP,POP,CLEAR,SWAP,DEPTH,CINDEX,MINDEX,void 0,void 0,void 0,LOOPCALL,CALL,FDEF,void 0,MDAP.bind(void 0,0),MDAP.bind(void 0,1),IUP.bind(void 0,yUnitVector),IUP.bind(void 0,xUnitVector),SHP.bind(void 0,0),SHP.bind(void 0,1),SHC.bind(void 0,0),SHC.bind(void 0,1),SHZ.bind(void 0,0),SHZ.bind(void 0,1),SHPIX,IP,MSIRP.bind(void 0,0),MSIRP.bind(void 0,1),ALIGNRP,RTDG,MIAP.bind(void 0,0),MIAP.bind(void 0,1),NPUSHB,NPUSHW,WS,RS,WCVTP,RCVT,GC.bind(void 0,0),GC.bind(void 0,1),void 0,MD.bind(void 0,0),MD.bind(void 0,1),MPPEM,void 0,FLIPON,void 0,void 0,LT,LTEQ,GT,GTEQ,EQ,NEQ,ODD,EVEN,IF,EIF,AND,OR,NOT,DELTAP123.bind(void 0,1),SDB,SDS,ADD,SUB,DIV,MUL,ABS,NEG,FLOOR,CEILING,ROUND.bind(void 0,0),ROUND.bind(void 0,1),ROUND.bind(void 0,2),ROUND.bind(void 0,3),void 0,void 0,void 0,void 0,WCVTF,DELTAP123.bind(void 0,2),DELTAP123.bind(void 0,3),DELTAC123.bind(void 0,1),DELTAC123.bind(void 0,2),DELTAC123.bind(void 0,3),SROUND,S45ROUND,void 0,void 0,ROFF,void 0,RUTG,RDTG,POP,POP,void 0,void 0,void 0,void 0,void 0,SCANCTRL,SDPVTL.bind(void 0,0),SDPVTL.bind(void 0,1),GETINFO,void 0,ROLL,MAX,MIN,SCANTYPE,INSTCTRL,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,PUSHB.bind(void 0,1),PUSHB.bind(void 0,2),PUSHB.bind(void 0,3),PUSHB.bind(void 0,4),PUSHB.bind(void 0,5),PUSHB.bind(void 0,6),PUSHB.bind(void 0,7),PUSHB.bind(void 0,8),PUSHW.bind(void 0,1),PUSHW.bind(void 0,2),PUSHW.bind(void 0,3),PUSHW.bind(void 0,4),PUSHW.bind(void 0,5),PUSHW.bind(void 0,6),PUSHW.bind(void 0,7),PUSHW.bind(void 0,8),MDRP_MIRP.bind(void 0,0,0,0,0,0),MDRP_MIRP.bind(void 0,0,0,0,0,1),MDRP_MIRP.bind(void 0,0,0,0,0,2),MDRP_MIRP.bind(void 0,0,0,0,0,3),MDRP_MIRP.bind(void 0,0,0,0,1,0),MDRP_MIRP.bind(void 0,0,0,0,1,1),MDRP_MIRP.bind(void 0,0,0,0,1,2),MDRP_MIRP.bind(void 0,0,0,0,1,3),MDRP_MIRP.bind(void 0,0,0,1,0,0),MDRP_MIRP.bind(void 0,0,0,1,0,1),MDRP_MIRP.bind(void 0,0,0,1,0,2),MDRP_MIRP.bind(void 0,0,0,1,0,3),MDRP_MIRP.bind(void 0,0,0,1,1,0),MDRP_MIRP.bind(void 0,0,0,1,1,1),MDRP_MIRP.bind(void 0,0,0,1,1,2),MDRP_MIRP.bind(void 0,0,0,1,1,3),MDRP_MIRP.bind(void 0,0,1,0,0,0),MDRP_MIRP.bind(void 0,0,1,0,0,1),MDRP_MIRP.bind(void 0,0,1,0,0,2),MDRP_MIRP.bind(void 0,0,1,0,0,3),MDRP_MIRP.bind(void 0,0,1,0,1,0),MDRP_MIRP.bind(void 0,0,1,0,1,1),MDRP_MIRP.bind(void 0,0,1,0,1,2),MDRP_MIRP.bind(void 0,0,1,0,1,3),MDRP_MIRP.bind(void 0,0,1,1,0,0),MDRP_MIRP.bind(void 0,0,1,1,0,1),MDRP_MIRP.bind(void 0,0,1,1,0,2),MDRP_MIRP.bind(void 0,0,1,1,0,3),MDRP_MIRP.bind(void 0,0,1,1,1,0),MDRP_MIRP.bind(void 0,0,1,1,1,1),MDRP_MIRP.bind(void 0,0,1,1,1,2),MDRP_MIRP.bind(void 0,0,1,1,1,3),MDRP_MIRP.bind(void 0,1,0,0,0,0),MDRP_MIRP.bind(void 0,1,0,0,0,1),MDRP_MIRP.bind(void 0,1,0,0,0,2),MDRP_MIRP.bind(void 0,1,0,0,0,3),MDRP_MIRP.bind(void 0,1,0,0,1,0),MDRP_MIRP.bind(void 0,1,0,0,1,1),MDRP_MIRP.bind(void 0,1,0,0,1,2),MDRP_MIRP.bind(void 0,1,0,0,1,3),MDRP_MIRP.bind(void 0,1,0,1,0,0),MDRP_MIRP.bind(void 0,1,0,1,0,1),MDRP_MIRP.bind(void 0,1,0,1,0,2),MDRP_MIRP.bind(void 0,1,0,1,0,3),MDRP_MIRP.bind(void 0,1,0,1,1,0),MDRP_MIRP.bind(void 0,1,0,1,1,1),MDRP_MIRP.bind(void 0,1,0,1,1,2),MDRP_MIRP.bind(void 0,1,0,1,1,3),MDRP_MIRP.bind(void 0,1,1,0,0,0),MDRP_MIRP.bind(void 0,1,1,0,0,1),MDRP_MIRP.bind(void 0,1,1,0,0,2),MDRP_MIRP.bind(void 0,1,1,0,0,3),MDRP_MIRP.bind(void 0,1,1,0,1,0),MDRP_MIRP.bind(void 0,1,1,0,1,1),MDRP_MIRP.bind(void 0,1,1,0,1,2),MDRP_MIRP.bind(void 0,1,1,0,1,3),MDRP_MIRP.bind(void 0,1,1,1,0,0),MDRP_MIRP.bind(void 0,1,1,1,0,1),MDRP_MIRP.bind(void 0,1,1,1,0,2),MDRP_MIRP.bind(void 0,1,1,1,0,3),MDRP_MIRP.bind(void 0,1,1,1,1,0),MDRP_MIRP.bind(void 0,1,1,1,1,1),MDRP_MIRP.bind(void 0,1,1,1,1,2),MDRP_MIRP.bind(void 0,1,1,1,1,3)];function Token(t){this.char=t,this.state={},this.activeState=null}function ContextRange(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function ContextChecker(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function ContextParams(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Event(t){this.eventId=t,this.subscribers=[]}function initializeCoreEvents(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(i){Object.defineProperty(e.events,i,{value:new Event(i)})}),t&&r.forEach(function(i){var o=t[i];typeof o=="function"&&e.events[i].subscribe(o)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(i){e.events[i].subscribe(e.updateContextsRanges)})}function Tokenizer(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],initializeCoreEvents.call(this,t)}Token.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},Token.prototype.getState=function(t){return this.state[t]||null},Tokenizer.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},Tokenizer.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(o){return e[o[0]].apply(e,o.slice(1).concat(r))}),i=function(o){return typeof o=="object"&&o.hasOwnProperty("FAIL")};if(n.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(i)};this.dispatch("composeRUD",[n.filter(function(o){return!i(o)})])},Tokenizer.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var i=r.every(function(a){return a instanceof Token});if(!isNaN(t)&&this.inboundIndex(t)&&i){var o=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[o,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Tokenizer.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Token){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},Tokenizer.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n},Tokenizer.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}},Tokenizer.prototype.insertToken=function(t,e,r){var n=t.every(function(i){return i instanceof Token});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},Tokenizer.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,i){var o=[n,i],a=e===null||e.apply(this,o)===!0,l=[n,i];if(a){var f=r.apply(this,l);n.setState(t,f)}}),this.registeredModifiers.push(t)},Event.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Event.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},ContextParams.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},ContextParams.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}},Tokenizer.prototype.rangeToText=function(t){if(t instanceof ContextRange)return this.getRangeTokens(t).map(function(e){return e.char}).join("")},Tokenizer.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},Tokenizer.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null},Tokenizer.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null},Tokenizer.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Event&&n.subscribers.forEach(function(i){i.apply(r,e||[])})},Tokenizer.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new ContextChecker(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},Tokenizer.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},Tokenizer.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},Tokenizer.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}},Tokenizer.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new ContextParams(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Tokenizer.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new ContextRange(r,t,e),i=this.getContext(e).ranges;return n.rangeId=e+"."+i.length,i.push(n),this.getContext(e).openRange=null,n},Tokenizer.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var i=n.contextName,o=e.getContext(i).openRange;if(!o&&n.checkStart(t)&&(o=new ContextRange(r,null,i),e.getContext(i).openRange=o,e.dispatch("contextStart",[i,r])),o&&n.checkEnd(t)){var a=r-o.startIndex+1,l=e.setEndOffset(a,i);e.dispatch("contextEnd",[i,l])}})},Tokenizer.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],i=new ContextParams(e,r);this.dispatch("next",[i]),this.runContextCheck(i);var o=new Token(n);this.tokens.push(o),this.dispatch("newToken",[o,i])}return this.dispatch("end",[this.tokens]),this.tokens};function isArabicChar(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function isIsolatedArabicChar(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function isTashkeelArabicChar(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function isLatinChar(t){return/[A-z]/.test(t)}function isWhiteSpace(t){return/\s/.test(t)}function FeatureQuery(t){this.font=t,this.features={}}function SubstitutionAction(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function lookupCoverage(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var i=r[n];if(t>=i.start&&t<=i.end){var o=t-i.start;return i.index+o}}break;default:return-1}return-1}function singleSubstitutionFormat1(t,e){var r=lookupCoverage(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function singleSubstitutionFormat2(t,e){var r=lookupCoverage(t,e.coverage);return r===-1?null:e.substitute[r]}function lookupCoverageList(t,e){for(var r=[],n=0;n<t.length;n++){var i=t[n],o=e.current;o=Array.isArray(o)?o[0]:o;var a=lookupCoverage(o,i);a!==-1&&r.push(a)}return r.length!==t.length?-1:r}function chainingSubstitutionFormat3(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=lookupCoverageList(e.inputCoverage,t);if(n===-1)return[];var i=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var o=t.lookahead.slice(i);o.length&&isTashkeelArabicChar(o[0].char);)o.shift();var a=new ContextParams(o,0),l=lookupCoverageList(e.lookaheadCoverage,a),f=[].concat(t.backtrack);for(f.reverse();f.length&&isTashkeelArabicChar(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var d=new ContextParams(f,0),g=lookupCoverageList(e.backtrackCoverage,d),b=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&g.length===e.backtrackCoverage.length,_=[];if(b)for(var E=0;E<e.lookupRecords.length;E++)for(var k=e.lookupRecords[E],D=k.lookupListIndex,L=this.getLookupByIndex(D),M=0;M<L.subtables.length;M++){var U=L.subtables[M],R=this.getLookupMethod(L,U),z=this.getSubstitutionType(L,U);if(z==="12")for(var X=0;X<n.length;X++){var se=t.get(X),$=R(se);$&&_.push($)}}return _}function ligatureSubstitutionFormat1(t,e){var r=t.current,n=lookupCoverage(r,e.coverage);if(n===-1)return null;for(var i,o=e.ligatureSets[n],a=0;a<o.length;a++){i=o[a];for(var l=0;l<i.components.length;l++){var f=t.lookahead[l],d=i.components[l];if(f!==d)break;if(l===i.components.length-1)return i}}return null}function decompositionSubstitutionFormat1(t,e){var r=lookupCoverage(t,e.coverage);return r===-1?null:e.sequences[r]}FeatureQuery.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},FeatureQuery.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var i=r[n];if(i.tag===t&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var o=i.langSysRecords;if(o)for(var a=0;a<o.length;a++){var l=o[a];if(l.tag===t){var f=l.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},FeatureQuery.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var i=t[n].tag,o=t[n].feature;r[i]=o}this.features[e].tags=r},FeatureQuery.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(i){return n.features[i]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},FeatureQuery.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n},FeatureQuery.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(i){return singleSubstitutionFormat1.apply(r,[i,e])};case"12":return function(i){return singleSubstitutionFormat2.apply(r,[i,e])};case"63":return function(i){return chainingSubstitutionFormat3.apply(r,[i,e])};case"41":return function(i){return ligatureSubstitutionFormat1.apply(r,[i,e])};case"21":return function(i){return decompositionSubstitutionFormat1.apply(r,[i,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},FeatureQuery.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var i=this.getFeatureLookups(n),o=[].concat(e.context),a=0;a<i.length;a++)for(var l=i[a],f=this.getLookupSubtables(l),d=0;d<f.length;d++){var g=f[d],b=this.getSubstitutionType(l,g),_=this.getLookupMethod(l,g),E=void 0;switch(b){case"11":E=_(e.current),E&&o.splice(r,1,new SubstitutionAction({id:11,tag:t.tag,substitution:E}));break;case"12":E=_(e.current),E&&o.splice(r,1,new SubstitutionAction({id:12,tag:t.tag,substitution:E}));break;case"63":E=_(e),Array.isArray(E)&&E.length&&o.splice(r,1,new SubstitutionAction({id:63,tag:t.tag,substitution:E}));break;case"41":E=_(e),E&&o.splice(r,1,new SubstitutionAction({id:41,tag:t.tag,substitution:E}));break;case"21":E=_(e.current),E&&o.splice(r,1,new SubstitutionAction({id:21,tag:t.tag,substitution:E}));break}e=new ContextParams(o,r),!(Array.isArray(E)&&!E.length)&&(E=null)}return o.length?o:null},FeatureQuery.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r},FeatureQuery.prototype.getLookupSubtables=function(t){return t.subtables||null},FeatureQuery.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null},FeatureQuery.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},FeatureQuery.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function arabicWordStartCheck(t){var e=t.current,r=t.get(-1);return r===null&&isArabicChar(e)||!isArabicChar(r)&&isArabicChar(e)}function arabicWordEndCheck(t){var e=t.get(1);return e===null||!isArabicChar(e)}var arabicWordCheck={startCheck:arabicWordStartCheck,endCheck:arabicWordEndCheck};function arabicSentenceStartCheck(t){var e=t.current,r=t.get(-1);return(isArabicChar(e)||isTashkeelArabicChar(e))&&!isArabicChar(r)}function arabicSentenceEndCheck(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!isArabicChar(e)&&!isTashkeelArabicChar(e)):var r=isWhiteSpace(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(i){return isArabicChar(i)||isTashkeelArabicChar(i)}),!n)return!0}break;default:return!1}}var arabicSentenceCheck={startCheck:arabicSentenceStartCheck,endCheck:arabicSentenceEndCheck};function singleSubstitutionFormat1$1(t,e,r){e[r].setState(t.tag,t.substitution)}function singleSubstitutionFormat2$1(t,e,r){e[r].setState(t.tag,t.substitution)}function chainingSubstitutionFormat3$1(t,e,r){t.substitution.forEach(function(n,i){var o=e[r+i];o.setState(t.tag,n)})}function ligatureSubstitutionFormat1$1(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var i=t.substitution.components.length,o=0;o<i;o++)n=e[r+o+1],n.setState("deleted",!0)}var SUBSTITUTIONS={11:singleSubstitutionFormat1$1,12:singleSubstitutionFormat2$1,63:chainingSubstitutionFormat3$1,41:ligatureSubstitutionFormat1$1};function applySubstitution(t,e,r){t instanceof SubstitutionAction&&SUBSTITUTIONS[t.id]&&SUBSTITUTIONS[t.id](t,e,r)}function willConnectPrev(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],i=isIsolatedArabicChar(n),o=isTashkeelArabicChar(n);if(!i&&!o)return!0;if(i)return!1}return!1}function willConnectNext(t){if(isIsolatedArabicChar(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=isTashkeelArabicChar(r);if(!n)return!0}return!1}function arabicPresentationForms(t){var e=this,r="arab",n=this.featuresTags[r],i=this.tokenizer.getRangeTokens(t);if(i.length!==1){var o=new ContextParams(i.map(function(l){return l.getState("glyphIndex")}),0),a=new ContextParams(i.map(function(l){return l.char}),0);i.forEach(function(l,f){if(!isTashkeelArabicChar(l.char)){o.setCurrentIndex(f),a.setCurrentIndex(f);var d=0;willConnectPrev(a)&&(d|=1),willConnectNext(a)&&(d|=2);var g;switch(d){case 1:g="fina";break;case 2:g="init";break;case 3:g="medi";break}if(n.indexOf(g)!==-1){var b=e.query.lookupFeature({tag:g,script:r,contextParams:o});if(b instanceof Error)return console.info(b.message);b.forEach(function(_,E){_ instanceof SubstitutionAction&&(applySubstitution(_,i,E),o.context[E]=_.substitution)})}}})}}function getContextParams(t,e){var r=t.map(function(n){return n.activeState.value});return new ContextParams(r,0)}function arabicRequiredLigatures(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),i=getContextParams(n);i.context.forEach(function(o,a){i.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:i});l.length&&(l.forEach(function(f){return applySubstitution(f,n,a)}),i=getContextParams(n))})}function latinWordStartCheck(t){var e=t.current,r=t.get(-1);return r===null&&isLatinChar(e)||!isLatinChar(r)&&isLatinChar(e)}function latinWordEndCheck(t){var e=t.get(1);return e===null||!isLatinChar(e)}var latinWordCheck={startCheck:latinWordStartCheck,endCheck:latinWordEndCheck};function getContextParams$1(t,e){var r=t.map(function(n){return n.activeState.value});return new ContextParams(r,0)}function latinLigature(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),i=getContextParams$1(n);i.context.forEach(function(o,a){i.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:i});l.length&&(l.forEach(function(f){return applySubstitution(f,n,a)}),i=getContextParams$1(n))})}function Bidi(t){this.baseDir=t||"ltr",this.tokenizer=new Tokenizer,this.featuresTags={}}Bidi.prototype.setText=function(t){this.text=t},Bidi.prototype.contextChecks={latinWordCheck,arabicWordCheck,arabicSentenceCheck};function registerContextChecker(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function tokenizeText(){return registerContextChecker.call(this,"latinWord"),registerContextChecker.call(this,"arabicWord"),registerContextChecker.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function reverseArabicSentences(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Bidi.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(i){return r.query.supports({script:t,tag:i})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},Bidi.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new FeatureQuery(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},Bidi.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function checkGlyphIndexStatus(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function applyArabicPresentationForms(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){checkGlyphIndexStatus.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){arabicPresentationForms.call(t,n)})}}function applyArabicRequireLigatures(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){checkGlyphIndexStatus.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){arabicRequiredLigatures.call(t,i)})}}}function applyLatinLigatures(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){checkGlyphIndexStatus.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(i){latinLigature.call(t,i)})}}}Bidi.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},Bidi.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(applyArabicPresentationForms.call(this),applyArabicRequireLigatures.call(this)),this.checkContextReady("latinWord")&&applyLatinLigatures.call(this),this.checkContextReady("arabicSentence")&&reverseArabicSentences.call(this)},Bidi.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),tokenizeText.call(this),this.applyFeaturesToContexts())},Bidi.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},Bidi.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var i=n.activeState.value;e.push(Array.isArray(i)?i[0]:i)}}return e};function Font(t){t=t||{},t.tables=t.tables||{},t.empty||(checkArgument(t.familyName,"When creating a new Font object, familyName is required."),checkArgument(t.styleName,"When creating a new Font object, styleName is required."),checkArgument(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),checkArgument(t.ascender,"When creating a new Font object, ascender is required."),checkArgument(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new glyphset.GlyphSet(this,t.glyphs||[]),this.encoding=new DefaultEncoding(this),this.position=new Position(this),this.substitution=new Substitution(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Hinting(this)}})}Font.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null},Font.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},Font.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},Font.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})},Font.prototype.stringToGlyphs=function(t,e){var r=this,n=new Bidi,i=function(b){return r.charToGlyphIndex(b.char)};n.registerModifier("glyphIndex",null,i);var o=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,o);for(var a=n.getTextGlyphs(t),l=a.length,f=new Array(l),d=this.glyphs.get(0),g=0;g<l;g+=1)f[g]=this.glyphs.get(a[g])||d;return f},Font.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},Font.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},Font.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},Font.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0},Font.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Font.prototype.forEachGlyph=function(t,e,r,n,i,o){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,i=Object.assign({},this.defaultRenderOptions,i);var a=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,i),f;if(i.kerning){var d=i.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(d,i.language)}for(var g=0;g<l.length;g+=1){var b=l[g];if(o.call(this,b,e,r,n,i),b.advanceWidth&&(e+=b.advanceWidth*a),i.kerning&&g<l.length-1){var _=f?this.position.getKerningValue(f,b.index,l[g+1].index):this.getKerningValue(b,l[g+1]);e+=_*a}i.letterSpacing?e+=i.letterSpacing*n:i.tracking&&(e+=i.tracking/1e3*n)}return e},Font.prototype.getPath=function(t,e,r,n,i){var o=new Path;return this.forEachGlyph(t,e,r,n,i,function(a,l,f,d){var g=a.getPath(l,f,d,i,this);o.extend(g)}),o},Font.prototype.getPaths=function(t,e,r,n,i){var o=[];return this.forEachGlyph(t,e,r,n,i,function(a,l,f,d){var g=a.getPath(l,f,d,i,this);o.push(g)}),o},Font.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})},Font.prototype.draw=function(t,e,r,n,i,o){this.getPath(e,r,n,i,o).draw(t)},Font.prototype.drawPoints=function(t,e,r,n,i,o){this.forEachGlyph(e,r,n,i,o,function(a,l,f,d){a.drawPoints(t,l,f,d)})},Font.prototype.drawMetrics=function(t,e,r,n,i,o){this.forEachGlyph(e,r,n,i,o,function(a,l,f,d){a.drawMetrics(t,l,f,d)})},Font.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},Font.prototype.validate=function(){var t=this;function e(n,i){}function r(n){var i=t.getEnglishName(n);i&&i.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},Font.prototype.toTables=function(){return sfnt.fontToTable(this)},Font.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Font.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0;i<e.length;i++)n[i]=e[i];return r},Font.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(isBrowser())if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(n),o=new Blob([i],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),a.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),d=arrayBufferToNodeBuffer(n);f.writeFileSync(t,d)}},Font.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Font.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Font.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function addName(t,e){var r=JSON.stringify(t),n=256;for(var i in e){var o=parseInt(i);if(!(!o||o<256)){if(JSON.stringify(e[i])===r)return o;n<=o&&(n=o+1)}}return e[n]=t,n}function makeFvarAxis(t,e,r){var n=addName(e.name,r);return[{name:"tag_"+t,type:"TAG",value:e.tag},{name:"minValue_"+t,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+t,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+t,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+t,type:"USHORT",value:0},{name:"nameID_"+t,type:"USHORT",value:n}]}function parseFvarAxis(t,e,r){var n={},i=new parse$1.Parser(t,e);return n.tag=i.parseTag(),n.minValue=i.parseFixed(),n.defaultValue=i.parseFixed(),n.maxValue=i.parseFixed(),i.skip("uShort",1),n.name=r[i.parseUShort()]||{},n}function makeFvarInstance(t,e,r,n){for(var i=addName(e.name,n),o=[{name:"nameID_"+t,type:"USHORT",value:i},{name:"flags_"+t,type:"USHORT",value:0}],a=0;a<r.length;++a){var l=r[a].tag;o.push({name:"axis_"+t+" "+l,type:"FIXED",value:e.coordinates[l]<<16})}return o}function parseFvarInstance(t,e,r,n){var i={},o=new parse$1.Parser(t,e);i.name=n[o.parseUShort()]||{},o.skip("uShort",1),i.coordinates={};for(var a=0;a<r.length;++a)i.coordinates[r[a].tag]=o.parseFixed();return i}function makeFvarTable(t,e){var r=new table.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:t.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:t.instances.length},{name:"instanceSize",type:"USHORT",value:4+t.axes.length*4}]);r.offsetToData=r.sizeOf();for(var n=0;n<t.axes.length;n++)r.fields=r.fields.concat(makeFvarAxis(n,t.axes[n],e));for(var i=0;i<t.instances.length;i++)r.fields=r.fields.concat(makeFvarInstance(i,t.instances[i],t.axes,e));return r}function parseFvarTable(t,e,r){var n=new parse$1.Parser(t,e),i=n.parseULong();check.argument(i===65536,"Unsupported fvar table version.");var o=n.parseOffset16();n.skip("uShort",1);for(var a=n.parseUShort(),l=n.parseUShort(),f=n.parseUShort(),d=n.parseUShort(),g=[],b=0;b<a;b++)g.push(parseFvarAxis(t,e+o+b*l,r));for(var _=[],E=e+o+a*l,k=0;k<f;k++)_.push(parseFvarInstance(t,E+k*d,g,r));return{axes:g,instances:_}}var fvar={make:makeFvarTable,parse:parseFvarTable},attachList=function(){return{coverage:this.parsePointer(Parser.coverage),attachPoints:this.parseList(Parser.pointer(Parser.uShortList))}},caretValue=function(){var t=this.parseUShort();if(check.argument(t===1||t===2||t===3,"Unsupported CaretValue table version."),t===1)return{coordinate:this.parseShort()};if(t===2)return{pointindex:this.parseShort()};if(t===3)return{coordinate:this.parseShort()}},ligGlyph=function(){return this.parseList(Parser.pointer(caretValue))},ligCaretList=function(){return{coverage:this.parsePointer(Parser.coverage),ligGlyphs:this.parseList(Parser.pointer(ligGlyph))}},markGlyphSets=function(){return this.parseUShort(),this.parseList(Parser.pointer(Parser.coverage))};function parseGDEFTable(t,e){e=e||0;var r=new Parser(t,e),n=r.parseVersion(1);check.argument(n===1||n===1.2||n===1.3,"Unsupported GDEF table version.");var i={version:n,classDef:r.parsePointer(Parser.classDef),attachList:r.parsePointer(attachList),ligCaretList:r.parsePointer(ligCaretList),markAttachClassDef:r.parsePointer(Parser.classDef)};return n>=1.2&&(i.markGlyphSets=r.parsePointer(markGlyphSets)),i}var gdef={parse:parseGDEFTable},subtableParsers$1=new Array(10);subtableParsers$1[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(Parser.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(Parser.coverage),values:this.parseValueRecordList()};check.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},subtableParsers$1[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();check.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(Parser.coverage),i=this.parseUShort(),o=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:o,pairSets:this.parseList(Parser.pointer(Parser.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(o)}})))};if(r===2){var a=this.parsePointer(Parser.classDef),l=this.parsePointer(Parser.classDef),f=this.parseUShort(),d=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:o,classDef1:a,classDef2:l,class1Count:f,class2Count:d,classRecords:this.parseList(f,Parser.list(d,function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(o)}}))}}},subtableParsers$1[3]=function(){return{error:"GPOS Lookup 3 not supported"}},subtableParsers$1[4]=function(){return{error:"GPOS Lookup 4 not supported"}},subtableParsers$1[5]=function(){return{error:"GPOS Lookup 5 not supported"}},subtableParsers$1[6]=function(){return{error:"GPOS Lookup 6 not supported"}},subtableParsers$1[7]=function(){return{error:"GPOS Lookup 7 not supported"}},subtableParsers$1[8]=function(){return{error:"GPOS Lookup 8 not supported"}},subtableParsers$1[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function parseGposTable(t,e){e=e||0;var r=new Parser(t,e),n=r.parseVersion(1);return check.argument(n===1||n===1.1,"Unsupported GPOS table version "+n),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers$1)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers$1),variations:r.parseFeatureVariationsList()}}var subtableMakers$1=new Array(10);function makeGposTable(t){return new table.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(t.lookups,subtableMakers$1)}])}var gpos={parse:parseGposTable,make:makeGposTable};function parseWindowsKernTable(t){var e={};t.skip("uShort");var r=t.parseUShort();check.argument(r===0,"Unsupported kern sub-table version."),t.skip("uShort",2);var n=t.parseUShort();t.skip("uShort",3);for(var i=0;i<n;i+=1){var o=t.parseUShort(),a=t.parseUShort(),l=t.parseShort();e[o+","+a]=l}return e}function parseMacKernTable(t){var e={};t.skip("uShort");var r=t.parseULong();r>1&&console.warn("Only the first kern subtable is supported."),t.skip("uLong");var n=t.parseUShort(),i=n&255;if(t.skip("uShort"),i===0){var o=t.parseUShort();t.skip("uShort",3);for(var a=0;a<o;a+=1){var l=t.parseUShort(),f=t.parseUShort(),d=t.parseShort();e[l+","+f]=d}}return e}function parseKernTable(t,e){var r=new parse$1.Parser(t,e),n=r.parseUShort();if(n===0)return parseWindowsKernTable(r);if(n===1)return parseMacKernTable(r);throw new Error("Unsupported kern table version ("+n+").")}var kern={parse:parseKernTable};function parseLocaTable(t,e,r,n){for(var i=new parse$1.Parser(t,e),o=n?i.parseUShort:i.parseULong,a=[],l=0;l<r+1;l+=1){var f=o.call(i);n&&(f*=2),a.push(f)}return a}var loca={parse:parseLocaTable};function loadFromFile(t,e){var r=require("fs");r.readFile(t,function(n,i){if(n)return e(n.message);e(null,nodeBufferToArrayBuffer(i))})}function loadFromUrl(t,e){var r=new XMLHttpRequest;r.open("get",t,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?e(null,r.response):e("Font could not be loaded: "+r.statusText)},r.onerror=function(){e("Font could not be loaded")},r.send()}function parseOpenTypeTableEntries(t,e){for(var r=[],n=12,i=0;i<e;i+=1){var o=parse$1.getTag(t,n),a=parse$1.getULong(t,n+4),l=parse$1.getULong(t,n+8),f=parse$1.getULong(t,n+12);r.push({tag:o,checksum:a,offset:l,length:f,compression:!1}),n+=16}return r}function parseWOFFTableEntries(t,e){for(var r=[],n=44,i=0;i<e;i+=1){var o=parse$1.getTag(t,n),a=parse$1.getULong(t,n+4),l=parse$1.getULong(t,n+8),f=parse$1.getULong(t,n+12),d=void 0;l<f?d="WOFF":d=!1,r.push({tag:o,offset:a,compression:d,compressedLength:l,length:f}),n+=20}return r}function uncompressTable(t,e){if(e.compression==="WOFF"){var r=new Uint8Array(t.buffer,e.offset+2,e.compressedLength-2),n=new Uint8Array(e.length);if(tinyInflate(r,n),n.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var i=new DataView(n.buffer,0);return{data:i,offset:0}}else return{data:t,offset:e.offset}}function parseBuffer(t,e){e=e??{};var r,n,i=new Font({empty:!0}),o=new DataView(t,0),a,l=[],f=parse$1.getTag(o,0);if(f==="\0\0\0"||f==="true"||f==="typ1")i.outlinesFormat="truetype",a=parse$1.getUShort(o,4),l=parseOpenTypeTableEntries(o,a);else if(f==="OTTO")i.outlinesFormat="cff",a=parse$1.getUShort(o,4),l=parseOpenTypeTableEntries(o,a);else if(f==="wOFF"){var d=parse$1.getTag(o,4);if(d==="\0\0\0")i.outlinesFormat="truetype";else if(d==="OTTO")i.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+f);a=parse$1.getUShort(o,12),l=parseWOFFTableEntries(o,a)}else throw new Error("Unsupported OpenType signature "+f);for(var g,b,_,E,k,D,L,M,U,R,z,X,se=0;se<a;se+=1){var $=l[se],q=void 0;switch($.tag){case"cmap":q=uncompressTable(o,$),i.tables.cmap=cmap.parse(q.data,q.offset),i.encoding=new CmapEncoding(i.tables.cmap);break;case"cvt ":q=uncompressTable(o,$),X=new parse$1.Parser(q.data,q.offset),i.tables.cvt=X.parseShortList($.length/2);break;case"fvar":b=$;break;case"fpgm":q=uncompressTable(o,$),X=new parse$1.Parser(q.data,q.offset),i.tables.fpgm=X.parseByteList($.length);break;case"head":q=uncompressTable(o,$),i.tables.head=head.parse(q.data,q.offset),i.unitsPerEm=i.tables.head.unitsPerEm,r=i.tables.head.indexToLocFormat;break;case"hhea":q=uncompressTable(o,$),i.tables.hhea=hhea.parse(q.data,q.offset),i.ascender=i.tables.hhea.ascender,i.descender=i.tables.hhea.descender,i.numberOfHMetrics=i.tables.hhea.numberOfHMetrics;break;case"hmtx":L=$;break;case"ltag":q=uncompressTable(o,$),n=ltag.parse(q.data,q.offset);break;case"maxp":q=uncompressTable(o,$),i.tables.maxp=maxp.parse(q.data,q.offset),i.numGlyphs=i.tables.maxp.numGlyphs;break;case"name":R=$;break;case"OS/2":q=uncompressTable(o,$),i.tables.os2=os2.parse(q.data,q.offset);break;case"post":q=uncompressTable(o,$),i.tables.post=post.parse(q.data,q.offset),i.glyphNames=new GlyphNames(i.tables.post);break;case"prep":q=uncompressTable(o,$),X=new parse$1.Parser(q.data,q.offset),i.tables.prep=X.parseByteList($.length);break;case"glyf":_=$;break;case"loca":U=$;break;case"CFF ":g=$;break;case"kern":M=$;break;case"GDEF":E=$;break;case"GPOS":k=$;break;case"GSUB":D=$;break;case"meta":z=$;break}}var ee=uncompressTable(o,R);if(i.tables.name=_name.parse(ee.data,ee.offset,n),i.names=i.tables.name,_&&U){var Pe=r===0,ce=uncompressTable(o,U),ve=loca.parse(ce.data,ce.offset,i.numGlyphs,Pe),we=uncompressTable(o,_);i.glyphs=glyf.parse(we.data,we.offset,ve,i,e)}else if(g){var ue=uncompressTable(o,g);cff.parse(ue.data,ue.offset,i,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var pe=uncompressTable(o,L);if(hmtx.parse(i,pe.data,pe.offset,i.numberOfHMetrics,i.numGlyphs,i.glyphs,e),addGlyphNames(i,e),M){var Q=uncompressTable(o,M);i.kerningPairs=kern.parse(Q.data,Q.offset)}else i.kerningPairs={};if(E){var re=uncompressTable(o,E);i.tables.gdef=gdef.parse(re.data,re.offset)}if(k){var ye=uncompressTable(o,k);i.tables.gpos=gpos.parse(ye.data,ye.offset),i.position.init()}if(D){var me=uncompressTable(o,D);i.tables.gsub=gsub.parse(me.data,me.offset)}if(b){var ae=uncompressTable(o,b);i.tables.fvar=fvar.parse(ae.data,ae.offset,i.names)}if(z){var fe=uncompressTable(o,z);i.tables.meta=meta.parse(fe.data,fe.offset),i.metas=i.tables.meta}return i}function load(t,e,r){r=r??{};var n=typeof window>"u",i=n&&!r.isUrl?loadFromFile:loadFromUrl;return new Promise(function(o,a){i(t,function(l,f){if(l){if(e)return e(l);a(l)}var d;try{d=parseBuffer(f,r)}catch(g){if(e)return e(g,null);a(g)}if(e)return e(null,d);o(d)})})}function loadSync(t,e){var r=require("fs"),n=r.readFileSync(t);return parseBuffer(nodeBufferToArrayBuffer(n),e)}var opentype=Object.freeze({__proto__:null,Font,Glyph,Path,BoundingBox:BoundingBox2,_parse:parse$1,parse:parseBuffer,load,loadSync});const FONT_REGISTER={},loadFont=async(t,e="default")=>{const r=await opentype.load(t,null,{isUrl:!0});return FONT_REGISTER[e]=r,FONT_REGISTER.default||(FONT_REGISTER.default=r),r},getFont=(t="default")=>FONT_REGISTER[t],sketchFontCommands=function*(t){let e=null,r=null;for(const n of t){if(n.type==="Z"){e&&(yield e.close()),e=null;continue}const i=[-n.x,n.y];if(n.type==="M"){e&&(yield e.done()),e=new BlueprintSketcher,e.movePointerTo(i),r=i;continue}r&&Math.abs(i[0]-r[0])<1e-9&&Math.abs(i[1]-r[1])<1e-9||(n.type==="L"&&(e==null||e.lineTo(i)),n.type==="C"&&(e==null||e.cubicBezierCurveTo(i,[-n.x1,n.y1],[-n.x2,n.y2])),n.type==="Q"&&(e==null||e.quadraticBezierCurveTo(i,[-n.x1,n.y1])),r=i)}};function textBlueprints(t,{startX:e=0,startY:r=0,fontSize:n=16,fontFamily:i="default"}={}){const a=getFont(i).getPath(t,-e,-r,n),l=Array.from(sketchFontCommands(a.commands));return organiseBlueprints(l).mirror([0,0])}function sketchText(t,e,r={}){const n=textBlueprints(t,e);return r.plane instanceof Plane?n.sketchOnPlane(r.plane):n.sketchOnPlane(r.plane,r.origin)}const uniqueId=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);async function importSTEP(t){const e=getOC(),[r,n]=localGC(),i=uniqueId(),o=new Uint8Array(await t.arrayBuffer());e.FS.writeFile(`/${i}`,o);const a=r(new e.STEPControl_Reader_1);if(a.ReadFile(i)){e.FS.unlink("/"+i),a.TransferRoots(r(new e.Message_ProgressRange_1));const l=r(a.OneShape()),f=cast(l);return n(),f}else throw e.FS.unlink("/"+i),n(),new Error("Failed to load STEP file")}async function importSTL(t){const e=getOC(),[r,n]=localGC(),i=uniqueId(),o=new Uint8Array(await t.arrayBuffer());e.FS.writeFile(`/${i}`,o);const a=r(new e.StlAPI_Reader),l=r(new e.TopoDS_Shell);if(a.Read(l,i)){e.FS.unlink("/"+i);const f=r(new e.ShapeUpgrade_UnifySameDomain_2(l,!0,!0,!1));f.Build();const d=r(f.Shape()),g=r(new e.BRepBuilderAPI_MakeSolid_1);g.Add(e.TopoDS.Shell_1(d));const b=r(g.Solid()),_=cast(b);return n(),_}else throw e.FS.unlink("/"+i),n(),new Error("Failed to load STL file")}const PROJECTION_PLANES={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function isProjectionPlane(t){return typeof t=="string"&&t in PROJECTION_PLANES}function lookFromPlane(t){const{dir:e,xAxis:r}=PROJECTION_PLANES[t];return new ProjectionCamera([0,0,0],e,r)}function defaultXDir(t){const e=new Vector(t);let r=new Vector([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new Vector([0,1,0]),n=r.cross(e)),n.normalize()}class ProjectionCamera extends WrappingObj{constructor(e=[0,0,0],r=[0,0,1],n){const i=n?new Vector(n):defaultXDir(r),o=makeAx2(e,r,i);super(o)}get position(){return new Vector(this.wrapped.Location())}get direction(){return new Vector(this.wrapped.Direction())}get xAxis(){return new Vector(this.wrapped.XDirection())}get yAxis(){return new Vector(this.wrapped.YDirection())}autoAxes(){const e=defaultXDir(this.direction);this.wrapped.SetXDirection(asDir(e))}setPosition(e){return this.wrapped.SetLocation(asPnt(e)),this}setXAxis(e){return this.wrapped.SetYDirection(asDir(e)),this}setYAxis(e){return this.wrapped.SetYDirection(asDir(e)),this}lookAt(e){const r=new Vector("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const getEdges=t=>t.IsNull()?[]:cast(t).edges;function makeProjectedEdges(t,e,r=!0){const n=getOC(),i=GCWithScope(),o=i(new n.HLRBRep_Algo_1);o.Add_2(t.wrapped,0);const a=i(new n.HLRAlgo_Projector_2(e.wrapped));o.Projector_1(a),o.Update(),o.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(o)),f=[...getEdges(l.VCompound_1()),...getEdges(l.Rg1LineVCompound_1()),...getEdges(l.OutLineVCompound_1())];f.forEach(g=>n.BRepLib.BuildCurves3d_2(g.wrapped));const d=r?[...getEdges(l.HCompound_1()),...getEdges(l.Rg1LineHCompound_1()),...getEdges(l.OutLineHCompound_1())]:[];return d.forEach(g=>n.BRepLib.BuildCurves3d_2(g.wrapped)),{visible:f,hidden:d}}const PRECISION=1e-8,samePoint=(t,e)=>samePoint$2(t,e,PRECISION*10);function rawOffsets(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(d=>({offset:make2dOffset(d,r),original:d})),i=[];let o=null,a=n.at(-1);if(!a)return[];if(i.length===1)return i;const l=d=>{o?d.offset instanceof Curve2D?i.push(d.offset):samePoint(d.offset.firstPoint,d.offset.lastPoint)||i.push(make2dSegmentCurve(d.offset.firstPoint,d.offset.lastPoint)):o=d},f=function*(){for(const d of n.slice(0,-1))yield d;if(!o)throw new Error("Bug in the offset algorithm");yield o};for(const d of f()){const g=a.offset.lastPoint,b=d.offset.firstPoint;if(samePoint(g,b)){l(a),a=d;continue}let _=[];if(a.offset instanceof Curve2D&&d.offset instanceof Curve2D){const{intersections:k,commonSegmentsPoints:D}=intersectCurves(a.offset,d.offset,PRECISION/100);_=[...k,...D]}if(_.length>0){let k=_[0];if(_.length>1){const M=a==null?void 0:a.original.lastPoint,U=_.map(R=>squareDistance2d(R,M));k=_[U.indexOf(Math.min(...U))]}const D=a.offset.splitAt([k],PRECISION)[0],L=d.offset.splitAt([k],PRECISION).at(-1);if(!L)throw new Error("Bug in the splitting algo in offset");l({offset:D,original:a.original}),a={offset:L,original:d.original};continue}const E=make2dArcFromCenter(g,b,a.original.lastPoint);l(a),i.push(E),a=d}return l(a),i}function offsetBlueprint(t,e){const r=rawOffsets(t,e);if(r.length<2)return null;const n=new Map,i=(d,g)=>{const b=n.get(d)||[];n.set(d,[...b,...g])};if(r.forEach((d,g)=>{r.slice(g+1).forEach((b,_)=>{const{intersections:E,commonSegmentsPoints:k}=intersectCurves(d,b,PRECISION),D=[...E,...k].filter(L=>{const M=samePoint(L,d.firstPoint)||samePoint(L,d.lastPoint),U=samePoint(L,b.firstPoint)||samePoint(L,b.lastPoint);return!(M&&U)});D.length&&(i(g,D),i(_+g+1,D))})}),!n.size){const d=new Blueprint(r);return t.intersects(d)?null:d}const a=r.flatMap((d,g)=>{if(!n.has(g))return d;const b=n.get(g)||[];return d.splitAt(b,PRECISION*100)}).filter(d=>!t.curves.find(b=>b.distanceFrom(d)<Math.abs(e)-PRECISION));if(!a.length)return null;const f=stitchCurves(a).filter(d=>d.length>1).map(d=>new Blueprint(d)).filter(d=>d.isClosed());return f.length?f.length===1?f[0]:new Blueprints(f):null}const fuseAll=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=fuse2D(e,t[r]);return e};function offset(t,e){if(t instanceof Blueprint)return offsetBlueprint(t,e);if(t instanceof Blueprints)return fuseAll(t.blueprints.map(r=>offset(r,e)));if(t instanceof CompoundBlueprint){const r=fuseAll(t.blueprints.slice(1).map(n=>offset(n,e)));return cut2D(offset(t.blueprints[0],e),r)}return null}function modifyCorners(t,e,r,n){let i=()=>!0;n&&(i=n.shouldKeep.bind(n));const o=[e.curves[0]],a=(f,d)=>{i({firstCurve:f,secondCurve:d,point:f.lastPoint})?o.push(...t(f,d,r)):o.push(f,d)};e.curves.slice(1).forEach(f=>{const d=o.pop();if(!d)throw new Error("Bug in the blueprint filletting algo");a(d,f)});const l=o.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(samePoint$2(o[0].firstPoint,l.lastPoint)&&o.length>1){const f=o.pop(),d=o.shift();if(!f||!d)throw new Error("Bug in the blueprint filletting algo");a(f,d)}return new Blueprint(o)}function modifyCorner2D(t,e,r,n){if(e instanceof Blueprint)return modifyCorners(t,e,r,n);if(e instanceof CompoundBlueprint)return new CompoundBlueprint(e.blueprints.map(i=>modifyCorners(t,i,r,n)));if(e instanceof Blueprints){const i=e.blueprints.map(o=>modifyCorner2D(t,o,r,n)).filter(o=>o!==null);return new Blueprints(i)}return null}function fillet2D(t,e,r){return modifyCorner2D(filletCurves,t,e,r)}function chamfer2D(t,e,r){return modifyCorner2D(chamferCurves,t,e,r)}class Drawing{constructor(e=null){this.innerShape=e}clone(){var e;return new Drawing(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new BoundingBox2d}stretch(e,r,n){return this.innerShape?new Drawing(this.innerShape.stretch(e,r,n)):new Drawing}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Drawing(this.innerShape.rotate(e,r)):new Drawing}translate(e,r=0){return this.innerShape?new Drawing(this.innerShape.translate(e,r)):new Drawing}scale(e,r){return this.innerShape?new Drawing(this.innerShape.scale(e,r)):new Drawing}mirror(e,r,n){return this.innerShape?new Drawing(this.innerShape.mirror(e,r,n)):new Drawing}cut(e){return new Drawing(cut2D(this.innerShape,e.innerShape))}fuse(e){return new Drawing(fuse2D(this.innerShape,e.innerShape))}intersect(e){return new Drawing(intersect2D(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new CornerFinder);return new Drawing(fillet2D(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new CornerFinder);return new Drawing(chamfer2D(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Drawing(offset(this.innerShape,e))}get blueprint(){if(!(this.innerShape instanceof Blueprint)){if(this.innerShape instanceof Blueprints&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof Blueprint)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class DrawingPen extends BaseSketcher2d{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Drawing(new Blueprint(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}function draw(t){const e=new DrawingPen;return t&&e.movePointerTo(t),e}function drawRoundedRectangle(t,e,r=0){return new Drawing(roundedRectangleBlueprint$1(t,e,r))}const drawRectangle=drawRoundedRectangle;function drawSingleCircle(t){return new Drawing(new Blueprint([make2dCircle(t)]))}function drawSingleEllipse(t,e){const[r,n]=[t,e].sort((o,a)=>o-a),i=n===t?[1,0]:[0,1];return new Drawing(new Blueprint([make2dEllipse(n,r,i)]))}function drawCircle(t){return draw().movePointerTo([-t,0]).sagittaArc(2*t,0,t).sagittaArc(-2*t,0,t).close()}function drawEllipse(t,e){return draw().movePointerTo([-t,0]).halfEllipse(2*t,0,e).halfEllipse(-2*t,0,e).close()}function drawPolysides(t,e,r=0){return new Drawing(polysidesBlueprint(t,e,r))}function drawText(t,{startX:e=0,startY:r=0,fontSize:n=16,fontFamily:i="default"}={}){return new Drawing(textBlueprints(t,{startX:e,startY:r,fontSize:n,fontFamily:i}))}const drawPointsInterpolation=(t,e={})=>new Drawing(new Blueprint([make2dInerpolatedBSplineCurve(t,e)])),drawParametricFunction=(t,{pointsCount:e=400,start:r=0,stop:n=1}={},i={})=>{const o=(n-r)/e,a=[...Array(e+1).keys()].map(l=>t(r+l*o));return drawPointsInterpolation(a,i)};function drawFaceOutline(t){const r=t.clone().outerWire().edges.map(i=>edgeToCurve(i,t)),n=stitchCurves(r).map(i=>new Blueprint(i));return n.length===0?new Drawing:n.length===1?new Drawing(n[0]):new Drawing(new Blueprints(n))}const edgesToDrawing=t=>{const e=drawRectangle(1e3,1e3).sketchOnPlane().face(),r=t.map(i=>edgeToCurve(i,e)),n=stitchCurves(r).map(i=>new Blueprint(i));return n.length===0?new Drawing:n.length===1?new Drawing(n[0]):new Drawing(new Blueprints(n))};function drawProjection(t,e="front"){let r;e instanceof ProjectionCamera?r=e:r=lookFromPlane(e);const{visible:n,hidden:i}=makeProjectedEdges(t,r);return{visible:edgesToDrawing(n),hidden:edgesToDrawing(i)}}function uuidv(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}const wrapString=t=>{const e=getOC();return new e.TCollection_ExtendedString_2(t,!0)};function parseSlice(t,e){return parseInt(t.slice(e*2,(e+1)*2),16)}function colorFromHex(t){let e=t;return e.indexOf("#")===0&&(e=e.slice(1)),e.length===3&&(e=e.replace(/([0-9a-f])/gi,"$1$1")),[parseSlice(e,0),parseSlice(e,1),parseSlice(e,2)]}const wrapColor=(t,e=1)=>{const r=getOC(),[n,i,o]=colorFromHex(t);return new r.Quantity_ColorRGBA_5(n/255,i/255,o/255,e)};class AssemblyExporter extends WrappingObj{}function createAssembly(t=[]){const e=getOC(),r=new e.TDocStd_Document(wrapString("XmlOcaf"));e.XCAFDoc_ShapeTool.SetAutoNaming(!1);const n=r.Main(),i=e.XCAFDoc_DocumentTool.ShapeTool(n).get(),o=e.XCAFDoc_DocumentTool.ColorTool(n).get();for(const{shape:a,name:l,color:f,alpha:d}of t){const g=i.NewShape();i.SetShape(g,a.wrapped),e.TDataStd_Name.Set_1(g,wrapString(l||uuidv())),o.SetColor_3(g,wrapColor(f||"#f00",d??1),e.XCAFDoc_ColorType.XCAFDoc_ColorSurf)}return i.UpdateAssemblies(),new AssemblyExporter(r)}function exportSTEP(t=[],{unit:e,modelUnit:r}={}){const n=getOC(),i=GCWithScope(),o=createAssembly(t);(e||r)&&(i(new n.STEPCAFControl_Writer_1),n.Interface_Static.SetCVal("xstep.cascade.unit",(r||e||"MM").toUpperCase()),n.Interface_Static.SetCVal("write.step.unit",(e||r||"MM").toUpperCase()));const a=i(new n.XSControl_WorkSession),l=i(new n.STEPCAFControl_Writer_2(i(new n.Handle_XSControl_WorkSession_2(a)),!1));l.SetColorMode(!0),l.SetLayerMode(!0),l.SetNameMode(!0),n.Interface_Static.SetIVal("write.surfacecurve.mode",!0),n.Interface_Static.SetIVal("write.precision.mode",0),n.Interface_Static.SetIVal("write.step.assembly",2),n.Interface_Static.SetIVal("write.step.schema",5);const f=i(new n.Message_ProgressRange_1);l.Transfer_1(new n.Handle_TDocStd_Document_2(o.wrapped),n.STEPControl_StepModelType.STEPControl_AsIs,null,f);const d="export.step";if(l.Write(d)===n.IFSelect_ReturnStatus.IFSelect_RetDone){const b=n.FS.readFile("/"+d);return n.FS.unlink("/"+d),new Blob([b],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}var replicad=Object.freeze({__proto__:null,AssemblyExporter,BaseSketcher2d,Blueprint,BlueprintSketcher,Blueprints,BoundingBox:BoundingBox$1,BoundingBox2d,CompSolid,Compound,CompoundBlueprint,CompoundSketch,CornerFinder,Curve,Curve2D,DEG2RAD,Drawing,DrawingPen,Edge,EdgeFinder,Face,FaceFinder,FaceSketcher,GCWithObject,GCWithScope,HASH_CODE_MAX,LinearPhysicalProperties,Plane,ProjectionCamera,RAD2DEG,Shape,Shell,Sketch,Sketcher,Sketches,Solid,Surface,SurfacePhysicalProperties,Transformation,Vector,Vertex,VolumePhysicalProperties,Wire,WrappingObj,_1DShape,_3DShape,addHolesInFace,asDir,asPnt,assembleWire,axis2d,basicFaceExtrusion,cast,combineFinderFilters,complexExtrude,compoundShapes,createAssembly,createNamedPlane,cut2D,cutBlueprints,downcast,draw,drawCircle,drawEllipse,drawFaceOutline,drawParametricFunction,drawPointsInterpolation,drawPolysides,drawProjection,drawRectangle,drawRoundedRectangle,drawSingleCircle,drawSingleEllipse,drawText,exportSTEP,fuse2D,fuseBlueprints,genericSweep,getFont,getOC,importSTEP,importSTL,intersect2D,intersectBlueprints,isPoint,isProjectionPlane,isShape3D,isWire,iterTopo,loadFont,localGC,loft,lookFromPlane,makeAx1,makeAx2,makeAx3,makeBSplineApproximation,makeBaseBox,makeBezierCurve,makeCircle,makeCompound,makeCylinder,makeDirection,makeEllipse,makeEllipseArc,makeFace,makeHelix,makeLine,makeNewFaceWithinFace,makeNonPlanarFace,makeOffset,makePlane,makePlaneFromFace,makePolygon,makeProjectedEdges,makeSolid,makeSphere,makeTangentArc,makeThreePointArc,makeVertex,measureArea,measureLength,measureShapeLinearProperties,measureShapeSurfaceProperties,measureShapeVolumeProperties,measureVolume,mirror,organiseBlueprints,polysideInnerRadius,polysidesBlueprint,revolution,rotate:rotate$1,roundedRectangleBlueprint:roundedRectangleBlueprint$1,scale,setOC,shapeType,sketchCircle,sketchEllipse,sketchFaceOffset,sketchHelix,sketchParametricFunction,sketchPolysides,sketchRectangle,sketchRoundedRectangle,sketchText,supportExtrude,textBlueprints,translate,twistExtrude});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),finalizer=Symbol("Comlink.finalizer"),throwMarker=Symbol("Comlink.thrown"),isObject=t=>typeof t=="object"&&t!==null||typeof t=="function",proxyTransferHandler={canHandle:t=>isObject(t)&&t[proxyMarker],serialize(t){const{port1:e,port2:r}=new MessageChannel;return expose(t,e),[r,[r]]},deserialize(t){return t.start(),wrap(t)}},throwTransferHandler={canHandle:t=>isObject(t)&&throwMarker in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},transferHandlers=new Map([["proxy",proxyTransferHandler],["throw",throwTransferHandler]]);function isAllowedOrigin(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function expose(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!isAllowedOrigin(r,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:a,path:l}=Object.assign({path:[]},i.data),f=(i.data.argumentList||[]).map(fromWireValue);let d;try{const g=l.slice(0,-1).reduce((_,E)=>_[E],t),b=l.reduce((_,E)=>_[E],t);switch(a){case"GET":d=b;break;case"SET":g[l.slice(-1)[0]]=fromWireValue(i.data.value),d=!0;break;case"APPLY":d=b.apply(g,f);break;case"CONSTRUCT":{const _=new b(...f);d=proxy(_)}break;case"ENDPOINT":{const{port1:_,port2:E}=new MessageChannel;expose(t,E),d=transfer(_,[_])}break;case"RELEASE":d=void 0;break;default:return}}catch(g){d={value:g,[throwMarker]:0}}Promise.resolve(d).catch(g=>({value:g,[throwMarker]:0})).then(g=>{const[b,_]=toWireValue(g);e.postMessage(Object.assign(Object.assign({},b),{id:o}),_),a==="RELEASE"&&(e.removeEventListener("message",n),closeEndPoint(e),finalizer in t&&typeof t[finalizer]=="function"&&t[finalizer]())}).catch(g=>{const[b,_]=toWireValue({value:new TypeError("Unserializable return value"),[throwMarker]:0});e.postMessage(Object.assign(Object.assign({},b),{id:o}),_)})}),e.start&&e.start()}function isMessagePort(t){return t.constructor.name==="MessagePort"}function closeEndPoint(t){isMessagePort(t)&&t.close()}function wrap(t,e){const r=new Map;return t.addEventListener("message",function(i){const{data:o}=i;if(!o||!o.id)return;const a=r.get(o.id);if(a)try{a(o)}finally{r.delete(o.id)}}),createProxy(t,r,[],e)}function throwIfProxyReleased(t){if(t)throw new Error("Proxy has been released and is not useable")}function releaseEndpoint(t){return requestResponseMessage(t,new Map,{type:"RELEASE"}).then(()=>{closeEndPoint(t)})}const proxyCounter=new WeakMap,proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(proxyCounter.get(t)||0)-1;proxyCounter.set(t,e),e===0&&releaseEndpoint(t)});function registerProxy(t,e){const r=(proxyCounter.get(e)||0)+1;proxyCounter.set(e,r),proxyFinalizers&&proxyFinalizers.register(t,e,t)}function unregisterProxy(t){proxyFinalizers&&proxyFinalizers.unregister(t)}function createProxy(t,e,r=[],n=function(){}){let i=!1;const o=new Proxy(n,{get(a,l){if(throwIfProxyReleased(i),l===releaseProxy)return()=>{unregisterProxy(o),releaseEndpoint(t),e.clear(),i=!0};if(l==="then"){if(r.length===0)return{then:()=>o};const f=requestResponseMessage(t,e,{type:"GET",path:r.map(d=>d.toString())}).then(fromWireValue);return f.then.bind(f)}return createProxy(t,e,[...r,l])},set(a,l,f){throwIfProxyReleased(i);const[d,g]=toWireValue(f);return requestResponseMessage(t,e,{type:"SET",path:[...r,l].map(b=>b.toString()),value:d},g).then(fromWireValue)},apply(a,l,f){throwIfProxyReleased(i);const d=r[r.length-1];if(d===createEndpoint)return requestResponseMessage(t,e,{type:"ENDPOINT"}).then(fromWireValue);if(d==="bind")return createProxy(t,e,r.slice(0,-1));const[g,b]=processArguments(f);return requestResponseMessage(t,e,{type:"APPLY",path:r.map(_=>_.toString()),argumentList:g},b).then(fromWireValue)},construct(a,l){throwIfProxyReleased(i);const[f,d]=processArguments(l);return requestResponseMessage(t,e,{type:"CONSTRUCT",path:r.map(g=>g.toString()),argumentList:f},d).then(fromWireValue)}});return registerProxy(o,t),o}function myFlat(t){return Array.prototype.concat.apply([],t)}function processArguments(t){const e=t.map(toWireValue);return[e.map(r=>r[0]),myFlat(e.map(r=>r[1]))]}const transferCache=new WeakMap;function transfer(t,e){return transferCache.set(t,e),t}function proxy(t){return Object.assign(t,{[proxyMarker]:!0})}function toWireValue(t){for(const[e,r]of transferHandlers)if(r.canHandle(t)){const[n,i]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:t},transferCache.get(t)||[]]}function fromWireValue(t){switch(t.type){case"HANDLER":return transferHandlers.get(t.name).deserialize(t.value);case"RAW":return t.value}}function requestResponseMessage(t,e,r,n){return new Promise(i=>{const o=generateUUID();e.set(o,i),t.start&&t.start(),t.postMessage(Object.assign({id:o},r),n)})}function generateUUID(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let EPS=1e-6;const atan2=Math.atan2,grahamScan2=(t,e=EPS)=>{const r=t.length;if(r<=3)return t.slice();let n=1,i,o,a,l,f,d;const g=findMin(t);[f,d]=t[g];const b=[];for(i=0;i<r;i++)o=t[i],b[i]={p:o,t:atan2(o[1]-d,o[0]-f)};b.sort((E,k)=>E.t!==k.t?E.t-k.t:E.p[0]-k.p[0]);const _=[b[0].p];for(i=1;i<r;i++){for(o=_[n-2],a=_[n-1],l=b[i].p,f=l[0],d=l[1];n>1&&notCCW(o[0],o[1],a[0],a[1],f,d,e)||n===1&&a[0]===f&&a[1]===d;)n--,a=o,o=_[n-2];_[n++]=l}return _.length=n,_},notCCW=(t,e,r,n,i,o,a)=>(n-e)*(i-t)>=(r-t)*(o-e)-a,findMin=t=>{let e=t.length-1,r=e,[n,i]=t[e],o,a;for(;e-- >0;)o=t[e],a=o[1],(a<i||a===i&&o[0]<n)&&(n=o[0],i=a,r=e);return r};function makeSegmentCurve(t,e){return draw(t).lineTo(e).pendingCurves[0]}const range=t=>Array.from({length:t},(e,r)=>r),isSamePoint=([t,e],[r,n],i=1e-6)=>Math.abs(t-r)<=i&&Math.abs(e-n)<=i,zipWithNext=t=>t.slice(0,-1).map((e,r)=>[t[r],t[r+1]]).concat([[t.at(-1),t[0]]]),asPoints=(t,e)=>{const r=t.innerShape,n=r.blueprints||[r],i=0,o=e-1;let a=0;return n.flatMap(l=>{const f=l.curves;let d=f.flatMap((g,b)=>{const _=g.firstParameter,E=g.lastParameter,k=E-_,D=g.value(E),L=(b+1)%f.length,M=f[L];D.meta=[{curve:g,param:E,curveIndex:b+a,pointIndex:o},{curve:M,param:M.firstParameter,curveIndex:L+a,pointIndex:i}];const U=R=>_+R*k;return[D,...range(e-2).map(R=>{const z=U((R+1)/e),X=g.value(z);return X.meta={curve:g,param:z,curveIndex:b+a,pointIndex:R+1},X})]});return a+=f.length,d})};function shrinkWrap(t,e=100){const r=asPoints(t,e);let n=grahamScan2(r);n=n.flatMap((a,l)=>{const f=a.meta;if(!Array.isArray(f))return[a];const[d,g]=f.map(D=>{const L=[a[0],a[1]];return L.meta=D,L}),b=d.meta.curveIndex,_=g.meta.curveIndex,E=n[(l+1)%n.length].meta.curveIndex,k=n[(l-1+n.length)%n.length].meta.curveIndex;return b===E&&_===k?[g,d]:[d,g]});let i=zipWithNext(n).filter(([a,l])=>a.meta.curveIndex===l.meta.curveIndex?a.meta.curve.geomType==="LINE"?!1:Math.abs(l.meta.pointIndex-a.meta.pointIndex)!==1:!0).flat();i=i.filter((a,l)=>{const f=i[(l+1)%i.length],d=a.meta.curveIndex===f.meta.curveIndex,g=a.meta.pointIndex===f.meta.pointIndex;return!d||!g});const o=zipWithNext(i).filter(([a,l])=>!isSamePoint(a,l)).map(([a,l])=>{if(a.meta.curveIndex===l.meta.curveIndex){if(a.meta.pointIndex===0&&l.meta.pointIndex===e-1)return a.meta.curve;if(a.meta.pointIndex===e-1&&l.meta.pointIndex===0){let b=a.meta.curve.clone();return b.reverse(),b}const f=[a,l].filter(b=>b.meta.pointIndex!==0&&b.meta.pointIndex!==e-1).map(b=>b.meta.param),d=a.meta.curve.splitAt(f);let g=d[0];return a.meta.pointIndex!==0&&l.meta.pointIndex!==0&&(g=d[1]),a.meta.pointIndex>l.meta.pointIndex&&g.reverse(),g}return makeSegmentCurve(a,l)});return new Drawing(new Blueprint(o))}var entities={};entities.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"};var sax$1={},nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function ParseError$1(t,e){this.message=t,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,ParseError$1)}ParseError$1.prototype=new Error,ParseError$1.prototype.name=ParseError$1.name;function XMLReader$1(){}XMLReader$1.prototype={parse:function(t,e,r){var n=this.domBuilder;n.startDocument(),_copy(e,e={}),parse(t,e,r,n,this.errorHandler),n.endDocument()}};function parse(t,e,r,n,i){function o(Q){if(Q>65535){Q-=65536;var re=55296+(Q>>10),ye=56320+(Q&1023);return String.fromCharCode(re,ye)}else return String.fromCharCode(Q)}function a(Q){var re=Q.slice(1,-1);return re in r?r[re]:re.charAt(0)==="#"?o(parseInt(re.substr(1).replace("x","0x"))):(i.error("entity not found:"+Q),Q)}function l(Q){if(Q>D){var re=t.substring(D,Q).replace(/&#?\w+;/g,a);_&&f(D),n.characters(re,0,Q-D),D=Q}}function f(Q,re){for(;Q>=g&&(re=b.exec(t));)d=re.index,g=d+re[0].length,_.lineNumber++;_.columnNumber=Q-d+1}for(var d=0,g=0,b=/.*(?:\r\n?|\n)|.*$/g,_=n.locator,E=[{currentNSMap:e}],k={},D=0;;){try{var L=t.indexOf("<",D);if(L<0){if(!t.substr(D).match(/^\s*$/)){var M=n.doc,U=M.createTextNode(t.substr(D));M.appendChild(U),n.currentElement=U}return}switch(L>D&&l(L),t.charAt(L+1)){case"/":var ce=t.indexOf(">",L+3),R=t.substring(L+2,ce),z=E.pop();ce<0?(R=t.substring(L+2).replace(/[\s<].*/,""),i.error("end tag name: "+R+" is not complete:"+z.tagName),ce=L+1+R.length):R.match(/\s</)&&(R=R.replace(/[\s<].*/,""),i.error("end tag name: "+R+" maybe not complete"),ce=L+1+R.length);var X=z.localNSMap,se=z.tagName==R,$=se||z.tagName&&z.tagName.toLowerCase()==R.toLowerCase();if($){if(n.endElement(z.uri,z.localName,R),X)for(var q in X)n.endPrefixMapping(q);se||i.fatalError("end tag name: "+R+" is not match the current start tagName:"+z.tagName)}else E.push(z);ce++;break;case"?":_&&f(L),ce=parseInstruction(t,L,n);break;case"!":_&&f(L),ce=parseDCC(t,L,n,i);break;default:_&&f(L);var ee=new ElementAttributes,Pe=E[E.length-1].currentNSMap,ce=parseElementStartPart(t,L,ee,Pe,a,i),ve=ee.length;if(!ee.closed&&fixSelfClosed(t,ce,ee.tagName,k)&&(ee.closed=!0,r.nbsp||i.warning("unclosed xml attribute")),_&&ve){for(var we=copyLocator(_,{}),ue=0;ue<ve;ue++){var pe=ee[ue];f(pe.offset),pe.locator=copyLocator(_,{})}n.locator=we,appendElement$1(ee,n,Pe)&&E.push(ee),n.locator=_}else appendElement$1(ee,n,Pe)&&E.push(ee);ee.uri==="http://www.w3.org/1999/xhtml"&&!ee.closed?ce=parseHtmlSpecialContent(t,ce,ee.tagName,a,n):ce++}}catch(Q){if(Q instanceof ParseError$1)throw Q;i.error("element parse error: "+Q),ce=-1}ce>D?D=ce:l(Math.max(L,D)+1)}}function copyLocator(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function parseElementStartPart(t,e,r,n,i,o){function a(_,E,k){_ in r.attributeNames&&o.fatalError("Attribute "+_+" redefined"),r.addValue(_,E,k)}for(var l,f,d=++e,g=S_TAG;;){var b=t.charAt(d);switch(b){case"=":if(g===S_ATTR)l=t.slice(e,d),g=S_EQ;else if(g===S_ATTR_SPACE)g=S_EQ;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(g===S_EQ||g===S_ATTR)if(g===S_ATTR&&(o.warning('attribute value must after "="'),l=t.slice(e,d)),e=d+1,d=t.indexOf(b,e),d>0)f=t.slice(e,d).replace(/&#?\w+;/g,i),a(l,f,e-1),g=S_ATTR_END;else throw new Error("attribute value no end '"+b+"' match");else if(g==S_ATTR_NOQUOT_VALUE)f=t.slice(e,d).replace(/&#?\w+;/g,i),a(l,f,e),o.warning('attribute "'+l+'" missed start quot('+b+")!!"),e=d+1,g=S_ATTR_END;else throw new Error('attribute value must after "="');break;case"/":switch(g){case S_TAG:r.setTagName(t.slice(e,d));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:g=S_TAG_CLOSE,r.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return o.error("unexpected end of input"),g==S_TAG&&r.setTagName(t.slice(e,d)),d;case">":switch(g){case S_TAG:r.setTagName(t.slice(e,d));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:f=t.slice(e,d),f.slice(-1)==="/"&&(r.closed=!0,f=f.slice(0,-1));case S_ATTR_SPACE:g===S_ATTR_SPACE&&(f=l),g==S_ATTR_NOQUOT_VALUE?(o.warning('attribute "'+f+'" missed quot(")!'),a(l,f.replace(/&#?\w+;/g,i),e)):((n[""]!=="http://www.w3.org/1999/xhtml"||!f.match(/^(?:disabled|checked|selected)$/i))&&o.warning('attribute "'+f+'" missed value!! "'+f+'" instead!!'),a(f,f,e));break;case S_EQ:throw new Error("attribute value missed!!")}return d;case"":b=" ";default:if(b<=" ")switch(g){case S_TAG:r.setTagName(t.slice(e,d)),g=S_TAG_SPACE;break;case S_ATTR:l=t.slice(e,d),g=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var f=t.slice(e,d).replace(/&#?\w+;/g,i);o.warning('attribute "'+f+'" missed quot(")!!'),a(l,f,e);case S_ATTR_END:g=S_TAG_SPACE;break}else switch(g){case S_ATTR_SPACE:r.tagName,(n[""]!=="http://www.w3.org/1999/xhtml"||!l.match(/^(?:disabled|checked|selected)$/i))&&o.warning('attribute "'+l+'" missed value!! "'+l+'" instead2!!'),a(l,l,e),e=d,g=S_ATTR;break;case S_ATTR_END:o.warning('attribute space is required"'+l+'"!!');case S_TAG_SPACE:g=S_ATTR,e=d;break;case S_EQ:g=S_ATTR_NOQUOT_VALUE,e=d;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}d++}}function appendElement$1(t,e,r){for(var n=t.tagName,i=null,b=t.length;b--;){var o=t[b],a=o.qName,l=o.value,_=a.indexOf(":");if(_>0)var f=o.prefix=a.slice(0,_),d=a.slice(_+1),g=f==="xmlns"&&d;else d=a,f=null,g=a==="xmlns"&&"";o.localName=d,g!==!1&&(i==null&&(i={},_copy(r,r={})),r[g]=i[g]=l,o.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(g,l))}for(var b=t.length;b--;){o=t[b];var f=o.prefix;f&&(f==="xml"&&(o.uri="http://www.w3.org/XML/1998/namespace"),f!=="xmlns"&&(o.uri=r[f||""]))}var _=n.indexOf(":");_>0?(f=t.prefix=n.slice(0,_),d=t.localName=n.slice(_+1)):(f=null,d=t.localName=n);var E=t.uri=r[f||""];if(e.startElement(E,d,n,t),t.closed){if(e.endElement(E,d,n),i)for(f in i)e.endPrefixMapping(f)}else return t.currentNSMap=r,t.localNSMap=i,!0}function parseHtmlSpecialContent(t,e,r,n,i){if(/^(?:script|textarea)$/i.test(r)){var o=t.indexOf("</"+r+">",e),a=t.substring(e+1,o);if(/[&<]/.test(a))return/^script$/i.test(r)?(i.characters(a,0,a.length),o):(a=a.replace(/&#?\w+;/g,n),i.characters(a,0,a.length),o)}return e+1}function fixSelfClosed(t,e,r,n){var i=n[r];return i==null&&(i=t.lastIndexOf("</"+r+">"),i<e&&(i=t.lastIndexOf("</"+r)),n[r]=i),i<e}function _copy(t,e){for(var r in t)e[r]=t[r]}function parseDCC(t,e,r,n){var i=t.charAt(e+2);switch(i){case"-":if(t.charAt(e+3)==="-"){var o=t.indexOf("-->",e+4);return o>e?(r.comment(t,e+4,o-e-4),o+3):(n.error("Unclosed comment"),-1)}else return-1;default:if(t.substr(e+3,6)=="CDATA["){var o=t.indexOf("]]>",e+9);return r.startCDATA(),r.characters(t,e+9,o-e-9),r.endCDATA(),o+3}var a=split(t,e),l=a.length;if(l>1&&/!doctype/i.test(a[0][0])){var f=a[1][0],d=!1,g=!1;l>3&&(/^public$/i.test(a[2][0])?(d=a[3][0],g=l>4&&a[4][0]):/^system$/i.test(a[2][0])&&(g=a[3][0]));var b=a[l-1];return r.startDTD(f,d,g),r.endDTD(),b.index+b[0].length}}return-1}function parseInstruction(t,e,r){var n=t.indexOf("?>",e);if(n){var i=t.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return i?(i[0].length,r.processingInstruction(i[1],i[2]),n+2):-1}return-1}function ElementAttributes(){this.attributeNames={}}ElementAttributes.prototype={setTagName:function(t){if(!tagNamePattern.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},addValue:function(t,e,r){if(!tagNamePattern.test(t))throw new Error("invalid attribute:"+t);this.attributeNames[t]=this.length,this[this.length++]={qName:t,value:e,offset:r}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}};function split(t,e){var r,n=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=e,i.exec(t);r=i.exec(t);)if(n.push(r),r[1])return n}sax$1.XMLReader=XMLReader$1,sax$1.ParseError=ParseError$1;var dom={};function copy(t,e){for(var r in t)e[r]=t[r]}function _extends(t,e){var r=t.prototype;if(!(r instanceof e)){let n=function(){};n.prototype=e.prototype,n=new n,copy(r,n),t.prototype=r=n}r.constructor!=t&&(typeof t!="function"&&console.error("unknow Class:"+t),r.constructor=t)}var htmlns="http://www.w3.org/1999/xhtml",NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={};ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(t,e){if(e instanceof Error)var r=e;else r=this,Error.call(this,ExceptionMessage[t]),this.message=ExceptionMessage[t],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return r.code=t,e&&(this.message=this.message+": "+e),r}DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var r=[],n=0;n<this.length;n++)serializeToString(this[n],r,t,e);return r.join("")}};function LiveNodeList(t,e){this._node=t,this._refresh=e,_updateLiveList(this)}function _updateLiveList(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var r=t._refresh(t._node);__set__(t,"length",r.length),copy(r,t),t._inc=e}}LiveNodeList.prototype.item=function(t){return _updateLiveList(this),this[t]},_extends(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(t,e){for(var r=t.length;r--;)if(t[r]===e)return r}function _addNamedNode(t,e,r,n){if(n?e[_findNodeIndex(e,n)]=r:e[e.length++]=r,t){r.ownerElement=t;var i=t.ownerDocument;i&&(n&&_onRemoveAttribute(i,t,n),_onAddAttribute(i,t,r))}}function _removeNamedNode(t,e,r){var n=_findNodeIndex(e,r);if(n>=0){for(var i=e.length-1;n<i;)e[n]=e[++n];if(e.length=i,t){var o=t.ownerDocument;o&&(_onRemoveAttribute(o,t,r),r.ownerElement=null)}}else throw DOMException(NOT_FOUND_ERR,new Error(t.tagName+"@"+r))}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var r=this[e];if(r.nodeName==t)return r}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var r=this.getNamedItem(t.nodeName);return _addNamedNode(this._ownerElement,this,t,r),r},setNamedItemNS:function(t){var e=t.ownerElement,r;if(e&&e!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return r=this.getNamedItemNS(t.namespaceURI,t.localName),_addNamedNode(this._ownerElement,this,t,r),r},removeNamedItem:function(t){var e=this.getNamedItem(t);return _removeNamedNode(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var r=this.getNamedItemNS(t,e);return _removeNamedNode(this._ownerElement,this,r),r},getNamedItemNS:function(t,e){for(var r=this.length;r--;){var n=this[r];if(n.localName==e&&n.namespaceURI==t)return n}return null}};function DOMImplementation$1(t){if(this._features={},t)for(var e in t)this._features=t[e]}DOMImplementation$1.prototype={hasFeature:function(t,e){var r=this._features[t.toLowerCase()];return!!(r&&(!e||e in r))},createDocument:function(t,e,r){var n=new Document;if(n.implementation=this,n.childNodes=new NodeList,n.doctype=r,r&&n.appendChild(r),e){var i=n.createElementNS(t,e);n.appendChild(i)}return n},createDocumentType:function(t,e,r){var n=new DocumentType;return n.name=t,n.nodeName=t,n.publicId=e,n.systemId=r,n}};function Node(){}Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return _insertBefore(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return _removeChild(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(t){return cloneNode(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==TEXT_NODE&&t.nodeType==TEXT_NODE?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var r=e._nsMap;if(r){for(var n in r)if(r[n]==t)return n}e=e.nodeType==ATTRIBUTE_NODE?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var r=e._nsMap;if(r&&t in r)return r[t];e=e.nodeType==ATTRIBUTE_NODE?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){var e=this.lookupPrefix(t);return e==null}};function _xmlEncoder(t){return t=="<"&&"&lt;"||t==">"&&"&gt;"||t=="&"&&"&amp;"||t=='"'&&"&quot;"||"&#"+t.charCodeAt()+";"}copy(NodeType,Node),copy(NodeType,Node.prototype);function _visitNode(t,e){if(e(t))return!0;if(t=t.firstChild)do if(_visitNode(t,e))return!0;while(t=t.nextSibling)}function Document(){}function _onAddAttribute(t,e,r){t&&t._inc++;var n=r.namespaceURI;n=="http://www.w3.org/2000/xmlns/"&&(e._nsMap[r.prefix?r.localName:""]=r.value)}function _onRemoveAttribute(t,e,r,n){t&&t._inc++;var i=r.namespaceURI;i=="http://www.w3.org/2000/xmlns/"&&delete e._nsMap[r.prefix?r.localName:""]}function _onUpdateChild(t,e,r){if(t&&t._inc){t._inc++;var n=e.childNodes;if(r)n[n.length++]=r;else{for(var i=e.firstChild,o=0;i;)n[o++]=i,i=i.nextSibling;n.length=o}}}function _removeChild(t,e){var r=e.previousSibling,n=e.nextSibling;return r?r.nextSibling=n:t.firstChild=n,n?n.previousSibling=r:t.lastChild=r,_onUpdateChild(t.ownerDocument,t),e}function _insertBefore(t,e,r){var n=e.parentNode;if(n&&n.removeChild(e),e.nodeType===DOCUMENT_FRAGMENT_NODE){var i=e.firstChild;if(i==null)return e;var o=e.lastChild}else i=o=e;var a=r?r.previousSibling:t.lastChild;i.previousSibling=a,o.nextSibling=r,a?a.nextSibling=i:t.firstChild=i,r==null?t.lastChild=o:r.previousSibling=o;do i.parentNode=t;while(i!==o&&(i=i.nextSibling));return _onUpdateChild(t.ownerDocument||t,t),e.nodeType==DOCUMENT_FRAGMENT_NODE&&(e.firstChild=e.lastChild=null),e}function _appendSingleChild(t,e){var r=e.parentNode;if(r){var n=t.lastChild;r.removeChild(e);var n=t.lastChild}var n=t.lastChild;return e.parentNode=t,e.previousSibling=n,e.nextSibling=null,n?n.nextSibling=e:t.firstChild=e,t.lastChild=e,_onUpdateChild(t.ownerDocument,t,e),e}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==DOCUMENT_FRAGMENT_NODE){for(var r=t.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,e),r=n}return t}return this.documentElement==null&&t.nodeType==ELEMENT_NODE&&(this.documentElement=t),_insertBefore(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),_removeChild(this,t)},importNode:function(t,e){return importNode(this,t,e)},getElementById:function(t){var e=null;return _visitNode(this.documentElement,function(r){if(r.nodeType==ELEMENT_NODE&&r.getAttribute("id")==t)return e=r,!0}),e},getElementsByClassName:function(t){var e=new RegExp("(^|\\s)"+t+"(\\s|$)");return new LiveNodeList(this,function(r){var n=[];return _visitNode(r.documentElement,function(i){i!==r&&i.nodeType==ELEMENT_NODE&&e.test(i.getAttribute("class"))&&n.push(i)}),n})},createElement:function(t){var e=new Element;e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new NodeList;var r=e.attributes=new NamedNodeMap;return r._ownerElement=e,e},createDocumentFragment:function(){var t=new DocumentFragment;return t.ownerDocument=this,t.childNodes=new NodeList,t},createTextNode:function(t){var e=new Text;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new Comment;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new CDATASection;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var r=new ProcessingInstruction;return r.ownerDocument=this,r.tagName=r.target=t,r.nodeValue=r.data=e,r},createAttribute:function(t){var e=new Attr;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new EntityReference;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var r=new Element,n=e.split(":"),i=r.attributes=new NamedNodeMap;return r.childNodes=new NodeList,r.ownerDocument=this,r.nodeName=e,r.tagName=e,r.namespaceURI=t,n.length==2?(r.prefix=n[0],r.localName=n[1]):r.localName=e,i._ownerElement=r,r},createAttributeNS:function(t,e){var r=new Attr,n=e.split(":");return r.ownerDocument=this,r.nodeName=e,r.name=e,r.namespaceURI=t,r.specified=!0,n.length==2?(r.prefix=n[0],r.localName=n[1]):r.localName=e,r}},_extends(Document,Node);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(t){return this.getAttributeNode(t)!=null},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var r=this.ownerDocument.createAttribute(t);r.value=r.nodeValue=""+e,this.setAttributeNode(r)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(t,null):_appendSingleChild(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);r&&this.removeAttributeNode(r)},hasAttributeNS:function(t,e){return this.getAttributeNodeNS(t,e)!=null},getAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);return r&&r.value||""},setAttributeNS:function(t,e,r){var n=this.ownerDocument.createAttributeNS(t,e);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new LiveNodeList(this,function(e){var r=[];return _visitNode(e,function(n){n!==e&&n.nodeType==ELEMENT_NODE&&(t==="*"||n.tagName==t)&&r.push(n)}),r})},getElementsByTagNameNS:function(t,e){return new LiveNodeList(this,function(r){var n=[];return _visitNode(r,function(i){i!==r&&i.nodeType===ELEMENT_NODE&&(t==="*"||i.namespaceURI===t)&&(e==="*"||i.localName==e)&&n.push(i)}),n})}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends(Attr,Node);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,r){var n=this.data.substring(0,t),i=this.data.substring(t+e);r=n+r+i,this.nodeValue=this.data=r,this.length=r.length}},_extends(CharacterData,Node);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(t){var e=this.data,r=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},_extends(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE},_extends(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE},_extends(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends(DocumentType,Node);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE,_extends(Notation,Node);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE,_extends(Entity,Node);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends(EntityReference,Node);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends(DocumentFragment,Node);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends(ProcessingInstruction,Node);function XMLSerializer(){}XMLSerializer.prototype.serializeToString=function(t,e,r){return nodeSerializeToString.call(t,e,r)},Node.prototype.toString=nodeSerializeToString;function nodeSerializeToString(t,e){var r=[],n=this.nodeType==9&&this.documentElement||this,i=n.prefix,o=n.namespaceURI;if(o&&i==null){var i=n.lookupPrefix(o);if(i==null)var a=[{namespace:o,prefix:null}]}return serializeToString(this,r,t,e,a),r.join("")}function needNamespaceDefine(t,e,r){var n=t.prefix||"",i=t.namespaceURI;if(!n&&!i||n==="xml"&&i==="http://www.w3.org/XML/1998/namespace"||i=="http://www.w3.org/2000/xmlns/")return!1;for(var o=r.length;o--;){var a=r[o];if(a.prefix==n)return a.namespace!=i}return!0}function serializeToString(t,e,r,n,i){if(n)if(t=n(t),t){if(typeof t=="string"){e.push(t);return}}else return;switch(t.nodeType){case ELEMENT_NODE:i||(i=[]),i.length;var o=t.attributes,a=o.length,E=t.firstChild,l=t.tagName;r=htmlns===t.namespaceURI||r,e.push("<",l);for(var f=0;f<a;f++){var d=o.item(f);d.prefix=="xmlns"?i.push({prefix:d.localName,namespace:d.value}):d.nodeName=="xmlns"&&i.push({prefix:"",namespace:d.value})}for(var f=0;f<a;f++){var d=o.item(f);if(needNamespaceDefine(d,r,i)){var g=d.prefix||"",b=d.namespaceURI,_=g?" xmlns:"+g:" xmlns";e.push(_,'="',b,'"'),i.push({prefix:g,namespace:b})}serializeToString(d,e,r,n,i)}if(needNamespaceDefine(t,r,i)){var g=t.prefix||"",b=t.namespaceURI;if(b){var _=g?" xmlns:"+g:" xmlns";e.push(_,'="',b,'"'),i.push({prefix:g,namespace:b})}}if(E||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(e.push(">"),r&&/^script$/i.test(l))for(;E;)E.data?e.push(E.data):serializeToString(E,e,r,n,i),E=E.nextSibling;else for(;E;)serializeToString(E,e,r,n,i),E=E.nextSibling;e.push("</",l,">")}else e.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(var E=t.firstChild;E;)serializeToString(E,e,r,n,i),E=E.nextSibling;return;case ATTRIBUTE_NODE:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return e.push(t.data.replace(/[<&]/g,_xmlEncoder).replace(/]]>/g,"]]&gt;"));case CDATA_SECTION_NODE:return e.push("<![CDATA[",t.data,"]]>");case COMMENT_NODE:return e.push("<!--",t.data,"-->");case DOCUMENT_TYPE_NODE:var k=t.publicId,D=t.systemId;if(e.push("<!DOCTYPE ",t.name),k)e.push(" PUBLIC ",k),D&&D!="."&&e.push(" ",D),e.push(">");else if(D&&D!=".")e.push(" SYSTEM ",D,">");else{var L=t.internalSubset;L&&e.push(" [",L,"]"),e.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return e.push("<?",t.target," ",t.data,"?>");case ENTITY_REFERENCE_NODE:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function importNode(t,e,r){var n;switch(e.nodeType){case ELEMENT_NODE:n=e.cloneNode(!1),n.ownerDocument=t;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:r=!0;break}if(n||(n=e.cloneNode(!1)),n.ownerDocument=t,n.parentNode=null,r)for(var i=e.firstChild;i;)n.appendChild(importNode(t,i,r)),i=i.nextSibling;return n}function cloneNode(t,e,r){var n=new e.constructor;for(var i in e){var o=e[i];typeof o!="object"&&o!=n[i]&&(n[i]=o)}switch(e.childNodes&&(n.childNodes=new NodeList),n.ownerDocument=t,n.nodeType){case ELEMENT_NODE:var a=e.attributes,l=n.attributes=new NamedNodeMap,f=a.length;l._ownerElement=n;for(var d=0;d<f;d++)n.setAttributeNode(cloneNode(t,a.item(d),!0));break;case ATTRIBUTE_NODE:r=!0}if(r)for(var g=e.firstChild;g;)n.appendChild(cloneNode(t,g,r)),g=g.nextSibling;return n}function __set__(t,e,r){t[e]=r}try{if(Object.defineProperty){let t=function(e){switch(e.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var r=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&r.push(t(e)),e=e.nextSibling;return r.join("");default:return e.nodeValue}};Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return t(this)},set:function(e){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),__set__=function(e,r,n){e["$$"+r]=n}}}catch(t){}dom.Node=Node,dom.DOMException=DOMException,dom.DOMImplementation=DOMImplementation$1,dom.XMLSerializer=XMLSerializer;function DOMParser(t){this.options=t||{locator:{}}}DOMParser.prototype.parseFromString=function(t,e){var r=this.options,n=new XMLReader,i=r.domBuilder||new DOMHandler,o=r.errorHandler,a=r.locator,l=r.xmlns||{},f=/\/x?html?$/.test(e),d=f?htmlEntity.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return a&&i.setDocumentLocator(a),n.errorHandler=buildErrorHandler(o,i,a),n.domBuilder=r.domBuilder||i,f&&(l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",t&&typeof t=="string"?n.parse(t,l,d):n.errorHandler.error("invalid doc source"),i.doc};function buildErrorHandler(t,e,r){if(!t){if(e instanceof DOMHandler)return e;t=e}var n={},i=t instanceof Function;r=r||{};function o(a){var l=t[a];!l&&i&&(l=t.length==2?function(f){t(a,f)}:t),n[a]=l&&function(f){l("[xmldom "+a+"]	"+f+_locator(r))}||function(){}}return o("warning"),o("error"),o("fatalError"),n}function DOMHandler(){this.cdata=!1}function position(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}DOMHandler.prototype={startDocument:function(){this.doc=new DOMImplementation().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,r,n){var i=this.doc,o=i.createElementNS(t,r||e),a=n.length;appendElement(this,o),this.currentElement=o,this.locator&&position(this.locator,o);for(var l=0;l<a;l++){var t=n.getURI(l),f=n.getValue(l),r=n.getQName(l),d=i.createAttributeNS(t,r);this.locator&&position(n.getLocator(l),d),d.value=d.nodeValue=f,o.setAttributeNode(d)}},endElement:function(t,e,r){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var r=this.doc.createProcessingInstruction(t,e);this.locator&&position(this.locator,r),appendElement(this,r)},ignorableWhitespace:function(t,e,r){},characters:function(t,e,r){if(t=_toString.apply(this,arguments),t){if(this.cdata)var n=this.doc.createCDATASection(t);else var n=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(t)&&this.doc.appendChild(n),this.locator&&position(this.locator,n)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,r){t=_toString.apply(this,arguments);var n=this.doc.createComment(t);this.locator&&position(this.locator,n),appendElement(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var i=n.createDocumentType(t,e,r);this.locator&&position(this.locator,i),appendElement(this,i)}},warning:function(t){console.warn("[xmldom warning]	"+t,_locator(this.locator))},error:function(t){console.error("[xmldom error]	"+t,_locator(this.locator))},fatalError:function(t){throw new ParseError(t,this.locator)}};function _locator(t){if(t)return`
@`+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function _toString(t,e,r){return typeof t=="string"?t.substr(e,r):t.length>=e+r||e?new java.lang.String(t,e,r)+"":t}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){DOMHandler.prototype[t]=function(){return null}});function appendElement(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}var htmlEntity=entities,sax=sax$1,XMLReader=sax.XMLReader,ParseError=sax.ParseError,DOMImplementation=dom.DOMImplementation,DOMParser_1=DOMParser;const fuseIntersectingBlueprints=t=>{const e=new Map,r=[];return t.forEach((n,i)=>{let o={current:n};e.has(i)?o=e.get(i):r.push(o);let a=o.current;t.slice(i+1).forEach((l,f)=>{const d=i+f+1;let g=l,b=!1;e.has(d)&&(g=e.get(d).current,b=!0),!a.boundingBox.isOut(g.boundingBox)&&a.intersects(g)&&(o.current=fuseBlueprints(a,g),b&&(e.get(d).current=!1),e.set(d,o))})}),r.map(({current:n})=>n).filter(n=>n)},COMMAND=0,NUMBER=1,EOD=2,PARAMS={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function tokenize(t){const e=new Array;for(;t!=="";)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:COMMAND,text:RegExp.$1},t=t.substr(RegExp.$1.length);else if(t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))e[e.length]={type:NUMBER,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length);else return[];return e[e.length]={type:EOD,text:""},e}function isType(t,e){return t.type===e}function parsePath(t){const e=[],r=tokenize(t);let n="BOD",i=0,o=r[i];for(;!isType(o,EOD);){let a=0;const l=[];if(n==="BOD")if(o.text==="M"||o.text==="m")i++,a=PARAMS[o.text],n=o.text;else return parsePath("M0,0"+t);else isType(o,NUMBER)?a=PARAMS[n]:(i++,a=PARAMS[o.text],n=o.text);if(i+a<r.length){for(let f=i;f<i+a;f++){const d=r[f];if(isType(d,NUMBER))l[l.length]=+d.text;else throw new Error("Param not a number: "+n+","+d.text)}if(typeof PARAMS[n]=="number"){const f={key:n,data:l};e.push(f),i+=a,o=r[i],n==="M"&&(n="L"),n==="m"&&(n="l")}else throw new Error("Bad segment: "+n)}else throw new Error("Path data ended short")}return e}function absolutize(t){let e=0,r=0,n=0,i=0;const o=[];for(const{key:a,data:l}of t)switch(a){case"M":o.push({key:"M",data:[...l]}),[e,r]=l,[n,i]=l;break;case"m":e+=l[0],r+=l[1],o.push({key:"M",data:[e,r]}),n=e,i=r;break;case"L":o.push({key:"L",data:[...l]}),[e,r]=l;break;case"l":e+=l[0],r+=l[1],o.push({key:"L",data:[e,r]});break;case"C":o.push({key:"C",data:[...l]}),e=l[4],r=l[5];break;case"c":{const f=l.map((d,g)=>g%2?d+r:d+e);o.push({key:"C",data:f}),e=f[4],r=f[5];break}case"Q":o.push({key:"Q",data:[...l]}),e=l[2],r=l[3];break;case"q":{const f=l.map((d,g)=>g%2?d+r:d+e);o.push({key:"Q",data:f}),e=f[2],r=f[3];break}case"A":o.push({key:"A",data:[...l]}),e=l[5],r=l[6];break;case"a":e+=l[5],r+=l[6],o.push({key:"A",data:[l[0],l[1],l[2],l[3],l[4],e,r]});break;case"H":o.push({key:"H",data:[...l]}),e=l[0];break;case"h":e+=l[0],o.push({key:"H",data:[e]});break;case"V":o.push({key:"V",data:[...l]}),r=l[0];break;case"v":r+=l[0],o.push({key:"V",data:[r]});break;case"S":o.push({key:"S",data:[...l]}),e=l[2],r=l[3];break;case"s":{const f=l.map((d,g)=>g%2?d+r:d+e);o.push({key:"S",data:f}),e=f[2],r=f[3];break}case"T":o.push({key:"T",data:[...l]}),e=l[0],r=l[1];break;case"t":e+=l[0],r+=l[1],o.push({key:"T",data:[e,r]});break;case"Z":case"z":o.push({key:"Z",data:[]}),e=n,r=i;break}return o}const roundedRectangleBlueprint=({x:t=0,y:e=0,rx:r=0,ry:n=0,width:i,height:o})=>{let a=Math.min(r,i/2),l=Math.min(n,o/2);const f=a&&l;f||(a=0,l=0);const d=new BlueprintSketcher([t+i/2,e]);return a<i/2&&d.hLine(i/2-a),f&&d.ellipse(a,l,a,l,0,!1,!0),l<o/2&&d.vLine(o-2*l),f&&d.ellipse(-a,l,a,l,0,!1,!0),d.hLine(-i/2+a).closeWithMirror()},ellipseBlueprint=({cx:t=0,cy:e=0,rx:r,ry:n})=>{const i=new BlueprintSketcher([t-r,e]);return i.halfEllipse(2*r,0,n,!1,!0),i.halfEllipse(-2*r,0,n,!1,!0),i.close()},parseArgs=(t,e,r)=>{let n,i=null,o=null;if(t.key==="M"){const[a,l]=t.data;return n=[a,l],{p:n}}if(t.key==="H"){const[a]=t.data;return n=[a,(e==null?void 0:e[1])||0],{p:n}}if(t.key==="V"){const[a]=t.data;return n=[(e==null?void 0:e[0])||0,a],{p:n}}if(t.key==="L"){const[a,l]=t.data;return n=[a,l],{p:n}}if(t.key==="C"){const[a,l,f,d,g,b]=t.data;return n=[g,b],i=[a,l],o=[f,d],{p:n,control1:i,control2:o}}if(t.key==="S"){const[a,l,f,d]=t.data;if(n=[f,d],o=[a,l],i=e,r.control2){const g=e;i=[g[0]+(g[0]-r.control2[0]),g[1]+(g[1]-r.control2[1])]}return{p:n,control1:i,control2:o}}if(t.key==="Q"){const[a,l,f,d]=t.data;return n=[f,d],i=[a,l],{p:n,control1:i}}if(t.key==="T"){const[a,l]=t.data;if(n=[a,l],i=e,r.control1&&!r.control2){const f=e;i=[f[0]+(f[0]-r.control1[0]),f[1]+(f[1]-r.control1[1])]}}if(t.key==="A"){const[a,l,f=0,d=0,g=0,b,_]=t.data;n=[b,_];const E=Math.sqrt((e[0]-b)**2+(e[1]-_)**2),k=Math.max(a,l);let D=a,L=l;if(k<E/2){const M=E/2/k;D=a*M,L=l*M}return{p:n,arcConfig:[D,L,f,!!d,!!g]}}},SVGPathBlueprint=function*(t){const e=absolutize(parsePath(t));let r=null,n=null,i={control1:null,control2:null};for(const o of e){if(o.key==="Z"){r&&(yield r.close()),r=null;continue}const{p:a,control1:l,control2:f,arcConfig:d=[]}=parseArgs(o,n,i);if(o.key==="M"){r&&(yield r.done()),r=new BlueprintSketcher(a),n=a;continue}if(n&&Math.abs(a[0]-n[0])<1e-9&&Math.abs(a[1]-n[1])<1e-9){n=a,i={control1:l,control2:f};continue}(o.key==="L"||o.key==="H"||o.key==="V")&&(r==null||r.lineTo(a)),(o.key==="C"||o.key==="S")&&(r==null||r.cubicBezierCurveTo(a,l,f)),(o.key==="Q"||o.key==="T")&&(r==null||r.quadraticBezierCurveTo(a,l)),o.key==="A"&&(r==null||r.ellipseTo(a,...d)),n=a,i={control1:l,control2:f}}r&&(yield r.done())};function drawSVG(t,{width:e}={}){const n=new DOMParser_1().parseFromString(t,"text/html");let i=[];for(let l of Array.from(n.getElementsByTagName("path"))){let f=l.getAttribute("d");const d=Array.from(SVGPathBlueprint(f));i.push(...d)}for(let l of Array.from(n.getElementsByTagName("polygon"))){let f=l.getAttribute("points");i=i.concat(Array.from(SVGPathBlueprint(`M${f}z`)))}for(let l of Array.from(n.getElementsByTagName("rect"))){const f=parseFloat(l.getAttribute("x"))||0,d=parseFloat(l.getAttribute("y"))||0,g=parseFloat(l.getAttribute("width"))||0,b=parseFloat(l.getAttribute("height"))||0;let _=parseFloat(l.getAttribute("rx"))||0,E=parseFloat(l.getAttribute("ry"))||0;i.push(roundedRectangleBlueprint({x:f,y:d,rx:_,ry:E,width:g,height:b}))}for(let l of Array.from(n.getElementsByTagName("circle"))){const f=parseFloat(l.getAttribute("cx"))||0,d=parseFloat(l.getAttribute("cy"))||0,g=parseFloat(l.getAttribute("r"))||0;i.push(ellipseBlueprint({cx:f,cy:d,rx:g,ry:g}))}for(let l of Array.from(n.getElementsByTagName("ellipse"))){const f=parseFloat(l.getAttribute("cx"))||0,d=parseFloat(l.getAttribute("cy"))||0,g=parseFloat(l.getAttribute("rx"))||0,b=parseFloat(l.getAttribute("ry"))||0;i.push(ellipseBlueprint({cx:f,cy:d,rx:g,ry:b}))}const o=fuseIntersectingBlueprints(i);let a=organiseBlueprints(o).mirror([1,0],[0,0],"plane");if(e){const l=e/a.boundingBox.width;a=a.scale(l,a.boundingBox.center)}return new Drawing(a)}const fonts={ANTON:"http://fonts.gstatic.com/s/anton/v7/XIbCenm-W0IRHWYIh7CGUQ.ttf",ROBOTO:"https://fonts.gstatic.com/s/roboto/v15/W5F8_SL0XFawnjxHGsZjJA.ttf",NOTOSANS:"http://fonts.gstatic.com/s/notosansdisplay/v20/RLplK4fy6r6tOBEJg0IAKzqdFZVZxokvfn_BDLxR.ttf",ANONYMOUSPRO:"http://fonts.gstatic.com/s/anonymouspro/v14/rP2Bp2a15UIB7Un-bOeISG3pLlw89CH98Ko.ttf",MONSERRAT:"http://fonts.gstatic.com/s/montserrat/v15/JTURjIg1_i6t8kCHKm45_dJE3gnD-w.ttf",AGUAFINA:"http://fonts.gstatic.com/s/aguafinascript/v5/65g7cgMtMGnNlNyq_Z6CvMxLhO8OSNnfAp53LK1_iRs.ttf",OPEN_SANS:"http://fonts.gstatic.com/s/opensans/v13/IgZJs4-7SA1XX_edsoXWog.ttf"};var TOLEARANCE=Math.pow(10,-9);function almostEqual(t,e,r){return r===void 0&&(r=TOLEARANCE),Math.abs(t-e)<r}function generateNFPCacheKey(t,e,r,n,i,o){return i===void 0&&(i=r.rotation),o===void 0&&(o=n.rotation),JSON.stringify({id1:r.id,id2:n.id,r1:i,r2:o,inside:e})}function keyToNFPData(t,e){return JSON.parse(t)}var FloatPoint=function(){function t(e,r){e===void 0&&(e=0),r===void 0&&(r=0),this._data=new Float32Array(2),this._data[0]=e,this._data[1]=r}return t.prototype.scale=function(e){return this._data[0]*=e,this._data[1]*=e,this},t.prototype.add=function(e){return this._data[0]+=e.x,this._data[1]+=e.y,this},t.prototype.sub=function(e){return this._data[0]-=e.x,this._data[1]-=e.y,this},t.prototype.set=function(e){return this._data[0]=e.x,this._data[1]=e.y,this},t.prototype.update=function(e,r){return this._data[0]=e,this._data[1]=r,this},t.prototype.max=function(e){return this._data[0]=Math.max(e.x,this._data[0]),this._data[1]=Math.max(e.y,this._data[1]),this},t.prototype.min=function(e){return this._data[0]=Math.min(e.x,this._data[0]),this._data[1]=Math.min(e.y,this._data[1]),this},t.prototype.dot=function(e){return e.x*this._data[0]+e.y*this._data[1]},t.prototype.cross=function(e,r){return r===void 0&&(r=1),this._data[1]*e.x+r*this._data[0]*e.y},t.prototype.abs=function(){return this._data[0]=Math.abs(this._data[0]),this._data[1]=Math.abs(this._data[1]),this},t.prototype.rotate=function(e){var r=Math.cos(e),n=Math.sin(e),i=this._data[0],o=this._data[1];return this._data[0]=i*r-o*n,this._data[1]=i*n+o*r,this},t.prototype.clone=function(){return new t(this._data[0],this._data[1])},t.prototype.almostEqual=function(e,r){return t.almostEqual(this,e,r)},t.prototype.onSegment=function(e,r){var n=Math.pow(10,-9),i=t.from(e).max(r),o=t.from(e).min(r),a=t.sub(e,r),l=t.sub(e,this);if(Math.abs(a.x)<n&&Math.abs(l.x)<n)return!almostEqual(this.y,r.y)&&!almostEqual(this.y,e.y)&&this.y<i.y&&this.y>o.y;if(Math.abs(a.x)<n&&Math.abs(l.x)<n)return!almostEqual(this.x,r.x)&&!almostEqual(this.x,e.x)&&this.x<i.x&&this.x>o.x;if(this.x<o.x||this.x>i.x||this.y<o.y||this.y>i.y||t.almostEqual(this,e)||t.almostEqual(this,r)||Math.abs(l.cross(a,-1))>n)return!1;var f=l.dot(a),d=a.squareLength;return!(f<n||f>d||almostEqual(f,d))},Object.defineProperty(t.prototype,"x",{get:function(){return this._data[0]},set:function(e){this._data[0]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._data[1]},set:function(e){this._data[1]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"squareLength",{get:function(){return this._data[0]*this._data[0]+this._data[1]*this._data[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.squareLength)},enumerable:!1,configurable:!0}),t.from=function(e){return new t(e.x,e.y)},t.abs=function(e){return new t(Math.abs(e.x),Math.abs(e.y))},t.square=function(e){return new t(e.x*e.x,e.y*e.y)},t.add=function(e,r){return new t(e.x+r.x,e.y+r.y)},t.sub=function(e,r){return new t(r.x-e.x,r.y-e.y)},t.almostEqual=function(e,r,n){return n===void 0&&(n=Math.pow(10,-9)),Math.abs(e.x-r.x)<n&&Math.abs(e.y-r.y)<n},t.normal=function(e){return new t(e.y,-e.x)},t.reverse=function(e){return new t(-e.x,-e.y)},t.normalizeVector=function(e){var r=t.from(e);return almostEqual(r.squareLength,1)?r:r.scale(1/r.length)},t}(),FloatRect=function(){function t(e,r,n,i){e===void 0&&(e=0),r===void 0&&(r=0),n===void 0&&(n=0),i===void 0&&(i=0),this._bottomLeft=new FloatPoint,this._topRight=new FloatPoint,this._size=new FloatPoint,this._bottomLeft.update(e,r),this._topRight.update(e+n,r+i),this._size.update(n,i)}return Object.defineProperty(t.prototype,"x",{get:function(){return this._bottomLeft.x},set:function(e){this._bottomLeft.x=e,this._topRight.x=this._size.x+e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._bottomLeft.y},set:function(e){this._bottomLeft.y=e,this._topRight.y=this._size.y+e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._size.x},set:function(e){this._size.x=e,this._topRight.x=this._size.x+e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._size.y},set:function(e){this._size.y=e,this._topRight.y=this._bottomLeft.y+e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return this._bottomLeft.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return this._topRight.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size.clone()},enumerable:!1,configurable:!0}),t.fromPoints=function(e,r){return new t(e.x,e.y,r.x-e.x,r.y-e.y)},t}(),Phenotype=function(){function t(e,r){this._fitness=0,this._placement=e,this._rotation=r}return t.prototype.cut=function(e){return new t(this._placement.slice(0,e),this._rotation.slice(0,e))},t.prototype.clone=function(){return new t(this._placement.slice(),this._rotation.slice())},t.prototype.mate=function(e){var r=0,n=e.placement[0],i=e.rotation[0];for(r=0;r<e.size;++r)n=e.placement[r],i=e.rotation[r],this._contains(n.id)||(this._placement.push(n),this._rotation.push(i))},t.prototype._contains=function(e){var r=0,n=this.size;for(r=0;r<n;++r)if(this._placement[r].id===e)return!0;return!1},Object.defineProperty(t.prototype,"placement",{get:function(){return this._placement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._placement.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fitness",{get:function(){return this._fitness},set:function(e){this._fitness=e},enumerable:!1,configurable:!0}),t}(),DEFAULT_CONFIG={populationSize:10,mutationRate:10,rotations:4},DEFAULT_BOUNDS=new FloatRect,GeneticAlgorithm=function(){function t(){this._isEmpty=!0,this._population=new Array,this._config=DEFAULT_CONFIG,this._binBounds=DEFAULT_BOUNDS}return t.prototype.init=function(e,r,n){n===void 0&&(n=DEFAULT_CONFIG),this._isEmpty=!1,this._config=n,this._binBounds=r;var i=[],o=0,a;for(o=0;o<e.length;++o)i.push(0);for(this._population=[new Phenotype(e,i)];this._population.length<n.populationSize;)a=this._mutate(this._population[0]),this._population.push(a)},t.prototype.clear=function(){this._isEmpty||(this._isEmpty=!0,this._population.length=0,this._binBounds=DEFAULT_BOUNDS,this._config=DEFAULT_CONFIG)},t.prototype._generation=function(){console.log("starting a new generation in the GA"),this._population.sort(function(a,l){return a.fitness-l.fitness});for(var e=[this._population[0]],r=this._population.length,n,i,o;e.length<r;)n=this._randomWeightedIndividual(),i=this._randomWeightedIndividual(n),o=this._mate(n,i),e.push(this._mutate(o[0])),e.length<r&&e.push(this._mutate(o[1]));this._population=e},t.prototype._randomAngle=function(e){var r=Math.max(this._config.rotations,1),n=[],i=0,o;for(i=0;i<r;++i)n.push(i*(360/r));for(n=t.shuffle(n),i=0;i<r;++i)if(o=e.rotate(n[i]).bounds,o.width<this._binBounds.width&&o.height<this._binBounds.height)return n[i];return 0},t.prototype._mutate=function(e){var r=.01*this._config.mutationRate,n=e.clone(),i=n.size,o=0,a=0,l=0,f;for(o=0;o<i;++o)l=Math.random(),l<r&&(a=o+1,a<i&&(f=n.placement[o],n.placement[o]=n.placement[a],n.placement[a]=f)),l=Math.random(),l<r&&(n.rotation[o]=this._randomAngle(n.placement[o]));return n},t.prototype._mate=function(e,r){var n=Math.round(Math.min(Math.max(Math.random(),.1),.9)*(e.placement.length-1)),i=[e.cut(n),r.cut(n)];return i[0].mate(r),i[1].mate(e),i},t.prototype._randomWeightedIndividual=function(e){var r=this._population.slice(),n=e?r.indexOf(e):-1;n>=0&&r.splice(n,1);var i=r.length,o=Math.random(),a=2/i,l=0,f=a/2,d=0;for(d=0;d<i;++d){if(o>l&&o<f)return r[d];l=f,f+=a*((i-d)/i)}return r[0]},Object.defineProperty(t.prototype,"individual",{get:function(){var e=0;for(e=0;e<this._population.length;++e)if(!this._population[e].fitness)return this._population[e];return this._generation(),this._population[1]||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"population",{get:function(){return this._population},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._isEmpty},enumerable:!1,configurable:!0}),t.shuffle=function(e){var r=e.length-1,n=0,i=0,o;for(n=r;n>0;--n)i=Math.floor(Math.random()*(n+1)),o=e[n],e[n]=e[i],e[i]=o;return e},t}();function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var clipper={exports:{}};(function(t){var e={},r=!1;t.exports?(t.exports=e,r=!0):typeof document<"u"?window.ClipperLib=e:self.ClipperLib=e;var n;if(r){var i="chrome";n="Netscape"}else{var i=navigator.userAgent.toString().toLowerCase();n=navigator.appName}var o={};i.indexOf("chrome")!=-1&&i.indexOf("chromium")==-1?o.chrome=1:o.chrome=0,i.indexOf("chromium")!=-1?o.chromium=1:o.chromium=0,i.indexOf("safari")!=-1&&i.indexOf("chrome")==-1&&i.indexOf("chromium")==-1?o.safari=1:o.safari=0,i.indexOf("firefox")!=-1?o.firefox=1:o.firefox=0,i.indexOf("firefox/17")!=-1?o.firefox17=1:o.firefox17=0,i.indexOf("firefox/15")!=-1?o.firefox15=1:o.firefox15=0,i.indexOf("firefox/3")!=-1?o.firefox3=1:o.firefox3=0,i.indexOf("opera")!=-1?o.opera=1:o.opera=0,i.indexOf("msie 10")!=-1?o.msie10=1:o.msie10=0,i.indexOf("msie 9")!=-1?o.msie9=1:o.msie9=0,i.indexOf("msie 8")!=-1?o.msie8=1:o.msie8=0,i.indexOf("msie 7")!=-1?o.msie7=1:o.msie7=0,i.indexOf("msie ")!=-1?o.msie=1:o.msie=0,e.biginteger_used=null;var a;function l(s,u,h){e.biginteger_used=1,s!=null&&(typeof s=="number"&&typeof u>"u"?this.fromInt(s):typeof s=="number"?this.fromNumber(s,u,h):u==null&&typeof s!="string"?this.fromString(s,256):this.fromString(s,u))}function f(){return new l(null)}function d(s,u,h,m,y,C){for(;--C>=0;){var T=u*this[s++]+h[m]+y;y=Math.floor(T/67108864),h[m++]=T&67108863}return y}function g(s,u,h,m,y,C){for(var T=u&32767,I=u>>15;--C>=0;){var F=this[s]&32767,N=this[s++]>>15,W=I*F+N*T;F=T*F+((W&32767)<<15)+h[m]+(y&1073741823),y=(F>>>30)+(W>>>15)+I*N+(y>>>30),h[m++]=F&1073741823}return y}function b(s,u,h,m,y,C){for(var T=u&16383,I=u>>14;--C>=0;){var F=this[s]&16383,N=this[s++]>>14,W=I*F+N*T;F=T*F+((W&16383)<<14)+h[m]+y,y=(F>>28)+(W>>14)+I*N,h[m++]=F&268435455}return y}n=="Microsoft Internet Explorer"?(l.prototype.am=g,a=30):n!="Netscape"?(l.prototype.am=d,a=26):(l.prototype.am=b,a=28),l.prototype.DB=a,l.prototype.DM=(1<<a)-1,l.prototype.DV=1<<a;var _=52;l.prototype.FV=Math.pow(2,_),l.prototype.F1=_-a,l.prototype.F2=2*a-_;var E="0123456789abcdefghijklmnopqrstuvwxyz",k=new Array,D,L;for(D=48,L=0;L<=9;++L)k[D++]=L;for(D=97,L=10;L<36;++L)k[D++]=L;for(D=65,L=10;L<36;++L)k[D++]=L;function M(s){return E.charAt(s)}function U(s,u){var h=k[s.charCodeAt(u)];return h??-1}function R(s){for(var u=this.t-1;u>=0;--u)s[u]=this[u];s.t=this.t,s.s=this.s}function z(s){this.t=1,this.s=s<0?-1:0,s>0?this[0]=s:s<-1?this[0]=s+this.DV:this.t=0}function X(s){var u=f();return u.fromInt(s),u}function se(s,u){var h;if(u==16)h=4;else if(u==8)h=3;else if(u==256)h=8;else if(u==2)h=1;else if(u==32)h=5;else if(u==4)h=2;else{this.fromRadix(s,u);return}this.t=0,this.s=0;for(var m=s.length,y=!1,C=0;--m>=0;){var T=h==8?s[m]&255:U(s,m);if(T<0){s.charAt(m)=="-"&&(y=!0);continue}y=!1,C==0?this[this.t++]=T:C+h>this.DB?(this[this.t-1]|=(T&(1<<this.DB-C)-1)<<C,this[this.t++]=T>>this.DB-C):this[this.t-1]|=T<<C,C+=h,C>=this.DB&&(C-=this.DB)}h==8&&s[0]&128&&(this.s=-1,C>0&&(this[this.t-1]|=(1<<this.DB-C)-1<<C)),this.clamp(),y&&l.ZERO.subTo(this,this)}function $(){for(var s=this.s&this.DM;this.t>0&&this[this.t-1]==s;)--this.t}function q(s){if(this.s<0)return"-"+this.negate().toString(s);var u;if(s==16)u=4;else if(s==8)u=3;else if(s==2)u=1;else if(s==32)u=5;else if(s==4)u=2;else return this.toRadix(s);var h=(1<<u)-1,m,y=!1,C="",T=this.t,I=this.DB-T*this.DB%u;if(T-- >0)for(I<this.DB&&(m=this[T]>>I)>0&&(y=!0,C=M(m));T>=0;)I<u?(m=(this[T]&(1<<I)-1)<<u-I,m|=this[--T]>>(I+=this.DB-u)):(m=this[T]>>(I-=u)&h,I<=0&&(I+=this.DB,--T)),m>0&&(y=!0),y&&(C+=M(m));return y?C:"0"}function ee(){var s=f();return l.ZERO.subTo(this,s),s}function Pe(){return this.s<0?this.negate():this}function ce(s){var u=this.s-s.s;if(u!=0)return u;var h=this.t;if(u=h-s.t,u!=0)return this.s<0?-u:u;for(;--h>=0;)if((u=this[h]-s[h])!=0)return u;return 0}function ve(s){var u=1,h;return(h=s>>>16)!=0&&(s=h,u+=16),(h=s>>8)!=0&&(s=h,u+=8),(h=s>>4)!=0&&(s=h,u+=4),(h=s>>2)!=0&&(s=h,u+=2),(h=s>>1)!=0&&(s=h,u+=1),u}function we(){return this.t<=0?0:this.DB*(this.t-1)+ve(this[this.t-1]^this.s&this.DM)}function ue(s,u){var h;for(h=this.t-1;h>=0;--h)u[h+s]=this[h];for(h=s-1;h>=0;--h)u[h]=0;u.t=this.t+s,u.s=this.s}function pe(s,u){for(var h=s;h<this.t;++h)u[h-s]=this[h];u.t=Math.max(this.t-s,0),u.s=this.s}function Q(s,u){var h=s%this.DB,m=this.DB-h,y=(1<<m)-1,C=Math.floor(s/this.DB),T=this.s<<h&this.DM,I;for(I=this.t-1;I>=0;--I)u[I+C+1]=this[I]>>m|T,T=(this[I]&y)<<h;for(I=C-1;I>=0;--I)u[I]=0;u[C]=T,u.t=this.t+C+1,u.s=this.s,u.clamp()}function re(s,u){u.s=this.s;var h=Math.floor(s/this.DB);if(h>=this.t){u.t=0;return}var m=s%this.DB,y=this.DB-m,C=(1<<m)-1;u[0]=this[h]>>m;for(var T=h+1;T<this.t;++T)u[T-h-1]|=(this[T]&C)<<y,u[T-h]=this[T]>>m;m>0&&(u[this.t-h-1]|=(this.s&C)<<y),u.t=this.t-h,u.clamp()}function ye(s,u){for(var h=0,m=0,y=Math.min(s.t,this.t);h<y;)m+=this[h]-s[h],u[h++]=m&this.DM,m>>=this.DB;if(s.t<this.t){for(m-=s.s;h<this.t;)m+=this[h],u[h++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;h<s.t;)m-=s[h],u[h++]=m&this.DM,m>>=this.DB;m-=s.s}u.s=m<0?-1:0,m<-1?u[h++]=this.DV+m:m>0&&(u[h++]=m),u.t=h,u.clamp()}function me(s,u){var h=this.abs(),m=s.abs(),y=h.t;for(u.t=y+m.t;--y>=0;)u[y]=0;for(y=0;y<m.t;++y)u[y+h.t]=h.am(0,m[y],u,y,0,h.t);u.s=0,u.clamp(),this.s!=s.s&&l.ZERO.subTo(u,u)}function ae(s){for(var u=this.abs(),h=s.t=2*u.t;--h>=0;)s[h]=0;for(h=0;h<u.t-1;++h){var m=u.am(h,u[h],s,2*h,0,1);(s[h+u.t]+=u.am(h+1,2*u[h],s,2*h+1,m,u.t-h-1))>=u.DV&&(s[h+u.t]-=u.DV,s[h+u.t+1]=1)}s.t>0&&(s[s.t-1]+=u.am(h,u[h],s,2*h,0,1)),s.s=0,s.clamp()}function fe(s,u,h){var m=s.abs();if(!(m.t<=0)){var y=this.abs();if(y.t<m.t){u!=null&&u.fromInt(0),h!=null&&this.copyTo(h);return}h==null&&(h=f());var C=f(),T=this.s,I=s.s,F=this.DB-ve(m[m.t-1]);F>0?(m.lShiftTo(F,C),y.lShiftTo(F,h)):(m.copyTo(C),y.copyTo(h));var N=C.t,W=C[N-1];if(W!=0){var H=W*(1<<this.F1)+(N>1?C[N-2]>>this.F2:0),te=this.FV/H,le=(1<<this.F1)/H,ie=1<<this.F2,ge=h.t,ke=ge-N,Ye=u??f();for(C.dlShiftTo(ke,Ye),h.compareTo(Ye)>=0&&(h[h.t++]=1,h.subTo(Ye,h)),l.ONE.dlShiftTo(N,Ye),Ye.subTo(C,C);C.t<N;)C[C.t++]=0;for(;--ke>=0;){var Je=h[--ge]==W?this.DM:Math.floor(h[ge]*te+(h[ge-1]+ie)*le);if((h[ge]+=C.am(0,Je,h,ke,0,N))<Je)for(C.dlShiftTo(ke,Ye),h.subTo(Ye,h);h[ge]<--Je;)h.subTo(Ye,h)}u!=null&&(h.drShiftTo(N,u),T!=I&&l.ZERO.subTo(u,u)),h.t=N,h.clamp(),F>0&&h.rShiftTo(F,h),T<0&&l.ZERO.subTo(h,h)}}}function Ae(s){var u=f();return this.abs().divRemTo(s,null,u),this.s<0&&u.compareTo(l.ZERO)>0&&s.subTo(u,u),u}function De(s){this.m=s}function Re(s){return s.s<0||s.compareTo(this.m)>=0?s.mod(this.m):s}function qe(s){return s}function Ke(s){s.divRemTo(this.m,null,s)}function $e(s,u,h){s.multiplyTo(u,h),this.reduce(h)}function He(s,u){s.squareTo(u),this.reduce(u)}De.prototype.convert=Re,De.prototype.revert=qe,De.prototype.reduce=Ke,De.prototype.mulTo=$e,De.prototype.sqrTo=He;function Se(){if(this.t<1)return 0;var s=this[0];if(!(s&1))return 0;var u=s&3;return u=u*(2-(s&15)*u)&15,u=u*(2-(s&255)*u)&255,u=u*(2-((s&65535)*u&65535))&65535,u=u*(2-s*u%this.DV)%this.DV,u>0?this.DV-u:-u}function _e(s){this.m=s,this.mp=s.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<s.DB-15)-1,this.mt2=2*s.t}function Be(s){var u=f();return s.abs().dlShiftTo(this.m.t,u),u.divRemTo(this.m,null,u),s.s<0&&u.compareTo(l.ZERO)>0&&this.m.subTo(u,u),u}function rt(s){var u=f();return s.copyTo(u),this.reduce(u),u}function j(s){for(;s.t<=this.mt2;)s[s.t++]=0;for(var u=0;u<this.m.t;++u){var h=s[u]&32767,m=h*this.mpl+((h*this.mph+(s[u]>>15)*this.mpl&this.um)<<15)&s.DM;for(h=u+this.m.t,s[h]+=this.m.am(0,m,s,u,0,this.m.t);s[h]>=s.DV;)s[h]-=s.DV,s[++h]++}s.clamp(),s.drShiftTo(this.m.t,s),s.compareTo(this.m)>=0&&s.subTo(this.m,s)}function be(s,u){s.squareTo(u),this.reduce(u)}function Ze(s,u,h){s.multiplyTo(u,h),this.reduce(h)}_e.prototype.convert=Be,_e.prototype.revert=rt,_e.prototype.reduce=j,_e.prototype.mulTo=Ze,_e.prototype.sqrTo=be;function Rt(){return(this.t>0?this[0]&1:this.s)==0}function Nt(s,u){if(s>4294967295||s<1)return l.ONE;var h=f(),m=f(),y=u.convert(this),C=ve(s)-1;for(y.copyTo(h);--C>=0;)if(u.sqrTo(h,m),(s&1<<C)>0)u.mulTo(m,y,h);else{var T=h;h=m,m=T}return u.revert(h)}function Ut(s,u){var h;return s<256||u.isEven()?h=new De(u):h=new _e(u),this.exp(s,h)}l.prototype.copyTo=R,l.prototype.fromInt=z,l.prototype.fromString=se,l.prototype.clamp=$,l.prototype.dlShiftTo=ue,l.prototype.drShiftTo=pe,l.prototype.lShiftTo=Q,l.prototype.rShiftTo=re,l.prototype.subTo=ye,l.prototype.multiplyTo=me,l.prototype.squareTo=ae,l.prototype.divRemTo=fe,l.prototype.invDigit=Se,l.prototype.isEven=Rt,l.prototype.exp=Nt,l.prototype.toString=q,l.prototype.negate=ee,l.prototype.abs=Pe,l.prototype.compareTo=ce,l.prototype.bitLength=we,l.prototype.mod=Ae,l.prototype.modPowInt=Ut,l.ZERO=X(0),l.ONE=X(1);function Gt(){var s=f();return this.copyTo(s),s}function Xt(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Wt(){return this.t==0?this.s:this[0]<<24>>24}function Yt(){return this.t==0?this.s:this[0]<<16>>16}function ar(s){return Math.floor(Math.LN2*this.DB/Math.log(s))}function lr(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function ur(s){if(s==null&&(s=10),this.signum()==0||s<2||s>36)return"0";var u=this.chunkSize(s),h=Math.pow(s,u),m=X(h),y=f(),C=f(),T="";for(this.divRemTo(m,y,C);y.signum()>0;)T=(h+C.intValue()).toString(s).substr(1)+T,y.divRemTo(m,y,C);return C.intValue().toString(s)+T}function cr(s,u){this.fromInt(0),u==null&&(u=10);for(var h=this.chunkSize(u),m=Math.pow(u,h),y=!1,C=0,T=0,I=0;I<s.length;++I){var F=U(s,I);if(F<0){s.charAt(I)=="-"&&this.signum()==0&&(y=!0);continue}T=u*T+F,++C>=h&&(this.dMultiply(m),this.dAddOffset(T,0),C=0,T=0)}C>0&&(this.dMultiply(Math.pow(u,C)),this.dAddOffset(T,0)),y&&l.ZERO.subTo(this,this)}function fr(s,u,h){if(typeof u=="number")if(s<2)this.fromInt(1);else for(this.fromNumber(s,h),this.testBit(s-1)||this.bitwiseTo(l.ONE.shiftLeft(s-1),kt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(u);)this.dAddOffset(2,0),this.bitLength()>s&&this.subTo(l.ONE.shiftLeft(s-1),this);else{var m=new Array,y=s&7;m.length=(s>>3)+1,u.nextBytes(m),y>0?m[0]&=(1<<y)-1:m[0]=0,this.fromString(m,256)}}function pr(){var s=this.t,u=new Array;u[0]=this.s;var h=this.DB-s*this.DB%8,m,y=0;if(s-- >0)for(h<this.DB&&(m=this[s]>>h)!=(this.s&this.DM)>>h&&(u[y++]=m|this.s<<this.DB-h);s>=0;)h<8?(m=(this[s]&(1<<h)-1)<<8-h,m|=this[--s]>>(h+=this.DB-8)):(m=this[s]>>(h-=8)&255,h<=0&&(h+=this.DB,--s)),m&128&&(m|=-256),y==0&&(this.s&128)!=(m&128)&&++y,(y>0||m!=this.s)&&(u[y++]=m);return u}function it(s){return this.compareTo(s)==0}function yt(s){return this.compareTo(s)<0?this:s}function jr(s){return this.compareTo(s)>0?this:s}function Ot(s,u,h){var m,y,C=Math.min(s.t,this.t);for(m=0;m<C;++m)h[m]=u(this[m],s[m]);if(s.t<this.t){for(y=s.s&this.DM,m=C;m<this.t;++m)h[m]=u(this[m],y);h.t=this.t}else{for(y=this.s&this.DM,m=C;m<s.t;++m)h[m]=u(y,s[m]);h.t=s.t}h.s=u(this.s,s.s),h.clamp()}function St(s,u){return s&u}function nt(s){var u=f();return this.bitwiseTo(s,St,u),u}function kt(s,u){return s|u}function Vt(s){var u=f();return this.bitwiseTo(s,kt,u),u}function It(s,u){return s^u}function Ve(s){var u=f();return this.bitwiseTo(s,It,u),u}function Dt(s,u){return s&~u}function hr(s){var u=f();return this.bitwiseTo(s,Dt,u),u}function dr(){for(var s=f(),u=0;u<this.t;++u)s[u]=this.DM&~this[u];return s.t=this.t,s.s=~this.s,s}function Ne(s){var u=f();return s<0?this.rShiftTo(-s,u):this.lShiftTo(s,u),u}function Qe(s){var u=f();return s<0?this.lShiftTo(-s,u):this.rShiftTo(s,u),u}function vr(s){if(s==0)return-1;var u=0;return s&65535||(s>>=16,u+=16),s&255||(s>>=8,u+=8),s&15||(s>>=4,u+=4),s&3||(s>>=2,u+=2),s&1||++u,u}function Lt(){for(var s=0;s<this.t;++s)if(this[s]!=0)return s*this.DB+vr(this[s]);return this.s<0?this.t*this.DB:-1}function Ct(s){for(var u=0;s!=0;)s&=s-1,++u;return u}function Tt(){for(var s=0,u=this.s&this.DM,h=0;h<this.t;++h)s+=Ct(this[h]^u);return s}function mr(s){var u=Math.floor(s/this.DB);return u>=this.t?this.s!=0:(this[u]&1<<s%this.DB)!=0}function gr(s,u){var h=l.ONE.shiftLeft(s);return this.bitwiseTo(h,u,h),h}function yr(s){return this.changeBit(s,kt)}function Pr(s){return this.changeBit(s,Dt)}function Ce(s){return this.changeBit(s,It)}function _r(s,u){for(var h=0,m=0,y=Math.min(s.t,this.t);h<y;)m+=this[h]+s[h],u[h++]=m&this.DM,m>>=this.DB;if(s.t<this.t){for(m+=s.s;h<this.t;)m+=this[h],u[h++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;h<s.t;)m+=s[h],u[h++]=m&this.DM,m>>=this.DB;m+=s.s}u.s=m<0?-1:0,m>0?u[h++]=m:m<-1&&(u[h++]=this.DV+m),u.t=h,u.clamp()}function et(s){var u=f();return this.addTo(s,u),u}function ot(s){var u=f();return this.subTo(s,u),u}function br(s){var u=f();return this.multiplyTo(s,u),u}function wr(){var s=f();return this.squareTo(s),s}function Ht(s){var u=f();return this.divRemTo(s,u,null),u}function he(s){var u=f();return this.divRemTo(s,null,u),u}function Sr(s){var u=f(),h=f();return this.divRemTo(s,u,h),new Array(u,h)}function S(s){this[this.t]=this.am(0,s-1,this,0,0,this.t),++this.t,this.clamp()}function Te(s,u){if(s!=0){for(;this.t<=u;)this[this.t++]=0;for(this[u]+=s;this[u]>=this.DV;)this[u]-=this.DV,++u>=this.t&&(this[this.t++]=0),++this[u]}}function Pt(){}function zt(s){return s}function Cr(s,u,h){s.multiplyTo(u,h)}function Tr(s,u){s.squareTo(u)}Pt.prototype.convert=zt,Pt.prototype.revert=zt,Pt.prototype.mulTo=Cr,Pt.prototype.sqrTo=Tr;function Er(s){return this.exp(s,new Pt)}function xr(s,u,h){var m=Math.min(this.t+s.t,u);for(h.s=0,h.t=m;m>0;)h[--m]=0;var y;for(y=h.t-this.t;m<y;++m)h[m+this.t]=this.am(0,s[m],h,m,0,this.t);for(y=Math.min(s.t,u);m<y;++m)this.am(0,s[m],h,m,0,u-m);h.clamp()}function Ar(s,u,h){--u;var m=h.t=this.t+s.t-u;for(h.s=0;--m>=0;)h[m]=0;for(m=Math.max(u-this.t,0);m<s.t;++m)h[this.t+m-u]=this.am(u-m,s[m],h,0,0,this.t+m-u);h.clamp(),h.drShiftTo(1,h)}function ft(s){this.r2=f(),this.q3=f(),l.ONE.dlShiftTo(2*s.t,this.r2),this.mu=this.r2.divide(s),this.m=s}function Or(s){if(s.s<0||s.t>2*this.m.t)return s.mod(this.m);if(s.compareTo(this.m)<0)return s;var u=f();return s.copyTo(u),this.reduce(u),u}function kr(s){return s}function Ir(s){for(s.drShiftTo(this.m.t-1,this.r2),s.t>this.m.t+1&&(s.t=this.m.t+1,s.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);s.compareTo(this.r2)<0;)s.dAddOffset(1,this.m.t+1);for(s.subTo(this.r2,s);s.compareTo(this.m)>=0;)s.subTo(this.m,s)}function Et(s,u){s.squareTo(u),this.reduce(u)}function Dr(s,u,h){s.multiplyTo(u,h),this.reduce(h)}ft.prototype.convert=Or,ft.prototype.revert=kr,ft.prototype.reduce=Ir,ft.prototype.mulTo=Dr,ft.prototype.sqrTo=Et;function qt(s,u){var h=s.bitLength(),m,y=X(1),C;if(h<=0)return y;h<18?m=1:h<48?m=3:h<144?m=4:h<768?m=5:m=6,h<8?C=new De(u):u.isEven()?C=new ft(u):C=new _e(u);var T=new Array,I=3,F=m-1,N=(1<<m)-1;if(T[1]=C.convert(this),m>1){var W=f();for(C.sqrTo(T[1],W);I<=N;)T[I]=f(),C.mulTo(W,T[I-2],T[I]),I+=2}var H=s.t-1,te,le=!0,ie=f(),ge;for(h=ve(s[H])-1;H>=0;){for(h>=F?te=s[H]>>h-F&N:(te=(s[H]&(1<<h+1)-1)<<F-h,H>0&&(te|=s[H-1]>>this.DB+h-F)),I=m;!(te&1);)te>>=1,--I;if((h-=I)<0&&(h+=this.DB,--H),le)T[te].copyTo(y),le=!1;else{for(;I>1;)C.sqrTo(y,ie),C.sqrTo(ie,y),I-=2;I>0?C.sqrTo(y,ie):(ge=y,y=ie,ie=ge),C.mulTo(ie,T[te],y)}for(;H>=0&&!(s[H]&1<<h);)C.sqrTo(y,ie),ge=y,y=ie,ie=ge,--h<0&&(h=this.DB-1,--H)}return C.revert(y)}function We(s){var u=this.s<0?this.negate():this.clone(),h=s.s<0?s.negate():s.clone();if(u.compareTo(h)<0){var m=u;u=h,h=m}var y=u.getLowestSetBit(),C=h.getLowestSetBit();if(C<0)return u;for(y<C&&(C=y),C>0&&(u.rShiftTo(C,u),h.rShiftTo(C,h));u.signum()>0;)(y=u.getLowestSetBit())>0&&u.rShiftTo(y,u),(y=h.getLowestSetBit())>0&&h.rShiftTo(y,h),u.compareTo(h)>=0?(u.subTo(h,u),u.rShiftTo(1,u)):(h.subTo(u,h),h.rShiftTo(1,h));return C>0&&h.lShiftTo(C,h),h}function pt(s){if(s<=0)return 0;var u=this.DV%s,h=this.s<0?s-1:0;if(this.t>0)if(u==0)h=this[0]%s;else for(var m=this.t-1;m>=0;--m)h=(u*h+this[m])%s;return h}function st(s){var u=s.isEven();if(this.isEven()&&u||s.signum()==0)return l.ZERO;for(var h=s.clone(),m=this.clone(),y=X(1),C=X(0),T=X(0),I=X(1);h.signum()!=0;){for(;h.isEven();)h.rShiftTo(1,h),u?((!y.isEven()||!C.isEven())&&(y.addTo(this,y),C.subTo(s,C)),y.rShiftTo(1,y)):C.isEven()||C.subTo(s,C),C.rShiftTo(1,C);for(;m.isEven();)m.rShiftTo(1,m),u?((!T.isEven()||!I.isEven())&&(T.addTo(this,T),I.subTo(s,I)),T.rShiftTo(1,T)):I.isEven()||I.subTo(s,I),I.rShiftTo(1,I);h.compareTo(m)>=0?(h.subTo(m,h),u&&y.subTo(T,y),C.subTo(I,C)):(m.subTo(h,m),u&&T.subTo(y,T),I.subTo(C,I))}if(m.compareTo(l.ONE)!=0)return l.ZERO;if(I.compareTo(s)>=0)return I.subtract(s);if(I.signum()<0)I.addTo(s,I);else return I;return I.signum()<0?I.add(s):I}var Ue=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Lr=(1<<26)/Ue[Ue.length-1];function Fr(s){var u,h=this.abs();if(h.t==1&&h[0]<=Ue[Ue.length-1]){for(u=0;u<Ue.length;++u)if(h[0]==Ue[u])return!0;return!1}if(h.isEven())return!1;for(u=1;u<Ue.length;){for(var m=Ue[u],y=u+1;y<Ue.length&&m<Lr;)m*=Ue[y++];for(m=h.modInt(m);u<y;)if(m%Ue[u++]==0)return!1}return h.millerRabin(s)}function xt(s){var u=this.subtract(l.ONE),h=u.getLowestSetBit();if(h<=0)return!1;var m=u.shiftRight(h);s=s+1>>1,s>Ue.length&&(s=Ue.length);for(var y=f(),C=0;C<s;++C){y.fromInt(Ue[Math.floor(Math.random()*Ue.length)]);var T=y.modPow(m,this);if(T.compareTo(l.ONE)!=0&&T.compareTo(u)!=0){for(var I=1;I++<h&&T.compareTo(u)!=0;)if(T=T.modPowInt(2,this),T.compareTo(l.ONE)==0)return!1;if(T.compareTo(u)!=0)return!1}}return!0}l.prototype.chunkSize=ar,l.prototype.toRadix=ur,l.prototype.fromRadix=cr,l.prototype.fromNumber=fr,l.prototype.bitwiseTo=Ot,l.prototype.changeBit=gr,l.prototype.addTo=_r,l.prototype.dMultiply=S,l.prototype.dAddOffset=Te,l.prototype.multiplyLowerTo=xr,l.prototype.multiplyUpperTo=Ar,l.prototype.modInt=pt,l.prototype.millerRabin=xt,l.prototype.clone=Gt,l.prototype.intValue=Xt,l.prototype.byteValue=Wt,l.prototype.shortValue=Yt,l.prototype.signum=lr,l.prototype.toByteArray=pr,l.prototype.equals=it,l.prototype.min=yt,l.prototype.max=jr,l.prototype.and=nt,l.prototype.or=Vt,l.prototype.xor=Ve,l.prototype.andNot=hr,l.prototype.not=dr,l.prototype.shiftLeft=Ne,l.prototype.shiftRight=Qe,l.prototype.getLowestSetBit=Lt,l.prototype.bitCount=Tt,l.prototype.testBit=mr,l.prototype.setBit=yr,l.prototype.clearBit=Pr,l.prototype.flipBit=Ce,l.prototype.add=et,l.prototype.subtract=ot,l.prototype.multiply=br,l.prototype.divide=Ht,l.prototype.remainder=he,l.prototype.divideAndRemainder=Sr,l.prototype.modPow=qt,l.prototype.modInverse=st,l.prototype.pow=Er,l.prototype.gcd=We,l.prototype.isProbablePrime=Fr,l.prototype.square=wr;var de=l;if(de.prototype.IsNegative=function(){return this.compareTo(de.ZERO)==-1},de.op_Equality=function(s,u){return s.compareTo(u)==0},de.op_Inequality=function(s,u){return s.compareTo(u)!=0},de.op_GreaterThan=function(s,u){return s.compareTo(u)>0},de.op_LessThan=function(s,u){return s.compareTo(u)<0},de.op_Addition=function(s,u){return new de(s).add(new de(u))},de.op_Subtraction=function(s,u){return new de(s).subtract(new de(u))},de.Int128Mul=function(s,u){return new de(s).multiply(new de(u))},de.op_Division=function(s,u){return s.divide(u)},de.prototype.ToDouble=function(){return parseFloat(this.toString())},typeof _t>"u")var _t=function(s,u){var h;if(typeof Object.getOwnPropertyNames>"u"){for(h in u.prototype)(typeof s.prototype[h]>"u"||s.prototype[h]==Object.prototype[h])&&(s.prototype[h]=u.prototype[h]);for(h in u)typeof s[h]>"u"&&(s[h]=u[h]);s.$baseCtor=u}else{for(var m=Object.getOwnPropertyNames(u.prototype),y=0;y<m.length;y++)typeof Object.getOwnPropertyDescriptor(s.prototype,m[y])>"u"&&Object.defineProperty(s.prototype,m[y],Object.getOwnPropertyDescriptor(u.prototype,m[y]));for(h in u)typeof s[h]>"u"&&(s[h]=u[h]);s.$baseCtor=u}};e.Path=function(){return[]},e.Paths=function(){return[]},e.DoublePoint=function(){var s=arguments;this.X=0,this.Y=0,s.length==1?(this.X=s[0].X,this.Y=s[0].Y):s.length==2&&(this.X=s[0],this.Y=s[1])},e.DoublePoint0=function(){this.X=0,this.Y=0},e.DoublePoint1=function(s){this.X=s.X,this.Y=s.Y},e.DoublePoint2=function(s,u){this.X=s,this.Y=u},e.PolyNode=function(){this.m_Parent=null,this.m_polygon=new e.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},e.PolyNode.prototype.IsHoleNode=function(){for(var s=!0,u=this.m_Parent;u!==null;)s=!s,u=u.m_Parent;return s},e.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},e.PolyNode.prototype.Contour=function(){return this.m_polygon},e.PolyNode.prototype.AddChild=function(s){var u=this.m_Childs.length;this.m_Childs.push(s),s.m_Parent=this,s.m_Index=u},e.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},e.PolyNode.prototype.GetNextSiblingUp=function(){return this.m_Parent===null?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},e.PolyNode.prototype.Childs=function(){return this.m_Childs},e.PolyNode.prototype.Parent=function(){return this.m_Parent},e.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},e.PolyTree=function(){this.m_AllPolys=[],e.PolyNode.call(this)},e.PolyTree.prototype.Clear=function(){for(var s=0,u=this.m_AllPolys.length;s<u;s++)this.m_AllPolys[s]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},e.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},e.PolyTree.prototype.Total=function(){return this.m_AllPolys.length},_t(e.PolyTree,e.PolyNode),e.Math_Abs_Int64=e.Math_Abs_Int32=e.Math_Abs_Double=function(s){return Math.abs(s)},e.Math_Max_Int32_Int32=function(s,u){return Math.max(s,u)},o.msie||o.opera||o.safari?e.Cast_Int32=function(s){return s|0}:e.Cast_Int32=function(s){return~~s},o.chrome?e.Cast_Int64=function(s){return s<-2147483648||s>2147483647?s<0?Math.ceil(s):Math.floor(s):~~s}:o.firefox&&typeof Number.toInteger=="function"?e.Cast_Int64=function(s){return Number.toInteger(s)}:o.msie7||o.msie8?e.Cast_Int64=function(s){return parseInt(s,10)}:o.msie?e.Cast_Int64=function(s){return s<-2147483648||s>2147483647?s<0?Math.ceil(s):Math.floor(s):s|0}:e.Cast_Int64=function(s){return s<0?Math.ceil(s):Math.floor(s)},e.Clear=function(s){s.length=0},e.PI=3.141592653589793,e.PI2=2*3.141592653589793,e.IntPoint=function(){var s=arguments,u=s.length;this.X=0,this.Y=0;var h,m;if(u==2)this.X=s[0],this.Y=s[1];else if(u==1)if(s[0]instanceof e.DoublePoint){var h=s[0];this.X=e.Clipper.Round(h.X),this.Y=e.Clipper.Round(h.Y)}else{var m=s[0];this.X=m.X,this.Y=m.Y}else this.X=0,this.Y=0},e.IntPoint.op_Equality=function(s,u){return s.X==u.X&&s.Y==u.Y},e.IntPoint.op_Inequality=function(s,u){return s.X!=u.X||s.Y!=u.Y},e.IntPoint0=function(){this.X=0,this.Y=0},e.IntPoint1=function(s){this.X=s.X,this.Y=s.Y},e.IntPoint1dp=function(s){this.X=e.Clipper.Round(s.X),this.Y=e.Clipper.Round(s.Y)},e.IntPoint2=function(s,u){this.X=s,this.Y=u},e.IntRect=function(){var s=arguments,u=s.length;u==4?(this.left=s[0],this.top=s[1],this.right=s[2],this.bottom=s[3]):u==1?(this.left=ir.left,this.top=ir.top,this.right=ir.right,this.bottom=ir.bottom):(this.left=0,this.top=0,this.right=0,this.bottom=0)},e.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},e.IntRect1=function(s){this.left=s.left,this.top=s.top,this.right=s.right,this.bottom=s.bottom},e.IntRect4=function(s,u,h,m){this.left=s,this.top=u,this.right=h,this.bottom=m},e.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},e.PolyType={ptSubject:0,ptClip:1},e.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},e.JoinType={jtSquare:0,jtRound:1,jtMiter:2},e.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},e.EdgeSide={esLeft:0,esRight:1},e.Direction={dRightToLeft:0,dLeftToRight:1},e.TEdge=function(){this.Bot=new e.IntPoint,this.Curr=new e.IntPoint,this.Top=new e.IntPoint,this.Delta=new e.IntPoint,this.Dx=0,this.PolyTyp=e.PolyType.ptSubject,this.Side=e.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},e.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new e.IntPoint},e.MyIntersectNodeSort=function(){},e.MyIntersectNodeSort.Compare=function(s,u){return u.Pt.Y-s.Pt.Y},e.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},e.Scanbeam=function(){this.Y=0,this.Next=null},e.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},e.OutPt=function(){this.Idx=0,this.Pt=new e.IntPoint,this.Next=null,this.Prev=null},e.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new e.IntPoint},e.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_MinimaList=null,this.m_CurrentLM=null,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},e.ClipperBase.horizontal=-9007199254740992,e.ClipperBase.Skip=-2,e.ClipperBase.Unassigned=-1,e.ClipperBase.tolerance=1e-20,e.ClipperBase.loRange=47453132,e.ClipperBase.hiRange=0xfffffffffffff,e.ClipperBase.near_zero=function(s){return s>-e.ClipperBase.tolerance&&s<e.ClipperBase.tolerance},e.ClipperBase.IsHorizontal=function(s){return s.Delta.Y===0},e.ClipperBase.prototype.PointIsVertex=function(s,u){var h=u;do{if(e.IntPoint.op_Equality(h.Pt,s))return!0;h=h.Next}while(h!=u);return!1},e.ClipperBase.prototype.PointOnLineSegment=function(s,u,h,m){return m?s.X==u.X&&s.Y==u.Y||s.X==h.X&&s.Y==h.Y||s.X>u.X==s.X<h.X&&s.Y>u.Y==s.Y<h.Y&&de.op_Equality(de.Int128Mul(s.X-u.X,h.Y-u.Y),de.Int128Mul(h.X-u.X,s.Y-u.Y)):s.X==u.X&&s.Y==u.Y||s.X==h.X&&s.Y==h.Y||s.X>u.X==s.X<h.X&&s.Y>u.Y==s.Y<h.Y&&(s.X-u.X)*(h.Y-u.Y)==(h.X-u.X)*(s.Y-u.Y)},e.ClipperBase.prototype.PointOnPolygon=function(s,u,h){for(var m=u;;){if(this.PointOnLineSegment(s,m.Pt,m.Next.Pt,h))return!0;if(m=m.Next,m==u)break}return!1},e.ClipperBase.prototype.SlopesEqual=e.ClipperBase.SlopesEqual=function(){var s=arguments,u=s.length,h,m,y,C,T,I,F;return u==3?(h=s[0],m=s[1],F=s[2],F?de.op_Equality(de.Int128Mul(h.Delta.Y,m.Delta.X),de.Int128Mul(h.Delta.X,m.Delta.Y)):e.Cast_Int64(h.Delta.Y*m.Delta.X)==e.Cast_Int64(h.Delta.X*m.Delta.Y)):u==4?(y=s[0],C=s[1],T=s[2],F=s[3],F?de.op_Equality(de.Int128Mul(y.Y-C.Y,C.X-T.X),de.Int128Mul(y.X-C.X,C.Y-T.Y)):e.Cast_Int64((y.Y-C.Y)*(C.X-T.X))-e.Cast_Int64((y.X-C.X)*(C.Y-T.Y))===0):(y=s[0],C=s[1],T=s[2],I=s[3],F=s[4],F?de.op_Equality(de.Int128Mul(y.Y-C.Y,T.X-I.X),de.Int128Mul(y.X-C.X,T.Y-I.Y)):e.Cast_Int64((y.Y-C.Y)*(T.X-I.X))-e.Cast_Int64((y.X-C.X)*(T.Y-I.Y))===0)},e.ClipperBase.SlopesEqual3=function(s,u,h){return h?de.op_Equality(de.Int128Mul(s.Delta.Y,u.Delta.X),de.Int128Mul(s.Delta.X,u.Delta.Y)):e.Cast_Int64(s.Delta.Y*u.Delta.X)==e.Cast_Int64(s.Delta.X*u.Delta.Y)},e.ClipperBase.SlopesEqual4=function(s,u,h,m){return m?de.op_Equality(de.Int128Mul(s.Y-u.Y,u.X-h.X),de.Int128Mul(s.X-u.X,u.Y-h.Y)):e.Cast_Int64((s.Y-u.Y)*(u.X-h.X))-e.Cast_Int64((s.X-u.X)*(u.Y-h.Y))===0},e.ClipperBase.SlopesEqual5=function(s,u,h,m,y){return y?de.op_Equality(de.Int128Mul(s.Y-u.Y,h.X-m.X),de.Int128Mul(s.X-u.X,h.Y-m.Y)):e.Cast_Int64((s.Y-u.Y)*(h.X-m.X))-e.Cast_Int64((s.X-u.X)*(h.Y-m.Y))===0},e.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var s=0,u=this.m_edges.length;s<u;++s){for(var h=0,m=this.m_edges[s].length;h<m;++h)this.m_edges[s][h]=null;e.Clear(this.m_edges[s])}e.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},e.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;this.m_MinimaList!==null;){var s=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=s}this.m_CurrentLM=null},e.ClipperBase.prototype.RangeTest=function(s,u){u.Value?(s.X>e.ClipperBase.hiRange||s.Y>e.ClipperBase.hiRange||-s.X>e.ClipperBase.hiRange||-s.Y>e.ClipperBase.hiRange)&&e.Error("Coordinate outside allowed range in RangeTest()."):(s.X>e.ClipperBase.loRange||s.Y>e.ClipperBase.loRange||-s.X>e.ClipperBase.loRange||-s.Y>e.ClipperBase.loRange)&&(u.Value=!0,this.RangeTest(s,u))},e.ClipperBase.prototype.InitEdge=function(s,u,h,m){s.Next=u,s.Prev=h,s.Curr.X=m.X,s.Curr.Y=m.Y,s.OutIdx=-1},e.ClipperBase.prototype.InitEdge2=function(s,u){s.Curr.Y>=s.Next.Curr.Y?(s.Bot.X=s.Curr.X,s.Bot.Y=s.Curr.Y,s.Top.X=s.Next.Curr.X,s.Top.Y=s.Next.Curr.Y):(s.Top.X=s.Curr.X,s.Top.Y=s.Curr.Y,s.Bot.X=s.Next.Curr.X,s.Bot.Y=s.Next.Curr.Y),this.SetDx(s),s.PolyTyp=u},e.ClipperBase.prototype.FindNextLocMin=function(s){for(var u;;){for(;e.IntPoint.op_Inequality(s.Bot,s.Prev.Bot)||e.IntPoint.op_Equality(s.Curr,s.Top);)s=s.Next;if(s.Dx!=e.ClipperBase.horizontal&&s.Prev.Dx!=e.ClipperBase.horizontal)break;for(;s.Prev.Dx==e.ClipperBase.horizontal;)s=s.Prev;for(u=s;s.Dx==e.ClipperBase.horizontal;)s=s.Next;if(s.Top.Y!=s.Prev.Bot.Y){u.Prev.Bot.X<s.Bot.X&&(s=u);break}}return s},e.ClipperBase.prototype.ProcessBound=function(s,u){var h=s,m=s,y,C;if(s.Dx==e.ClipperBase.horizontal&&(u?C=s.Prev.Bot.X:C=s.Next.Bot.X,s.Bot.X!=C&&this.ReverseHorizontal(s)),m.OutIdx!=e.ClipperBase.Skip)if(u){for(;m.Top.Y==m.Next.Bot.Y&&m.Next.OutIdx!=e.ClipperBase.Skip;)m=m.Next;if(m.Dx==e.ClipperBase.horizontal&&m.Next.OutIdx!=e.ClipperBase.Skip){for(y=m;y.Prev.Dx==e.ClipperBase.horizontal;)y=y.Prev;y.Prev.Top.X==m.Next.Top.X?u||(m=y.Prev):y.Prev.Top.X>m.Next.Top.X&&(m=y.Prev)}for(;s!=m;)s.NextInLML=s.Next,s.Dx==e.ClipperBase.horizontal&&s!=h&&s.Bot.X!=s.Prev.Top.X&&this.ReverseHorizontal(s),s=s.Next;s.Dx==e.ClipperBase.horizontal&&s!=h&&s.Bot.X!=s.Prev.Top.X&&this.ReverseHorizontal(s),m=m.Next}else{for(;m.Top.Y==m.Prev.Bot.Y&&m.Prev.OutIdx!=e.ClipperBase.Skip;)m=m.Prev;if(m.Dx==e.ClipperBase.horizontal&&m.Prev.OutIdx!=e.ClipperBase.Skip){for(y=m;y.Next.Dx==e.ClipperBase.horizontal;)y=y.Next;y.Next.Top.X==m.Prev.Top.X?u||(m=y.Next):y.Next.Top.X>m.Prev.Top.X&&(m=y.Next)}for(;s!=m;)s.NextInLML=s.Prev,s.Dx==e.ClipperBase.horizontal&&s!=h&&s.Bot.X!=s.Next.Top.X&&this.ReverseHorizontal(s),s=s.Prev;s.Dx==e.ClipperBase.horizontal&&s!=h&&s.Bot.X!=s.Next.Top.X&&this.ReverseHorizontal(s),m=m.Prev}if(m.OutIdx==e.ClipperBase.Skip){if(s=m,u){for(;s.Top.Y==s.Next.Bot.Y;)s=s.Next;for(;s!=m&&s.Dx==e.ClipperBase.horizontal;)s=s.Prev}else{for(;s.Top.Y==s.Prev.Bot.Y;)s=s.Prev;for(;s!=m&&s.Dx==e.ClipperBase.horizontal;)s=s.Next}if(s==m)u?m=s.Next:m=s.Prev;else{u?s=m.Next:s=m.Prev;var T=new e.LocalMinima;T.Next=null,T.Y=s.Bot.Y,T.LeftBound=null,T.RightBound=s,T.RightBound.WindDelta=0,m=this.ProcessBound(T.RightBound,u),this.InsertLocalMinima(T)}}return m},e.ClipperBase.prototype.AddPath=function(s,u,h){!h&&u==e.PolyType.ptClip&&e.Error("AddPath: Open paths must be subject.");var m=s.length-1;if(h)for(;m>0&&e.IntPoint.op_Equality(s[m],s[0]);)--m;for(;m>0&&e.IntPoint.op_Equality(s[m],s[m-1]);)--m;if(h&&m<2||!h&&m<1)return!1;for(var y=new Array,C=0;C<=m;C++)y.push(new e.TEdge);var T=!0;y[1].Curr.X=s[1].X,y[1].Curr.Y=s[1].Y;var I={Value:this.m_UseFullRange};this.RangeTest(s[0],I),this.m_UseFullRange=I.Value,I.Value=this.m_UseFullRange,this.RangeTest(s[m],I),this.m_UseFullRange=I.Value,this.InitEdge(y[0],y[1],y[m],s[0]),this.InitEdge(y[m],y[0],y[m-1],s[m]);for(var C=m-1;C>=1;--C)I.Value=this.m_UseFullRange,this.RangeTest(s[C],I),this.m_UseFullRange=I.Value,this.InitEdge(y[C],y[C+1],y[C-1],s[C]);for(var F=y[0],N=F,W=F;;){if(e.IntPoint.op_Equality(N.Curr,N.Next.Curr)){if(N==N.Next)break;N==F&&(F=N.Next),N=this.RemoveEdge(N),W=N;continue}if(N.Prev==N.Next)break;if(h&&e.ClipperBase.SlopesEqual(N.Prev.Curr,N.Curr,N.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(N.Prev.Curr,N.Curr,N.Next.Curr))){N==F&&(F=N.Next),N=this.RemoveEdge(N),N=N.Prev,W=N;continue}if(N=N.Next,N==W)break}if(!h&&N==N.Next||h&&N.Prev==N.Next)return!1;h||(this.m_HasOpenPaths=!0,F.Prev.OutIdx=e.ClipperBase.Skip),N=F;do this.InitEdge2(N,u),N=N.Next,T&&N.Curr.Y!=F.Curr.Y&&(T=!1);while(N!=F);if(T){if(h)return!1;N.Prev.OutIdx=e.ClipperBase.Skip,N.Prev.Bot.X<N.Prev.Top.X&&this.ReverseHorizontal(N.Prev);var H=new e.LocalMinima;for(H.Next=null,H.Y=N.Bot.Y,H.LeftBound=null,H.RightBound=N,H.RightBound.Side=e.EdgeSide.esRight,H.RightBound.WindDelta=0;N.Next.OutIdx!=e.ClipperBase.Skip;)N.NextInLML=N.Next,N.Bot.X!=N.Prev.Top.X&&this.ReverseHorizontal(N),N=N.Next;return this.InsertLocalMinima(H),this.m_edges.push(y),!0}this.m_edges.push(y);for(var te,le=null;N=this.FindNextLocMin(N),N!=le;){le==null&&(le=N);var H=new e.LocalMinima;H.Next=null,H.Y=N.Bot.Y,N.Dx<N.Prev.Dx?(H.LeftBound=N.Prev,H.RightBound=N,te=!1):(H.LeftBound=N,H.RightBound=N.Prev,te=!0),H.LeftBound.Side=e.EdgeSide.esLeft,H.RightBound.Side=e.EdgeSide.esRight,h?H.LeftBound.Next==H.RightBound?H.LeftBound.WindDelta=-1:H.LeftBound.WindDelta=1:H.LeftBound.WindDelta=0,H.RightBound.WindDelta=-H.LeftBound.WindDelta,N=this.ProcessBound(H.LeftBound,te);var ie=this.ProcessBound(H.RightBound,!te);H.LeftBound.OutIdx==e.ClipperBase.Skip?H.LeftBound=null:H.RightBound.OutIdx==e.ClipperBase.Skip&&(H.RightBound=null),this.InsertLocalMinima(H),te||(N=ie)}return!0},e.ClipperBase.prototype.AddPaths=function(s,u,h){for(var m=!1,y=0,C=s.length;y<C;++y)this.AddPath(s[y],u,h)&&(m=!0);return m},e.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(s,u,h){return e.IntPoint.op_Equality(s,h)||e.IntPoint.op_Equality(s,u)||e.IntPoint.op_Equality(h,u)?!1:s.X!=h.X?u.X>s.X==u.X<h.X:u.Y>s.Y==u.Y<h.Y},e.ClipperBase.prototype.RemoveEdge=function(s){s.Prev.Next=s.Next,s.Next.Prev=s.Prev;var u=s.Next;return s.Prev=null,u},e.ClipperBase.prototype.SetDx=function(s){s.Delta.X=s.Top.X-s.Bot.X,s.Delta.Y=s.Top.Y-s.Bot.Y,s.Delta.Y===0?s.Dx=e.ClipperBase.horizontal:s.Dx=s.Delta.X/s.Delta.Y},e.ClipperBase.prototype.InsertLocalMinima=function(s){if(this.m_MinimaList===null)this.m_MinimaList=s;else if(s.Y>=this.m_MinimaList.Y)s.Next=this.m_MinimaList,this.m_MinimaList=s;else{for(var u=this.m_MinimaList;u.Next!==null&&s.Y<u.Next.Y;)u=u.Next;s.Next=u.Next,u.Next=s}},e.ClipperBase.prototype.PopLocalMinima=function(){this.m_CurrentLM!==null&&(this.m_CurrentLM=this.m_CurrentLM.Next)},e.ClipperBase.prototype.ReverseHorizontal=function(s){var u=s.Top.X;s.Top.X=s.Bot.X,s.Bot.X=u},e.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,this.m_CurrentLM!=null)for(var s=this.m_MinimaList;s!=null;){var u=s.LeftBound;u!=null&&(u.Curr.X=u.Bot.X,u.Curr.Y=u.Bot.Y,u.Side=e.EdgeSide.esLeft,u.OutIdx=e.ClipperBase.Unassigned),u=s.RightBound,u!=null&&(u.Curr.X=u.Bot.X,u.Curr.Y=u.Bot.Y,u.Side=e.EdgeSide.esRight,u.OutIdx=e.ClipperBase.Unassigned),s=s.Next}},e.Clipper=function(s){typeof s>"u"&&(s=0),this.m_PolyOuts=null,this.m_ClipType=e.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=e.PolyFillType.pftEvenOdd,this.m_SubjFillType=e.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,e.ClipperBase.call(this),this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=e.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=(1&s)!==0,this.StrictlySimple=(2&s)!==0,this.PreserveCollinear=(4&s)!==0},e.Clipper.ioReverseSolution=1,e.Clipper.ioStrictlySimple=2,e.Clipper.ioPreserveCollinear=4,e.Clipper.prototype.Clear=function(){this.m_edges.length!==0&&(this.DisposeAllPolyPts(),e.ClipperBase.prototype.Clear.call(this))},e.Clipper.prototype.DisposeScanbeamList=function(){for(;this.m_Scanbeam!==null;){var s=this.m_Scanbeam.Next;this.m_Scanbeam=null,this.m_Scanbeam=s}},e.Clipper.prototype.Reset=function(){e.ClipperBase.prototype.Reset.call(this),this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null;for(var s=this.m_MinimaList;s!==null;)this.InsertScanbeam(s.Y),s=s.Next},e.Clipper.prototype.InsertScanbeam=function(s){if(this.m_Scanbeam===null)this.m_Scanbeam=new e.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=s;else if(s>this.m_Scanbeam.Y){var u=new e.Scanbeam;u.Y=s,u.Next=this.m_Scanbeam,this.m_Scanbeam=u}else{for(var h=this.m_Scanbeam;h.Next!==null&&s<=h.Next.Y;)h=h.Next;if(s==h.Y)return;var u=new e.Scanbeam;u.Y=s,u.Next=h.Next,h.Next=u}},e.Clipper.prototype.Execute=function(){var s=arguments,u=s.length,h=s[1]instanceof e.PolyTree;if(u==4&&!h){var m=s[0],y=s[1],C=s[2],T=s[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&e.Error("Error: PolyTree struct is need for open path clipping."),this.m_ExecuteLocked=!0,e.Clear(y),this.m_SubjFillType=C,this.m_ClipFillType=T,this.m_ClipType=m,this.m_UsingPolyTree=!1;try{var I=this.ExecuteInternal();I&&this.BuildResult(y)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return I}else if(u==4&&h){var m=s[0],F=s[1],C=s[2],T=s[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=C,this.m_ClipFillType=T,this.m_ClipType=m,this.m_UsingPolyTree=!0;try{var I=this.ExecuteInternal();I&&this.BuildResult2(F)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return I}else if(u==2&&!h){var m=s[0],y=s[1];return this.Execute(m,y,e.PolyFillType.pftEvenOdd,e.PolyFillType.pftEvenOdd)}else if(u==2&&h){var m=s[0],F=s[1];return this.Execute(m,F,e.PolyFillType.pftEvenOdd,e.PolyFillType.pftEvenOdd)}},e.Clipper.prototype.FixHoleLinkage=function(s){if(!(s.FirstLeft===null||s.IsHole!=s.FirstLeft.IsHole&&s.FirstLeft.Pts!==null)){for(var u=s.FirstLeft;u!==null&&(u.IsHole==s.IsHole||u.Pts===null);)u=u.FirstLeft;s.FirstLeft=u}},e.Clipper.prototype.ExecuteInternal=function(){try{if(this.Reset(),this.m_CurrentLM===null)return!1;var s=this.PopScanbeam();do{if(this.InsertLocalMinimaIntoAEL(s),e.Clear(this.m_GhostJoins),this.ProcessHorizontals(!1),this.m_Scanbeam===null)break;var u=this.PopScanbeam();if(!this.ProcessIntersections(s,u))return!1;this.ProcessEdgesAtTopOfScanbeam(u),s=u}while(this.m_Scanbeam!==null||this.m_CurrentLM!==null);for(var h=0,m=this.m_PolyOuts.length;h<m;h++){var y=this.m_PolyOuts[h];y.Pts===null||y.IsOpen||(y.IsHole^this.ReverseSolution)==this.Area(y)>0&&this.ReversePolyPtLinks(y.Pts)}this.JoinCommonEdges();for(var h=0,m=this.m_PolyOuts.length;h<m;h++){var y=this.m_PolyOuts[h];y.Pts!==null&&!y.IsOpen&&this.FixupOutPolygon(y)}return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{e.Clear(this.m_Joins),e.Clear(this.m_GhostJoins)}},e.Clipper.prototype.PopScanbeam=function(){var s=this.m_Scanbeam.Y;return this.m_Scanbeam,this.m_Scanbeam=this.m_Scanbeam.Next,s},e.Clipper.prototype.DisposeAllPolyPts=function(){for(var s=0,u=this.m_PolyOuts.length;s<u;++s)this.DisposeOutRec(s);e.Clear(this.m_PolyOuts)},e.Clipper.prototype.DisposeOutRec=function(s){var u=this.m_PolyOuts[s];u.Pts!==null&&this.DisposeOutPts(u.Pts),u=null,this.m_PolyOuts[s]=null},e.Clipper.prototype.DisposeOutPts=function(s){if(s!==null)for(s.Prev.Next=null;s!==null;)s=s.Next},e.Clipper.prototype.AddJoin=function(s,u,h){var m=new e.Join;m.OutPt1=s,m.OutPt2=u,m.OffPt.X=h.X,m.OffPt.Y=h.Y,this.m_Joins.push(m)},e.Clipper.prototype.AddGhostJoin=function(s,u){var h=new e.Join;h.OutPt1=s,h.OffPt.X=u.X,h.OffPt.Y=u.Y,this.m_GhostJoins.push(h)},e.Clipper.prototype.InsertLocalMinimaIntoAEL=function(s){for(;this.m_CurrentLM!==null&&this.m_CurrentLM.Y==s;){var u=this.m_CurrentLM.LeftBound,h=this.m_CurrentLM.RightBound;this.PopLocalMinima();var m=null;if(u===null?(this.InsertEdgeIntoAEL(h,null),this.SetWindingCount(h),this.IsContributing(h)&&(m=this.AddOutPt(h,h.Bot))):h==null?(this.InsertEdgeIntoAEL(u,null),this.SetWindingCount(u),this.IsContributing(u)&&(m=this.AddOutPt(u,u.Bot)),this.InsertScanbeam(u.Top.Y)):(this.InsertEdgeIntoAEL(u,null),this.InsertEdgeIntoAEL(h,u),this.SetWindingCount(u),h.WindCnt=u.WindCnt,h.WindCnt2=u.WindCnt2,this.IsContributing(u)&&(m=this.AddLocalMinPoly(u,h,u.Bot)),this.InsertScanbeam(u.Top.Y)),h!=null&&(e.ClipperBase.IsHorizontal(h)?this.AddEdgeToSEL(h):this.InsertScanbeam(h.Top.Y)),!(u==null||h==null)){if(m!==null&&e.ClipperBase.IsHorizontal(h)&&this.m_GhostJoins.length>0&&h.WindDelta!==0)for(var y=0,C=this.m_GhostJoins.length;y<C;y++){var T=this.m_GhostJoins[y];this.HorzSegmentsOverlap(T.OutPt1.Pt,T.OffPt,h.Bot,h.Top)&&this.AddJoin(T.OutPt1,m,T.OffPt)}if(u.OutIdx>=0&&u.PrevInAEL!==null&&u.PrevInAEL.Curr.X==u.Bot.X&&u.PrevInAEL.OutIdx>=0&&e.ClipperBase.SlopesEqual(u.PrevInAEL,u,this.m_UseFullRange)&&u.WindDelta!==0&&u.PrevInAEL.WindDelta!==0){var I=this.AddOutPt(u.PrevInAEL,u.Bot);this.AddJoin(m,I,u.Top)}if(u.NextInAEL!=h){if(h.OutIdx>=0&&h.PrevInAEL.OutIdx>=0&&e.ClipperBase.SlopesEqual(h.PrevInAEL,h,this.m_UseFullRange)&&h.WindDelta!==0&&h.PrevInAEL.WindDelta!==0){var I=this.AddOutPt(h.PrevInAEL,h.Bot);this.AddJoin(m,I,h.Top)}var F=u.NextInAEL;if(F!==null)for(;F!=h;)this.IntersectEdges(h,F,u.Curr,!1),F=F.NextInAEL}}}},e.Clipper.prototype.InsertEdgeIntoAEL=function(s,u){if(this.m_ActiveEdges===null)s.PrevInAEL=null,s.NextInAEL=null,this.m_ActiveEdges=s;else if(u===null&&this.E2InsertsBeforeE1(this.m_ActiveEdges,s))s.PrevInAEL=null,s.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=s,this.m_ActiveEdges=s;else{for(u===null&&(u=this.m_ActiveEdges);u.NextInAEL!==null&&!this.E2InsertsBeforeE1(u.NextInAEL,s);)u=u.NextInAEL;s.NextInAEL=u.NextInAEL,u.NextInAEL!==null&&(u.NextInAEL.PrevInAEL=s),s.PrevInAEL=u,u.NextInAEL=s}},e.Clipper.prototype.E2InsertsBeforeE1=function(s,u){return u.Curr.X==s.Curr.X?u.Top.Y>s.Top.Y?u.Top.X<e.Clipper.TopX(s,u.Top.Y):s.Top.X>e.Clipper.TopX(u,s.Top.Y):u.Curr.X<s.Curr.X},e.Clipper.prototype.IsEvenOddFillType=function(s){return s.PolyTyp==e.PolyType.ptSubject?this.m_SubjFillType==e.PolyFillType.pftEvenOdd:this.m_ClipFillType==e.PolyFillType.pftEvenOdd},e.Clipper.prototype.IsEvenOddAltFillType=function(s){return s.PolyTyp==e.PolyType.ptSubject?this.m_ClipFillType==e.PolyFillType.pftEvenOdd:this.m_SubjFillType==e.PolyFillType.pftEvenOdd},e.Clipper.prototype.IsContributing=function(s){var u,h;switch(s.PolyTyp==e.PolyType.ptSubject?(u=this.m_SubjFillType,h=this.m_ClipFillType):(u=this.m_ClipFillType,h=this.m_SubjFillType),u){case e.PolyFillType.pftEvenOdd:if(s.WindDelta===0&&s.WindCnt!=1)return!1;break;case e.PolyFillType.pftNonZero:if(Math.abs(s.WindCnt)!=1)return!1;break;case e.PolyFillType.pftPositive:if(s.WindCnt!=1)return!1;break;default:if(s.WindCnt!=-1)return!1;break}switch(this.m_ClipType){case e.ClipType.ctIntersection:switch(h){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return s.WindCnt2!==0;case e.PolyFillType.pftPositive:return s.WindCnt2>0;default:return s.WindCnt2<0}case e.ClipType.ctUnion:switch(h){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return s.WindCnt2===0;case e.PolyFillType.pftPositive:return s.WindCnt2<=0;default:return s.WindCnt2>=0}case e.ClipType.ctDifference:if(s.PolyTyp==e.PolyType.ptSubject)switch(h){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return s.WindCnt2===0;case e.PolyFillType.pftPositive:return s.WindCnt2<=0;default:return s.WindCnt2>=0}else switch(h){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return s.WindCnt2!==0;case e.PolyFillType.pftPositive:return s.WindCnt2>0;default:return s.WindCnt2<0}case e.ClipType.ctXor:if(s.WindDelta===0)switch(h){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return s.WindCnt2===0;case e.PolyFillType.pftPositive:return s.WindCnt2<=0;default:return s.WindCnt2>=0}else return!0}return!0},e.Clipper.prototype.SetWindingCount=function(s){for(var u=s.PrevInAEL;u!==null&&(u.PolyTyp!=s.PolyTyp||u.WindDelta===0);)u=u.PrevInAEL;if(u===null)s.WindCnt=s.WindDelta===0?1:s.WindDelta,s.WindCnt2=0,u=this.m_ActiveEdges;else if(s.WindDelta===0&&this.m_ClipType!=e.ClipType.ctUnion)s.WindCnt=1,s.WindCnt2=u.WindCnt2,u=u.NextInAEL;else if(this.IsEvenOddFillType(s)){if(s.WindDelta===0){for(var h=!0,m=u.PrevInAEL;m!==null;)m.PolyTyp==u.PolyTyp&&m.WindDelta!==0&&(h=!h),m=m.PrevInAEL;s.WindCnt=h?0:1}else s.WindCnt=s.WindDelta;s.WindCnt2=u.WindCnt2,u=u.NextInAEL}else u.WindCnt*u.WindDelta<0?Math.abs(u.WindCnt)>1?u.WindDelta*s.WindDelta<0?s.WindCnt=u.WindCnt:s.WindCnt=u.WindCnt+s.WindDelta:s.WindCnt=s.WindDelta===0?1:s.WindDelta:s.WindDelta===0?s.WindCnt=u.WindCnt<0?u.WindCnt-1:u.WindCnt+1:u.WindDelta*s.WindDelta<0?s.WindCnt=u.WindCnt:s.WindCnt=u.WindCnt+s.WindDelta,s.WindCnt2=u.WindCnt2,u=u.NextInAEL;if(this.IsEvenOddAltFillType(s))for(;u!=s;)u.WindDelta!==0&&(s.WindCnt2=s.WindCnt2===0?1:0),u=u.NextInAEL;else for(;u!=s;)s.WindCnt2+=u.WindDelta,u=u.NextInAEL},e.Clipper.prototype.AddEdgeToSEL=function(s){this.m_SortedEdges===null?(this.m_SortedEdges=s,s.PrevInSEL=null,s.NextInSEL=null):(s.NextInSEL=this.m_SortedEdges,s.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=s,this.m_SortedEdges=s)},e.Clipper.prototype.CopyAELToSEL=function(){var s=this.m_ActiveEdges;for(this.m_SortedEdges=s;s!==null;)s.PrevInSEL=s.PrevInAEL,s.NextInSEL=s.NextInAEL,s=s.NextInAEL},e.Clipper.prototype.SwapPositionsInAEL=function(s,u){if(!(s.NextInAEL==s.PrevInAEL||u.NextInAEL==u.PrevInAEL)){if(s.NextInAEL==u){var h=u.NextInAEL;h!==null&&(h.PrevInAEL=s);var m=s.PrevInAEL;m!==null&&(m.NextInAEL=u),u.PrevInAEL=m,u.NextInAEL=s,s.PrevInAEL=u,s.NextInAEL=h}else if(u.NextInAEL==s){var h=s.NextInAEL;h!==null&&(h.PrevInAEL=u);var m=u.PrevInAEL;m!==null&&(m.NextInAEL=s),s.PrevInAEL=m,s.NextInAEL=u,u.PrevInAEL=s,u.NextInAEL=h}else{var h=s.NextInAEL,m=s.PrevInAEL;s.NextInAEL=u.NextInAEL,s.NextInAEL!==null&&(s.NextInAEL.PrevInAEL=s),s.PrevInAEL=u.PrevInAEL,s.PrevInAEL!==null&&(s.PrevInAEL.NextInAEL=s),u.NextInAEL=h,u.NextInAEL!==null&&(u.NextInAEL.PrevInAEL=u),u.PrevInAEL=m,u.PrevInAEL!==null&&(u.PrevInAEL.NextInAEL=u)}s.PrevInAEL===null?this.m_ActiveEdges=s:u.PrevInAEL===null&&(this.m_ActiveEdges=u)}},e.Clipper.prototype.SwapPositionsInSEL=function(s,u){if(!(s.NextInSEL===null&&s.PrevInSEL===null)&&!(u.NextInSEL===null&&u.PrevInSEL===null)){if(s.NextInSEL==u){var h=u.NextInSEL;h!==null&&(h.PrevInSEL=s);var m=s.PrevInSEL;m!==null&&(m.NextInSEL=u),u.PrevInSEL=m,u.NextInSEL=s,s.PrevInSEL=u,s.NextInSEL=h}else if(u.NextInSEL==s){var h=s.NextInSEL;h!==null&&(h.PrevInSEL=u);var m=u.PrevInSEL;m!==null&&(m.NextInSEL=s),s.PrevInSEL=m,s.NextInSEL=u,u.PrevInSEL=s,u.NextInSEL=h}else{var h=s.NextInSEL,m=s.PrevInSEL;s.NextInSEL=u.NextInSEL,s.NextInSEL!==null&&(s.NextInSEL.PrevInSEL=s),s.PrevInSEL=u.PrevInSEL,s.PrevInSEL!==null&&(s.PrevInSEL.NextInSEL=s),u.NextInSEL=h,u.NextInSEL!==null&&(u.NextInSEL.PrevInSEL=u),u.PrevInSEL=m,u.PrevInSEL!==null&&(u.PrevInSEL.NextInSEL=u)}s.PrevInSEL===null?this.m_SortedEdges=s:u.PrevInSEL===null&&(this.m_SortedEdges=u)}},e.Clipper.prototype.AddLocalMaxPoly=function(s,u,h){this.AddOutPt(s,h),u.WindDelta==0&&this.AddOutPt(u,h),s.OutIdx==u.OutIdx?(s.OutIdx=-1,u.OutIdx=-1):s.OutIdx<u.OutIdx?this.AppendPolygon(s,u):this.AppendPolygon(u,s)},e.Clipper.prototype.AddLocalMinPoly=function(s,u,h){var m,y,C;if(e.ClipperBase.IsHorizontal(u)||s.Dx>u.Dx?(m=this.AddOutPt(s,h),u.OutIdx=s.OutIdx,s.Side=e.EdgeSide.esLeft,u.Side=e.EdgeSide.esRight,y=s,y.PrevInAEL==u?C=u.PrevInAEL:C=y.PrevInAEL):(m=this.AddOutPt(u,h),s.OutIdx=u.OutIdx,s.Side=e.EdgeSide.esRight,u.Side=e.EdgeSide.esLeft,y=u,y.PrevInAEL==s?C=s.PrevInAEL:C=y.PrevInAEL),C!==null&&C.OutIdx>=0&&e.Clipper.TopX(C,h.Y)==e.Clipper.TopX(y,h.Y)&&e.ClipperBase.SlopesEqual(y,C,this.m_UseFullRange)&&y.WindDelta!==0&&C.WindDelta!==0){var T=this.AddOutPt(C,h);this.AddJoin(m,T,y.Top)}return m},e.Clipper.prototype.CreateOutRec=function(){var s=new e.OutRec;return s.Idx=-1,s.IsHole=!1,s.IsOpen=!1,s.FirstLeft=null,s.Pts=null,s.BottomPt=null,s.PolyNode=null,this.m_PolyOuts.push(s),s.Idx=this.m_PolyOuts.length-1,s},e.Clipper.prototype.AddOutPt=function(s,u){var h=s.Side==e.EdgeSide.esLeft;if(s.OutIdx<0){var m=this.CreateOutRec();m.IsOpen=s.WindDelta===0;var y=new e.OutPt;return m.Pts=y,y.Idx=m.Idx,y.Pt.X=u.X,y.Pt.Y=u.Y,y.Next=y,y.Prev=y,m.IsOpen||this.SetHoleState(s,m),s.OutIdx=m.Idx,y}else{var m=this.m_PolyOuts[s.OutIdx],C=m.Pts;if(h&&e.IntPoint.op_Equality(u,C.Pt))return C;if(!h&&e.IntPoint.op_Equality(u,C.Prev.Pt))return C.Prev;var y=new e.OutPt;return y.Idx=m.Idx,y.Pt.X=u.X,y.Pt.Y=u.Y,y.Next=C,y.Prev=C.Prev,y.Prev.Next=y,C.Prev=y,h&&(m.Pts=y),y}},e.Clipper.prototype.SwapPoints=function(s,u){var h=new e.IntPoint(s.Value);s.Value.X=u.Value.X,s.Value.Y=u.Value.Y,u.Value.X=h.X,u.Value.Y=h.Y},e.Clipper.prototype.HorzSegmentsOverlap=function(s,u,h,m){return s.X>h.X==s.X<m.X||u.X>h.X==u.X<m.X||h.X>s.X==h.X<u.X||m.X>s.X==m.X<u.X||s.X==h.X&&u.X==m.X?!0:s.X==m.X&&u.X==h.X},e.Clipper.prototype.InsertPolyPtBetween=function(s,u,h){var m=new e.OutPt;return m.Pt.X=h.X,m.Pt.Y=h.Y,u==s.Next?(s.Next=m,u.Prev=m,m.Next=u,m.Prev=s):(u.Next=m,s.Prev=m,m.Next=s,m.Prev=u),m},e.Clipper.prototype.SetHoleState=function(s,u){for(var h=!1,m=s.PrevInAEL;m!==null;)m.OutIdx>=0&&m.WindDelta!=0&&(h=!h,u.FirstLeft===null&&(u.FirstLeft=this.m_PolyOuts[m.OutIdx])),m=m.PrevInAEL;h&&(u.IsHole=!0)},e.Clipper.prototype.GetDx=function(s,u){return s.Y==u.Y?e.ClipperBase.horizontal:(u.X-s.X)/(u.Y-s.Y)},e.Clipper.prototype.FirstIsBottomPt=function(s,u){for(var h=s.Prev;e.IntPoint.op_Equality(h.Pt,s.Pt)&&h!=s;)h=h.Prev;var m=Math.abs(this.GetDx(s.Pt,h.Pt));for(h=s.Next;e.IntPoint.op_Equality(h.Pt,s.Pt)&&h!=s;)h=h.Next;var y=Math.abs(this.GetDx(s.Pt,h.Pt));for(h=u.Prev;e.IntPoint.op_Equality(h.Pt,u.Pt)&&h!=u;)h=h.Prev;var C=Math.abs(this.GetDx(u.Pt,h.Pt));for(h=u.Next;e.IntPoint.op_Equality(h.Pt,u.Pt)&&h!=u;)h=h.Next;var T=Math.abs(this.GetDx(u.Pt,h.Pt));return m>=C&&m>=T||y>=C&&y>=T},e.Clipper.prototype.GetBottomPt=function(s){for(var u=null,h=s.Next;h!=s;)h.Pt.Y>s.Pt.Y?(s=h,u=null):h.Pt.Y==s.Pt.Y&&h.Pt.X<=s.Pt.X&&(h.Pt.X<s.Pt.X?(u=null,s=h):h.Next!=s&&h.Prev!=s&&(u=h)),h=h.Next;if(u!==null)for(;u!=h;)for(this.FirstIsBottomPt(h,u)||(s=u),u=u.Next;e.IntPoint.op_Inequality(u.Pt,s.Pt);)u=u.Next;return s},e.Clipper.prototype.GetLowermostRec=function(s,u){s.BottomPt===null&&(s.BottomPt=this.GetBottomPt(s.Pts)),u.BottomPt===null&&(u.BottomPt=this.GetBottomPt(u.Pts));var h=s.BottomPt,m=u.BottomPt;return h.Pt.Y>m.Pt.Y?s:h.Pt.Y<m.Pt.Y?u:h.Pt.X<m.Pt.X?s:h.Pt.X>m.Pt.X||h.Next==h?u:m.Next==m||this.FirstIsBottomPt(h,m)?s:u},e.Clipper.prototype.Param1RightOfParam2=function(s,u){do if(s=s.FirstLeft,s==u)return!0;while(s!==null);return!1},e.Clipper.prototype.GetOutRec=function(s){for(var u=this.m_PolyOuts[s];u!=this.m_PolyOuts[u.Idx];)u=this.m_PolyOuts[u.Idx];return u},e.Clipper.prototype.AppendPolygon=function(s,u){var h=this.m_PolyOuts[s.OutIdx],m=this.m_PolyOuts[u.OutIdx],y;this.Param1RightOfParam2(h,m)?y=m:this.Param1RightOfParam2(m,h)?y=h:y=this.GetLowermostRec(h,m);var C=h.Pts,T=C.Prev,I=m.Pts,F=I.Prev,N;s.Side==e.EdgeSide.esLeft?(u.Side==e.EdgeSide.esLeft?(this.ReversePolyPtLinks(I),I.Next=C,C.Prev=I,T.Next=F,F.Prev=T,h.Pts=F):(F.Next=C,C.Prev=F,I.Prev=T,T.Next=I,h.Pts=I),N=e.EdgeSide.esLeft):(u.Side==e.EdgeSide.esRight?(this.ReversePolyPtLinks(I),T.Next=F,F.Prev=T,I.Next=C,C.Prev=I):(T.Next=I,I.Prev=T,C.Prev=F,F.Next=C),N=e.EdgeSide.esRight),h.BottomPt=null,y==m&&(m.FirstLeft!=h&&(h.FirstLeft=m.FirstLeft),h.IsHole=m.IsHole),m.Pts=null,m.BottomPt=null,m.FirstLeft=h;var W=s.OutIdx,H=u.OutIdx;s.OutIdx=-1,u.OutIdx=-1;for(var te=this.m_ActiveEdges;te!==null;){if(te.OutIdx==H){te.OutIdx=W,te.Side=N;break}te=te.NextInAEL}m.Idx=h.Idx},e.Clipper.prototype.ReversePolyPtLinks=function(s){if(s!==null){var u,h;u=s;do h=u.Next,u.Next=u.Prev,u.Prev=h,u=h;while(u!=s)}},e.Clipper.SwapSides=function(s,u){var h=s.Side;s.Side=u.Side,u.Side=h},e.Clipper.SwapPolyIndexes=function(s,u){var h=s.OutIdx;s.OutIdx=u.OutIdx,u.OutIdx=h},e.Clipper.prototype.IntersectEdges=function(s,u,h,m){var y=!m&&s.NextInLML===null&&s.Top.X==h.X&&s.Top.Y==h.Y,C=!m&&u.NextInLML===null&&u.Top.X==h.X&&u.Top.Y==h.Y,T=s.OutIdx>=0,I=u.OutIdx>=0;if(s.WindDelta===0||u.WindDelta===0){s.WindDelta===0&&u.WindDelta===0?(y||C)&&T&&I&&this.AddLocalMaxPoly(s,u,h):s.PolyTyp==u.PolyTyp&&s.WindDelta!=u.WindDelta&&this.m_ClipType==e.ClipType.ctUnion?s.WindDelta===0?I&&(this.AddOutPt(s,h),T&&(s.OutIdx=-1)):T&&(this.AddOutPt(u,h),I&&(u.OutIdx=-1)):s.PolyTyp!=u.PolyTyp&&(s.WindDelta===0&&Math.abs(u.WindCnt)==1&&(this.m_ClipType!=e.ClipType.ctUnion||u.WindCnt2===0)?(this.AddOutPt(s,h),T&&(s.OutIdx=-1)):u.WindDelta===0&&Math.abs(s.WindCnt)==1&&(this.m_ClipType!=e.ClipType.ctUnion||s.WindCnt2===0)&&(this.AddOutPt(u,h),I&&(u.OutIdx=-1))),y&&(s.OutIdx<0?this.DeleteFromAEL(s):e.Error("Error intersecting polylines")),C&&(u.OutIdx<0?this.DeleteFromAEL(u):e.Error("Error intersecting polylines"));return}if(s.PolyTyp==u.PolyTyp)if(this.IsEvenOddFillType(s)){var F=s.WindCnt;s.WindCnt=u.WindCnt,u.WindCnt=F}else s.WindCnt+u.WindDelta===0?s.WindCnt=-s.WindCnt:s.WindCnt+=u.WindDelta,u.WindCnt-s.WindDelta===0?u.WindCnt=-u.WindCnt:u.WindCnt-=s.WindDelta;else this.IsEvenOddFillType(u)?s.WindCnt2=s.WindCnt2===0?1:0:s.WindCnt2+=u.WindDelta,this.IsEvenOddFillType(s)?u.WindCnt2=u.WindCnt2===0?1:0:u.WindCnt2-=s.WindDelta;var N,W,H,te;s.PolyTyp==e.PolyType.ptSubject?(N=this.m_SubjFillType,H=this.m_ClipFillType):(N=this.m_ClipFillType,H=this.m_SubjFillType),u.PolyTyp==e.PolyType.ptSubject?(W=this.m_SubjFillType,te=this.m_ClipFillType):(W=this.m_ClipFillType,te=this.m_SubjFillType);var le,ie;switch(N){case e.PolyFillType.pftPositive:le=s.WindCnt;break;case e.PolyFillType.pftNegative:le=-s.WindCnt;break;default:le=Math.abs(s.WindCnt);break}switch(W){case e.PolyFillType.pftPositive:ie=u.WindCnt;break;case e.PolyFillType.pftNegative:ie=-u.WindCnt;break;default:ie=Math.abs(u.WindCnt);break}if(T&&I)y||C||le!==0&&le!=1||ie!==0&&ie!=1||s.PolyTyp!=u.PolyTyp&&this.m_ClipType!=e.ClipType.ctXor?this.AddLocalMaxPoly(s,u,h):(this.AddOutPt(s,h),this.AddOutPt(u,h),e.Clipper.SwapSides(s,u),e.Clipper.SwapPolyIndexes(s,u));else if(T)(ie===0||ie==1)&&(this.AddOutPt(s,h),e.Clipper.SwapSides(s,u),e.Clipper.SwapPolyIndexes(s,u));else if(I)(le===0||le==1)&&(this.AddOutPt(u,h),e.Clipper.SwapSides(s,u),e.Clipper.SwapPolyIndexes(s,u));else if((le===0||le==1)&&(ie===0||ie==1)&&!y&&!C){var ge,ke;switch(H){case e.PolyFillType.pftPositive:ge=s.WindCnt2;break;case e.PolyFillType.pftNegative:ge=-s.WindCnt2;break;default:ge=Math.abs(s.WindCnt2);break}switch(te){case e.PolyFillType.pftPositive:ke=u.WindCnt2;break;case e.PolyFillType.pftNegative:ke=-u.WindCnt2;break;default:ke=Math.abs(u.WindCnt2);break}if(s.PolyTyp!=u.PolyTyp)this.AddLocalMinPoly(s,u,h);else if(le==1&&ie==1)switch(this.m_ClipType){case e.ClipType.ctIntersection:ge>0&&ke>0&&this.AddLocalMinPoly(s,u,h);break;case e.ClipType.ctUnion:ge<=0&&ke<=0&&this.AddLocalMinPoly(s,u,h);break;case e.ClipType.ctDifference:(s.PolyTyp==e.PolyType.ptClip&&ge>0&&ke>0||s.PolyTyp==e.PolyType.ptSubject&&ge<=0&&ke<=0)&&this.AddLocalMinPoly(s,u,h);break;case e.ClipType.ctXor:this.AddLocalMinPoly(s,u,h);break}else e.Clipper.SwapSides(s,u)}y!=C&&(y&&s.OutIdx>=0||C&&u.OutIdx>=0)&&(e.Clipper.SwapSides(s,u),e.Clipper.SwapPolyIndexes(s,u)),y&&this.DeleteFromAEL(s),C&&this.DeleteFromAEL(u)},e.Clipper.prototype.DeleteFromAEL=function(s){var u=s.PrevInAEL,h=s.NextInAEL;u===null&&h===null&&s!=this.m_ActiveEdges||(u!==null?u.NextInAEL=h:this.m_ActiveEdges=h,h!==null&&(h.PrevInAEL=u),s.NextInAEL=null,s.PrevInAEL=null)},e.Clipper.prototype.DeleteFromSEL=function(s){var u=s.PrevInSEL,h=s.NextInSEL;u===null&&h===null&&s!=this.m_SortedEdges||(u!==null?u.NextInSEL=h:this.m_SortedEdges=h,h!==null&&(h.PrevInSEL=u),s.NextInSEL=null,s.PrevInSEL=null)},e.Clipper.prototype.UpdateEdgeIntoAEL=function(s){s.NextInLML===null&&e.Error("UpdateEdgeIntoAEL: invalid call");var u=s.PrevInAEL,h=s.NextInAEL;return s.NextInLML.OutIdx=s.OutIdx,u!==null?u.NextInAEL=s.NextInLML:this.m_ActiveEdges=s.NextInLML,h!==null&&(h.PrevInAEL=s.NextInLML),s.NextInLML.Side=s.Side,s.NextInLML.WindDelta=s.WindDelta,s.NextInLML.WindCnt=s.WindCnt,s.NextInLML.WindCnt2=s.WindCnt2,s=s.NextInLML,s.Curr.X=s.Bot.X,s.Curr.Y=s.Bot.Y,s.PrevInAEL=u,s.NextInAEL=h,e.ClipperBase.IsHorizontal(s)||this.InsertScanbeam(s.Top.Y),s},e.Clipper.prototype.ProcessHorizontals=function(s){for(var u=this.m_SortedEdges;u!==null;)this.DeleteFromSEL(u),this.ProcessHorizontal(u,s),u=this.m_SortedEdges},e.Clipper.prototype.GetHorzDirection=function(s,u){s.Bot.X<s.Top.X?(u.Left=s.Bot.X,u.Right=s.Top.X,u.Dir=e.Direction.dLeftToRight):(u.Left=s.Top.X,u.Right=s.Bot.X,u.Dir=e.Direction.dRightToLeft)},e.Clipper.prototype.PrepareHorzJoins=function(s,u){var h=this.m_PolyOuts[s.OutIdx].Pts;s.Side!=e.EdgeSide.esLeft&&(h=h.Prev),u&&(e.IntPoint.op_Equality(h.Pt,s.Top)?this.AddGhostJoin(h,s.Bot):this.AddGhostJoin(h,s.Top))},e.Clipper.prototype.ProcessHorizontal=function(s,u){var h={Dir:null,Left:null,Right:null};this.GetHorzDirection(s,h);for(var m=h.Dir,y=h.Left,C=h.Right,T=s,I=null;T.NextInLML!==null&&e.ClipperBase.IsHorizontal(T.NextInLML);)T=T.NextInLML;for(T.NextInLML===null&&(I=this.GetMaximaPair(T));;){for(var F=s==T,N=this.GetNextInAEL(s,m);N!==null&&!(N.Curr.X==s.Top.X&&s.NextInLML!==null&&N.Dx<s.NextInLML.Dx);){var W=this.GetNextInAEL(N,m);if(m==e.Direction.dLeftToRight&&N.Curr.X<=C||m==e.Direction.dRightToLeft&&N.Curr.X>=y){if(s.OutIdx>=0&&s.WindDelta!=0&&this.PrepareHorzJoins(s,u),N==I&&F){m==e.Direction.dLeftToRight?this.IntersectEdges(s,N,N.Top,!1):this.IntersectEdges(N,s,N.Top,!1),I.OutIdx>=0&&e.Error("ProcessHorizontal error");return}else if(m==e.Direction.dLeftToRight){var H=new e.IntPoint(N.Curr.X,s.Curr.Y);this.IntersectEdges(s,N,H,!0)}else{var H=new e.IntPoint(N.Curr.X,s.Curr.Y);this.IntersectEdges(N,s,H,!0)}this.SwapPositionsInAEL(s,N)}else if(m==e.Direction.dLeftToRight&&N.Curr.X>=C||m==e.Direction.dRightToLeft&&N.Curr.X<=y)break;N=W}if(s.OutIdx>=0&&s.WindDelta!==0&&this.PrepareHorzJoins(s,u),s.NextInLML!==null&&e.ClipperBase.IsHorizontal(s.NextInLML)){s=this.UpdateEdgeIntoAEL(s),s.OutIdx>=0&&this.AddOutPt(s,s.Bot);var h={Dir:m,Left:y,Right:C};this.GetHorzDirection(s,h),m=h.Dir,y=h.Left,C=h.Right}else break}if(s.NextInLML!==null)if(s.OutIdx>=0){var te=this.AddOutPt(s,s.Top);if(s=this.UpdateEdgeIntoAEL(s),s.WindDelta===0)return;var le=s.PrevInAEL,W=s.NextInAEL;if(le!==null&&le.Curr.X==s.Bot.X&&le.Curr.Y==s.Bot.Y&&le.WindDelta!==0&&le.OutIdx>=0&&le.Curr.Y>le.Top.Y&&e.ClipperBase.SlopesEqual(s,le,this.m_UseFullRange)){var ie=this.AddOutPt(le,s.Bot);this.AddJoin(te,ie,s.Top)}else if(W!==null&&W.Curr.X==s.Bot.X&&W.Curr.Y==s.Bot.Y&&W.WindDelta!==0&&W.OutIdx>=0&&W.Curr.Y>W.Top.Y&&e.ClipperBase.SlopesEqual(s,W,this.m_UseFullRange)){var ie=this.AddOutPt(W,s.Bot);this.AddJoin(te,ie,s.Top)}}else s=this.UpdateEdgeIntoAEL(s);else I!==null?I.OutIdx>=0?(m==e.Direction.dLeftToRight?this.IntersectEdges(s,I,s.Top,!1):this.IntersectEdges(I,s,s.Top,!1),I.OutIdx>=0&&e.Error("ProcessHorizontal error")):(this.DeleteFromAEL(s),this.DeleteFromAEL(I)):(s.OutIdx>=0&&this.AddOutPt(s,s.Top),this.DeleteFromAEL(s))},e.Clipper.prototype.GetNextInAEL=function(s,u){return u==e.Direction.dLeftToRight?s.NextInAEL:s.PrevInAEL},e.Clipper.prototype.IsMinima=function(s){return s!==null&&s.Prev.NextInLML!=s&&s.Next.NextInLML!=s},e.Clipper.prototype.IsMaxima=function(s,u){return s!==null&&s.Top.Y==u&&s.NextInLML===null},e.Clipper.prototype.IsIntermediate=function(s,u){return s.Top.Y==u&&s.NextInLML!==null},e.Clipper.prototype.GetMaximaPair=function(s){var u=null;return e.IntPoint.op_Equality(s.Next.Top,s.Top)&&s.Next.NextInLML===null?u=s.Next:e.IntPoint.op_Equality(s.Prev.Top,s.Top)&&s.Prev.NextInLML===null&&(u=s.Prev),u!==null&&(u.OutIdx==-2||u.NextInAEL==u.PrevInAEL&&!e.ClipperBase.IsHorizontal(u))?null:u},e.Clipper.prototype.ProcessIntersections=function(s,u){if(this.m_ActiveEdges==null)return!0;try{if(this.BuildIntersectList(s,u),this.m_IntersectList.length==0)return!0;if(this.m_IntersectList.length==1||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch{this.m_SortedEdges=null,this.m_IntersectList.length=0,e.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},e.Clipper.prototype.BuildIntersectList=function(s,u){if(this.m_ActiveEdges!==null){var h=this.m_ActiveEdges;for(this.m_SortedEdges=h;h!==null;)h.PrevInSEL=h.PrevInAEL,h.NextInSEL=h.NextInAEL,h.Curr.X=e.Clipper.TopX(h,u),h=h.NextInAEL;for(var m=!0;m&&this.m_SortedEdges!==null;){for(m=!1,h=this.m_SortedEdges;h.NextInSEL!==null;){var y=h.NextInSEL,C=new e.IntPoint;if(h.Curr.X>y.Curr.X){!this.IntersectPoint(h,y,C)&&h.Curr.X>y.Curr.X+1&&e.Error("Intersection error"),C.Y>s&&(C.Y=s,Math.abs(h.Dx)>Math.abs(y.Dx)?C.X=e.Clipper.TopX(y,s):C.X=e.Clipper.TopX(h,s));var T=new e.IntersectNode;T.Edge1=h,T.Edge2=y,T.Pt.X=C.X,T.Pt.Y=C.Y,this.m_IntersectList.push(T),this.SwapPositionsInSEL(h,y),m=!0}else h=y}if(h.PrevInSEL!==null)h.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}},e.Clipper.prototype.EdgesAdjacent=function(s){return s.Edge1.NextInSEL==s.Edge2||s.Edge1.PrevInSEL==s.Edge2},e.Clipper.IntersectNodeSort=function(s,u){return u.Pt.Y-s.Pt.Y},e.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var s=this.m_IntersectList.length,u=0;u<s;u++){if(!this.EdgesAdjacent(this.m_IntersectList[u])){for(var h=u+1;h<s&&!this.EdgesAdjacent(this.m_IntersectList[h]);)h++;if(h==s)return!1;var m=this.m_IntersectList[u];this.m_IntersectList[u]=this.m_IntersectList[h],this.m_IntersectList[h]=m}this.SwapPositionsInSEL(this.m_IntersectList[u].Edge1,this.m_IntersectList[u].Edge2)}return!0},e.Clipper.prototype.ProcessIntersectList=function(){for(var s=0,u=this.m_IntersectList.length;s<u;s++){var h=this.m_IntersectList[s];this.IntersectEdges(h.Edge1,h.Edge2,h.Pt,!0),this.SwapPositionsInAEL(h.Edge1,h.Edge2)}this.m_IntersectList.length=0};var ht=function(s){return s<0?Math.ceil(s-.5):Math.round(s)},Ee=function(s){return s<0?Math.ceil(s-.5):Math.floor(s+.5)},$t=function(s){return s<0?-Math.round(Math.abs(s)):Math.round(s)},At=function(s){return s<0?(s-=.5,s<-2147483648?Math.ceil(s):s|0):(s+=.5,s>2147483647?Math.floor(s):s|0)};o.msie?e.Clipper.Round=ht:o.chromium?e.Clipper.Round=$t:o.safari?e.Clipper.Round=At:e.Clipper.Round=Ee,e.Clipper.TopX=function(s,u){return u==s.Top.Y?s.Top.X:s.Bot.X+e.Clipper.Round(s.Dx*(u-s.Bot.Y))},e.Clipper.prototype.IntersectPoint=function(s,u,h){h.X=0,h.Y=0;var m,y;if(e.ClipperBase.SlopesEqual(s,u,this.m_UseFullRange)||s.Dx==u.Dx)return u.Bot.Y>s.Bot.Y?(h.X=u.Bot.X,h.Y=u.Bot.Y):(h.X=s.Bot.X,h.Y=s.Bot.Y),!1;if(s.Delta.X===0)h.X=s.Bot.X,e.ClipperBase.IsHorizontal(u)?h.Y=u.Bot.Y:(y=u.Bot.Y-u.Bot.X/u.Dx,h.Y=e.Clipper.Round(h.X/u.Dx+y));else if(u.Delta.X===0)h.X=u.Bot.X,e.ClipperBase.IsHorizontal(s)?h.Y=s.Bot.Y:(m=s.Bot.Y-s.Bot.X/s.Dx,h.Y=e.Clipper.Round(h.X/s.Dx+m));else{m=s.Bot.X-s.Bot.Y*s.Dx,y=u.Bot.X-u.Bot.Y*u.Dx;var C=(y-m)/(s.Dx-u.Dx);h.Y=e.Clipper.Round(C),Math.abs(s.Dx)<Math.abs(u.Dx)?h.X=e.Clipper.Round(s.Dx*C+m):h.X=e.Clipper.Round(u.Dx*C+y)}if(h.Y<s.Top.Y||h.Y<u.Top.Y){if(s.Top.Y>u.Top.Y)return h.Y=s.Top.Y,h.X=e.Clipper.TopX(u,s.Top.Y),h.X<s.Top.X;h.Y=u.Top.Y,Math.abs(s.Dx)<Math.abs(u.Dx)?h.X=e.Clipper.TopX(s,h.Y):h.X=e.Clipper.TopX(u,h.Y)}return!0},e.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(s){for(var u=this.m_ActiveEdges;u!==null;){var h=this.IsMaxima(u,s);if(h){var m=this.GetMaximaPair(u);h=m===null||!e.ClipperBase.IsHorizontal(m)}if(h){var y=u.PrevInAEL;this.DoMaxima(u),y===null?u=this.m_ActiveEdges:u=y.NextInAEL}else{if(this.IsIntermediate(u,s)&&e.ClipperBase.IsHorizontal(u.NextInLML)?(u=this.UpdateEdgeIntoAEL(u),u.OutIdx>=0&&this.AddOutPt(u,u.Bot),this.AddEdgeToSEL(u)):(u.Curr.X=e.Clipper.TopX(u,s),u.Curr.Y=s),this.StrictlySimple){var y=u.PrevInAEL;if(u.OutIdx>=0&&u.WindDelta!==0&&y!==null&&y.OutIdx>=0&&y.Curr.X==u.Curr.X&&y.WindDelta!==0){var C=this.AddOutPt(y,u.Curr),T=this.AddOutPt(u,u.Curr);this.AddJoin(C,T,u.Curr)}}u=u.NextInAEL}}for(this.ProcessHorizontals(!0),u=this.m_ActiveEdges;u!==null;){if(this.IsIntermediate(u,s)){var C=null;u.OutIdx>=0&&(C=this.AddOutPt(u,u.Top)),u=this.UpdateEdgeIntoAEL(u);var y=u.PrevInAEL,I=u.NextInAEL;if(y!==null&&y.Curr.X==u.Bot.X&&y.Curr.Y==u.Bot.Y&&C!==null&&y.OutIdx>=0&&y.Curr.Y>y.Top.Y&&e.ClipperBase.SlopesEqual(u,y,this.m_UseFullRange)&&u.WindDelta!==0&&y.WindDelta!==0){var T=this.AddOutPt(y,u.Bot);this.AddJoin(C,T,u.Top)}else if(I!==null&&I.Curr.X==u.Bot.X&&I.Curr.Y==u.Bot.Y&&C!==null&&I.OutIdx>=0&&I.Curr.Y>I.Top.Y&&e.ClipperBase.SlopesEqual(u,I,this.m_UseFullRange)&&u.WindDelta!==0&&I.WindDelta!==0){var T=this.AddOutPt(I,u.Bot);this.AddJoin(C,T,u.Top)}}u=u.NextInAEL}},e.Clipper.prototype.DoMaxima=function(s){var u=this.GetMaximaPair(s);if(u===null){s.OutIdx>=0&&this.AddOutPt(s,s.Top),this.DeleteFromAEL(s);return}for(var h=s.NextInAEL;h!==null&&h!=u;)this.IntersectEdges(s,h,s.Top,!0),this.SwapPositionsInAEL(s,h),h=s.NextInAEL;s.OutIdx==-1&&u.OutIdx==-1?(this.DeleteFromAEL(s),this.DeleteFromAEL(u)):s.OutIdx>=0&&u.OutIdx>=0?this.IntersectEdges(s,u,s.Top,!1):s.WindDelta===0?(s.OutIdx>=0&&(this.AddOutPt(s,s.Top),s.OutIdx=-1),this.DeleteFromAEL(s),u.OutIdx>=0&&(this.AddOutPt(u,s.Top),u.OutIdx=-1),this.DeleteFromAEL(u)):e.Error("DoMaxima error")},e.Clipper.ReversePaths=function(s){for(var u=0,h=s.length;u<h;u++)s[u].reverse()},e.Clipper.Orientation=function(s){return e.Clipper.Area(s)>=0},e.Clipper.prototype.PointCount=function(s){if(s===null)return 0;var u=0,h=s;do u++,h=h.Next;while(h!=s);return u},e.Clipper.prototype.BuildResult=function(s){e.Clear(s);for(var u=0,h=this.m_PolyOuts.length;u<h;u++){var m=this.m_PolyOuts[u];if(m.Pts!==null){var y=m.Pts.Prev,C=this.PointCount(y);if(!(C<2)){for(var T=new Array(C),I=0;I<C;I++)T[I]=y.Pt,y=y.Prev;s.push(T)}}}},e.Clipper.prototype.BuildResult2=function(s){s.Clear();for(var u=0,h=this.m_PolyOuts.length;u<h;u++){var m=this.m_PolyOuts[u],y=this.PointCount(m.Pts);if(!(m.IsOpen&&y<2||!m.IsOpen&&y<3)){this.FixHoleLinkage(m);var C=new e.PolyNode;s.m_AllPolys.push(C),m.PolyNode=C,C.m_polygon.length=y;for(var T=m.Pts.Prev,I=0;I<y;I++)C.m_polygon[I]=T.Pt,T=T.Prev}}for(var u=0,h=this.m_PolyOuts.length;u<h;u++){var m=this.m_PolyOuts[u];m.PolyNode!==null&&(m.IsOpen?(m.PolyNode.IsOpen=!0,s.AddChild(m.PolyNode)):m.FirstLeft!==null&&m.FirstLeft.PolyNode!=null?m.FirstLeft.PolyNode.AddChild(m.PolyNode):s.AddChild(m.PolyNode))}},e.Clipper.prototype.FixupOutPolygon=function(s){var u=null;s.BottomPt=null;for(var h=s.Pts;;){if(h.Prev==h||h.Prev==h.Next){this.DisposeOutPts(h),s.Pts=null;return}if(e.IntPoint.op_Equality(h.Pt,h.Next.Pt)||e.IntPoint.op_Equality(h.Pt,h.Prev.Pt)||e.ClipperBase.SlopesEqual(h.Prev.Pt,h.Pt,h.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(h.Prev.Pt,h.Pt,h.Next.Pt)))u=null,h.Prev.Next=h.Next,h.Next.Prev=h.Prev,h=h.Prev;else{if(h==u)break;u===null&&(u=h),h=h.Next}}s.Pts=h},e.Clipper.prototype.DupOutPt=function(s,u){var h=new e.OutPt;return h.Pt.X=s.Pt.X,h.Pt.Y=s.Pt.Y,h.Idx=s.Idx,u?(h.Next=s.Next,h.Prev=s,s.Next.Prev=h,s.Next=h):(h.Prev=s.Prev,h.Next=s,s.Prev.Next=h,s.Prev=h),h},e.Clipper.prototype.GetOverlap=function(s,u,h,m,y){return s<u?h<m?(y.Left=Math.max(s,h),y.Right=Math.min(u,m)):(y.Left=Math.max(s,m),y.Right=Math.min(u,h)):h<m?(y.Left=Math.max(u,h),y.Right=Math.min(s,m)):(y.Left=Math.max(u,m),y.Right=Math.min(s,h)),y.Left<y.Right},e.Clipper.prototype.JoinHorz=function(s,u,h,m,y,C){var T=s.Pt.X>u.Pt.X?e.Direction.dRightToLeft:e.Direction.dLeftToRight,I=h.Pt.X>m.Pt.X?e.Direction.dRightToLeft:e.Direction.dLeftToRight;if(T==I)return!1;if(T==e.Direction.dLeftToRight){for(;s.Next.Pt.X<=y.X&&s.Next.Pt.X>=s.Pt.X&&s.Next.Pt.Y==y.Y;)s=s.Next;C&&s.Pt.X!=y.X&&(s=s.Next),u=this.DupOutPt(s,!C),e.IntPoint.op_Inequality(u.Pt,y)&&(s=u,s.Pt.X=y.X,s.Pt.Y=y.Y,u=this.DupOutPt(s,!C))}else{for(;s.Next.Pt.X>=y.X&&s.Next.Pt.X<=s.Pt.X&&s.Next.Pt.Y==y.Y;)s=s.Next;!C&&s.Pt.X!=y.X&&(s=s.Next),u=this.DupOutPt(s,C),e.IntPoint.op_Inequality(u.Pt,y)&&(s=u,s.Pt.X=y.X,s.Pt.Y=y.Y,u=this.DupOutPt(s,C))}if(I==e.Direction.dLeftToRight){for(;h.Next.Pt.X<=y.X&&h.Next.Pt.X>=h.Pt.X&&h.Next.Pt.Y==y.Y;)h=h.Next;C&&h.Pt.X!=y.X&&(h=h.Next),m=this.DupOutPt(h,!C),e.IntPoint.op_Inequality(m.Pt,y)&&(h=m,h.Pt.X=y.X,h.Pt.Y=y.Y,m=this.DupOutPt(h,!C))}else{for(;h.Next.Pt.X>=y.X&&h.Next.Pt.X<=h.Pt.X&&h.Next.Pt.Y==y.Y;)h=h.Next;!C&&h.Pt.X!=y.X&&(h=h.Next),m=this.DupOutPt(h,C),e.IntPoint.op_Inequality(m.Pt,y)&&(h=m,h.Pt.X=y.X,h.Pt.Y=y.Y,m=this.DupOutPt(h,C))}return T==e.Direction.dLeftToRight==C?(s.Prev=h,h.Next=s,u.Next=m,m.Prev=u):(s.Next=h,h.Prev=s,u.Prev=m,m.Next=u),!0},e.Clipper.prototype.JoinPoints=function(s,u,h){var m=s.OutPt1,y=new e.OutPt,C=s.OutPt2,T=new e.OutPt,I=s.OutPt1.Pt.Y==s.OffPt.Y;if(I&&e.IntPoint.op_Equality(s.OffPt,s.OutPt1.Pt)&&e.IntPoint.op_Equality(s.OffPt,s.OutPt2.Pt)){for(y=s.OutPt1.Next;y!=m&&e.IntPoint.op_Equality(y.Pt,s.OffPt);)y=y.Next;var F=y.Pt.Y>s.OffPt.Y;for(T=s.OutPt2.Next;T!=C&&e.IntPoint.op_Equality(T.Pt,s.OffPt);)T=T.Next;var N=T.Pt.Y>s.OffPt.Y;return F==N?!1:F?(y=this.DupOutPt(m,!1),T=this.DupOutPt(C,!0),m.Prev=C,C.Next=m,y.Next=T,T.Prev=y,s.OutPt1=m,s.OutPt2=y,!0):(y=this.DupOutPt(m,!0),T=this.DupOutPt(C,!1),m.Next=C,C.Prev=m,y.Prev=T,T.Next=y,s.OutPt1=m,s.OutPt2=y,!0)}else if(I){for(y=m;m.Prev.Pt.Y==m.Pt.Y&&m.Prev!=y&&m.Prev!=C;)m=m.Prev;for(;y.Next.Pt.Y==y.Pt.Y&&y.Next!=m&&y.Next!=C;)y=y.Next;if(y.Next==m||y.Next==C)return!1;for(T=C;C.Prev.Pt.Y==C.Pt.Y&&C.Prev!=T&&C.Prev!=y;)C=C.Prev;for(;T.Next.Pt.Y==T.Pt.Y&&T.Next!=C&&T.Next!=m;)T=T.Next;if(T.Next==C||T.Next==m)return!1;var W={Left:null,Right:null};if(!this.GetOverlap(m.Pt.X,y.Pt.X,C.Pt.X,T.Pt.X,W))return!1;var H=W.Left,te=W.Right,le=new e.IntPoint,ie;return m.Pt.X>=H&&m.Pt.X<=te?(le.X=m.Pt.X,le.Y=m.Pt.Y,ie=m.Pt.X>y.Pt.X):C.Pt.X>=H&&C.Pt.X<=te?(le.X=C.Pt.X,le.Y=C.Pt.Y,ie=C.Pt.X>T.Pt.X):y.Pt.X>=H&&y.Pt.X<=te?(le.X=y.Pt.X,le.Y=y.Pt.Y,ie=y.Pt.X>m.Pt.X):(le.X=T.Pt.X,le.Y=T.Pt.Y,ie=T.Pt.X>C.Pt.X),s.OutPt1=m,s.OutPt2=C,this.JoinHorz(m,y,C,T,le,ie)}else{for(y=m.Next;e.IntPoint.op_Equality(y.Pt,m.Pt)&&y!=m;)y=y.Next;var ge=y.Pt.Y>m.Pt.Y||!e.ClipperBase.SlopesEqual(m.Pt,y.Pt,s.OffPt,this.m_UseFullRange);if(ge){for(y=m.Prev;e.IntPoint.op_Equality(y.Pt,m.Pt)&&y!=m;)y=y.Prev;if(y.Pt.Y>m.Pt.Y||!e.ClipperBase.SlopesEqual(m.Pt,y.Pt,s.OffPt,this.m_UseFullRange))return!1}for(T=C.Next;e.IntPoint.op_Equality(T.Pt,C.Pt)&&T!=C;)T=T.Next;var ke=T.Pt.Y>C.Pt.Y||!e.ClipperBase.SlopesEqual(C.Pt,T.Pt,s.OffPt,this.m_UseFullRange);if(ke){for(T=C.Prev;e.IntPoint.op_Equality(T.Pt,C.Pt)&&T!=C;)T=T.Prev;if(T.Pt.Y>C.Pt.Y||!e.ClipperBase.SlopesEqual(C.Pt,T.Pt,s.OffPt,this.m_UseFullRange))return!1}return y==m||T==C||y==T||u==h&&ge==ke?!1:ge?(y=this.DupOutPt(m,!1),T=this.DupOutPt(C,!0),m.Prev=C,C.Next=m,y.Next=T,T.Prev=y,s.OutPt1=m,s.OutPt2=y,!0):(y=this.DupOutPt(m,!0),T=this.DupOutPt(C,!1),m.Next=C,C.Prev=m,y.Prev=T,T.Next=y,s.OutPt1=m,s.OutPt2=y,!0)}},e.Clipper.GetBounds=function(s){for(var u=0,h=s.length;u<h&&s[u].length==0;)u++;if(u==h)return new e.IntRect(0,0,0,0);var m=new e.IntRect;for(m.left=s[u][0].X,m.right=m.left,m.top=s[u][0].Y,m.bottom=m.top;u<h;u++)for(var y=0,C=s[u].length;y<C;y++)s[u][y].X<m.left?m.left=s[u][y].X:s[u][y].X>m.right&&(m.right=s[u][y].X),s[u][y].Y<m.top?m.top=s[u][y].Y:s[u][y].Y>m.bottom&&(m.bottom=s[u][y].Y);return m},e.Clipper.prototype.GetBounds2=function(s){var u=s,h=new e.IntRect;for(h.left=s.Pt.X,h.right=s.Pt.X,h.top=s.Pt.Y,h.bottom=s.Pt.Y,s=s.Next;s!=u;)s.Pt.X<h.left&&(h.left=s.Pt.X),s.Pt.X>h.right&&(h.right=s.Pt.X),s.Pt.Y<h.top&&(h.top=s.Pt.Y),s.Pt.Y>h.bottom&&(h.bottom=s.Pt.Y),s=s.Next;return h},e.Clipper.PointInPolygon=function(s,u){var h=0,m=u.length;if(m<3)return 0;for(var y=u[0],C=1;C<=m;++C){var T=C==m?u[0]:u[C];if(T.Y==s.Y&&(T.X==s.X||y.Y==s.Y&&T.X>s.X==y.X<s.X))return-1;if(y.Y<s.Y!=T.Y<s.Y){if(y.X>=s.X)if(T.X>s.X)h=1-h;else{var I=(y.X-s.X)*(T.Y-s.Y)-(T.X-s.X)*(y.Y-s.Y);if(I==0)return-1;I>0==T.Y>y.Y&&(h=1-h)}else if(T.X>s.X){var I=(y.X-s.X)*(T.Y-s.Y)-(T.X-s.X)*(y.Y-s.Y);if(I==0)return-1;I>0==T.Y>y.Y&&(h=1-h)}}y=T}return h},e.Clipper.prototype.PointInPolygon=function(s,u){for(var h=0,m=u;;){var y=u.Pt.X,C=u.Pt.Y,T=u.Next.Pt.X,I=u.Next.Pt.Y;if(I==s.Y&&(T==s.X||C==s.Y&&T>s.X==y<s.X))return-1;if(C<s.Y!=I<s.Y){if(y>=s.X)if(T>s.X)h=1-h;else{var F=(y-s.X)*(I-s.Y)-(T-s.X)*(C-s.Y);if(F==0)return-1;F>0==I>C&&(h=1-h)}else if(T>s.X){var F=(y-s.X)*(I-s.Y)-(T-s.X)*(C-s.Y);if(F==0)return-1;F>0==I>C&&(h=1-h)}}if(u=u.Next,m==u)break}return h},e.Clipper.prototype.Poly2ContainsPoly1=function(s,u){var h=s;do{var m=this.PointInPolygon(h.Pt,u);if(m>=0)return m!=0;h=h.Next}while(h!=s);return!0},e.Clipper.prototype.FixupFirstLefts1=function(s,u){for(var h=0,m=this.m_PolyOuts.length;h<m;h++){var y=this.m_PolyOuts[h];y.Pts!==null&&y.FirstLeft==s&&this.Poly2ContainsPoly1(y.Pts,u.Pts)&&(y.FirstLeft=u)}},e.Clipper.prototype.FixupFirstLefts2=function(s,u){for(var h=0,m=this.m_PolyOuts,y=m.length,C=m[h];h<y;h++,C=m[h])C.FirstLeft==s&&(C.FirstLeft=u)},e.Clipper.ParseFirstLeft=function(s){for(;s!=null&&s.Pts==null;)s=s.FirstLeft;return s},e.Clipper.prototype.JoinCommonEdges=function(){for(var s=0,u=this.m_Joins.length;s<u;s++){var h=this.m_Joins[s],m=this.GetOutRec(h.OutPt1.Idx),y=this.GetOutRec(h.OutPt2.Idx);if(!(m.Pts==null||y.Pts==null)){var C;if(m==y?C=m:this.Param1RightOfParam2(m,y)?C=y:this.Param1RightOfParam2(y,m)?C=m:C=this.GetLowermostRec(m,y),!!this.JoinPoints(h,m,y))if(m==y){if(m.Pts=h.OutPt1,m.BottomPt=null,y=this.CreateOutRec(),y.Pts=h.OutPt2,this.UpdateOutPtIdxs(y),this.m_UsingPolyTree)for(var T=0,I=this.m_PolyOuts.length;T<I-1;T++){var F=this.m_PolyOuts[T];F.Pts==null||e.Clipper.ParseFirstLeft(F.FirstLeft)!=m||F.IsHole==m.IsHole||this.Poly2ContainsPoly1(F.Pts,h.OutPt2)&&(F.FirstLeft=y)}this.Poly2ContainsPoly1(y.Pts,m.Pts)?(y.IsHole=!m.IsHole,y.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(y,m),(y.IsHole^this.ReverseSolution)==this.Area(y)>0&&this.ReversePolyPtLinks(y.Pts)):this.Poly2ContainsPoly1(m.Pts,y.Pts)?(y.IsHole=m.IsHole,m.IsHole=!y.IsHole,y.FirstLeft=m.FirstLeft,m.FirstLeft=y,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,y),(m.IsHole^this.ReverseSolution)==this.Area(m)>0&&this.ReversePolyPtLinks(m.Pts)):(y.IsHole=m.IsHole,y.FirstLeft=m.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(m,y))}else y.Pts=null,y.BottomPt=null,y.Idx=m.Idx,m.IsHole=C.IsHole,C==y&&(m.FirstLeft=y.FirstLeft),y.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(y,m)}}},e.Clipper.prototype.UpdateOutPtIdxs=function(s){var u=s.Pts;do u.Idx=s.Idx,u=u.Prev;while(u!=s.Pts)},e.Clipper.prototype.DoSimplePolygons=function(){for(var s=0;s<this.m_PolyOuts.length;){var u=this.m_PolyOuts[s++],h=u.Pts;if(h!==null)do{for(var m=h.Next;m!=u.Pts;){if(e.IntPoint.op_Equality(h.Pt,m.Pt)&&m.Next!=h&&m.Prev!=h){var y=h.Prev,C=m.Prev;h.Prev=C,C.Next=h,m.Prev=y,y.Next=m,u.Pts=h;var T=this.CreateOutRec();T.Pts=m,this.UpdateOutPtIdxs(T),this.Poly2ContainsPoly1(T.Pts,u.Pts)?(T.IsHole=!u.IsHole,T.FirstLeft=u):this.Poly2ContainsPoly1(u.Pts,T.Pts)?(T.IsHole=u.IsHole,u.IsHole=!T.IsHole,T.FirstLeft=u.FirstLeft,u.FirstLeft=T):(T.IsHole=u.IsHole,T.FirstLeft=u.FirstLeft),m=h}m=m.Next}h=h.Next}while(h!=u.Pts)}},e.Clipper.Area=function(s){var u=s.length;if(u<3)return 0;for(var h=0,m=0,y=u-1;m<u;++m)h+=(s[y].X+s[m].X)*(s[y].Y-s[m].Y),y=m;return-h*.5},e.Clipper.prototype.Area=function(s){var u=s.Pts;if(u==null)return 0;var h=0;do h=h+(u.Prev.Pt.X+u.Pt.X)*(u.Prev.Pt.Y-u.Pt.Y),u=u.Next;while(u!=s.Pts);return h*.5},e.Clipper.SimplifyPolygon=function(s,u){var h=new Array,m=new e.Clipper(0);return m.StrictlySimple=!0,m.AddPath(s,e.PolyType.ptSubject,!0),m.Execute(e.ClipType.ctUnion,h,u,u),h},e.Clipper.SimplifyPolygons=function(s,u){typeof u>"u"&&(u=e.PolyFillType.pftEvenOdd);var h=new Array,m=new e.Clipper(0);return m.StrictlySimple=!0,m.AddPaths(s,e.PolyType.ptSubject,!0),m.Execute(e.ClipType.ctUnion,h,u,u),h},e.Clipper.DistanceSqrd=function(s,u){var h=s.X-u.X,m=s.Y-u.Y;return h*h+m*m},e.Clipper.DistanceFromLineSqrd=function(s,u,h){var m=u.Y-h.Y,y=h.X-u.X,C=m*u.X+y*u.Y;return C=m*s.X+y*s.Y-C,C*C/(m*m+y*y)},e.Clipper.SlopesNearCollinear=function(s,u,h,m){return e.Clipper.DistanceFromLineSqrd(u,s,h)<m},e.Clipper.PointsAreClose=function(s,u,h){var m=s.X-u.X,y=s.Y-u.Y;return m*m+y*y<=h},e.Clipper.ExcludeOp=function(s){var u=s.Prev;return u.Next=s.Next,s.Next.Prev=u,u.Idx=0,u},e.Clipper.CleanPolygon=function(s,u){typeof u>"u"&&(u=1.415);var h=s.length;if(h==0)return new Array;for(var m=new Array(h),y=0;y<h;++y)m[y]=new e.OutPt;for(var y=0;y<h;++y)m[y].Pt=s[y],m[y].Next=m[(y+1)%h],m[y].Next.Prev=m[y],m[y].Idx=0;for(var C=u*u,T=m[0];T.Idx==0&&T.Next!=T.Prev;)e.Clipper.PointsAreClose(T.Pt,T.Prev.Pt,C)?(T=e.Clipper.ExcludeOp(T),h--):e.Clipper.PointsAreClose(T.Prev.Pt,T.Next.Pt,C)?(e.Clipper.ExcludeOp(T.Next),T=e.Clipper.ExcludeOp(T),h-=2):e.Clipper.SlopesNearCollinear(T.Prev.Pt,T.Pt,T.Next.Pt,C)?(T=e.Clipper.ExcludeOp(T),h--):(T.Idx=1,T=T.Next);h<3&&(h=0);for(var I=new Array(h),y=0;y<h;++y)I[y]=new e.IntPoint(T.Pt),T=T.Next;return m=null,I},e.Clipper.CleanPolygons=function(s,u){for(var h=new Array(s.length),m=0,y=s.length;m<y;m++)h[m]=e.Clipper.CleanPolygon(s[m],u);return h},e.Clipper.Minkowski=function(s,u,h,m){var y=m?1:0,C=s.length,T=u.length,I=new Array;if(h)for(var F=0;F<T;F++){for(var N=new Array(C),W=0,H=s.length,te=s[W];W<H;W++,te=s[W])N[W]=new e.IntPoint(u[F].X+te.X,u[F].Y+te.Y);I.push(N)}else for(var F=0;F<T;F++){for(var N=new Array(C),W=0,H=s.length,te=s[W];W<H;W++,te=s[W])N[W]=new e.IntPoint(u[F].X-te.X,u[F].Y-te.Y);I.push(N)}for(var le=new Array,F=0;F<T-1+y;F++)for(var W=0;W<C;W++){var ie=new Array;ie.push(I[F%T][W%C]),ie.push(I[(F+1)%T][W%C]),ie.push(I[(F+1)%T][(W+1)%C]),ie.push(I[F%T][(W+1)%C]),e.Clipper.Orientation(ie)||ie.reverse(),le.push(ie)}var ge=new e.Clipper(0);return ge.AddPaths(le,e.PolyType.ptSubject,!0),ge.Execute(e.ClipType.ctUnion,I,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero),I},e.Clipper.MinkowskiSum=function(){var s=arguments,u=s.length;if(u==3){var h=s[0],m=s[1],y=s[2];return e.Clipper.Minkowski(h,m,!0,y)}else if(u==4){for(var h=s[0],C=s[1],T=s[2],y=s[3],I=new e.Clipper,F,N=0,W=C.length;N<W;++N){var F=e.Clipper.Minkowski(h,C[N],!0,y);I.AddPaths(F,e.PolyType.ptSubject,!0)}y&&I.AddPaths(C,e.PolyType.ptClip,!0);var H=new e.Paths;return I.Execute(e.ClipType.ctUnion,H,T,T),H}},e.Clipper.MinkowskiDiff=function(s,u,h){return e.Clipper.Minkowski(s,u,!1,h)},e.Clipper.PolyTreeToPaths=function(s){var u=new Array;return e.Clipper.AddPolyNodeToPaths(s,e.Clipper.NodeType.ntAny,u),u},e.Clipper.AddPolyNodeToPaths=function(s,u,h){var m=!0;switch(u){case e.Clipper.NodeType.ntOpen:return;case e.Clipper.NodeType.ntClosed:m=!s.IsOpen;break}s.m_polygon.length>0&&m&&h.push(s.m_polygon);for(var y=0,C=s.Childs(),T=C.length,I=C[y];y<T;y++,I=C[y])e.Clipper.AddPolyNodeToPaths(I,u,h)},e.Clipper.OpenPathsFromPolyTree=function(s){for(var u=new e.Paths,h=0,m=s.ChildCount();h<m;h++)s.Childs()[h].IsOpen&&u.push(s.Childs()[h].m_polygon);return u},e.Clipper.ClosedPathsFromPolyTree=function(s){var u=new e.Paths;return e.Clipper.AddPolyNodeToPaths(s,e.Clipper.NodeType.ntClosed,u),u},_t(e.Clipper,e.ClipperBase),e.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},e.ClipperOffset=function(s,u){typeof s>"u"&&(s=2),typeof u>"u"&&(u=e.ClipperOffset.def_arc_tolerance),this.m_destPolys=new e.Paths,this.m_srcPoly=new e.Path,this.m_destPoly=new e.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new e.IntPoint,this.m_polyNodes=new e.PolyNode,this.MiterLimit=s,this.ArcTolerance=u,this.m_lowest.X=-1},e.ClipperOffset.two_pi=6.28318530717959,e.ClipperOffset.def_arc_tolerance=.25,e.ClipperOffset.prototype.Clear=function(){e.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},e.ClipperOffset.Round=e.Clipper.Round,e.ClipperOffset.prototype.AddPath=function(s,u,h){var m=s.length-1;if(!(m<0)){var y=new e.PolyNode;if(y.m_jointype=u,y.m_endtype=h,h==e.EndType.etClosedLine||h==e.EndType.etClosedPolygon)for(;m>0&&e.IntPoint.op_Equality(s[0],s[m]);)m--;y.m_polygon.push(s[0]);for(var C=0,T=0,I=1;I<=m;I++)e.IntPoint.op_Inequality(y.m_polygon[C],s[I])&&(C++,y.m_polygon.push(s[I]),(s[I].Y>y.m_polygon[T].Y||s[I].Y==y.m_polygon[T].Y&&s[I].X<y.m_polygon[T].X)&&(T=C));if(!(h==e.EndType.etClosedPolygon&&C<2||h!=e.EndType.etClosedPolygon&&C<0)&&(this.m_polyNodes.AddChild(y),h==e.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new e.IntPoint(0,T);else{var F=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(y.m_polygon[T].Y>F.Y||y.m_polygon[T].Y==F.Y&&y.m_polygon[T].X<F.X)&&(this.m_lowest=new e.IntPoint(this.m_polyNodes.ChildCount()-1,T))}}},e.ClipperOffset.prototype.AddPaths=function(s,u,h){for(var m=0,y=s.length;m<y;m++)this.AddPath(s[m],u,h)},e.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!e.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var s=0;s<this.m_polyNodes.ChildCount();s++){var u=this.m_polyNodes.Childs()[s];(u.m_endtype==e.EndType.etClosedPolygon||u.m_endtype==e.EndType.etClosedLine&&e.Clipper.Orientation(u.m_polygon))&&u.m_polygon.reverse()}else for(var s=0;s<this.m_polyNodes.ChildCount();s++){var u=this.m_polyNodes.Childs()[s];u.m_endtype==e.EndType.etClosedLine&&!e.Clipper.Orientation(u.m_polygon)&&u.m_polygon.reverse()}},e.ClipperOffset.GetUnitNormal=function(s,u){var h=u.X-s.X,m=u.Y-s.Y;if(h==0&&m==0)return new e.DoublePoint(0,0);var y=1/Math.sqrt(h*h+m*m);return h*=y,m*=y,new e.DoublePoint(m,-h)},e.ClipperOffset.prototype.DoOffset=function(s){if(this.m_destPolys=new Array,this.m_delta=s,e.ClipperBase.near_zero(s)){for(var u=0;u<this.m_polyNodes.ChildCount();u++){var h=this.m_polyNodes.Childs()[u];h.m_endtype==e.EndType.etClosedPolygon&&this.m_destPolys.push(h.m_polygon)}return}this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5;var m;this.ArcTolerance<=0?m=e.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(s)*e.ClipperOffset.def_arc_tolerance?m=Math.abs(s)*e.ClipperOffset.def_arc_tolerance:m=this.ArcTolerance;var y=3.14159265358979/Math.acos(1-m/Math.abs(s));this.m_sin=Math.sin(e.ClipperOffset.two_pi/y),this.m_cos=Math.cos(e.ClipperOffset.two_pi/y),this.m_StepsPerRad=y/e.ClipperOffset.two_pi,s<0&&(this.m_sin=-this.m_sin);for(var u=0;u<this.m_polyNodes.ChildCount();u++){var h=this.m_polyNodes.Childs()[u];this.m_srcPoly=h.m_polygon;var C=this.m_srcPoly.length;if(!(C==0||s<=0&&(C<3||h.m_endtype!=e.EndType.etClosedPolygon))){if(this.m_destPoly=new Array,C==1){if(h.m_jointype==e.JoinType.jtRound)for(var T=1,I=0,F=1;F<=y;F++){this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[0].X+T*s),e.ClipperOffset.Round(this.m_srcPoly[0].Y+I*s)));var N=T;T=T*this.m_cos-this.m_sin*I,I=N*this.m_sin+I*this.m_cos}else for(var T=-1,I=-1,F=0;F<4;++F)this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[0].X+T*s),e.ClipperOffset.Round(this.m_srcPoly[0].Y+I*s))),T<0?T=1:I<0?I=1:T=-1;this.m_destPolys.push(this.m_destPoly);continue}this.m_normals.length=0;for(var F=0;F<C-1;F++)this.m_normals.push(e.ClipperOffset.GetUnitNormal(this.m_srcPoly[F],this.m_srcPoly[F+1]));if(h.m_endtype==e.EndType.etClosedLine||h.m_endtype==e.EndType.etClosedPolygon?this.m_normals.push(e.ClipperOffset.GetUnitNormal(this.m_srcPoly[C-1],this.m_srcPoly[0])):this.m_normals.push(new e.DoublePoint(this.m_normals[C-2])),h.m_endtype==e.EndType.etClosedPolygon){for(var W=C-1,F=0;F<C;F++)W=this.OffsetPoint(F,W,h.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(h.m_endtype==e.EndType.etClosedLine){for(var W=C-1,F=0;F<C;F++)W=this.OffsetPoint(F,W,h.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;for(var H=this.m_normals[C-1],F=C-1;F>0;F--)this.m_normals[F]=new e.DoublePoint(-this.m_normals[F-1].X,-this.m_normals[F-1].Y);this.m_normals[0]=new e.DoublePoint(-H.X,-H.Y),W=0;for(var F=C-1;F>=0;F--)W=this.OffsetPoint(F,W,h.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{for(var W=0,F=1;F<C-1;++F)W=this.OffsetPoint(F,W,h.m_jointype);var te;if(h.m_endtype==e.EndType.etOpenButt){var F=C-1;te=new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[F].X+this.m_normals[F].X*s),e.ClipperOffset.Round(this.m_srcPoly[F].Y+this.m_normals[F].Y*s)),this.m_destPoly.push(te),te=new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[F].X-this.m_normals[F].X*s),e.ClipperOffset.Round(this.m_srcPoly[F].Y-this.m_normals[F].Y*s)),this.m_destPoly.push(te)}else{var F=C-1;W=C-2,this.m_sinA=0,this.m_normals[F]=new e.DoublePoint(-this.m_normals[F].X,-this.m_normals[F].Y),h.m_endtype==e.EndType.etOpenSquare?this.DoSquare(F,W):this.DoRound(F,W)}for(var F=C-1;F>0;F--)this.m_normals[F]=new e.DoublePoint(-this.m_normals[F-1].X,-this.m_normals[F-1].Y);this.m_normals[0]=new e.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y),W=C-1;for(var F=W-1;F>0;--F)W=this.OffsetPoint(F,W,h.m_jointype);h.m_endtype==e.EndType.etOpenButt?(te=new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*s),e.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*s)),this.m_destPoly.push(te),te=new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*s),e.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*s)),this.m_destPoly.push(te)):(W=1,this.m_sinA=0,h.m_endtype==e.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}}},e.ClipperOffset.prototype.Execute=function(){var s=arguments,u=s[0]instanceof e.PolyTree;if(u){var h=s[0],m=s[1];h.Clear(),this.FixOrientations(),this.DoOffset(m);var y=new e.Clipper(0);if(y.AddPaths(this.m_destPolys,e.PolyType.ptSubject,!0),m>0)y.Execute(e.ClipType.ctUnion,h,e.PolyFillType.pftPositive,e.PolyFillType.pftPositive);else{var C=e.Clipper.GetBounds(this.m_destPolys),T=new e.Path;if(T.push(new e.IntPoint(C.left-10,C.bottom+10)),T.push(new e.IntPoint(C.right+10,C.bottom+10)),T.push(new e.IntPoint(C.right+10,C.top-10)),T.push(new e.IntPoint(C.left-10,C.top-10)),y.AddPath(T,e.PolyType.ptSubject,!0),y.ReverseSolution=!0,y.Execute(e.ClipType.ctUnion,h,e.PolyFillType.pftNegative,e.PolyFillType.pftNegative),h.ChildCount()==1&&h.Childs()[0].ChildCount()>0){var I=h.Childs()[0];h.Childs()[0]=I.Childs()[0];for(var F=1;F<I.ChildCount();F++)h.AddChild(I.Childs()[F])}else h.Clear()}}else{var h=s[0],m=s[1];e.Clear(h),this.FixOrientations(),this.DoOffset(m);var y=new e.Clipper(0);if(y.AddPaths(this.m_destPolys,e.PolyType.ptSubject,!0),m>0)y.Execute(e.ClipType.ctUnion,h,e.PolyFillType.pftPositive,e.PolyFillType.pftPositive);else{var C=e.Clipper.GetBounds(this.m_destPolys),T=new e.Path;T.push(new e.IntPoint(C.left-10,C.bottom+10)),T.push(new e.IntPoint(C.right+10,C.bottom+10)),T.push(new e.IntPoint(C.right+10,C.top-10)),T.push(new e.IntPoint(C.left-10,C.top-10)),y.AddPath(T,e.PolyType.ptSubject,!0),y.ReverseSolution=!0,y.Execute(e.ClipType.ctUnion,h,e.PolyFillType.pftNegative,e.PolyFillType.pftNegative),h.length>0&&h.splice(0,1)}}},e.ClipperOffset.prototype.OffsetPoint=function(s,u,h){if(this.m_sinA=this.m_normals[u].X*this.m_normals[s].Y-this.m_normals[s].X*this.m_normals[u].Y,this.m_sinA<5e-5&&this.m_sinA>-5e-5)return u;if(this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1),this.m_sinA*this.m_delta<0)this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[s].X+this.m_normals[u].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[s].Y+this.m_normals[u].Y*this.m_delta))),this.m_destPoly.push(new e.IntPoint(this.m_srcPoly[s])),this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[s].X+this.m_normals[s].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[s].Y+this.m_normals[s].Y*this.m_delta)));else switch(h){case e.JoinType.jtMiter:{var m=1+(this.m_normals[s].X*this.m_normals[u].X+this.m_normals[s].Y*this.m_normals[u].Y);m>=this.m_miterLim?this.DoMiter(s,u,m):this.DoSquare(s,u);break}case e.JoinType.jtSquare:this.DoSquare(s,u);break;case e.JoinType.jtRound:this.DoRound(s,u);break}return u=s,u},e.ClipperOffset.prototype.DoSquare=function(s,u){var h=Math.tan(Math.atan2(this.m_sinA,this.m_normals[u].X*this.m_normals[s].X+this.m_normals[u].Y*this.m_normals[s].Y)/4);this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[s].X+this.m_delta*(this.m_normals[u].X-this.m_normals[u].Y*h)),e.ClipperOffset.Round(this.m_srcPoly[s].Y+this.m_delta*(this.m_normals[u].Y+this.m_normals[u].X*h)))),this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[s].X+this.m_delta*(this.m_normals[s].X+this.m_normals[s].Y*h)),e.ClipperOffset.Round(this.m_srcPoly[s].Y+this.m_delta*(this.m_normals[s].Y-this.m_normals[s].X*h))))},e.ClipperOffset.prototype.DoMiter=function(s,u,h){var m=this.m_delta/h;this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[s].X+(this.m_normals[u].X+this.m_normals[s].X)*m),e.ClipperOffset.Round(this.m_srcPoly[s].Y+(this.m_normals[u].Y+this.m_normals[s].Y)*m)))},e.ClipperOffset.prototype.DoRound=function(s,u){for(var h=Math.atan2(this.m_sinA,this.m_normals[u].X*this.m_normals[s].X+this.m_normals[u].Y*this.m_normals[s].Y),m=e.Cast_Int32(e.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(h))),y=this.m_normals[u].X,C=this.m_normals[u].Y,T,I=0;I<m;++I)this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[s].X+y*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[s].Y+C*this.m_delta))),T=y,y=y*this.m_cos-this.m_sin*C,C=T*this.m_sin+C*this.m_cos;this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[s].X+this.m_normals[s].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[s].Y+this.m_normals[s].Y*this.m_delta)))},e.Error=function(s){try{throw new Error(s)}catch(u){alert(u.message)}},e.JS={},e.JS.AreaOfPolygon=function(s,u){return u||(u=1),e.Clipper.Area(s)/(u*u)},e.JS.AreaOfPolygons=function(s,u){u||(u=1);for(var h=0,m=0;m<s.length;m++)h+=e.Clipper.Area(s[m]);return h/(u*u)},e.JS.BoundsOfPath=function(s,u){return e.JS.BoundsOfPaths([s],u)},e.JS.BoundsOfPaths=function(s,u){u||(u=1);var h=e.Clipper.GetBounds(s);return h.left/=u,h.bottom/=u,h.right/=u,h.top/=u,h},e.JS.Clean=function(m,u){if(!(m instanceof Array))return[];var h=m[0]instanceof Array,m=e.JS.Clone(m);if(typeof u!="number"||u===null)return e.Error("Delta is not a number in Clean()."),m;if(m.length===0||m.length==1&&m[0].length===0||u<0)return m;h||(m=[m]);for(var y=m.length,C,T,I,F,N,W,H,te=[],le=0;le<y;le++)if(T=m[le],C=T.length,C!==0){if(C<3){I=T,te.push(I);continue}for(I=T,F=u*u,N=T[0],W=1,H=1;H<C;H++)(T[H].X-N.X)*(T[H].X-N.X)+(T[H].Y-N.Y)*(T[H].Y-N.Y)<=F||(I[W]=T[H],N=T[H],W++);N=T[W-1],(T[0].X-N.X)*(T[0].X-N.X)+(T[0].Y-N.Y)*(T[0].Y-N.Y)<=F&&W--,W<C&&I.splice(W,C-W),I.length&&te.push(I)}return!h&&te.length?te=te[0]:!h&&te.length===0?te=[]:h&&te.length===0&&(te=[[]]),te},e.JS.Clone=function(s){if(!(s instanceof Array))return[];if(s.length===0)return[];if(s.length==1&&s[0].length===0)return[[]];var u=s[0]instanceof Array;u||(s=[s]);var h=s.length,m,y,C,T,I=new Array(h);for(y=0;y<h;y++){for(m=s[y].length,T=new Array(m),C=0;C<m;C++)T[C]={X:s[y][C].X,Y:s[y][C].Y};I[y]=T}return u||(I=I[0]),I},e.JS.Lighten=function(s,u){if(!(s instanceof Array))return[];if(typeof u!="number"||u===null)return e.Error("Tolerance is not a number in Lighten()."),e.JS.Clone(s);if(s.length===0||s.length==1&&s[0].length===0||u<0)return e.JS.Clone(s);s[0]instanceof Array||(s=[s]);var h,m,y,C,T,I,F,N,W,H,te,le,ie,ge,ke,Ye,Je,bt=s.length,Mr=u*u,dt=[];for(h=0;h<bt;h++)if(y=s[h],I=y.length,I!=0){for(C=0;C<1e6;C++){for(T=[],I=y.length,y[I-1].X!=y[0].X||y[I-1].Y!=y[0].Y?(le=1,y.push({X:y[0].X,Y:y[0].Y}),I=y.length):le=0,te=[],m=0;m<I-2;m++)F=y[m],W=y[m+1],N=y[m+2],Ye=F.X,Je=F.Y,ie=N.X-Ye,ge=N.Y-Je,(ie!==0||ge!==0)&&(ke=((W.X-Ye)*ie+(W.Y-Je)*ge)/(ie*ie+ge*ge),ke>1?(Ye=N.X,Je=N.Y):ke>0&&(Ye+=ie*ke,Je+=ge*ke)),ie=W.X-Ye,ge=W.Y-Je,H=ie*ie+ge*ge,H<=Mr&&(te[m+1]=1,m++);for(T.push({X:y[0].X,Y:y[0].Y}),m=1;m<I-1;m++)te[m]||T.push({X:y[m].X,Y:y[m].Y});if(T.push({X:y[I-1].X,Y:y[I-1].Y}),le&&y.pop(),te.length)y=T;else break}I=T.length,T[I-1].X==T[0].X&&T[I-1].Y==T[0].Y&&T.pop(),T.length>2&&dt.push(T)}return!s[0]instanceof Array&&(dt=dt[0]),typeof dt>"u"&&(dt=[[]]),dt},e.JS.PerimeterOfPath=function(s,u,h){if(typeof s>"u")return 0;var m=Math.sqrt,y=0,C,T,I=0,F=0,N=0,W=0,H=s.length;if(H<2)return 0;for(u&&(s[H]=s[0],H++);--H;)C=s[H],I=C.X,F=C.Y,T=s[H-1],N=T.X,W=T.Y,y+=m((I-N)*(I-N)+(F-W)*(F-W));return u&&s.pop(),y/h},e.JS.PerimeterOfPaths=function(s,u,h){h||(h=1);for(var m=0,y=0;y<s.length;y++)m+=e.JS.PerimeterOfPath(s[y],u,h);return m},e.JS.ScaleDownPath=function(s,u){var h,m;for(u||(u=1),h=s.length;h--;)m=s[h],m.X=m.X/u,m.Y=m.Y/u},e.JS.ScaleDownPaths=function(s,u){var h,m,y;for(u||(u=1),h=s.length;h--;)for(m=s[h].length;m--;)y=s[h][m],y.X=y.X/u,y.Y=y.Y/u},e.JS.ScaleUpPath=function(s,u){var h,m,y=Math.round;for(u||(u=1),h=s.length;h--;)m=s[h],m.X=y(m.X*u),m.Y=y(m.Y*u)},e.JS.ScaleUpPaths=function(s,u){var h,m,y,C=Math.round;for(u||(u=1),h=s.length;h--;)for(m=s[h].length;m--;)y=s[h][m],y.X=C(y.X*u),y.Y=C(y.Y*u)},e.ExPolygons=function(){return[]},e.ExPolygon=function(){this.outer=null,this.holes=null},e.JS.AddOuterPolyNodeToExPolygons=function(s,u){var h=new e.ExPolygon;h.outer=s.Contour();var m=s.Childs(),y=m.length;h.holes=new Array(y);var C,T,I,F,N,W;for(I=0;I<y;I++)for(C=m[I],h.holes[I]=C.Contour(),F=0,N=C.Childs(),W=N.length;F<W;F++)T=N[F],e.JS.AddOuterPolyNodeToExPolygons(T,u);u.push(h)},e.JS.ExPolygonsToPaths=function(s){var u,h,m,y,C=new e.Paths;for(u=0,m=s.length;u<m;u++)for(C.push(s[u].outer),h=0,y=s[u].holes.length;h<y;h++)C.push(s[u].holes[h]);return C},e.JS.PolyTreeToExPolygons=function(s){var u=new e.ExPolygons,h,m,y,C;for(m=0,y=s.Childs(),C=y.length;m<C;m++)h=y[m],e.JS.AddOuterPolyNodeToExPolygons(h,u);return u},t.exports=e})(clipper);var clipperExports=clipper.exports,ClipperLib=getDefaultExportFromCjs(clipperExports);function polygonArea(t){var e=t.length,r=0,n=0,i,o;for(n=0;n<e;++n)o=t.at((n-1+e)%e),i=t.at(n),r+=(o.x+i.x)*(o.y-i.y);return .5*r}function getPolygonBounds(t){if(t.points.length<3)return null;var e=t.points.length,r=FloatPoint.from(t.points.at(0)),n=FloatPoint.from(t.points.at(0)),i=0;for(i=1;i<e;++i)n.max(t.points.at(i)),r.min(t.points.at(i));return FloatRect.fromPoints(r,n)}function pointInPolygon(t,e){if(e.points.length<3)return!1;var r=FloatPoint.from(t),n=e.points.length,i=!1,o=new FloatPoint(e.offsetx||0,e.offsety||0),a=new FloatPoint,l=new FloatPoint,f=0;for(f=0;f<n;++f){if(a.set(e.points.at(f)).add(o),l.set(e.points.at((f-1+n)%n)).add(o),r.almostEqual(a)||r.onSegment(a,l))return!1;FloatPoint.almostEqual(a,l)||a.y-t.y>0!=l.y-t.y>0&&t.x-a.x<(l.x-a.x)*(t.y-a.y)/(l.y-a.y)&&(i=!i)}return i}function toClipperCoordinates(t,e){e===void 0&&(e=1);var r=t.length,n=[],i=0,o;for(i=0;i<r;++i)o=t[i],n.push({X:o.x,Y:o.y});return e!==1&&ClipperLib.JS.ScaleUpPath(n,e),n}function toNestCoordinates(t,e){var r=t.length,n=new Array,i=0,o;for(i=0;i<r;++i)o=t[i],n.push({x:o.X/e,y:o.Y/e});return n}var FloatPolygon=function(){function t(){this._area=0,this._rotation=0}return t.fromPoints=function(e,r){var n=new t;return n.updatePoints(e),n._children=[],n._id=r,n._offset=new FloatPoint,n},t.prototype.clone=function(){var e=this._points.map(function(n){return n.clone()}),r=t.fromPoints(e,this._id);return r._rotation=this._rotation,r._offset=this._offset.clone(),this._children.map(function(n){r._children.push(n.clone())}),r},t.prototype.updatePoints=function(e){if(this._points=e.map(function(r){return FloatPoint.from(r)}),this._isValid=this._points.length>=3,!this._isValid)throw new Error("Invalid points: "+JSON.stringify(e));this._bounds=this._computeBounds(),this._area=this._getArea(),this._area>0&&(this._points.reverse(),this._area=this._getArea()),FloatPoint.almostEqual(this._points[0],this._points.at(-1))&&this._points.pop()},t.prototype.rotate=function(e){var r=new Array,n=this._points.length,i=e*Math.PI/180,o=0;for(o=0;o<n;++o)r.push(this._points[o].clone().rotate(i));var a=t.fromPoints(r,this._id);if(this.hasChildren){var l=this.childCount;for(o=0;o<l;++o)a.children.push(this._children[o].rotate(e))}return a},t.prototype.translate=function(e){this._points.map(function(r){r.add(e)})},t.prototype.pointIn=function(e){if(!this._isValid)return!1;var r=FloatPoint.from(e),n=this._points.length,i=!1,o=new FloatPoint,a=new FloatPoint,l=0;for(l=0;l<n;++l){if(o.set(this._points[l]).add(this._offset),a.set(this._points[(l-1+n)%n]).add(this._offset),r.almostEqual(o)||r.onSegment(o,a))return!1;FloatPoint.almostEqual(o,a)||o.y-e.y>0!=a.y-e.y>0&&e.x-o.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)&&(i=!i)}return i},t.prototype.polygonOffset=function(e,r,n){if(!almostEqual(e,0)){var i=toClipperCoordinates(this.points,r),o=2,a=new ClipperLib.ClipperOffset(o,n*r);a.AddPath(i,ClipperLib.JoinType.jtRound,ClipperLib.EndType.etClosedPolygon);var l=new ClipperLib.Paths;if(a.Execute(l,e*r),l.length>1)throw new Error("Bin offset too large and generated multiple bin spaces. This is not currently supported");this.updatePoints(toNestCoordinates(l[0],r))}},t.prototype.setOffset=function(e){this._offset=e.clone()},t.prototype._computeBounds=function(){if(!this._isValid)return null;var e=this._points[0],r=this._points.length,n=FloatPoint.from(e),i=FloatPoint.from(e),o=0;for(o=1;o<r;++o)e=this._points[o],i.max(e),n.min(e);return FloatRect.fromPoints(n,i)},t.prototype._getArea=function(){var e=this._points.length,r=0,n=0,i,o;for(n=0;n<e;++n)o=this._points[(n-1+e)%e],i=this._points[n],r+=(o.x+i.x)*(o.y-i.y);return .5*r},Object.defineProperty(t.prototype,"points",{get:function(){return this._points},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isValid",{get:function(){return this._isValid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bound",{get:function(){return this._bounds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this._area},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstPoint",{get:function(){return this._points[0]||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._bounds?this._bounds.x:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._bounds?this._bounds.y:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._bounds!==null?this._bounds.width:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._bounds!==null?this._bounds.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetx",{get:function(){return this._offset.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsety",{get:function(){return this._offset.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this._offset},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"min",{get:function(){var e=FloatPoint.from(this._points[0]),r=0,n=this._points.length;for(r=1;r<n;++r)e.min(this._points[r]);return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=FloatPoint.from(this._points[0]),r=0,n=this._points.length;for(r=1;r<n;++r)e.max(this._points[r]);return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasChildren",{get:function(){return this._children.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bounds",{get:function(){return this._bounds},enumerable:!1,configurable:!0}),t}(),SharedPolygon=function(){function t(e){this._configuration=e}return t.prototype._polygonOffset=function(e,r){if(almostEqual(r,0))return[e];var n=this.svgToClipper(e),i=2,o=new ClipperLib.ClipperOffset(i,this._configuration.curveTolerance*this._configuration.clipperScale);o.AddPath(n,ClipperLib.JoinType.jtRound,ClipperLib.EndType.etClosedPolygon);var a=new ClipperLib.Paths;o.Execute(a,r*this._configuration.clipperScale);var l=[],f=0;if(a.lengths==1)return[this.clipperToSvg(a[0],e.id)];for(f=0;f<a.length;++f)l.push(this.clipperToSvg(a[f],e.id+"_offset_"+f));return l},t.prototype.svgToClipper=function(e){return toClipperCoordinates(e.points,this._configuration.clipperScale)},t.prototype.clipperToSvg=function(e,r){return FloatPolygon.fromPoints(toNestCoordinates(e,this._configuration.clipperScale),r)},Object.defineProperty(t.prototype,"curveTolerance",{get:function(){return this._configuration.curveTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clipperScale",{get:function(){return this._configuration.clipperScale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spacing",{get:function(){return this._configuration.spacing},enumerable:!1,configurable:!0}),t}(),__extends=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),TreePolygon=function(t){__extends(e,t);function e(r,n,i){var o=t.call(this,n)||this;return o._polygons=r,i&&o._offsetTree(o._polygons,o.spacing*.5),o}return e.prototype.removeDuplicats=function(){},e.prototype.at=function(r){return this._polygons[r]},e.prototype.byId=function(r){var n=this._polygons.filter(function(i){return i.id==r});if(n.length==1)return n[0]},e.prototype.flat=function(r){var n=this._polygons[r];return n.children&&n.children.length>0?e.flattenTree(n.children,!0):null},e.prototype._offsetTree=function(r,n){if(!(!r||r.length==0)){var i=0,o,a,l=r.length;for(i=0;i<l;++i){if(o=r[i],!o){console.warn("empty node in tree, this is probably bad?");continue}a=this._polygonOffset(o,n),a.length==1&&o.updatePoints(a[0].points),o.children&&o.children.length>0&&this._offsetTree(o.children,-n)}}},Object.defineProperty(e.prototype,"polygons",{get:function(){return this._polygons.slice()},enumerable:!1,configurable:!0}),e.flattenTree=function(r,n,i){i===void 0&&(i=[]);var o=r.length,a=0,l,f;for(a=0;a<o;++a)l=r[a],l.hole=n,f=l.children,i.push(l),f&&f.length>0&&e.flattenTree(f,!n,i);return i},e}(SharedPolygon);/*!
 * General purpose geometry functions for polygon/Bezier calculations
 * Copyright 2015 Jack Qiao
 * Licensed under the MIT license
 */var TOL=Math.pow(10,-9);function checkIntersection(t,e,r){var n=Math.abs(t-e);return n>=Math.pow(10,-9)&&Math.abs(2*r-t-e)<=n}function isRectangle(t){var e=t.points.length,r=getPolygonBounds(t),n=r.bottomLeft,i=r.topRight,o=0,a;for(o=0;o<e;++o)if(a=t.points.at(o),!almostEqual(a.x,n.x)&&!almostEqual(a.x,i.x)||!almostEqual(a.y,n.y)&&!almostEqual(a.y,i.y))return!1;return!0}function lineIntersect(t,e,r,n,i){i===void 0&&(i=!1);var o=e.y-t.y,a=t.x-e.x,l=e.x*t.y-t.x*e.y,f=n.y-r.y,d=r.x-n.x,g=n.x*r.y-r.x*n.y,b=o*d-f*a,_=new FloatPoint((a*g-d*l)/b,(f*l-o*g)/b);return!isFinite(_.x)||!isFinite(_.y)||!i&&(checkIntersection(t.x,e.x,_.x)||checkIntersection(t.y,e.y,_.y)||checkIntersection(r.x,n.x,_.x)||checkIntersection(r.y,n.y,_.y))?null:_}function checkPolygon(t,e,r,n,i,o,a){var l=t.points.length,f=(i+o+l)%l;return(f===i||FloatPoint.almostEqual(t.points.at(f),t.points.at(i)))&&(f=(f+o+l)%l),r.set(t.points.at(f)).add(a),pointInPolygon(r,e)!==pointInPolygon(n,e)}function intersect$1(t,e){var r=new FloatPoint(t.offsetx||0,t.offsety||0),n=new FloatPoint(e.offsetx||0,e.offsety||0),i=t.points.length,o=e.points.length,a=new FloatPoint,l=new FloatPoint,f=new FloatPoint,d=new FloatPoint,g=new FloatPoint,b=0,_=0;for(b=0;b<i-1;++b)for(a.set(t.points.at(b)).add(r),l.set(t.points.at(b+1)).add(r),_=0;_<o-1;++_){if(f.set(e.points.at(_)).add(n),d.set(e.points.at(_+1)).add(n),f.onSegment(a,l)||f.almostEqual(a)){if(checkPolygon(e,t,g,d,_,-1,n))return!0;continue}if(d.onSegment(a,l)||d.almostEqual(l)){if(checkPolygon(e,t,g,f,_+1,1,n))return!0;continue}if(a.onSegment(f,d)||a.almostEqual(d)){if(checkPolygon(t,e,g,l,b,-1,r))return!0;continue}if(l.onSegment(f,d)||l.almostEqual(f)){if(checkPolygon(t,e,g,a,b+1,1,r))return!0;continue}if(lineIntersect(f,d,a,l)!==null)return!0}return!1}function pointDistance(t,e,r,n,i){i===void 0&&(i=!1);var o=FloatPoint.normalizeVector(n),a=FloatPoint.normal(o),l=a.dot(t),f=a.dot(e),d=a.dot(r),g=o.dot(t),b=o.dot(e),_=o.dot(r),E=g-b,k=g-_,D=l-f,L=l-d;if(!i){if(D<TOL&&L<TOL||D>-TOL&&L>-TOL)return-1;if(almostEqual(l,f)&&almostEqual(l,d)&&E>0&&k>0)return Math.min(E,k);if(almostEqual(l,f)&&almostEqual(l,d)&&E<0&&E<0)return Math.max(E,k)}return(b-_)*D/(f-d)-E}function segmentDistance(t,e,r,n,i){var o=FloatPoint.normal(i),a=FloatPoint.reverse(i),l=o.dot(t),f=o.dot(e),d=o.dot(r),g=o.dot(n),b=i.dot(t),_=i.dot(e),E=i.dot(r),k=i.dot(n),D=Math.min(l,f),L=Math.max(l,f),M=Math.max(d,g),U=Math.min(d,g),R=FloatPoint.sub(t,e),z=FloatPoint.sub(r,n);if(almostEqual(L,U)||almostEqual(D,M)||L<U||D>M)return null;var X=1,se=L-M,$=D-U;if(Math.abs(se+$)>=Math.abs(se-$)){var q=Math.min(L,M),ee=Math.max(D,U),Pe=Math.max(L,M),ce=Math.min(D,U);X=(q-ee)/(Pe-ce)}var ve=FloatPoint.sub(t,r),we=FloatPoint.sub(t,n),ue=ve.cross(R,-1),pe=we.cross(R,-1);if(almostEqual(ue,0)&&almostEqual(pe,0)){var Q=FloatPoint.normal(R),re=FloatPoint.normal(z);if(Q.scale(1/Q.length),re.scale(1/re.length),Math.abs(Q.cross(re,-1))<TOL&&Q.dot(re)<0){var ye=i.dot(Q);if(almostEqual(ye,0))return null;if(ye<0)return 0}return null}var me=[],ae=null,fe=0;return almostEqual(l,d)?me.push(b-E):almostEqual(l,g)?me.push(b-k):l>U&&l<M&&(ae=pointDistance(t,r,n,a),ae!==null&&Math.abs(ae)<TOL&&(fe=pointDistance(e,r,n,a,!0),(fe<0||Math.abs(fe*X)<TOL)&&(ae=null)),ae!==null&&me.push(ae)),almostEqual(f,d)?me.push(_-E):almostEqual(f,g)?me.push(_-k):f>U&&f<M&&(ae=pointDistance(e,r,n,a),ae!==null&&Math.abs(ae)<TOL&&(fe=pointDistance(t,r,n,a,!0),(fe<0||Math.abs(fe*X)<TOL)&&(ae=null)),ae!==null&&me.push(ae)),d>D&&d<L&&(ae=pointDistance(r,t,e,i),ae!==null&&Math.abs(ae)<TOL&&(fe=pointDistance(n,t,e,i,!0),(fe<0||Math.abs(fe*X)<TOL)&&(ae=null)),ae!==null&&me.push(ae)),g>D&&g<L&&(ae=pointDistance(n,t,e,i),ae!==null&&Math.abs(ae)<TOL&&(fe=pointDistance(r,t,e,i,!0),(fe<0||Math.abs(fe*X)<TOL)&&(ae=null)),ae!==null&&me.push(ae)),me.length?Math.min.apply(Math,me):null}function polygonSlideDistance(t,e,r,n){var i=new FloatPoint,o=new FloatPoint,a=new FloatPoint,l=new FloatPoint,f=new FloatPoint(t.offsetx||0,t.offsety||0),d=new FloatPoint(e.offsetx||0,e.offsety||0),g=FloatPoint.normalizeVector(r),b=FloatPolygon.fromPoints(t.points,t.id),_=FloatPolygon.fromPoints(e.points,e.id),E=b.points.length,k=_.points.length,D=null,L=null,M=0,U=0;for(b.points.at(0)!=b.points.at(E-1)&&(++E,b.points.push(b.points.at(0))),_.points.at(0)!=_.points.at(k-1)&&(++k,_.points.push(_.points.at(0))),M=0;M<k-1;++M)if(a.set(_.points.at(M)).add(d),l.set(_.points.at(M+1)).add(d),!FloatPoint.almostEqual(a,l))for(U=0;U<E-1;++U)i.set(b.points.at(U)).add(f),o.set(b.points.at(U+1)).add(f),!FloatPoint.almostEqual(i,o)&&(L=segmentDistance(i,o,a,l,g),L!==null&&(D===null||L<D)&&(L>0||almostEqual(L,0))&&(D=L));return D}function polygonProjectionDistance(t,e,r){var n=new FloatPoint(t.offsetx||0,t.offsety||0),i=new FloatPoint(e.offsetx||0,e.offsety||0),o=FloatPolygon.fromPoints(t.points,t.id),a=FloatPolygon.fromPoints(e.points,e.id),l=new FloatPoint,f=new FloatPoint,d=new FloatPoint,g=null,b=null,_=o.points.length,E=a.points.length,k=null,D=0,L=0;for(o.points.at(0)!=o.points.at(_-1)&&(++_,o.points.push(o.points.at(0))),a.points.at(0)!=a.points.at(E-1)&&(++E,a.points.push(a.points.at(0))),D=0;D<E;++D){for(k=null,l.set(a.points.at(D)).add(i),L=0;L<_-1;++L)f.set(o.points.at(L)).add(n),d.set(o.points.at(L+1)).add(n),!almostEqual((d.y-f.y)*r.x,(d.x-f.x)*r.y)&&(b=pointDistance(l,f,d,r),b!==null&&(k===null||b<k)&&(k=b));k!==null&&(g===null||k>g)&&(g=k)}return g}function searchStartPoint(t,e,r,n){n===void 0&&(n=[]);var i=FloatPolygon.fromPoints(t.points,t.id),o=FloatPolygon.fromPoints(e.points,e.id),a=new FloatPoint,l=new FloatPoint,f=0,d=0,g=0,b=0,_=0,E=0,k=0,D=i.points.length,L=o.points.length;for(i.points.at(0)!=i.points.at(D-1)&&(++D,i.points.push(i.points.at(0))),o.points.at(0)!=o.points.at(L-1)&&(++L,o.points.push(o.points.at(0))),f=0;f<D-1;++f)if(!i.points.at(f).marked)for(i.points.at(f).marked=!0,d=0;d<L;++d){a.set(i.points.at(f)).sub(o.points.at(d)),o.setOffset(a);var M=null;for(g=0;g<L&&(M=pointInPolygon(l.set(o.points.at(g)).add(a),i),M==null);++g);if(M==null)return null;if(M==r&&!intersect$1(i,o)&&!inNfp(a,n))return a.clone();if(l.set(i.points.at(f+1)).sub(i.points.at(f)),b=polygonProjectionDistance(i,o,l),_=polygonProjectionDistance(o,i,FloatPoint.reverse(l)),!(b===null&&_===null)&&(b=b===null?_:b,_=_===null?b:_,k=Math.min(b,_),!(Math.abs(k)<TOL||k<=0))){for(E=l.length,k-E<-TOL&&l.scale(k/E),a.add(l),o.setOffset(a),M=null,g=0;g<L&&(M=pointInPolygon(l.set(o.points.at(g)).add(a),i),M==null);++g);if(M==r&&!intersect$1(i,o)&&!inNfp(a,n))return a.clone()}}return null}function inNfp(t,e){if(e===void 0&&(e=[]),e.length==0)return!1;var r=e.length,n=0,i=0,o=0,a;for(i=0;i<r;++i)for(a=e.at(i),n=a.length,o=0;o<n;++o)if(FloatPoint.almostEqual(t,a.at(o)))return!0;return!1}function noFitPolygon(t,e,r,n){if(t.points.length<3||e.points.length<3)return null;t.setOffset(new FloatPoint(0,0));var i=t.points.length,o=e.points.length,a=0,l=0,f=t.points.at(0).y,d=0,g=e.points.at(0).y,b=0;for(a=1;a<i;++a)t.points.at(a).marked=!1,t.points.at(a).y<f&&(f=t.points.at(a).y,d=a);for(a=1;a<o;++a)e.points.at(a).marked=!1,e.points.at(a).y>g&&(g=e.points.at(a).y,b=a);for(var _=r?searchStartPoint(t,e,!0):FloatPoint.sub(e.points.at(b),t.points.at(d)),E=new FloatPoint,k=new FloatPoint,D=new FloatPoint,L=new FloatPoint,M=new FloatPoint,U=new FloatPoint,R=new FloatPoint,z=new FloatPoint,X=[],se=i+o,$=0,q,ee,Pe,ce,ve,we,ue=!1,pe=null,Q=null,re=0,ye=0,me=0,ae=0,fe=0,Ae=0,De=0,Re,qe,Ke,$e,He,Se,_e,Be;_!==null;){for(D.set(_),e.setOffset(D),pe=null,Q=new Array,Q.push(FloatPoint.add(e.points.at(0),_)),E.set(e.points.at(0)).add(_),k.set(E),$=0;$<10*se;){for(q=[],a=0;a<i;++a)for(l=0;l<o;++l)L.set(e.points.at(l)).add(D),M.set(e.points.at((l+1)%o)).add(D),U.set(t.points.at(a)),FloatPoint.almostEqual(t.points.at(a),L)?q.push({type:0,A:a,B:l}):L.onSegment(t.points.at(a),t.points.at((a+1)%i))?q.push({type:1,A:(a+1)%i,B:l}):U.onSegment(L,M)&&q.push({type:2,A:a,B:(l+1)%o});for(ee=[],a=0;a<q.length;++a)Be=q.at(a),Se=t.points.at(Be.A),Se.marked=!0,ye=(Be.A-1+i)%i,me=(Be.A+1)%i,qe=t.points.at(ye),Ke=t.points.at(me),_e=e.points.at(Be.B),ae=(Be.B-1+o)%o,fe=(Be.B+1)%o,$e=e.points.at(ae),He=e.points.at(fe),Be.type==0?(Pe=FloatPoint.sub(Se,qe),ce=FloatPoint.sub(Se,Ke),ve=FloatPoint.sub($e,_e),we=FloatPoint.sub(He,_e),Pe.start=Se,Pe.end=qe,ce.start=Se,ce.end=Ke,ve.start=$e,ve.end=_e,we.start=He,we.end=_e,ee.push(Pe),ee.push(ce),ee.push(ve),ee.push(we)):Be.type==1?(ee.push({x:Se.x-(_e.x+D.x),y:Se.y-(_e.y+D.y),start:qe,end:Se}),ee.push({x:qe.x-(_e.x+D.x),y:qe.y-(_e.y+D.y),start:Se,end:qe})):Be.type==2&&(ee.push({x:Se.x-(_e.x+D.x),y:Se.y-(_e.y+D.y),start:$e,end:_e}),ee.push({x:Se.x-($e.x+D.x),y:Se.y-($e.y+D.y),start:_e,end:$e}));for(Re=null,De=0,a=0;a<ee.length;++a)ee.at(a).x===0&&ee.at(a).y===0||(L.set(ee.at(a)),!(pe&&L.dot(pe)<0&&(M.set(pe),z.set(L).scale(1/L.length),R.set(pe).scale(1/M.length),Math.abs(z.cross(R,-1))<1e-4))&&(Ae=polygonSlideDistance(t,e,L),(Ae===null||Ae*Ae>L.squareLength)&&(Ae=L.length),Ae!==null&&Ae>De&&(De=Ae,Re=ee.at(a))));if(Re===null||almostEqual(De,0)){Q=null;break}if(Re.start.marked=!0,Re.end.marked=!0,pe=Re,re=Re.x*Re.x+Re.y*Re.y,De*De<re&&!almostEqual(De*De,re)){var rt=Math.sqrt(De*De/re);Re.x*=rt,Re.y*=rt}if(E.add(Re),E.almostEqual(k))break;if(ue=!1,Q.length>0){for(a=0;a<Q.length-1;++a)if(E.almostEqual(Q.at(a))){ue=!0;break}}if(ue)break;Q.push(E.clone()),D.add(Re),e.setOffset(D),++$}if(Q&&Q.length>0&&X.push(Q),!n)break;_=searchStartPoint(t,e,r,X)}return X}function noFitPolygonRectangle(t,e){var r=t.points.at(0),n=e.points.at(0),i=FloatPoint.from(r),o=FloatPoint.from(r),a=FloatPoint.from(n),l=FloatPoint.from(n),f=0,d;for(f=1;f<t.points.length;++f)d=t.points.at(f),i.min(d),o.max(d);for(f=1;f<e.points.length;++f)d=e.points.at(f),a.min(d),l.max(d);var g=FloatPoint.sub(i,o),b=FloatPoint.sub(a,l);if(b.x>g.x||b.y>g.y)return null;var _=FloatPoint.add(i,n),E=FloatPoint.add(o,n);return[[{x:_.x-a.x,y:_.y-a.y},{x:E.x-l.x,y:_.y-a.y},{x:E.x-l.x,y:E.y-l.y},{x:_.x-a.x,y:E.y-l.y}]]}function minkowskiDifference(t,e){var r=0,n,i=null,o,a,l=toClipperCoordinates(t.points),f=toClipperCoordinates(e.points);for(ClipperLib.JS.ScaleUpPath(l,1e7),ClipperLib.JS.ScaleUpPath(f,1e7),r=0;r<f.length;++r)f.at(r).X*=-1,f.at(r).Y*=-1;var d=ClipperLib.Clipper.MinkowskiSum(l,f,!0),g=d.length;for(r=0;r<g;++r)o=toNestCoordinates(d.at(r),1e7),a=polygonArea(o),(i===null||i>a)&&(n=o,i=a);for(r=0;r<n.length;++r)n.at(r).x+=e.points.at(0).x,n.at(r).y+=e.points.at(0).y;return[n]}function pairData(t,e){if(!t)return null;var r=e.searchEdges,n=e.useHoles,i=keyToNFPData(t.key),o=t.A.rotate(i.r1),a=t.B.rotate(i.r2),l,f=0;if(i.inside)if(isRectangle(o)?l=noFitPolygonRectangle(o,a):l=noFitPolygon(o,a,!0,r),l&&l.length>0)for(f=0;f<l.length;++f)polygonArea(l.at(f))>0&&l.at(f).reverse();else return console.log("NFP Warning: ",i),null;else{if(r?l=noFitPolygon(o,a,!1,r):l=minkowskiDifference(o,a),!l||l.length==0)return console.log("NFP Error: ",i),console.log("A: ",JSON.stringify(o)),console.log("B: ",JSON.stringify(a)),null;for(f=0;f<l.length;++f)if((!r||f==0)&&Math.abs(polygonArea(l.at(f)))<Math.abs(polygonArea(o.points)))return console.log("NFP Area Error: ",Math.abs(polygonArea(l.at(f))),i),console.log("computed area for a: "+polygonArea(o.points)),console.log("NFP:",JSON.stringify(l.at(f))),console.log("A: ",JSON.stringify(o)),console.log("B: ",JSON.stringify(a)),l.splice(f,1),null;if(l.length==0)return null;for(f=0;f<l.length;++f)polygonArea(l.at(f))>0&&l.at(f).reverse(),f>0&&pointInPolygon(l.at(f).at(0),FloatPolygon.fromPoints(l.at(0),""))&&polygonArea(l.at(f))<0&&l.at(f).reverse();if(n&&o.children&&o.children.length>0){var d=getPolygonBounds(a),g=void 0,b=void 0,_=0;for(f=0;f<o.children.length;++f)if(g=getPolygonBounds(o.children.at(f)),g.width>d.width&&g.height>d.height&&(b=noFitPolygon(o.children.at(f),a,!0,r),b&&b.length>0))for(_=0;_<b.length;++_)polygonArea(b.at(_))<0&&b.at(_).reverse(),l.push(b.at(_))}}var E=l.map(function(k){return FloatPolygon.fromPoints(k,"")});return{value:E,key:t.key}}function placePaths(t,e){if(!e.binPolygon)return null;var r=[],n=[],i=Math.abs(e.binPolygon.area),o=0,a=0,l=0,f=0,d=0,g,b,_=0,E,k,D,L,M,U,R,z,X,se,$,q,ee,Pe,ce,ve=null,we=null,ue,pe,Q,re,ye=.1*e.config.clipperScale*e.config.clipperScale,me=1e-4*e.config.clipperScale,ae=e.config.rotations;for(o=0;o<t.length;++o)g=t.at(o),b=g.rotate(g.rotation),b.rotation=g.rotation,r.push(b);for(;r.length>0;){for(D=[],L=[],_+=1,o=0;o<r.length;++o)if(g=r.at(o),k=generateNFPCacheKey(ae,!0,e.binPolygon,g),M=e.nfpCache.get(k),!(!M||M.length==0)){for(U=!1,a=0;a<D.length;++a)if(k=generateNFPCacheKey(ae,!1,D.at(a),g),!e.nfpCache.has(k)){U=!0;break}if(!U){if(R=null,D.length==0){for(a=0;a<M.length;++a){var fe=M.at(a);for(l=0;l<fe.points.length;++l)(R===null||fe.points.at(l).x-g.points.at(0).x<R.x)&&(R={translate:{x:fe.points.at(l).x-g.points.at(0).x,y:fe.points.at(l).y-g.points.at(0).y},id:g.id,rotate:g.rotation})}L.push(R),D.push(g);continue}for(z=[],a=0;a<M.length;++a)z.push(toClipperCoordinates(M.at(a).points));for(ClipperLib.JS.ScaleUpPaths(z,e.config.clipperScale),X=new ClipperLib.Clipper,se=new ClipperLib.Paths,a=0;a<D.length;++a)if(k=generateNFPCacheKey(ae,!1,D.at(a),g),!!e.nfpCache.has(k))for(E=e.nfpCache.get(k),l=0;l<E.length;++l){for(re=toClipperCoordinates(E.at(l).points),f=0;f<re.length;++f)re.at(f).X+=L.at(a).translate.x,re.at(f).Y+=L.at(a).translate.y;ClipperLib.JS.ScaleUpPath(re,e.config.clipperScale),re=ClipperLib.Clipper.CleanPolygon(re,me),pe=Math.abs(ClipperLib.Clipper.Area(re)),re.length>2&&pe>ye&&X.AddPath(re,ClipperLib.PolyType.ptSubject,!0)}if(X.Execute(ClipperLib.ClipType.ctUnion,se,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero)&&($=new ClipperLib.Paths,X=new ClipperLib.Clipper,X.AddPaths(se,ClipperLib.PolyType.ptClip,!0),X.AddPaths(z,ClipperLib.PolyType.ptSubject,!0),!!X.Execute(ClipperLib.ClipType.ctDifference,$,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero))){for($=ClipperLib.Clipper.CleanPolygons($,me),a=0;a<$.length;++a)pe=Math.abs(ClipperLib.Clipper.Area($.at(a))),($.at(a).length<3||pe<ye)&&($.splice(a,1),a--);if(!(!$||$.length==0)){for(q=[],a=0;a<$.length;++a)q.push(toNestCoordinates($.at(a),e.config.clipperScale));for($=q,ve=null,we=null,a=0;a<$.length;++a)for(ue=$.at(a),l=0;l<ue.length;++l){for(ee=new Array,f=0;f<D.length;++f)for(d=0;d<D.at(f).points.length;++d)ee.push(FloatPoint.from(D.at(f).points.at(d)).add(L.at(f).translate));for(Q={translate:{x:ue.at(l).x-g.points.at(0).x,y:ue.at(l).y-g.points.at(0).y},id:g.id,rotate:g.rotation},f=0;f<g.points.length;++f)ee.push(FloatPoint.from(g.points.at(f)).add(Q.translate));ce=getPolygonBounds(FloatPolygon.fromPoints(ee,"")),pe=ce.width*2+ce.height,(ve===null||pe<ve||almostEqual(ve,pe)&&(we===null||Q.translate.x<we))&&(ve=pe,ce.width,R=Q,we=Q.translate.x)}R&&(D.push(g),L.push(R))}}}}for(ve&&(_+=ve/i),o=0;o<D.length;++o)Pe=r.indexOf(D.at(o)),Pe>=0&&r.splice(Pe,1);if(L&&L.length>0)n.push(L);else break}return _+=2*r.length,{placements:n,fitness:_,paths:r,area:i}}/*!
 * SvgNest
 * Licensed under the MIT license
 */var __awaiter=function(t,e,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function l(g){try{d(n.next(g))}catch(b){a(b)}}function f(g){try{d(n.throw(g))}catch(b){a(b)}}function d(g){g.done?o(g.value):i(g.value).then(l,f)}d((n=n.apply(t,e||[])).next())})},__generator=function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(d){return function(g){return f([d,g])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(r=0)),r;)try{if(n=1,i&&(o=d[0]&2?i.return:d[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,d[1])).done)return o;switch(i=0,o&&(d=[d[0]&2,o.value]),d[0]){case 0:case 1:o=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,i=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){r.label=d[1];break}if(d[0]===6&&r.label<o[1]){r.label=o[1],o=d;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(d);break}o[2]&&r.ops.pop(),r.trys.pop();continue}d=e.call(t,r)}catch(g){d=[6,g],i=0}finally{n=o=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},AnyNest=function(){function t(){this._best=null,this._isWorking=!1,this._progress=0,this._tree=null,this._binPolygon=null,this._workerTimer=null,this._nfpCache=new Map,this._configuration={clipperScale:1e7,curveTolerance:.3,spacing:0,binSpacing:0,rotations:4,populationSize:10,mutationRate:50,useHoles:!1,exploreConcave:!1},this._genethicAlgorithm=new GeneticAlgorithm}return t.prototype.setBin=function(e){this._binPolygon=e.clone(),this._binPolygon.translate(this._binPolygon.min.scale(-1));var r=-1*this._configuration.binSpacing;this._binPolygon.polygonOffset(r,this._configuration.clipperScale,this._configuration.curveTolerance)},t.prototype.setParts=function(e){this._tree=new TreePolygon(e,this._configuration,!0)},t.prototype.config=function(e){if(this._binPolygon||this._tree)throw new Error("Config must be set before bin and parts in order to behave correctly.");if(!e)return this._configuration;for(var r in this._configuration)e[r]&&(this._configuration[r]=e[r]);return this._best=null,this._nfpCache.clear(),this._genethicAlgorithm.clear(),this._configuration},t.prototype.getConfig=function(){return this._configuration},t.prototype.start=function(e,r){var n=this;if(!this._binPolygon)throw new Error("Missing bin for packing. Ensure you have called setBin");if(!this._tree)throw new Error("Missing shapes for nesting. Ensure you have called setParts");this._tree.removeDuplicats(),this._isWorking=!1,this._workerTimer=setInterval(function(){if(!n._isWorking)try{n._launchWorkers(r),n._isWorking=!0}catch(i){console.log(i)}e(n._progress)},100)},t.prototype.stop=function(){this._isWorking=!1,this._workerTimer&&(clearInterval(this._workerTimer),this._workerTimer=null)},t.prototype._calculateNfpPairs=function(e,r){return __awaiter(this,void 0,void 0,function(){var n,i;return __generator(this,function(o){for(n=[],i=0;i<r.length;i++)n.push(pairData(r[i],{rotations:this._configuration.rotations,binPolygon:this._binPolygon,searchEdges:this._configuration.exploreConcave,useHoles:this._configuration.useHoles})),this._progress=n.length/r.length;return[2,n]})})},t.prototype._launchWorkers=function(e){var r=this,n=0,i=0;if(this._genethicAlgorithm.isEmpty){var o=this._tree.polygons;o.sort(function(U,R){return Math.abs(polygonArea(R.points))-Math.abs(polygonArea(U.points))}),this._genethicAlgorithm.init(o,this._binPolygon.bounds,this._configuration)}var a=this._genethicAlgorithm.individual,l=a.placement,f=a.rotation,d=l.length,g=[],b=[],_=new Map,E,k,D=function(U,R,z,X,se){k=generateNFPCacheKey(r._configuration.rotations,se,U,R,z,X),r._nfpCache.has(k)?_.set(k,r._nfpCache.get(k)):b.push({A:U,B:R,key:k})};for(n=0;n<d;++n)for(E=l[n],g.push(E.id),E.rotation=f[n],D(this._binPolygon,E,0,f[n],!0),i=0;i<n;++i)D(l[i],E,f[i],f[n],!1);this._nfpCache=_;var L={binPolygon:this._binPolygon,paths:l.slice(),ids:g,rotations:f,config:this._configuration,nfpCache:this._nfpCache},M=this._calculateNfpPairs(4,b);M.then(function(U){if(U){var R=0,z=void 0;for(R=0;R<U.length;++R)z=U[R],z&&r._nfpCache.set(z.key,z.value)}return L.nfpCache=r._nfpCache,[placePaths(l.slice(),L)]}).then(function(U){if(!(!U||U.length==0)){var R=0,z=0,X=U[0];for(a.fitness=X.fitness,R=1;R<U.length;++R)U[R].fitness<X.fitness&&(X=U[R]);if(!r._best||X.fitness<r._best.fitness){r._best=X;var se=0,$=0,q=void 0;for(Math.abs(r._binPolygon.area),R=0;R<r._best.placements.length;++R)for(q=r._best.placements[R],$+=q.length,z=0;z<q.length;++z){if(!q[z])throw new Error("missing entry in placement: "+JSON.stringify(r._best));var ee=r._tree.byId(q[z].id);se+=Math.abs(polygonArea(ee.points))}}e(r._best.placements,r._best.fitness),r._isWorking=!1}},function(U){console.log(U)}).catch(function(U){console.log(U)})},t}(),library={};let loaded=!1;const init=async()=>{if(loaded)return Promise.resolve(!0);const t=await Module({locateFile:()=>opencascadeWasm});return loaded=!0,setOC(t),!0},started=init();console.log("Replicad Module:"),console.log(replicad);function toGeometry(t){return typeof t=="number"?library[t]:t.geometry?t:{geometry:[t],tags:[],color:"#FF9065",bom:[]}}function generateUniqueID(){const t=new Date().getTime(),e=Math.floor(Math.random()*1e3);return t+e}function deleteFromLibrary(t){return started.then(()=>{delete library[t]})}function createMesh(t){return started.then(()=>[])}function circle(t,e){return started.then(()=>{const r=new Plane().pivot(0,"Y");return library[t]={geometry:[drawCircle(e/2)],tags:[],plane:r,color:"#FF9065",bom:[]},!0})}function rectangle(t,e,r){return started.then(()=>{const n=new Plane().pivot(0,"Y");return library[t]={geometry:[drawRectangle(e,r)],tags:[],plane:n,color:"#FF9065",bom:[]},!0})}function regularPolygon(t,e,r){return started.then(()=>{const n=new Plane().pivot(0,"Y");return library[t]={geometry:[drawPolysides(e,r)],tags:[],plane:n,color:"#FF9065",bom:[]},!0})}async function text(t,e,r,n){return await loadFont(fonts[n]).then(()=>console.log("Font loaded")).catch(i=>console.error("Error loading font: ",i)),started.then(()=>{const i=new Plane().pivot(0,"Y"),o=drawText(e,{startX:0,startY:0,fontSize:r,font:n});return library[t]={geometry:[o],tags:[],plane:i,color:"#FF9065",bom:[]},!0})}function loftShapes(t,e){return started.then(()=>{let r=[];e.forEach(o=>{if(is3D(library[o]))throw new Error("Parts to be lofted must be sketches");let l=digFuse(library[o]).sketchOnPlane(library[o].plane);if(!l.sketches)r.push(l);else throw new Error("Sketches to be lofted can't have interior geometries")});let n=r.shift();const i=new Plane().pivot(0,"Y");return library[t]={geometry:[n.loftWith([...r])],tags:[],plane:i,color:"#FF9065",bom:[]},!0})}function extrude(t,e,r){return started.then(()=>(library[t]=actOnLeafs(library[e],n=>({geometry:[n.geometry[0].clone().sketchOnPlane(n.plane).extrude(r)],tags:n.tags,plane:n.plane,color:n.color,bom:n.bom})),!0))}function is3D(t){return isAssembly(t)?t.geometry.some(e=>is3D(e)):t.geometry[0].mesh!==void 0}function move(t,e,r,n,i){return started.then(()=>(is3D(library[e])?library[t]=actOnLeafs(library[e],o=>({geometry:[o.geometry[0].clone().translate(r,n,i)],plane:o.plane,tags:o.tags,color:o.color,bom:o.bom})):library[t]=actOnLeafs(library[e],o=>({geometry:[o.geometry[0].clone().translate([r,n])],tags:o.tags,plane:o.plane.translate([0,0,i]),color:o.color,bom:o.bom}),library[e].plane.translate([0,0,i])),!0))}function rotate(t,e,r,n,i=null){let o=toGeometry(t);return started.then(()=>{if(is3D(o)){let a=actOnLeafs(o,l=>({geometry:[l.geometry[0].clone().rotate(e,[0,0,0],[1,0,0]).rotate(r,[0,0,0],[0,1,0]).rotate(n,[0,0,0],[0,0,1])],tags:l.tags,plane:l.plane,color:l.color,bom:l.bom}));if(i)library[i]=a;else return a}else{let a=actOnLeafs(toGeometry(t),l=>({geometry:[l.geometry[0].clone().rotate(n,[0,0,0],[0,0,1])],tags:l.tags,plane:l.plane.pivot(e,"X").pivot(r,"Y"),color:l.color,bom:l.bom}));if(i)library[i]=a;else return a}})}function difference(t,e,r){return started.then(()=>{let n;if(is3D(library[e])&&is3D(library[r])||!is3D(library[e])&&!is3D(library[r]))n=digFuse(library[r]),library[t]=actOnLeafs(library[e],i=>({geometry:[i.geometry[0].clone().cut(n)],tags:i.tags,color:i.color,plane:i.plane,bom:i.bom}));else throw new Error("Both inputs must be either 3D or 2D");return!0})}function shrinkWrapSketches(t,e){return started.then(()=>{let r=[];if(e.every(n=>!is3D(library[n]))){let n=[];e.forEach(a=>{let l=digFuse(library[a]);if(n.push(l),l.innerShape.blueprints)throw new Error("Sketches to be lofted can't have interior geometries");r.push(library[a].bom)});let i=chainFuse(n);const o=new Plane().pivot(0,"Y");return library[t]={geometry:[shrinkWrap(i,50)],tags:[],color:"#FF9065",plane:o,bom:r},!0}else throw new Error("All inputs must be sketches")})}function intersect(t,e,r){return started.then(()=>(library[t]=actOnLeafs(library[e],n=>{const i=digFuse(library[r]);return{geometry:[n.geometry[0].clone().intersect(i)],tags:n.tags,color:n.color,plane:n.plane,bom:n.bom}}),!0))}function tag(t,e,r){return started.then(()=>(library[t]={geometry:library[e].geometry,bom:library[e].bom,tags:[...r,...library[e].tags],color:library[e].color,plane:library[e].plane},!0))}async function Rotate(t,e,r,n){try{return await rotate(t,e,r,n)}catch(i){throw console.error("Error rotating geometry:",i),i}}async function Assembly(t){try{return await assembly(t)}catch(e){throw console.error("Error assembling geometry:",e),e}}async function code(targetID,code,argumentsArray){await started;let keys1=["Rotate","Assembly"],inputValues=[Rotate,Assembly];for(const[t,e]of Object.entries(argumentsArray))keys1.push(`${t}`),inputValues.push(e);var result=await eval("(async ("+keys1.join(",")+") => {"+code+"})("+inputValues.join(",")+")");return library[targetID]=result,typeof result=="number"?result:!0}function color(t,e,r){return started.then(()=>{library[t]=actOnLeafs(library[e],n=>(r=="#D9544D"&&n.tags.push("keepout"),{geometry:n.geometry,tags:[...n.tags],color:r,bom:n.bom,plane:n.plane}))})}function bom(t,e,r){return started.then(()=>(library[e].bom!=[]&&(r=[...library[e].bom,r]),library[t]={geometry:library[e].geometry,tags:[...library[e].tags],bom:r,color:library[e].color},!0))}function extractTag(t,e,r){return started.then(()=>{let n=extractTags(library[e],r);if(n!=!1)library[t]={bom:n.bom,geometry:n.geometry,tags:n.tags,color:n.color};else throw new Error("Tag not found");return!0})}function output(t,e){return started.then(()=>{if(library[e]!=null)library[t]=library[e];else throw new Error("Nothing is connected to the output");return!0})}function molecule(t,e){return started.then(()=>{if(library[e]!=null)library[t]=library[e];else throw new Error("output ID is undefined");return!0})}function extractBomList(t){return library[t].bom!==void 0?library[t].bom:!1}function visExport(t,e,r){return started.then(()=>{let n=extractKeepOut(library[e]),i=digFuse(n),o=r=="STL"?"#91C8D5":r=="STEP"?"#ACAFDD":"#3C3C3C",a;return r=="SVG"?is3D(library[e])?a=[drawProjection(i,"top").visible]:a=[i]:a=[i],library[t]={geometry:a,color:o,plane:library[e].plane},!0})}function downExport(t,e,r,n){return started.then(()=>{let i=n=="Inches"?1:n=="MM"?25.4:1,o=r/i;if(e=="SVG"){let l=library[t].geometry[0].clone().scale(o).toSVG(o);var a=new Blob([l],{type:"image/svg+xml;charset=utf-8"});return a}else return e=="STL"?library[t].geometry[0].clone().blobSTL():library[t].geometry[0].clone().blobSTEP()})}async function importingSTEP(t,e){let r=await importSTEP(e);return library[t]={geometry:[r],tags:[],color:"#FF9065",bom:[]},!0}async function importingSTL(t,e){let r=await importSTL(e);return library[t]={geometry:[r],tags:[],color:"#FF9065",bom:[]},!0}async function importingSVG(t,e,r){const n=r+r*.05;drawRectangle(n,n).sketchOnPlane().extrude(1);const i=e;try{let o=await drawSVG(i,{width:r}),a=o.boundingBox.center;return library[t]={geometry:[o.clone().translate(-a[0],-a[1])],tags:[],plane:new Plane().pivot(0,"Y"),color:"#FF9065",bom:[]},console.log("SVG imported successfully"),!0}catch(o){throw console.error("Error importing SVG:",o),o}}const prettyProjection=t=>{const e=t.boundingBox,r=e.center,n=[e.center[0]+e.width,e.center[1]-e.height,e.center[2]+e.depth],i=new ProjectionCamera(n).lookAt(r),{visible:o,hidden:a}=drawProjection(t,i);return{visible:o,hidden:a}};function generateThumbnail(t){return started.then(()=>{if(library[t]!=null){let e,r,n;return is3D(library[t])?(e=digFuse(library[t]),r=prettyProjection(e),n=r.visible.toSVG()):(e=digFuse(library[t]).sketchOnPlane("XY").extrude(1e-4),r=drawProjection(e,"top").visible,n=r.toSVG()),n}else throw new Error("can't generate thumbnail for undefined geometry")})}function extractTags(t,e){if(t.tags.includes(e))return t;if(isAssembly(t)){let r=[];return t.geometry.forEach(n=>{let i=extractTags(n,e);i!=!1&&r.push(i)}),r.length>0?{geometry:r,tags:t.tags,color:t.color,bom:t.bom}:!1}else return!1}function extractKeepOut(t){if(t.tags.includes("keepout"))return!1;if(isAssembly(t)){let e=[];return t.geometry.forEach(r=>{let n=extractKeepOut(r);n!=!1&&e.push(n)}),e.length>0?{geometry:e,tags:t.tags,color:t.color,bom:t.bom}:!1}else return t}function layout(t,e,r,n,i,o){return started.then(()=>{var a=rotateForLayout(t,e,r,o);return computePositions(a,n,i,o).then(f=>{let d;if(f.length==0)d="Failed to place any parts. Are sheet dimensions right?";else{let g=a.length-f.flat().length;g>0&&(d=g+" parts are too big to fit on this sheet size. Failed layout for "+g+" part(s)")}return applyLayout(t,e,f,r,o),d})})}function displayLayout(t,e,r,n,i){rotateForLayout(t,e,n,i),applyLayout(t,e,r,n,i)}function rotateForLayout(t,e,r,n){var i=.001;let o=extractTags(library[e],r);if(!o)throw new Error("No Upstream Geometries Tagged for Cut");let a=0,l=[];return library[t]=actOnLeafs(o,f=>{let d=[],g=!1,b=0;f.geometry[0].faces.forEach(k=>{if(k.geomType=="PLANE"){g=!0;let D=moveFaceToCuttingPlane(f.geometry[0],k);D.boundingBox.depth<n.thickness+i&&D.boundingBox.bounds[0][2]>-1*i&&d.push({face:k,geom:D,faceIndex:b})}b++});let _;if(d.length==0)throw g?new Error("Upstream object too thick for specified material"):new Error("Upstream object uncuttable, has no flat face");if(d.length==1)_=d[0];else{let k=Math.min(...d.map(M=>M.face.clone().innerWires().length));d=d.filter(M=>M.face.clone().innerWires().length===k),d.length===1&&(_=d[0]);let D=d.filter(M=>Math.abs(M.geom.boundingBox.depth-n.thickness)<i);D.length>0&&(d=D);let L=0;d.forEach(M=>{areaApprox(M.face.UVBounds)>L&&(L=areaApprox(M.face.UVBounds),_=M)})}let E={geometry:[_.geom],id:a,referencePoint:_.face.center,tags:f.tags,color:f.color,plane:f.plane,bom:f.bom};return l.push({id:a,shape:E.geometry[0].faces[_.faceIndex]}),a++,E}),l}function applyLayout(t,e,r,n,i){library[t]=actOnLeafs(extractTags(library[t],n),o=>{let a;for(var l=0;l<r.length;l++){let d=r[l].filter(g=>g.id==o.id);if(d.length==1){a=d[0];break}else d.length>1&&console.warn("Found more than one transformation for same id")}if(a==null){console.log("didn't find transform for id: "+o.id);return}return{geometry:[o.geometry[0].clone().rotate(a.rotate,new Vector([0,0,0]),new Vector([0,0,1])).translate(a.translate.x,a.translate.y+l*i.height,0)],tags:o.tags,color:o.color,plane:o.plane,bom:o.bom}})}function computePositions(t,e,r,n){const o=new AnyNest,a=.1,l=o.config({spacing:n.partPadding+a*2,binSpacing:n.sheetPadding,populationSize:5,exploreConcave:!1});o.setBin(FloatPolygon.fromPoints([{x:0,y:0},{x:n.width,y:0},{x:n.width,y:n.height},{x:0,y:n.height}],"bin"));let f=[];t.forEach(b=>{const E=b.shape.clone().outerWire().meshEdges({tolerance:.5,angularTolerance:5}),k=preparePoints(E,a);f.push(FloatPolygon.fromPoints(k,b.id))}),o.setParts(f),console.log("Starting nesting task with configuration: "+JSON.stringify(l));let d=0;const g=5;return new Promise((b,_)=>{try{o.start(E=>{const k=1/(g*5);e(.1+.9*(E+d)*k,proxy(()=>{o.stop()}))},(E,k)=>{d++,d>=g*5&&(console.log("nesting search completed "+g+" generations. Final result: "+JSON.stringify(E)),r(E),o.stop(),b(E))})}catch(E){console.log("error in nesting engine: "+E),o.stop(),_(E)}})}function preparePoints(t,e){let r=[];t.edgeGroups.forEach(l=>{r.push({startPoint:{x:t.lines[l.start*3],y:t.lines[l.start*3+1]},start:l.start*3,len:l.count,edgeId:l.edgeId});const f=(l.start+l.count-1)*3;r.push({startPoint:{x:t.lines[f],y:t.lines[f+1]},start:f,len:-1*l.count,edgeId:l.edgeId})});const n=(l,f)=>{const d=Math.abs(l.x-f.x)<e,g=Math.abs(l.y-f.y)<e;return d&&g},i=[];let o=r[0];for(;r.length>0;){for(var a=1;a<Math.abs(o.len);a++){let f=a*3;o.len<0&&(f=-1*f);const d=o.start+f;i.push({x:t.lines[d],y:t.lines[d+1]})}r=r.filter(f=>f.edgeId!=o.edgeId);const l=r.filter(f=>n(i[i.length-1],f.startPoint));if(r.length>0&&l.length!=1)throw new Error("Geometry error when preparing for cutlayout. Part perimiter has an edge with: "+l.length+" continuations");o=l[0]}return i}function moveFaceToCuttingPlane(t,e){let r=e.pointOnSurface(0,0),n=e.normalAt(),i=new Vector([0,0,-1]),o=n.cross(i);if(o.Length==0)return t.clone().translate(0,0,-1*r.z);let a=Math.acos(n.dot(i)/(i.Length*n.Length))*360/(2*Math.PI);return t.clone().rotate(a,r,o).translate(0,0,-1*r.z)}function areaApprox(t){return(t.uMax-t.uMin)*(t.vMax-t.vMin)}function isAssembly(t){return t.geometry.length>0?!!t.geometry[0].geometry:!1}function cutAssembly(t,e,r){try{if(isAssembly(t)){let i=t.geometry,o=[];i.forEach(l=>{o.push(cutAssembly(l,e,r))});let a=generateUniqueID();return library[a]={geometry:o,tags:t.tags,bom:t.bom},library[a]}else{var n=t.geometry[0];e.forEach(o=>{n=recursiveCut(n,toGeometry(o))});let i=generateUniqueID();return library[i]={geometry:[n],tags:t.tags,color:t.color,bom:t.bom,plane:t.plane},library[i]}}catch{throw new Error("Cut Assembly failed")}}function recursiveCut(t,e){try{let r=t;if(isAssembly(e)){for(let n=0;n<e.geometry.length;n++)r=recursiveCut(r,e.geometry[n]);return r}else{let n;return n=t.cut(e.geometry[0]),n}}catch{throw new Error("Recursive Cut failed")}}async function assembly(t,e=null){if(!Array.isArray(t)||t.length===0)throw new Error("inputIDs must be a non-empty array");await started;let r=[],n=[];if(t.length>1){const a=t.every(f=>is3D(toGeometry(f))),l=t.every(f=>!is3D(toGeometry(f)));if(a||l)for(let f=0;f<t.length;f++){const d=toGeometry(t[f]);r.push(cutAssembly(d,t.slice(f+1),e)),d.bom.length>0&&n.push(...d.bom)}else throw new Error("Assemblies must be composed from only sketches OR only solids")}else{const a=toGeometry(t[0]);r.push(a),a.bom.length>0&&n.push(...a.bom)}const i=new Plane().pivot(0,"Y");let o={geometry:r,plane:i,tags:[],bom:n};if(e!=null)library[e]=o;else return o;return!0}function fusion(t,e){return started.then(()=>{let r=[],n=[];e.forEach(o=>{if(e.every(a=>is3D(library[a])))r.push(digFuse(library[o]));else if(e.every(a=>!is3D(library[a])))r.push(digFuse(library[o]));else throw new Error("Fusion must be composed from only sketches OR only solids");library[o].bom.length>0&&n.push(...library[o].bom)});const i=new Plane().pivot(0,"Y");return library[t]={geometry:[chainFuse(r)],tags:[],bom:n,plane:i,color:"#FF9065"},!0})}function actOnLeafs(t,e,r){if(r=r||t.plane,t.geometry.length==1&&t.geometry[0].geometry==null)return e(t);{let n=[];return t.geometry.forEach(i=>{const o=actOnLeafs(i,e);o!=null&&n.push(o)}),{geometry:n,tags:t.tags,bom:t.bom,plane:r}}}function flattenAssembly(t){var e=[];return t.geometry.length==1&&t.geometry[0].geometry==null?(e.push({geometry:t.geometry[0],color:t.color}),e):(t.geometry.forEach(r=>{e.push(...flattenAssembly(r))}),e)}function chainFuse(t){try{let e=t[0].clone();for(let r=1;r<t.length;r++)e=e.fuse(t[r]);return e}catch{throw new Error("Fusion failed")}}function digFuse(t){var e=[];return isAssembly(t)?(t.geometry.forEach(r=>{isAssembly(r)?e.push(digFuse(r)):e.push(r.geometry[0])}),chainFuse(e)):t.geometry[0]}async function generateDefaultMesh(t){return await text(t,"No output to display",28,"ROBOTO")}function resetView(){return started.then(()=>[])}function getLargestBoundingBox(t){let e=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];if(!Array.isArray(t))throw new Error("meshArray is not defined or not an array");t.forEach(a=>{if(!a.geometry||!a.geometry.boundingBox||!Array.isArray(a.geometry.boundingBox.bounds))throw new Error("Invalid mesh geometry or boundingBox structure");let l=a.geometry.boundingBox.bounds;if(l.length<2||!Array.isArray(l[0])||!Array.isArray(l[1]))throw new Error("boundingBox bounds are not properly defined");let f=l[0],d=l[1];e[0]=Math.min(e[0],f[0]),e[1]=Math.min(e[1],f[1]),e[2]=Math.min(e[2],f[2]),r[0]=Math.max(r[0],d[0]),r[1]=Math.max(r[1],d[1]),r[2]=Math.max(r[2],d[2])});let n=r[0]-e[0],i=r[1]-e[1],o=r[2]-e[2];return{width:n,height:i,depth:o}}function calculateZoom(t){try{const e={width:312.0005000624958,height:312.00074999364347,depth:432.0009977339615},r=.5,n=Math.sqrt(Math.pow(e.width,2)+Math.pow(e.height,2)+Math.pow(e.depth,2)),i=Math.sqrt(Math.pow(t.width,2)+Math.pow(t.height,2)+Math.pow(t.depth,2));return r*n/i}catch{throw new Error("Error calculating zoom level")}}function generateCameraPosition(t){try{let e=getLargestBoundingBox(t);return calculateZoom(e)}catch(e){throw new Error(e)}}function generateDisplayMesh(t){return started.then(()=>{console.log("Generating display mesh for "+t),(library[t]==null||t==null)&&(console.log("ID undefined or not found in library"),generateDefaultMesh(t).then(o=>{console.log(o)}));let e=[];flattenAssembly(library[t]).forEach(o=>{var a=[];if(o.geometry.mesh==null){let l=library[t].plane;a=o.geometry.clone().sketchOnPlane(l).extrude(1e-4)}else a=o.geometry;e.push({color:o.color,geometry:a})});let n;try{n=generateCameraPosition(e)}catch{console.log("Error generating camera position"),n=1}let i=[];return e.forEach(o=>{try{if(o.geometry.mesh==null){const a=o.sketchOnPlane(sketchPlane).clone().extrude(1e-4);return{faces:a.mesh({tolerance:.1,angularTolerance:.5}),edges:a.meshEdges({tolerance:.1,angularTolerance:.5})}}else i.push({cameraZoom:n,faces:o.geometry.mesh({tolerance:.1,angularTolerance:.5}),edges:o.geometry.meshEdges({tolerance:.1,angularTolerance:.5}),color:o.color})}catch(a){throw new Error("Error generating display mesh"+a)}}),i})}expose({deleteFromLibrary,importingSTEP,importingSTL,importingSVG,createMesh,circle,color,code,regularPolygon,rectangle,generateDisplayMesh,extrude,fusion,extractBomList,generateThumbnail,visExport,downExport,shrinkWrapSketches,move,rotate,difference,tag,layout,displayLayout,output,molecule,bom,extractTag,intersect,assembly,loftShapes,text,resetView})})();
