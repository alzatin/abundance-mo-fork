(function(){"use strict";var Module=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,a;r.ready=new Promise(function(i,u){n=i,a=u});var o=Object.assign({},r),s="./this.program",l=(i,u)=>{throw u},c=typeof window=="object",p=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function m(i){return r.locateFile?r.locateFile(i,y):y+i}var w,_,E;function x(i){if(i instanceof Vt)return;L("exiting due to exception: "+i)}var k,R,A;d?(p?y=require("path").dirname(y)+"/":y=__dirname+"/",A=()=>{R||(k=require("fs"),R=require("path"))},w=function(u,f){return A(),u=R.normalize(u),k.readFileSync(u,f?void 0:"utf8")},E=i=>{var u=w(i,!0);return u.buffer||(u=new Uint8Array(u)),u},_=(i,u,f)=>{A(),i=R.normalize(i),k.readFile(i,function(h,v){h?f(h):u(v.buffer)})},process.argv.length>1&&(s=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(i){if(!(i instanceof Vt))throw i}),process.on("unhandledRejection",function(i){throw i}),l=(i,u)=>{if(jt())throw process.exitCode=i,u;x(u),process.exit(i)},r.inspect=function(){return"[Emscripten Module object]"}):(c||p)&&(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),t&&(y=t),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",w=i=>{var u=new XMLHttpRequest;return u.open("GET",i,!1),u.send(null),u.responseText},p&&(E=i=>{var u=new XMLHttpRequest;return u.open("GET",i,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),_=(i,u,f)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){u(h.response);return}f()},h.onerror=f,h.send(null)});var G=r.print||console.log.bind(console),L=r.printErr||console.warn.bind(console);Object.assign(r,o),o=null,r.arguments&&r.arguments,r.thisProgram&&(s=r.thisProgram),r.quit&&(l=r.quit);var q=4,V;r.wasmBinary&&(V=r.wasmBinary);var U=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Ie("no native wasm support detected");var W,oe=!1;function j(i,u){i||Ie(u)}var fe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ie(i,u,f){for(var h=u+f,v=u;i[v]&&!(v>=h);)++v;if(v-u>16&&i.buffer&&fe)return fe.decode(i.subarray(u,v));for(var b="";u<v;){var S=i[u++];if(!(S&128)){b+=String.fromCharCode(S);continue}var T=i[u++]&63;if((S&224)==192){b+=String.fromCharCode((S&31)<<6|T);continue}var P=i[u++]&63;if((S&240)==224?S=(S&15)<<12|T<<6|P:S=(S&7)<<18|T<<12|P<<6|i[u++]&63,S<65536)b+=String.fromCharCode(S);else{var C=S-65536;b+=String.fromCharCode(55296|C>>10,56320|C&1023)}}return b}function X(i,u){return i?ie(be,i,u):""}function te(i,u,f,h){if(!(h>0))return 0;for(var v=f,b=f+h-1,S=0;S<i.length;++S){var T=i.charCodeAt(S);if(T>=55296&&T<=57343){var P=i.charCodeAt(++S);T=65536+((T&1023)<<10)|P&1023}if(T<=127){if(f>=b)break;u[f++]=T}else if(T<=2047){if(f+1>=b)break;u[f++]=192|T>>6,u[f++]=128|T&63}else if(T<=65535){if(f+2>=b)break;u[f++]=224|T>>12,u[f++]=128|T>>6&63,u[f++]=128|T&63}else{if(f+3>=b)break;u[f++]=240|T>>18,u[f++]=128|T>>12&63,u[f++]=128|T>>6&63,u[f++]=128|T&63}}return u[f]=0,f-v}function H(i,u,f){return te(i,be,u,f)}function $(i){for(var u=0,f=0;f<i.length;++f){var h=i.charCodeAt(f);h>=55296&&h<=57343&&(h=65536+((h&1023)<<10)|i.charCodeAt(++f)&1023),h<=127?++u:h<=2047?u+=2:h<=65535?u+=3:u+=4}return u}var re=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function pe(i,u){for(var f=i,h=f>>1,v=h+u/2;!(h>=v)&&qe[h];)++h;if(f=h<<1,f-i>32&&re)return re.decode(be.subarray(i,f));for(var b="",S=0;!(S>=u/2);++S){var T=Fe[i+S*2>>1];if(T==0)break;b+=String.fromCharCode(T)}return b}function ge(i,u,f){if(f===void 0&&(f=2147483647),f<2)return 0;f-=2;for(var h=u,v=f<i.length*2?f/2:i.length,b=0;b<v;++b){var S=i.charCodeAt(b);Fe[u>>1]=S,u+=2}return Fe[u>>1]=0,u-h}function ae(i){return i.length*2}function ve(i,u){for(var f=0,h="";!(f>=u/4);){var v=I[i+f*4>>2];if(v==0)break;if(++f,v>=65536){var b=v-65536;h+=String.fromCharCode(55296|b>>10,56320|b&1023)}else h+=String.fromCharCode(v)}return h}function Ye(i,u,f){if(f===void 0&&(f=2147483647),f<4)return 0;for(var h=u,v=h+f-4,b=0;b<i.length;++b){var S=i.charCodeAt(b);if(S>=55296&&S<=57343){var T=i.charCodeAt(++b);S=65536+((S&1023)<<10)|T&1023}if(I[u>>2]=S,u+=4,u+4>v)break}return I[u>>2]=0,u-h}function _t(i){for(var u=0,f=0;f<i.length;++f){var h=i.charCodeAt(f);h>=55296&&h<=57343&&++f,u+=4}return u}function rt(i){var u=$(i)+1,f=Re(u);return f&&te(i,ye,f,u),f}function Xe(i,u){ye.set(i,u)}function nt(i,u,f){for(var h=0;h<i.length;++h)ye[u++>>0]=i.charCodeAt(h);ye[u>>0]=0}var Ce,ye,be,Fe,qe,I,Z,Ee,Ht;function Wt(i){Ce=i,r.HEAP8=ye=new Int8Array(i),r.HEAP16=Fe=new Int16Array(i),r.HEAP32=I=new Int32Array(i),r.HEAPU8=be=new Uint8Array(i),r.HEAPU16=qe=new Uint16Array(i),r.HEAPU32=Z=new Uint32Array(i),r.HEAPF32=Ee=new Float32Array(i),r.HEAPF64=Ht=new Float64Array(i)}r.INITIAL_MEMORY;var $t,Yt=[],Xt=[],qt=[];function jt(){return U}function Er(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Cr(r.preRun.shift());Pt(Yt)}function Pr(){!r.noFSInit&&!g.init.initialized&&g.init(),g.ignorePermissions=!1,Pt(Xt)}function xr(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Ar(r.postRun.shift());Pt(qt)}function Cr(i){Yt.unshift(i)}function kr(i){Xt.unshift(i)}function Ar(i){qt.unshift(i)}var Ne=0,je=null;function so(i){return i}function Et(i){Ne++,r.monitorRunDependencies&&r.monitorRunDependencies(Ne)}function at(i){if(Ne--,r.monitorRunDependencies&&r.monitorRunDependencies(Ne),Ne==0&&je){var u=je;je=null,u()}}function Ie(i){r.onAbort&&r.onAbort(i),i="Aborted("+i+")",L(i),oe=!0,i+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(i);throw a(u),u}var Dr="data:application/octet-stream;base64,";function Zt(i){return i.startsWith(Dr)}function Qt(i){return i.startsWith("file://")}var Te;Te="replicad_single.wasm",Zt(Te)||(Te=m(Te));function Kt(i){try{if(i==Te&&V)return new Uint8Array(V);if(E)return E(i);throw"both async and sync fetching of the wasm failed"}catch(u){Ie(u)}}function Or(){if(!V&&(c||p)){if(typeof fetch=="function"&&!Qt(Te))return fetch(Te,{credentials:"same-origin"}).then(function(i){if(!i.ok)throw"failed to load wasm binary file at '"+Te+"'";return i.arrayBuffer()}).catch(function(){return Kt(Te)});if(_)return new Promise(function(i,u){_(Te,function(f){i(new Uint8Array(f))},u)})}return Promise.resolve().then(function(){return Kt(Te)})}function Rr(){var i={a:no};function u(S,T){var P=S.exports;r.asm=P,W=r.asm.oa,Wt(W.buffer),$t=r.asm.va,kr(r.asm.pa),at()}Et();function f(S){u(S.instance)}function h(S){return Or().then(function(T){return WebAssembly.instantiate(T,i)}).then(function(T){return T}).then(S,function(T){L("failed to asynchronously prepare wasm: "+T),Ie(T)})}function v(){return!V&&typeof WebAssembly.instantiateStreaming=="function"&&!Zt(Te)&&!Qt(Te)&&!d&&typeof fetch=="function"?fetch(Te,{credentials:"same-origin"}).then(function(S){var T=WebAssembly.instantiateStreaming(S,i);return T.then(f,function(P){return L("wasm streaming compile failed: "+P),L("falling back to ArrayBuffer instantiation"),h(f)})}):h(f)}if(r.instantiateWasm)try{var b=r.instantiateWasm(i,u);return b}catch(S){return L("Module.instantiateWasm callback failed with error: "+S),!1}return v().catch(a),{}}var me,ke;function Mr(){return r.HEAP8.length}function Pt(i){for(;i.length>0;){var u=i.shift();if(typeof u=="function"){u(r);continue}var f=u.func;typeof f=="number"?u.arg===void 0?st(f)():st(f)(u.arg):f(u.arg===void 0?null:u.arg)}}var ot=[];function st(i){var u=ot[i];return u||(i>=ot.length&&(ot.length=i+1),ot[i]=u=$t.get(i)),u}function Fr(i,u,f,h){Ie("Assertion failed: "+X(i)+", at: "+[u?X(u):"unknown filename",f,h?X(h):"unknown function"])}function Ir(i){return Re(i+24)+24}function Br(i){this.excPtr=i,this.ptr=i-24,this.set_type=function(u){Z[this.ptr+4>>2]=u},this.get_type=function(){return Z[this.ptr+4>>2]},this.set_destructor=function(u){Z[this.ptr+8>>2]=u},this.get_destructor=function(){return Z[this.ptr+8>>2]},this.set_refcount=function(u){I[this.ptr>>2]=u},this.set_caught=function(u){u=u?1:0,ye[this.ptr+12>>0]=u},this.get_caught=function(){return ye[this.ptr+12>>0]!=0},this.set_rethrown=function(u){u=u?1:0,ye[this.ptr+13>>0]=u},this.get_rethrown=function(){return ye[this.ptr+13>>0]!=0},this.init=function(u,f){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(f),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var u=I[this.ptr>>2];I[this.ptr>>2]=u+1},this.release_ref=function(){var u=I[this.ptr>>2];return I[this.ptr>>2]=u-1,u===1},this.set_adjusted_ptr=function(u){Z[this.ptr+16>>2]=u},this.get_adjusted_ptr=function(){return Z[this.ptr+16>>2]},this.get_exception_ptr=function(){var u=_r(this.get_type());if(u)return Z[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}function Lr(i,u,f){var h=new Br(i);throw h.init(u,f),i}var Q={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return u.exec(i).slice(1)},normalizeArray:(i,u)=>{for(var f=0,h=i.length-1;h>=0;h--){var v=i[h];v==="."?i.splice(h,1):v===".."?(i.splice(h,1),f++):f&&(i.splice(h,1),f--)}if(u)for(;f;f--)i.unshift("..");return i},normalize:i=>{var u=Q.isAbs(i),f=i.substr(-1)==="/";return i=Q.normalizeArray(i.split("/").filter(h=>!!h),!u).join("/"),!i&&!u&&(i="."),i&&f&&(i+="/"),(u?"/":"")+i},dirname:i=>{var u=Q.splitPath(i),f=u[0],h=u[1];return!f&&!h?".":(h&&(h=h.substr(0,h.length-1)),f+h)},basename:i=>{if(i==="/")return"/";i=Q.normalize(i),i=i.replace(/\/$/,"");var u=i.lastIndexOf("/");return u===-1?i:i.substr(u+1)},join:function(){var i=Array.prototype.slice.call(arguments,0);return Q.normalize(i.join("/"))},join2:(i,u)=>Q.normalize(i+"/"+u)};function Ur(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var i=new Uint8Array(1);return function(){return crypto.getRandomValues(i),i[0]}}else if(d)try{var u=require("crypto");return function(){return u.randomBytes(1)[0]}}catch{}return function(){Ie("randomDevice")}}var Ae={resolve:function(){for(var i="",u=!1,f=arguments.length-1;f>=-1&&!u;f--){var h=f>=0?arguments[f]:g.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";i=h+"/"+i,u=Q.isAbs(h)}return i=Q.normalizeArray(i.split("/").filter(v=>!!v),!u).join("/"),(u?"/":"")+i||"."},relative:(i,u)=>{i=Ae.resolve(i).substr(1),u=Ae.resolve(u).substr(1);function f(C){for(var M=0;M<C.length&&C[M]==="";M++);for(var F=C.length-1;F>=0&&C[F]==="";F--);return M>F?[]:C.slice(M,F-M+1)}for(var h=f(i.split("/")),v=f(u.split("/")),b=Math.min(h.length,v.length),S=b,T=0;T<b;T++)if(h[T]!==v[T]){S=T;break}for(var P=[],T=S;T<h.length;T++)P.push("..");return P=P.concat(v.slice(S)),P.join("/")}},Ge={ttys:[],init:function(){},shutdown:function(){},register:function(i,u){Ge.ttys[i]={input:[],output:[],ops:u},g.registerDevice(i,Ge.stream_ops)},stream_ops:{open:function(i){var u=Ge.ttys[i.node.rdev];if(!u)throw new g.ErrnoError(43);i.tty=u,i.seekable=!1},close:function(i){i.tty.ops.flush(i.tty)},flush:function(i){i.tty.ops.flush(i.tty)},read:function(i,u,f,h,v){if(!i.tty||!i.tty.ops.get_char)throw new g.ErrnoError(60);for(var b=0,S=0;S<h;S++){var T;try{T=i.tty.ops.get_char(i.tty)}catch{throw new g.ErrnoError(29)}if(T===void 0&&b===0)throw new g.ErrnoError(6);if(T==null)break;b++,u[f+S]=T}return b&&(i.node.timestamp=Date.now()),b},write:function(i,u,f,h,v){if(!i.tty||!i.tty.ops.put_char)throw new g.ErrnoError(60);try{for(var b=0;b<h;b++)i.tty.ops.put_char(i.tty,u[f+b])}catch{throw new g.ErrnoError(29)}return h&&(i.node.timestamp=Date.now()),b}},default_tty_ops:{get_char:function(i){if(!i.input.length){var u=null;if(d){var f=256,h=Buffer.alloc(f),v=0;try{v=k.readSync(process.stdin.fd,h,0,f,-1)}catch(b){if(b.toString().includes("EOF"))v=0;else throw b}v>0?u=h.slice(0,v).toString("utf-8"):u=null}else typeof window<"u"&&typeof window.prompt=="function"?(u=window.prompt("Input: "),u!==null&&(u+=`
`)):typeof readline=="function"&&(u=readline(),u!==null&&(u+=`
`));if(!u)return null;i.input=St(u,!0)}return i.input.shift()},put_char:function(i,u){u===null||u===10?(G(ie(i.output,0)),i.output=[]):u!=0&&i.output.push(u)},flush:function(i){i.output&&i.output.length>0&&(G(ie(i.output,0)),i.output=[])}},default_tty1_ops:{put_char:function(i,u){u===null||u===10?(L(ie(i.output,0)),i.output=[]):u!=0&&i.output.push(u)},flush:function(i){i.output&&i.output.length>0&&(L(ie(i.output,0)),i.output=[])}}};function Nr(i,u){be.fill(0,i,i+u)}function Gr(i,u){return Math.ceil(i/u)*u}function Jt(i){i=Gr(i,65536);var u=Tr(65536,i);return u?(Nr(u,i),u):0}var Y={ops_table:null,mount:function(i){return Y.createNode(null,"/",16895,0)},createNode:function(i,u,f,h){if(g.isBlkdev(f)||g.isFIFO(f))throw new g.ErrnoError(63);Y.ops_table||(Y.ops_table={dir:{node:{getattr:Y.node_ops.getattr,setattr:Y.node_ops.setattr,lookup:Y.node_ops.lookup,mknod:Y.node_ops.mknod,rename:Y.node_ops.rename,unlink:Y.node_ops.unlink,rmdir:Y.node_ops.rmdir,readdir:Y.node_ops.readdir,symlink:Y.node_ops.symlink},stream:{llseek:Y.stream_ops.llseek}},file:{node:{getattr:Y.node_ops.getattr,setattr:Y.node_ops.setattr},stream:{llseek:Y.stream_ops.llseek,read:Y.stream_ops.read,write:Y.stream_ops.write,allocate:Y.stream_ops.allocate,mmap:Y.stream_ops.mmap,msync:Y.stream_ops.msync}},link:{node:{getattr:Y.node_ops.getattr,setattr:Y.node_ops.setattr,readlink:Y.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Y.node_ops.getattr,setattr:Y.node_ops.setattr},stream:g.chrdev_stream_ops}});var v=g.createNode(i,u,f,h);return g.isDir(v.mode)?(v.node_ops=Y.ops_table.dir.node,v.stream_ops=Y.ops_table.dir.stream,v.contents={}):g.isFile(v.mode)?(v.node_ops=Y.ops_table.file.node,v.stream_ops=Y.ops_table.file.stream,v.usedBytes=0,v.contents=null):g.isLink(v.mode)?(v.node_ops=Y.ops_table.link.node,v.stream_ops=Y.ops_table.link.stream):g.isChrdev(v.mode)&&(v.node_ops=Y.ops_table.chrdev.node,v.stream_ops=Y.ops_table.chrdev.stream),v.timestamp=Date.now(),i&&(i.contents[u]=v,i.timestamp=v.timestamp),v},getFileDataAsTypedArray:function(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage:function(i,u){var f=i.contents?i.contents.length:0;if(!(f>=u)){var h=1024*1024;u=Math.max(u,f*(f<h?2:1.125)>>>0),f!=0&&(u=Math.max(u,256));var v=i.contents;i.contents=new Uint8Array(u),i.usedBytes>0&&i.contents.set(v.subarray(0,i.usedBytes),0)}},resizeFileStorage:function(i,u){if(i.usedBytes!=u)if(u==0)i.contents=null,i.usedBytes=0;else{var f=i.contents;i.contents=new Uint8Array(u),f&&i.contents.set(f.subarray(0,Math.min(u,i.usedBytes))),i.usedBytes=u}},node_ops:{getattr:function(i){var u={};return u.dev=g.isChrdev(i.mode)?i.id:1,u.ino=i.id,u.mode=i.mode,u.nlink=1,u.uid=0,u.gid=0,u.rdev=i.rdev,g.isDir(i.mode)?u.size=4096:g.isFile(i.mode)?u.size=i.usedBytes:g.isLink(i.mode)?u.size=i.link.length:u.size=0,u.atime=new Date(i.timestamp),u.mtime=new Date(i.timestamp),u.ctime=new Date(i.timestamp),u.blksize=4096,u.blocks=Math.ceil(u.size/u.blksize),u},setattr:function(i,u){u.mode!==void 0&&(i.mode=u.mode),u.timestamp!==void 0&&(i.timestamp=u.timestamp),u.size!==void 0&&Y.resizeFileStorage(i,u.size)},lookup:function(i,u){throw g.genericErrors[44]},mknod:function(i,u,f,h){return Y.createNode(i,u,f,h)},rename:function(i,u,f){if(g.isDir(i.mode)){var h;try{h=g.lookupNode(u,f)}catch{}if(h)for(var v in h.contents)throw new g.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=f,u.contents[f]=i,u.timestamp=i.parent.timestamp,i.parent=u},unlink:function(i,u){delete i.contents[u],i.timestamp=Date.now()},rmdir:function(i,u){var f=g.lookupNode(i,u);for(var h in f.contents)throw new g.ErrnoError(55);delete i.contents[u],i.timestamp=Date.now()},readdir:function(i){var u=[".",".."];for(var f in i.contents)i.contents.hasOwnProperty(f)&&u.push(f);return u},symlink:function(i,u,f){var h=Y.createNode(i,u,41471,0);return h.link=f,h},readlink:function(i){if(!g.isLink(i.mode))throw new g.ErrnoError(28);return i.link}},stream_ops:{read:function(i,u,f,h,v){var b=i.node.contents;if(v>=i.node.usedBytes)return 0;var S=Math.min(i.node.usedBytes-v,h);if(S>8&&b.subarray)u.set(b.subarray(v,v+S),f);else for(var T=0;T<S;T++)u[f+T]=b[v+T];return S},write:function(i,u,f,h,v,b){if(u.buffer===ye.buffer&&(b=!1),!h)return 0;var S=i.node;if(S.timestamp=Date.now(),u.subarray&&(!S.contents||S.contents.subarray)){if(b)return S.contents=u.subarray(f,f+h),S.usedBytes=h,h;if(S.usedBytes===0&&v===0)return S.contents=u.slice(f,f+h),S.usedBytes=h,h;if(v+h<=S.usedBytes)return S.contents.set(u.subarray(f,f+h),v),h}if(Y.expandFileStorage(S,v+h),S.contents.subarray&&u.subarray)S.contents.set(u.subarray(f,f+h),v);else for(var T=0;T<h;T++)S.contents[v+T]=u[f+T];return S.usedBytes=Math.max(S.usedBytes,v+h),h},llseek:function(i,u,f){var h=u;if(f===1?h+=i.position:f===2&&g.isFile(i.node.mode)&&(h+=i.node.usedBytes),h<0)throw new g.ErrnoError(28);return h},allocate:function(i,u,f){Y.expandFileStorage(i.node,u+f),i.node.usedBytes=Math.max(i.node.usedBytes,u+f)},mmap:function(i,u,f,h,v){if(!g.isFile(i.node.mode))throw new g.ErrnoError(43);var b,S,T=i.node.contents;if(!(v&2)&&T.buffer===Ce)S=!1,b=T.byteOffset;else{if((f>0||f+u<T.length)&&(T.subarray?T=T.subarray(f,f+u):T=Array.prototype.slice.call(T,f,f+u)),S=!0,b=Jt(u),!b)throw new g.ErrnoError(48);ye.set(T,b)}return{ptr:b,allocated:S}},msync:function(i,u,f,h,v){if(!g.isFile(i.node.mode))throw new g.ErrnoError(43);return v&2||Y.stream_ops.write(i,u,0,h,f,!1),0}}};function Vr(i,u,f,h){var v="al "+i;_(i,function(b){j(b,'Loading data file "'+i+'" failed (no arrayBuffer).'),u(new Uint8Array(b)),v&&at()},function(b){if(f)f();else throw'Loading data file "'+i+'" failed.'}),v&&Et()}var g={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(i,u={})=>{if(i=Ae.resolve(g.cwd(),i),!i)return{path:"",node:null};var f={follow_mount:!0,recurse_count:0};if(u=Object.assign(f,u),u.recurse_count>8)throw new g.ErrnoError(32);for(var h=Q.normalizeArray(i.split("/").filter(F=>!!F),!1),v=g.root,b="/",S=0;S<h.length;S++){var T=S===h.length-1;if(T&&u.parent)break;if(v=g.lookupNode(v,h[S]),b=Q.join2(b,h[S]),g.isMountpoint(v)&&(!T||T&&u.follow_mount)&&(v=v.mounted.root),!T||u.follow)for(var P=0;g.isLink(v.mode);){var C=g.readlink(b);b=Ae.resolve(Q.dirname(b),C);var M=g.lookupPath(b,{recurse_count:u.recurse_count+1});if(v=M.node,P++>40)throw new g.ErrnoError(32)}}return{path:b,node:v}},getPath:i=>{for(var u;;){if(g.isRoot(i)){var f=i.mount.mountpoint;return u?f[f.length-1]!=="/"?f+"/"+u:f+u:f}u=u?i.name+"/"+u:i.name,i=i.parent}},hashName:(i,u)=>{for(var f=0,h=0;h<u.length;h++)f=(f<<5)-f+u.charCodeAt(h)|0;return(i+f>>>0)%g.nameTable.length},hashAddNode:i=>{var u=g.hashName(i.parent.id,i.name);i.name_next=g.nameTable[u],g.nameTable[u]=i},hashRemoveNode:i=>{var u=g.hashName(i.parent.id,i.name);if(g.nameTable[u]===i)g.nameTable[u]=i.name_next;else for(var f=g.nameTable[u];f;){if(f.name_next===i){f.name_next=i.name_next;break}f=f.name_next}},lookupNode:(i,u)=>{var f=g.mayLookup(i);if(f)throw new g.ErrnoError(f,i);for(var h=g.hashName(i.id,u),v=g.nameTable[h];v;v=v.name_next){var b=v.name;if(v.parent.id===i.id&&b===u)return v}return g.lookup(i,u)},createNode:(i,u,f,h)=>{var v=new g.FSNode(i,u,f,h);return g.hashAddNode(v),v},destroyNode:i=>{g.hashRemoveNode(i)},isRoot:i=>i===i.parent,isMountpoint:i=>!!i.mounted,isFile:i=>(i&61440)===32768,isDir:i=>(i&61440)===16384,isLink:i=>(i&61440)===40960,isChrdev:i=>(i&61440)===8192,isBlkdev:i=>(i&61440)===24576,isFIFO:i=>(i&61440)===4096,isSocket:i=>(i&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:i=>{var u=g.flagModes[i];if(typeof u>"u")throw new Error("Unknown file open mode: "+i);return u},flagsToPermissionString:i=>{var u=["r","w","rw"][i&3];return i&512&&(u+="w"),u},nodePermissions:(i,u)=>g.ignorePermissions?0:u.includes("r")&&!(i.mode&292)||u.includes("w")&&!(i.mode&146)||u.includes("x")&&!(i.mode&73)?2:0,mayLookup:i=>{var u=g.nodePermissions(i,"x");return u||(i.node_ops.lookup?0:2)},mayCreate:(i,u)=>{try{var f=g.lookupNode(i,u);return 20}catch{}return g.nodePermissions(i,"wx")},mayDelete:(i,u,f)=>{var h;try{h=g.lookupNode(i,u)}catch(b){return b.errno}var v=g.nodePermissions(i,"wx");if(v)return v;if(f){if(!g.isDir(h.mode))return 54;if(g.isRoot(h)||g.getPath(h)===g.cwd())return 10}else if(g.isDir(h.mode))return 31;return 0},mayOpen:(i,u)=>i?g.isLink(i.mode)?32:g.isDir(i.mode)&&(g.flagsToPermissionString(u)!=="r"||u&512)?31:g.nodePermissions(i,g.flagsToPermissionString(u)):44,MAX_OPEN_FDS:4096,nextfd:(i=0,u=g.MAX_OPEN_FDS)=>{for(var f=i;f<=u;f++)if(!g.streams[f])return f;throw new g.ErrnoError(33)},getStream:i=>g.streams[i],createStream:(i,u,f)=>{g.FSStream||(g.FSStream=function(){this.shared={}},g.FSStream.prototype={},Object.defineProperties(g.FSStream.prototype,{object:{get:function(){return this.node},set:function(v){this.node=v}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(v){this.shared.flags=v}},position:{get:function(){return this.shared.position},set:function(v){this.shared.position=v}}})),i=Object.assign(new g.FSStream,i);var h=g.nextfd(u,f);return i.fd=h,g.streams[h]=i,i},closeStream:i=>{g.streams[i]=null},chrdev_stream_ops:{open:i=>{var u=g.getDevice(i.node.rdev);i.stream_ops=u.stream_ops,i.stream_ops.open&&i.stream_ops.open(i)},llseek:()=>{throw new g.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,u)=>i<<8|u,registerDevice:(i,u)=>{g.devices[i]={stream_ops:u}},getDevice:i=>g.devices[i],getMounts:i=>{for(var u=[],f=[i];f.length;){var h=f.pop();u.push(h),f.push.apply(f,h.mounts)}return u},syncfs:(i,u)=>{typeof i=="function"&&(u=i,i=!1),g.syncFSRequests++,g.syncFSRequests>1&&L("warning: "+g.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var f=g.getMounts(g.root.mount),h=0;function v(S){return g.syncFSRequests--,u(S)}function b(S){if(S)return b.errored?void 0:(b.errored=!0,v(S));++h>=f.length&&v(null)}f.forEach(S=>{if(!S.type.syncfs)return b(null);S.type.syncfs(S,i,b)})},mount:(i,u,f)=>{var h=f==="/",v=!f,b;if(h&&g.root)throw new g.ErrnoError(10);if(!h&&!v){var S=g.lookupPath(f,{follow_mount:!1});if(f=S.path,b=S.node,g.isMountpoint(b))throw new g.ErrnoError(10);if(!g.isDir(b.mode))throw new g.ErrnoError(54)}var T={type:i,opts:u,mountpoint:f,mounts:[]},P=i.mount(T);return P.mount=T,T.root=P,h?g.root=P:b&&(b.mounted=T,b.mount&&b.mount.mounts.push(T)),P},unmount:i=>{var u=g.lookupPath(i,{follow_mount:!1});if(!g.isMountpoint(u.node))throw new g.ErrnoError(28);var f=u.node,h=f.mounted,v=g.getMounts(h);Object.keys(g.nameTable).forEach(S=>{for(var T=g.nameTable[S];T;){var P=T.name_next;v.includes(T.mount)&&g.destroyNode(T),T=P}}),f.mounted=null;var b=f.mount.mounts.indexOf(h);f.mount.mounts.splice(b,1)},lookup:(i,u)=>i.node_ops.lookup(i,u),mknod:(i,u,f)=>{var h=g.lookupPath(i,{parent:!0}),v=h.node,b=Q.basename(i);if(!b||b==="."||b==="..")throw new g.ErrnoError(28);var S=g.mayCreate(v,b);if(S)throw new g.ErrnoError(S);if(!v.node_ops.mknod)throw new g.ErrnoError(63);return v.node_ops.mknod(v,b,u,f)},create:(i,u)=>(u=u!==void 0?u:438,u&=4095,u|=32768,g.mknod(i,u,0)),mkdir:(i,u)=>(u=u!==void 0?u:511,u&=1023,u|=16384,g.mknod(i,u,0)),mkdirTree:(i,u)=>{for(var f=i.split("/"),h="",v=0;v<f.length;++v)if(f[v]){h+="/"+f[v];try{g.mkdir(h,u)}catch(b){if(b.errno!=20)throw b}}},mkdev:(i,u,f)=>(typeof f>"u"&&(f=u,u=438),u|=8192,g.mknod(i,u,f)),symlink:(i,u)=>{if(!Ae.resolve(i))throw new g.ErrnoError(44);var f=g.lookupPath(u,{parent:!0}),h=f.node;if(!h)throw new g.ErrnoError(44);var v=Q.basename(u),b=g.mayCreate(h,v);if(b)throw new g.ErrnoError(b);if(!h.node_ops.symlink)throw new g.ErrnoError(63);return h.node_ops.symlink(h,v,i)},rename:(i,u)=>{var f=Q.dirname(i),h=Q.dirname(u),v=Q.basename(i),b=Q.basename(u),S,T,P;if(S=g.lookupPath(i,{parent:!0}),T=S.node,S=g.lookupPath(u,{parent:!0}),P=S.node,!T||!P)throw new g.ErrnoError(44);if(T.mount!==P.mount)throw new g.ErrnoError(75);var C=g.lookupNode(T,v),M=Ae.relative(i,h);if(M.charAt(0)!==".")throw new g.ErrnoError(28);if(M=Ae.relative(u,f),M.charAt(0)!==".")throw new g.ErrnoError(55);var F;try{F=g.lookupNode(P,b)}catch{}if(C!==F){var O=g.isDir(C.mode),B=g.mayDelete(T,v,O);if(B)throw new g.ErrnoError(B);if(B=F?g.mayDelete(P,b,O):g.mayCreate(P,b),B)throw new g.ErrnoError(B);if(!T.node_ops.rename)throw new g.ErrnoError(63);if(g.isMountpoint(C)||F&&g.isMountpoint(F))throw new g.ErrnoError(10);if(P!==T&&(B=g.nodePermissions(T,"w"),B))throw new g.ErrnoError(B);g.hashRemoveNode(C);try{T.node_ops.rename(C,P,b)}catch(z){throw z}finally{g.hashAddNode(C)}}},rmdir:i=>{var u=g.lookupPath(i,{parent:!0}),f=u.node,h=Q.basename(i),v=g.lookupNode(f,h),b=g.mayDelete(f,h,!0);if(b)throw new g.ErrnoError(b);if(!f.node_ops.rmdir)throw new g.ErrnoError(63);if(g.isMountpoint(v))throw new g.ErrnoError(10);f.node_ops.rmdir(f,h),g.destroyNode(v)},readdir:i=>{var u=g.lookupPath(i,{follow:!0}),f=u.node;if(!f.node_ops.readdir)throw new g.ErrnoError(54);return f.node_ops.readdir(f)},unlink:i=>{var u=g.lookupPath(i,{parent:!0}),f=u.node;if(!f)throw new g.ErrnoError(44);var h=Q.basename(i),v=g.lookupNode(f,h),b=g.mayDelete(f,h,!1);if(b)throw new g.ErrnoError(b);if(!f.node_ops.unlink)throw new g.ErrnoError(63);if(g.isMountpoint(v))throw new g.ErrnoError(10);f.node_ops.unlink(f,h),g.destroyNode(v)},readlink:i=>{var u=g.lookupPath(i),f=u.node;if(!f)throw new g.ErrnoError(44);if(!f.node_ops.readlink)throw new g.ErrnoError(28);return Ae.resolve(g.getPath(f.parent),f.node_ops.readlink(f))},stat:(i,u)=>{var f=g.lookupPath(i,{follow:!u}),h=f.node;if(!h)throw new g.ErrnoError(44);if(!h.node_ops.getattr)throw new g.ErrnoError(63);return h.node_ops.getattr(h)},lstat:i=>g.stat(i,!0),chmod:(i,u,f)=>{var h;if(typeof i=="string"){var v=g.lookupPath(i,{follow:!f});h=v.node}else h=i;if(!h.node_ops.setattr)throw new g.ErrnoError(63);h.node_ops.setattr(h,{mode:u&4095|h.mode&-4096,timestamp:Date.now()})},lchmod:(i,u)=>{g.chmod(i,u,!0)},fchmod:(i,u)=>{var f=g.getStream(i);if(!f)throw new g.ErrnoError(8);g.chmod(f.node,u)},chown:(i,u,f,h)=>{var v;if(typeof i=="string"){var b=g.lookupPath(i,{follow:!h});v=b.node}else v=i;if(!v.node_ops.setattr)throw new g.ErrnoError(63);v.node_ops.setattr(v,{timestamp:Date.now()})},lchown:(i,u,f)=>{g.chown(i,u,f,!0)},fchown:(i,u,f)=>{var h=g.getStream(i);if(!h)throw new g.ErrnoError(8);g.chown(h.node,u,f)},truncate:(i,u)=>{if(u<0)throw new g.ErrnoError(28);var f;if(typeof i=="string"){var h=g.lookupPath(i,{follow:!0});f=h.node}else f=i;if(!f.node_ops.setattr)throw new g.ErrnoError(63);if(g.isDir(f.mode))throw new g.ErrnoError(31);if(!g.isFile(f.mode))throw new g.ErrnoError(28);var v=g.nodePermissions(f,"w");if(v)throw new g.ErrnoError(v);f.node_ops.setattr(f,{size:u,timestamp:Date.now()})},ftruncate:(i,u)=>{var f=g.getStream(i);if(!f)throw new g.ErrnoError(8);if(!(f.flags&2097155))throw new g.ErrnoError(28);g.truncate(f.node,u)},utime:(i,u,f)=>{var h=g.lookupPath(i,{follow:!0}),v=h.node;v.node_ops.setattr(v,{timestamp:Math.max(u,f)})},open:(i,u,f)=>{if(i==="")throw new g.ErrnoError(44);u=typeof u=="string"?g.modeStringToFlags(u):u,f=typeof f>"u"?438:f,u&64?f=f&4095|32768:f=0;var h;if(typeof i=="object")h=i;else{i=Q.normalize(i);try{var v=g.lookupPath(i,{follow:!(u&131072)});h=v.node}catch{}}var b=!1;if(u&64)if(h){if(u&128)throw new g.ErrnoError(20)}else h=g.mknod(i,f,0),b=!0;if(!h)throw new g.ErrnoError(44);if(g.isChrdev(h.mode)&&(u&=-513),u&65536&&!g.isDir(h.mode))throw new g.ErrnoError(54);if(!b){var S=g.mayOpen(h,u);if(S)throw new g.ErrnoError(S)}u&512&&!b&&g.truncate(h,0),u&=-131713;var T=g.createStream({node:h,path:g.getPath(h),flags:u,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return T.stream_ops.open&&T.stream_ops.open(T),r.logReadFiles&&!(u&1)&&(g.readFiles||(g.readFiles={}),i in g.readFiles||(g.readFiles[i]=1)),T},close:i=>{if(g.isClosed(i))throw new g.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(u){throw u}finally{g.closeStream(i.fd)}i.fd=null},isClosed:i=>i.fd===null,llseek:(i,u,f)=>{if(g.isClosed(i))throw new g.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new g.ErrnoError(70);if(f!=0&&f!=1&&f!=2)throw new g.ErrnoError(28);return i.position=i.stream_ops.llseek(i,u,f),i.ungotten=[],i.position},read:(i,u,f,h,v)=>{if(h<0||v<0)throw new g.ErrnoError(28);if(g.isClosed(i))throw new g.ErrnoError(8);if((i.flags&2097155)===1)throw new g.ErrnoError(8);if(g.isDir(i.node.mode))throw new g.ErrnoError(31);if(!i.stream_ops.read)throw new g.ErrnoError(28);var b=typeof v<"u";if(!b)v=i.position;else if(!i.seekable)throw new g.ErrnoError(70);var S=i.stream_ops.read(i,u,f,h,v);return b||(i.position+=S),S},write:(i,u,f,h,v,b)=>{if(h<0||v<0)throw new g.ErrnoError(28);if(g.isClosed(i))throw new g.ErrnoError(8);if(!(i.flags&2097155))throw new g.ErrnoError(8);if(g.isDir(i.node.mode))throw new g.ErrnoError(31);if(!i.stream_ops.write)throw new g.ErrnoError(28);i.seekable&&i.flags&1024&&g.llseek(i,0,2);var S=typeof v<"u";if(!S)v=i.position;else if(!i.seekable)throw new g.ErrnoError(70);var T=i.stream_ops.write(i,u,f,h,v,b);return S||(i.position+=T),T},allocate:(i,u,f)=>{if(g.isClosed(i))throw new g.ErrnoError(8);if(u<0||f<=0)throw new g.ErrnoError(28);if(!(i.flags&2097155))throw new g.ErrnoError(8);if(!g.isFile(i.node.mode)&&!g.isDir(i.node.mode))throw new g.ErrnoError(43);if(!i.stream_ops.allocate)throw new g.ErrnoError(138);i.stream_ops.allocate(i,u,f)},mmap:(i,u,f,h,v)=>{if(h&2&&!(v&2)&&(i.flags&2097155)!==2)throw new g.ErrnoError(2);if((i.flags&2097155)===1)throw new g.ErrnoError(2);if(!i.stream_ops.mmap)throw new g.ErrnoError(43);return i.stream_ops.mmap(i,u,f,h,v)},msync:(i,u,f,h,v)=>!i||!i.stream_ops.msync?0:i.stream_ops.msync(i,u,f,h,v),munmap:i=>0,ioctl:(i,u,f)=>{if(!i.stream_ops.ioctl)throw new g.ErrnoError(59);return i.stream_ops.ioctl(i,u,f)},readFile:(i,u={})=>{if(u.flags=u.flags||0,u.encoding=u.encoding||"binary",u.encoding!=="utf8"&&u.encoding!=="binary")throw new Error('Invalid encoding type "'+u.encoding+'"');var f,h=g.open(i,u.flags),v=g.stat(i),b=v.size,S=new Uint8Array(b);return g.read(h,S,0,b,0),u.encoding==="utf8"?f=ie(S,0):u.encoding==="binary"&&(f=S),g.close(h),f},writeFile:(i,u,f={})=>{f.flags=f.flags||577;var h=g.open(i,f.flags,f.mode);if(typeof u=="string"){var v=new Uint8Array($(u)+1),b=te(u,v,0,v.length);g.write(h,v,0,b,void 0,f.canOwn)}else if(ArrayBuffer.isView(u))g.write(h,u,0,u.byteLength,void 0,f.canOwn);else throw new Error("Unsupported data type");g.close(h)},cwd:()=>g.currentPath,chdir:i=>{var u=g.lookupPath(i,{follow:!0});if(u.node===null)throw new g.ErrnoError(44);if(!g.isDir(u.node.mode))throw new g.ErrnoError(54);var f=g.nodePermissions(u.node,"x");if(f)throw new g.ErrnoError(f);g.currentPath=u.path},createDefaultDirectories:()=>{g.mkdir("/tmp"),g.mkdir("/home"),g.mkdir("/home/web_user")},createDefaultDevices:()=>{g.mkdir("/dev"),g.registerDevice(g.makedev(1,3),{read:()=>0,write:(u,f,h,v,b)=>v}),g.mkdev("/dev/null",g.makedev(1,3)),Ge.register(g.makedev(5,0),Ge.default_tty_ops),Ge.register(g.makedev(6,0),Ge.default_tty1_ops),g.mkdev("/dev/tty",g.makedev(5,0)),g.mkdev("/dev/tty1",g.makedev(6,0));var i=Ur();g.createDevice("/dev","random",i),g.createDevice("/dev","urandom",i),g.mkdir("/dev/shm"),g.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{g.mkdir("/proc");var i=g.mkdir("/proc/self");g.mkdir("/proc/self/fd"),g.mount({mount:()=>{var u=g.createNode(i,"fd",16895,73);return u.node_ops={lookup:(f,h)=>{var v=+h,b=g.getStream(v);if(!b)throw new g.ErrnoError(8);var S={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>b.path}};return S.parent=S,S}},u}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?g.createDevice("/dev","stdin",r.stdin):g.symlink("/dev/tty","/dev/stdin"),r.stdout?g.createDevice("/dev","stdout",null,r.stdout):g.symlink("/dev/tty","/dev/stdout"),r.stderr?g.createDevice("/dev","stderr",null,r.stderr):g.symlink("/dev/tty1","/dev/stderr"),g.open("/dev/stdin",0),g.open("/dev/stdout",1),g.open("/dev/stderr",1)},ensureErrnoError:()=>{g.ErrnoError||(g.ErrnoError=function(u,f){this.node=f,this.setErrno=function(h){this.errno=h},this.setErrno(u),this.message="FS error"},g.ErrnoError.prototype=new Error,g.ErrnoError.prototype.constructor=g.ErrnoError,[44].forEach(i=>{g.genericErrors[i]=new g.ErrnoError(i),g.genericErrors[i].stack="<generic error, no stack>"}))},staticInit:()=>{g.ensureErrnoError(),g.nameTable=new Array(4096),g.mount(Y,{},"/"),g.createDefaultDirectories(),g.createDefaultDevices(),g.createSpecialDirectories(),g.filesystems={MEMFS:Y}},init:(i,u,f)=>{g.init.initialized=!0,g.ensureErrnoError(),r.stdin=i||r.stdin,r.stdout=u||r.stdout,r.stderr=f||r.stderr,g.createStandardStreams()},quit:()=>{g.init.initialized=!1;for(var i=0;i<g.streams.length;i++){var u=g.streams[i];u&&g.close(u)}},getMode:(i,u)=>{var f=0;return i&&(f|=365),u&&(f|=146),f},findObject:(i,u)=>{var f=g.analyzePath(i,u);return f.exists?f.object:null},analyzePath:(i,u)=>{try{var f=g.lookupPath(i,{follow:!u});i=f.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var f=g.lookupPath(i,{parent:!0});h.parentExists=!0,h.parentPath=f.path,h.parentObject=f.node,h.name=Q.basename(i),f=g.lookupPath(i,{follow:!u}),h.exists=!0,h.path=f.path,h.object=f.node,h.name=f.node.name,h.isRoot=f.path==="/"}catch(v){h.error=v.errno}return h},createPath:(i,u,f,h)=>{i=typeof i=="string"?i:g.getPath(i);for(var v=u.split("/").reverse();v.length;){var b=v.pop();if(b){var S=Q.join2(i,b);try{g.mkdir(S)}catch{}i=S}}return S},createFile:(i,u,f,h,v)=>{var b=Q.join2(typeof i=="string"?i:g.getPath(i),u),S=g.getMode(h,v);return g.create(b,S)},createDataFile:(i,u,f,h,v,b)=>{var S=u;i&&(i=typeof i=="string"?i:g.getPath(i),S=u?Q.join2(i,u):i);var T=g.getMode(h,v),P=g.create(S,T);if(f){if(typeof f=="string"){for(var C=new Array(f.length),M=0,F=f.length;M<F;++M)C[M]=f.charCodeAt(M);f=C}g.chmod(P,T|146);var O=g.open(P,577);g.write(O,f,0,f.length,0,b),g.close(O),g.chmod(P,T)}return P},createDevice:(i,u,f,h)=>{var v=Q.join2(typeof i=="string"?i:g.getPath(i),u),b=g.getMode(!!f,!!h);g.createDevice.major||(g.createDevice.major=64);var S=g.makedev(g.createDevice.major++,0);return g.registerDevice(S,{open:T=>{T.seekable=!1},close:T=>{h&&h.buffer&&h.buffer.length&&h(10)},read:(T,P,C,M,F)=>{for(var O=0,B=0;B<M;B++){var z;try{z=f()}catch{throw new g.ErrnoError(29)}if(z===void 0&&O===0)throw new g.ErrnoError(6);if(z==null)break;O++,P[C+B]=z}return O&&(T.node.timestamp=Date.now()),O},write:(T,P,C,M,F)=>{for(var O=0;O<M;O++)try{h(P[C+O])}catch{throw new g.ErrnoError(29)}return M&&(T.node.timestamp=Date.now()),O}}),g.mkdev(v,b,S)},forceLoadFile:i=>{if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(w)try{i.contents=St(w(i.url),!0),i.usedBytes=i.contents.length}catch{throw new g.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(i,u,f,h,v)=>{function b(){this.lengthKnown=!1,this.chunks=[]}if(b.prototype.get=function(B){if(!(B>this.length-1||B<0)){var z=B%this.chunkSize,ee=B/this.chunkSize|0;return this.getter(ee)[z]}},b.prototype.setDataGetter=function(B){this.getter=B},b.prototype.cacheLength=function(){var B=new XMLHttpRequest;if(B.open("HEAD",f,!1),B.send(null),!(B.status>=200&&B.status<300||B.status===304))throw new Error("Couldn't load "+f+". Status: "+B.status);var z=Number(B.getResponseHeader("Content-length")),ee,ue=(ee=B.getResponseHeader("Accept-Ranges"))&&ee==="bytes",le=(ee=B.getResponseHeader("Content-Encoding"))&&ee==="gzip",D=1024*1024;ue||(D=z);var N=(ne,_e)=>{if(ne>_e)throw new Error("invalid range ("+ne+", "+_e+") or no bytes requested!");if(_e>z-1)throw new Error("only "+z+" bytes available! programmer error!");var ce=new XMLHttpRequest;if(ce.open("GET",f,!1),z!==D&&ce.setRequestHeader("Range","bytes="+ne+"-"+_e),ce.responseType="arraybuffer",ce.overrideMimeType&&ce.overrideMimeType("text/plain; charset=x-user-defined"),ce.send(null),!(ce.status>=200&&ce.status<300||ce.status===304))throw new Error("Couldn't load "+f+". Status: "+ce.status);return ce.response!==void 0?new Uint8Array(ce.response||[]):St(ce.responseText||"",!0)},de=this;de.setDataGetter(ne=>{var _e=ne*D,ce=(ne+1)*D-1;if(ce=Math.min(ce,z-1),typeof de.chunks[ne]>"u"&&(de.chunks[ne]=N(_e,ce)),typeof de.chunks[ne]>"u")throw new Error("doXHR failed!");return de.chunks[ne]}),(le||!z)&&(D=z=1,z=this.getter(0).length,D=z,G("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=z,this._chunkSize=D,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var S=new b;Object.defineProperties(S,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var T={isDevice:!1,contents:S}}else var T={isDevice:!1,url:f};var P=g.createFile(i,u,T,h,v);T.contents?P.contents=T.contents:T.url&&(P.contents=null,P.url=T.url),Object.defineProperties(P,{usedBytes:{get:function(){return this.contents.length}}});var C={},M=Object.keys(P.stream_ops);M.forEach(O=>{var B=P.stream_ops[O];C[O]=function(){return g.forceLoadFile(P),B.apply(null,arguments)}});function F(O,B,z,ee,ue){var le=O.node.contents;if(ue>=le.length)return 0;var D=Math.min(le.length-ue,ee);if(le.slice)for(var N=0;N<D;N++)B[z+N]=le[ue+N];else for(var N=0;N<D;N++)B[z+N]=le.get(ue+N);return D}return C.read=(O,B,z,ee,ue)=>(g.forceLoadFile(P),F(O,B,z,ee,ue)),C.mmap=(O,B,z,ee,ue)=>{g.forceLoadFile(P);var le=Jt(B);if(!le)throw new g.ErrnoError(48);return F(O,ye,le,B,z),{ptr:le,allocated:!0}},P.stream_ops=C,P},createPreloadedFile:(i,u,f,h,v,b,S,T,P,C)=>{var M=u?Ae.resolve(Q.join2(i,u)):i;function F(O){function B(z){C&&C(),T||g.createDataFile(i,u,z,h,v,P),b&&b(),at()}Browser.handledByPreloadPlugin(O,M,B,()=>{S&&S(),at()})||B(O)}Et(),typeof f=="string"?Vr(f,O=>F(O),S):F(f)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(i,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var h=g.indexedDB();try{var v=h.open(g.DB_NAME(),g.DB_VERSION)}catch(b){return f(b)}v.onupgradeneeded=()=>{G("creating db");var b=v.result;b.createObjectStore(g.DB_STORE_NAME)},v.onsuccess=()=>{var b=v.result,S=b.transaction([g.DB_STORE_NAME],"readwrite"),T=S.objectStore(g.DB_STORE_NAME),P=0,C=0,M=i.length;function F(){C==0?u():f()}i.forEach(O=>{var B=T.put(g.analyzePath(O).object.contents,O);B.onsuccess=()=>{P++,P+C==M&&F()},B.onerror=()=>{C++,P+C==M&&F()}}),S.onerror=f},v.onerror=f},loadFilesFromDB:(i,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var h=g.indexedDB();try{var v=h.open(g.DB_NAME(),g.DB_VERSION)}catch(b){return f(b)}v.onupgradeneeded=f,v.onsuccess=()=>{var b=v.result;try{var S=b.transaction([g.DB_STORE_NAME],"readonly")}catch(O){f(O);return}var T=S.objectStore(g.DB_STORE_NAME),P=0,C=0,M=i.length;function F(){C==0?u():f()}i.forEach(O=>{var B=T.get(O);B.onsuccess=()=>{g.analyzePath(O).exists&&g.unlink(O),g.createDataFile(Q.dirname(O),Q.basename(O),B.result,!0,!0,!0),P++,P+C==M&&F()},B.onerror=()=>{C++,P+C==M&&F()}}),S.onerror=f},v.onerror=f}},K={DEFAULT_POLLMASK:5,calculateAt:function(i,u,f){if(Q.isAbs(u))return u;var h;if(i===-100)h=g.cwd();else{var v=g.getStream(i);if(!v)throw new g.ErrnoError(8);h=v.path}if(u.length==0){if(!f)throw new g.ErrnoError(44);return h}return Q.join2(h,u)},doStat:function(i,u,f){try{var h=i(u)}catch(v){if(v&&v.node&&Q.normalize(u)!==Q.normalize(g.getPath(v.node)))return-54;throw v}return I[f>>2]=h.dev,I[f+4>>2]=0,I[f+8>>2]=h.ino,I[f+12>>2]=h.mode,I[f+16>>2]=h.nlink,I[f+20>>2]=h.uid,I[f+24>>2]=h.gid,I[f+28>>2]=h.rdev,I[f+32>>2]=0,ke=[h.size>>>0,(me=h.size,+Math.abs(me)>=1?me>0?(Math.min(+Math.floor(me/4294967296),4294967295)|0)>>>0:~~+Math.ceil((me-+(~~me>>>0))/4294967296)>>>0:0)],I[f+40>>2]=ke[0],I[f+44>>2]=ke[1],I[f+48>>2]=4096,I[f+52>>2]=h.blocks,I[f+56>>2]=h.atime.getTime()/1e3|0,I[f+60>>2]=0,I[f+64>>2]=h.mtime.getTime()/1e3|0,I[f+68>>2]=0,I[f+72>>2]=h.ctime.getTime()/1e3|0,I[f+76>>2]=0,ke=[h.ino>>>0,(me=h.ino,+Math.abs(me)>=1?me>0?(Math.min(+Math.floor(me/4294967296),4294967295)|0)>>>0:~~+Math.ceil((me-+(~~me>>>0))/4294967296)>>>0:0)],I[f+80>>2]=ke[0],I[f+84>>2]=ke[1],0},doMsync:function(i,u,f,h,v){var b=be.slice(i,i+f);g.msync(u,b,v,f,h)},varargs:void 0,get:function(){K.varargs+=4;var i=I[K.varargs-4>>2];return i},getStr:function(i){var u=X(i);return u},getStreamFromFD:function(i){var u=g.getStream(i);if(!u)throw new g.ErrnoError(8);return u}};function zr(i,u){try{return i=K.getStr(i),g.chmod(i,u),0}catch(f){if(typeof g>"u"||!(f instanceof g.ErrnoError))throw f;return-f.errno}}function Hr(i,u,f,h){try{if(u=K.getStr(u),u=K.calculateAt(i,u),f&-8)return-28;var v=g.lookupPath(u,{follow:!0}),b=v.node;if(!b)return-44;var S="";return f&4&&(S+="r"),f&2&&(S+="w"),f&1&&(S+="x"),S&&g.nodePermissions(b,S)?-2:0}catch(T){if(typeof g>"u"||!(T instanceof g.ErrnoError))throw T;return-T.errno}}function Wr(i){return I[br()>>2]=i,i}function $r(i,u,f){K.varargs=f;try{var h=K.getStreamFromFD(i);switch(u){case 0:{var v=K.get();if(v<0)return-28;var b;return b=g.createStream(h,v),b.fd}case 1:case 2:return 0;case 3:return h.flags;case 4:{var v=K.get();return h.flags|=v,0}case 5:{var v=K.get(),S=0;return Fe[v+S>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Wr(28),-1;default:return-28}}catch(T){if(typeof g>"u"||!(T instanceof g.ErrnoError))throw T;return-T.errno}}function Yr(i,u){try{var f=K.getStreamFromFD(i);return K.doStat(g.stat,f.path,u)}catch(h){if(typeof g>"u"||!(h instanceof g.ErrnoError))throw h;return-h.errno}}function Xr(i,u,f){K.varargs=f;try{var h=K.getStreamFromFD(i);switch(u){case 21509:case 21505:return h.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return h.tty?0:-59;case 21519:{if(!h.tty)return-59;var v=K.get();return I[v>>2]=0,0}case 21520:return h.tty?-28:-59;case 21531:{var v=K.get();return g.ioctl(h,u,v)}case 21523:return h.tty?0:-59;case 21524:return h.tty?0:-59;default:Ie("bad ioctl syscall "+u)}}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return-b.errno}}function qr(i,u){try{return i=K.getStr(i),K.doStat(g.lstat,i,u)}catch(f){if(typeof g>"u"||!(f instanceof g.ErrnoError))throw f;return-f.errno}}function jr(i,u,f,h){try{u=K.getStr(u);var v=h&256,b=h&4096;return h=h&-4353,u=K.calculateAt(i,u,b),K.doStat(v?g.lstat:g.stat,u,f)}catch(S){if(typeof g>"u"||!(S instanceof g.ErrnoError))throw S;return-S.errno}}function Zr(i,u,f,h){K.varargs=h;try{u=K.getStr(u),u=K.calculateAt(i,u);var v=h?K.get():0;return g.open(u,f,v).fd}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return-b.errno}}function Qr(i,u){try{return i=K.getStr(i),K.doStat(g.stat,i,u)}catch(f){if(typeof g>"u"||!(f instanceof g.ErrnoError))throw f;return-f.errno}}function Kr(i,u,f,h,v){}function it(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+i)}}function Jr(){for(var i=new Array(256),u=0;u<256;++u)i[u]=String.fromCharCode(u);er=i}var er=void 0;function we(i){for(var u="",f=i;be[f];)u+=er[be[f++]];return u}var We={},Ve={},ut={},en=48,tn=57;function lt(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var u=i.charCodeAt(0);return u>=en&&u<=tn?"_"+i:i}function ct(i,u){return i=lt(i),new Function("body","return function "+i+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(u)}function xt(i,u){var f=ct(u,function(h){this.name=u,this.message=h;var v=new Error(h).stack;v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(i.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},f}var $e=void 0;function J(i){throw new $e(i)}var tr=void 0;function ft(i){throw new tr(i)}function ze(i,u,f){i.forEach(function(T){ut[T]=u});function h(T){var P=f(T);P.length!==i.length&&ft("Mismatched type converter count");for(var C=0;C<i.length;++C)xe(i[C],P[C])}var v=new Array(u.length),b=[],S=0;u.forEach((T,P)=>{Ve.hasOwnProperty(T)?v[P]=Ve[T]:(b.push(T),We.hasOwnProperty(T)||(We[T]=[]),We[T].push(()=>{v[P]=Ve[T],++S,S===b.length&&h(v)}))}),b.length===0&&h(v)}function xe(i,u,f={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");var h=u.name;if(i||J('type "'+h+'" must have a positive integer typeid pointer'),Ve.hasOwnProperty(i)){if(f.ignoreDuplicateRegistrations)return;J("Cannot register type '"+h+"' twice")}if(Ve[i]=u,delete ut[i],We.hasOwnProperty(i)){var v=We[i];delete We[i],v.forEach(b=>b())}}function rn(i,u,f,h,v){var b=it(f);u=we(u),xe(i,{name:u,fromWireType:function(S){return!!S},toWireType:function(S,T){return T?h:v},argPackAdvance:8,readValueFromPointer:function(S){var T;if(f===1)T=ye;else if(f===2)T=Fe;else if(f===4)T=I;else throw new TypeError("Unknown boolean type size: "+u);return this.fromWireType(T[S>>b])},destructorFunction:null})}function nn(i){if(!(this instanceof Be)||!(i instanceof Be))return!1;for(var u=this.$$.ptrType.registeredClass,f=this.$$.ptr,h=i.$$.ptrType.registeredClass,v=i.$$.ptr;u.baseClass;)f=u.upcast(f),u=u.baseClass;for(;h.baseClass;)v=h.upcast(v),h=h.baseClass;return u===h&&f===v}function an(i){return{count:i.count,deleteScheduled:i.deleteScheduled,preservePointerOnDelete:i.preservePointerOnDelete,ptr:i.ptr,ptrType:i.ptrType,smartPtr:i.smartPtr,smartPtrType:i.smartPtrType}}function Ct(i){function u(f){return f.$$.ptrType.registeredClass.name}J(u(i)+" instance already deleted")}var kt=!1;function rr(i){}function on(i){i.smartPtr?i.smartPtrType.rawDestructor(i.smartPtr):i.ptrType.registeredClass.rawDestructor(i.ptr)}function nr(i){i.count.value-=1;var u=i.count.value===0;u&&on(i)}function ar(i,u,f){if(u===f)return i;if(f.baseClass===void 0)return null;var h=ar(i,u,f.baseClass);return h===null?null:f.downcast(h)}var or={};function sn(){return Object.keys(Ke).length}function un(){var i=[];for(var u in Ke)Ke.hasOwnProperty(u)&&i.push(Ke[u]);return i}var Ze=[];function At(){for(;Ze.length;){var i=Ze.pop();i.$$.deleteScheduled=!1,i.delete()}}var Qe=void 0;function ln(i){Qe=i,Ze.length&&Qe&&Qe(At)}function cn(){r.getInheritedInstanceCount=sn,r.getLiveInheritedInstances=un,r.flushPendingDeletes=At,r.setDelayFunction=ln}var Ke={};function fn(i,u){for(u===void 0&&J("ptr should not be undefined");i.baseClass;)u=i.upcast(u),i=i.baseClass;return u}function pn(i,u){return u=fn(i,u),Ke[u]}function pt(i,u){(!u.ptrType||!u.ptr)&&ft("makeClassHandle requires ptr and ptrType");var f=!!u.smartPtrType,h=!!u.smartPtr;return f!==h&&ft("Both smartPtrType and smartPtr must be specified"),u.count={value:1},Je(Object.create(i,{$$:{value:u}}))}function hn(i){var u=this.getPointee(i);if(!u)return this.destructor(i),null;var f=pn(this.registeredClass,u);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=u,f.$$.smartPtr=i,f.clone();var h=f.clone();return this.destructor(i),h}function v(){return this.isSmartPointer?pt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:i}):pt(this.registeredClass.instancePrototype,{ptrType:this,ptr:i})}var b=this.registeredClass.getActualType(u),S=or[b];if(!S)return v.call(this);var T;this.isConst?T=S.constPointerType:T=S.pointerType;var P=ar(u,this.registeredClass,T.registeredClass);return P===null?v.call(this):this.isSmartPointer?pt(T.registeredClass.instancePrototype,{ptrType:T,ptr:P,smartPtrType:this,smartPtr:i}):pt(T.registeredClass.instancePrototype,{ptrType:T,ptr:P})}function Je(i){return typeof FinalizationRegistry>"u"?(Je=u=>u,i):(kt=new FinalizationRegistry(u=>{nr(u.$$)}),Je=u=>{var f=u.$$,h=!!f.smartPtr;if(h){var v={$$:f};kt.register(u,v,u)}return u},rr=u=>kt.unregister(u),Je(i))}function dn(){if(this.$$.ptr||Ct(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var i=Je(Object.create(Object.getPrototypeOf(this),{$$:{value:an(this.$$)}}));return i.$$.count.value+=1,i.$$.deleteScheduled=!1,i}function vn(){this.$$.ptr||Ct(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&J("Object already scheduled for deletion"),rr(this),nr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function gn(){return!this.$$.ptr}function mn(){return this.$$.ptr||Ct(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&J("Object already scheduled for deletion"),Ze.push(this),Ze.length===1&&Qe&&Qe(At),this.$$.deleteScheduled=!0,this}function yn(){Be.prototype.isAliasOf=nn,Be.prototype.clone=dn,Be.prototype.delete=vn,Be.prototype.isDeleted=gn,Be.prototype.deleteLater=mn}function Be(){}function Dt(i,u,f){if(i[u].overloadTable===void 0){var h=i[u];i[u]=function(){return i[u].overloadTable.hasOwnProperty(arguments.length)||J("Function '"+f+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+i[u].overloadTable+")!"),i[u].overloadTable[arguments.length].apply(this,arguments)},i[u].overloadTable=[],i[u].overloadTable[h.argCount]=h}}function sr(i,u,f){r.hasOwnProperty(i)?(J("Cannot register public name '"+i+"' twice"),Dt(r,i,i),r.hasOwnProperty(f)&&J("Cannot register multiple overloads of a function with the same number of arguments ("+f+")!"),r[i].overloadTable[f]=u):r[i]=u}function bn(i,u,f,h,v,b,S,T){this.name=i,this.constructor=u,this.instancePrototype=f,this.rawDestructor=h,this.baseClass=v,this.getActualType=b,this.upcast=S,this.downcast=T,this.pureVirtualFunctions=[]}function Ot(i,u,f){for(;u!==f;)u.upcast||J("Expected null or instance of "+f.name+", got an instance of "+u.name),i=u.upcast(i),u=u.baseClass;return i}function wn(i,u){if(u===null)return this.isReference&&J("null is not a valid "+this.name),0;u.$$||J('Cannot pass "'+Bt(u)+'" as a '+this.name),u.$$.ptr||J("Cannot pass deleted object as a pointer of type "+this.name);var f=u.$$.ptrType.registeredClass,h=Ot(u.$$.ptr,f,this.registeredClass);return h}function Sn(i,u){var f;if(u===null)return this.isReference&&J("null is not a valid "+this.name),this.isSmartPointer?(f=this.rawConstructor(),i!==null&&i.push(this.rawDestructor,f),f):0;u.$$||J('Cannot pass "'+Bt(u)+'" as a '+this.name),u.$$.ptr||J("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&u.$$.ptrType.isConst&&J("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);var h=u.$$.ptrType.registeredClass;if(f=Ot(u.$$.ptr,h,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&J("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?f=u.$$.smartPtr:J("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:f=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)f=u.$$.smartPtr;else{var v=u.clone();f=this.rawShare(f,he.toHandle(function(){v.delete()})),i!==null&&i.push(this.rawDestructor,f)}break;default:J("Unsupporting sharing policy")}return f}function Tn(i,u){if(u===null)return this.isReference&&J("null is not a valid "+this.name),0;u.$$||J('Cannot pass "'+Bt(u)+'" as a '+this.name),u.$$.ptr||J("Cannot pass deleted object as a pointer of type "+this.name),u.$$.ptrType.isConst&&J("Cannot convert argument of type "+u.$$.ptrType.name+" to parameter type "+this.name);var f=u.$$.ptrType.registeredClass,h=Ot(u.$$.ptr,f,this.registeredClass);return h}function ht(i){return this.fromWireType(Z[i>>2])}function _n(i){return this.rawGetPointee&&(i=this.rawGetPointee(i)),i}function En(i){this.rawDestructor&&this.rawDestructor(i)}function Pn(i){i!==null&&i.delete()}function xn(){De.prototype.getPointee=_n,De.prototype.destructor=En,De.prototype.argPackAdvance=8,De.prototype.readValueFromPointer=ht,De.prototype.deleteObject=Pn,De.prototype.fromWireType=hn}function De(i,u,f,h,v,b,S,T,P,C,M){this.name=i,this.registeredClass=u,this.isReference=f,this.isConst=h,this.isSmartPointer=v,this.pointeeType=b,this.sharingPolicy=S,this.rawGetPointee=T,this.rawConstructor=P,this.rawShare=C,this.rawDestructor=M,!v&&u.baseClass===void 0?h?(this.toWireType=wn,this.destructorFunction=null):(this.toWireType=Tn,this.destructorFunction=null):this.toWireType=Sn}function Cn(i,u,f){r.hasOwnProperty(i)||ft("Replacing nonexistant public symbol"),r[i].overloadTable!==void 0&&f!==void 0?r[i].overloadTable[f]=u:(r[i]=u,r[i].argCount=f)}function kn(i,u,f){var h=r["dynCall_"+i];return f&&f.length?h.apply(null,[u].concat(f)):h.call(null,u)}function An(i,u,f){return i.includes("j")?kn(i,u,f):st(u).apply(null,f)}function Dn(i,u){var f=[];return function(){return f.length=0,Object.assign(f,arguments),An(i,u,f)}}function He(i,u){i=we(i);function f(){return i.includes("j")?Dn(i,u):st(u)}var h=f();return typeof h!="function"&&J("unknown function pointer with signature "+i+": "+u),h}var ir=void 0;function ur(i){var u=wr(i),f=we(u);return Me(u),f}function dt(i,u){var f=[],h={};function v(b){if(!h[b]&&!Ve[b]){if(ut[b]){ut[b].forEach(v);return}f.push(b),h[b]=!0}}throw u.forEach(v),new ir(i+": "+f.map(ur).join([", "]))}function On(i,u,f,h,v,b,S,T,P,C,M,F,O){M=we(M),b=He(v,b),T&&(T=He(S,T)),C&&(C=He(P,C)),O=He(F,O);var B=lt(M);sr(B,function(){dt("Cannot construct "+M+" due to unbound types",[h])}),ze([i,u,f],h?[h]:[],function(z){z=z[0];var ee,ue;h?(ee=z.registeredClass,ue=ee.instancePrototype):ue=Be.prototype;var le=ct(B,function(){if(Object.getPrototypeOf(this)!==D)throw new $e("Use 'new' to construct "+M);if(N.constructor_body===void 0)throw new $e(M+" has no accessible constructor");var ce=N.constructor_body[arguments.length];if(ce===void 0)throw new $e("Tried to invoke ctor of "+M+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(N.constructor_body).toString()+") parameters instead!");return ce.apply(this,arguments)}),D=Object.create(ue,{constructor:{value:le}});le.prototype=D;var N=new bn(M,le,D,O,ee,b,T,C),de=new De(M,N,!0,!1,!1),ne=new De(M+"*",N,!1,!1,!1),_e=new De(M+" const*",N,!1,!0,!1);return or[i]={pointerType:ne,constPointerType:_e},Cn(B,le),[de,ne,_e]})}function lr(i,u){if(!(i instanceof Function))throw new TypeError("new_ called with constructor type "+typeof i+" which is not a function");var f=ct(i.name||"unknownFunctionName",function(){});f.prototype=i.prototype;var h=new f,v=i.apply(h,u);return v instanceof Object?v:h}function cr(i){for(;i.length;){var u=i.pop(),f=i.pop();f(u)}}function Rt(i,u,f,h,v){var b=u.length;b<2&&J("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var S=u[1]!==null&&f!==null,T=!1,P=1;P<u.length;++P)if(u[P]!==null&&u[P].destructorFunction===void 0){T=!0;break}for(var C=u[0].name!=="void",M="",F="",P=0;P<b-2;++P)M+=(P!==0?", ":"")+"arg"+P,F+=(P!==0?", ":"")+"arg"+P+"Wired";var O="return function "+lt(i)+"("+M+`) {
if (arguments.length !== `+(b-2)+`) {
throwBindingError('function `+i+" called with ' + arguments.length + ' arguments, expected "+(b-2)+` args!');
}
`;T&&(O+=`var destructors = [];
`);var B=T?"destructors":"null",z=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ee=[J,h,v,cr,u[0],u[1]];S&&(O+="var thisWired = classParam.toWireType("+B+`, this);
`);for(var P=0;P<b-2;++P)O+="var arg"+P+"Wired = argType"+P+".toWireType("+B+", arg"+P+"); // "+u[P+2].name+`
`,z.push("argType"+P),ee.push(u[P+2]);if(S&&(F="thisWired"+(F.length>0?", ":"")+F),O+=(C?"var rv = ":"")+"invoker(fn"+(F.length>0?", ":"")+F+`);
`,T)O+=`runDestructors(destructors);
`;else for(var P=S?1:2;P<u.length;++P){var ue=P===1?"thisWired":"arg"+(P-2)+"Wired";u[P].destructorFunction!==null&&(O+=ue+"_dtor("+ue+"); // "+u[P].name+`
`,z.push(ue+"_dtor"),ee.push(u[P].destructorFunction))}C&&(O+=`var ret = retType.fromWireType(rv);
return ret;
`),O+=`}
`,z.push(O);var le=lr(Function,z).apply(null,ee);return le}function Mt(i,u){for(var f=[],h=0;h<i;h++)f.push(I[(u>>2)+h]);return f}function Rn(i,u,f,h,v,b,S){var T=Mt(f,h);u=we(u),b=He(v,b),ze([],[i],function(P){P=P[0];var C=P.name+"."+u;function M(){dt("Cannot call "+C+" due to unbound types",T)}u.startsWith("@@")&&(u=Symbol[u.substring(2)]);var F=P.registeredClass.constructor;return F[u]===void 0?(M.argCount=f-1,F[u]=M):(Dt(F,u,C),F[u].overloadTable[f-1]=M),ze([],T,function(O){var B=[O[0],null].concat(O.slice(1)),z=Rt(C,B,null,b,S);return F[u].overloadTable===void 0?(z.argCount=f-1,F[u]=z):F[u].overloadTable[f-1]=z,[]}),[]})}function Mn(i,u,f,h,v,b){j(u>0);var S=Mt(u,f);v=He(h,v),ze([],[i],function(T){T=T[0];var P="constructor "+T.name;if(T.registeredClass.constructor_body===void 0&&(T.registeredClass.constructor_body=[]),T.registeredClass.constructor_body[u-1]!==void 0)throw new $e("Cannot register multiple constructors with identical number of parameters ("+(u-1)+") for class '"+T.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return T.registeredClass.constructor_body[u-1]=()=>{dt("Cannot construct "+T.name+" due to unbound types",S)},ze([],S,function(C){return C.splice(1,0,null),T.registeredClass.constructor_body[u-1]=Rt(P,C,null,v,b),[]}),[]})}function Fn(i,u,f,h,v,b,S,T){var P=Mt(f,h);u=we(u),b=He(v,b),ze([],[i],function(C){C=C[0];var M=C.name+"."+u;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),T&&C.registeredClass.pureVirtualFunctions.push(u);function F(){dt("Cannot call "+M+" due to unbound types",P)}var O=C.registeredClass.instancePrototype,B=O[u];return B===void 0||B.overloadTable===void 0&&B.className!==C.name&&B.argCount===f-2?(F.argCount=f-2,F.className=C.name,O[u]=F):(Dt(O,u,M),O[u].overloadTable[f-2]=F),ze([],P,function(z){var ee=Rt(M,z,C,b,S);return O[u].overloadTable===void 0?(ee.argCount=f-2,O[u]=ee):O[u].overloadTable[f-2]=ee,[]}),[]})}var Ft=[],Pe=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function It(i){i>4&&--Pe[i].refcount===0&&(Pe[i]=void 0,Ft.push(i))}function In(){for(var i=0,u=5;u<Pe.length;++u)Pe[u]!==void 0&&++i;return i}function Bn(){for(var i=5;i<Pe.length;++i)if(Pe[i]!==void 0)return Pe[i];return null}function Ln(){r.count_emval_handles=In,r.get_first_emval=Bn}var he={toValue:i=>(i||J("Cannot use deleted val. handle = "+i),Pe[i].value),toHandle:i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var u=Ft.length?Ft.pop():Pe.length;return Pe[u]={refcount:1,value:i},u}}}};function Un(i,u){u=we(u),xe(i,{name:u,fromWireType:function(f){var h=he.toValue(f);return It(f),h},toWireType:function(f,h){return he.toHandle(h)},argPackAdvance:8,readValueFromPointer:ht,destructorFunction:null})}function Nn(i,u,f){switch(u){case 0:return function(h){var v=f?ye:be;return this.fromWireType(v[h])};case 1:return function(h){var v=f?Fe:qe;return this.fromWireType(v[h>>1])};case 2:return function(h){var v=f?I:Z;return this.fromWireType(v[h>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Gn(i,u,f,h){var v=it(f);u=we(u);function b(){}b.values={},xe(i,{name:u,constructor:b,fromWireType:function(S){return this.constructor.values[S]},toWireType:function(S,T){return T.value},argPackAdvance:8,readValueFromPointer:Nn(u,v,h),destructorFunction:null}),sr(u,b)}function vt(i,u){var f=Ve[i];return f===void 0&&J(u+" has unknown type "+ur(i)),f}function Vn(i,u,f){var h=vt(i,"enum");u=we(u);var v=h.constructor,b=Object.create(h.constructor.prototype,{value:{value:f},constructor:{value:ct(h.name+"_"+u,function(){})}});v.values[f]=b,v[u]=b}function Bt(i){if(i===null)return"null";var u=typeof i;return u==="object"||u==="array"||u==="function"?i.toString():""+i}function zn(i,u){switch(u){case 2:return function(f){return this.fromWireType(Ee[f>>2])};case 3:return function(f){return this.fromWireType(Ht[f>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Hn(i,u,f){var h=it(f);u=we(u),xe(i,{name:u,fromWireType:function(v){return v},toWireType:function(v,b){return b},argPackAdvance:8,readValueFromPointer:zn(u,h),destructorFunction:null})}function Wn(i,u,f){switch(u){case 0:return f?function(v){return ye[v]}:function(v){return be[v]};case 1:return f?function(v){return Fe[v>>1]}:function(v){return qe[v>>1]};case 2:return f?function(v){return I[v>>2]}:function(v){return Z[v>>2]};default:throw new TypeError("Unknown integer type: "+i)}}function $n(i,u,f,h,v){u=we(u);var b=it(f),S=F=>F;if(h===0){var T=32-8*f;S=F=>F<<T>>>T}var P=u.includes("unsigned"),C=(F,O)=>{},M;P?M=function(F,O){return C(O,this.name),O>>>0}:M=function(F,O){return C(O,this.name),O},xe(i,{name:u,fromWireType:S,toWireType:M,argPackAdvance:8,readValueFromPointer:Wn(u,b,h!==0),destructorFunction:null})}function Yn(i,u,f){var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],v=h[u];function b(S){S=S>>2;var T=Z,P=T[S],C=T[S+1];return new v(Ce,C,P)}f=we(f),xe(i,{name:f,fromWireType:b,argPackAdvance:8,readValueFromPointer:b},{ignoreDuplicateRegistrations:!0})}function Xn(i,u){u=we(u);var f=u==="std::string";xe(i,{name:u,fromWireType:function(h){var v=Z[h>>2],b;if(f)for(var S=h+4,T=0;T<=v;++T){var P=h+4+T;if(T==v||be[P]==0){var C=P-S,M=X(S,C);b===void 0?b=M:(b+="\0",b+=M),S=P+1}}else{for(var F=new Array(v),T=0;T<v;++T)F[T]=String.fromCharCode(be[h+4+T]);b=F.join("")}return Me(h),b},toWireType:function(h,v){v instanceof ArrayBuffer&&(v=new Uint8Array(v));var b,S=typeof v=="string";S||v instanceof Uint8Array||v instanceof Uint8ClampedArray||v instanceof Int8Array||J("Cannot pass non-string to std::string"),f&&S?b=()=>$(v):b=()=>v.length;var T=b(),P=Re(4+T+1);if(Z[P>>2]=T,f&&S)H(v,P+4,T+1);else if(S)for(var C=0;C<T;++C){var M=v.charCodeAt(C);M>255&&(Me(P),J("String has UTF-16 code units that do not fit in 8 bits")),be[P+4+C]=M}else for(var C=0;C<T;++C)be[P+4+C]=v[C];return h!==null&&h.push(Me,P),P},argPackAdvance:8,readValueFromPointer:ht,destructorFunction:function(h){Me(h)}})}function qn(i,u,f){f=we(f);var h,v,b,S,T;u===2?(h=pe,v=ge,S=ae,b=()=>qe,T=1):u===4&&(h=ve,v=Ye,S=_t,b=()=>Z,T=2),xe(i,{name:f,fromWireType:function(P){for(var C=Z[P>>2],M=b(),F,O=P+4,B=0;B<=C;++B){var z=P+4+B*u;if(B==C||M[z>>T]==0){var ee=z-O,ue=h(O,ee);F===void 0?F=ue:(F+="\0",F+=ue),O=z+u}}return Me(P),F},toWireType:function(P,C){typeof C!="string"&&J("Cannot pass non-string to C++ string type "+f);var M=S(C),F=Re(4+M+u);return Z[F>>2]=M>>T,v(C,F+4,M+u),P!==null&&P.push(Me,F),F},argPackAdvance:8,readValueFromPointer:ht,destructorFunction:function(P){Me(P)}})}function jn(i,u){u=we(u),xe(i,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:function(){},toWireType:function(f,h){}})}function Zn(){return Date.now()}var Qn=!0;function Kn(){return Qn}function Jn(i,u,f){i=he.toValue(i),u=vt(u,"emval::as");var h=[],v=he.toHandle(h);return I[f>>2]=v,u.toWireType(h,i)}function ea(i){var u=[];return I[i>>2]=he.toHandle(u),u}var ta={};function Lt(i){var u=ta[i];return u===void 0?we(i):u}var Ut=[];function ra(i,u,f,h,v){return i=Ut[i],u=he.toValue(u),f=Lt(f),i(u,f,ea(h),v)}function fr(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function na(i){return i===0?he.toHandle(fr()):(i=Lt(i),he.toHandle(fr()[i]))}function aa(i){var u=Ut.length;return Ut.push(i),u}function oa(i,u){for(var f=new Array(i),h=0;h<i;++h)f[h]=vt(Z[u+h*q>>2],"parameter "+h);return f}var pr=[];function sa(i,u){var f=oa(i,u),h=f[0],v=h.name+"_$"+f.slice(1).map(function(z){return z.name}).join("_")+"$",b=pr[v];if(b!==void 0)return b;for(var S=["retType"],T=[h],P="",C=0;C<i-1;++C)P+=(C!==0?", ":"")+"arg"+C,S.push("argType"+C),T.push(f[1+C]);for(var M=lt("methodCaller_"+v),F="return function "+M+`(handle, name, destructors, args) {
`,O=0,C=0;C<i-1;++C)F+="    var arg"+C+" = argType"+C+".readValueFromPointer(args"+(O?"+"+O:"")+`);
`,O+=f[C+1].argPackAdvance;F+="    var rv = handle[name]("+P+`);
`;for(var C=0;C<i-1;++C)f[C+1].deleteObject&&(F+="    argType"+C+".deleteObject(arg"+C+`);
`);h.isVoid||(F+=`    return retType.toWireType(destructors, rv);
`),F+=`};
`,S.push(F);var B=lr(Function,S).apply(null,T);return b=aa(B),pr[v]=b,b}function ia(i,u){return i=he.toValue(i),u=he.toValue(u),he.toHandle(i[u])}function ua(i){i>4&&(Pe[i].refcount+=1)}function la(i){return he.toHandle(Lt(i))}function ca(i){var u=he.toValue(i);cr(u),It(i)}function fa(i,u,f){i=he.toValue(i),u=he.toValue(u),f=he.toValue(f),i[u]=f}function pa(i,u){i=vt(i,"_emval_take_value");var f=i.readValueFromPointer(u);return he.toHandle(f)}function ha(i){return i=he.toValue(i),he.toHandle(typeof i)}function da(i,u){var f=new Date(I[i>>2]*1e3);I[u>>2]=f.getSeconds(),I[u+4>>2]=f.getMinutes(),I[u+8>>2]=f.getHours(),I[u+12>>2]=f.getDate(),I[u+16>>2]=f.getMonth(),I[u+20>>2]=f.getFullYear()-1900,I[u+24>>2]=f.getDay();var h=new Date(f.getFullYear(),0,1),v=(f.getTime()-h.getTime())/(1e3*60*60*24)|0;I[u+28>>2]=v,I[u+36>>2]=-(f.getTimezoneOffset()*60);var b=new Date(f.getFullYear(),6,1).getTimezoneOffset(),S=h.getTimezoneOffset(),T=(b!=S&&f.getTimezoneOffset()==Math.min(S,b))|0;I[u+32>>2]=T}function va(i,u,f,h,v,b){try{var S=g.getStream(v);S&&(f&2&&K.doMsync(i,S,u,h,b),g.munmap(S))}catch(T){if(typeof g>"u"||!(T instanceof g.ErrnoError))throw T;return-T.errno}}function ga(i,u,f){var h=new Date().getFullYear(),v=new Date(h,0,1),b=new Date(h,6,1),S=v.getTimezoneOffset(),T=b.getTimezoneOffset(),P=Math.max(S,T);I[i>>2]=P*60,I[u>>2]=+(S!=T);function C(z){var ee=z.toTimeString().match(/\(([A-Za-z ]+)\)$/);return ee?ee[1]:"GMT"}var M=C(v),F=C(b),O=rt(M),B=rt(F);T<S?(Z[f>>2]=O,Z[f+4>>2]=B):(Z[f>>2]=B,Z[f+4>>2]=O)}function Nt(i,u,f){Nt.called||(Nt.called=!0,ga(i,u,f))}function ma(){Ie("")}function hr(){return 2147483648}function ya(){return hr()}function ba(i,u,f){be.copyWithin(i,u,u+f)}function wa(i){try{return W.grow(i-Ce.byteLength+65535>>>16),Wt(W.buffer),1}catch{}}function Sa(i){var u=be.length;i=i>>>0;var f=hr();if(i>f)return!1;let h=(P,C)=>P+(C-P%C)%C;for(var v=1;v<=4;v*=2){var b=u*(1+.2/v);b=Math.min(b,i+100663296);var S=Math.min(f,h(Math.max(i,b),65536)),T=wa(S);if(T)return!0}return!1}var Gt={};function Ta(){return s||"./this.program"}function et(){if(!et.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:Ta()};for(var f in Gt)Gt[f]===void 0?delete u[f]:u[f]=Gt[f];var h=[];for(var f in u)h.push(f+"="+u[f]);et.strings=h}return et.strings}function _a(i,u){var f=0;return et().forEach(function(h,v){var b=u+f;Z[i+v*4>>2]=b,nt(h,b),f+=h.length+1}),0}function Ea(i,u){var f=et();Z[i>>2]=f.length;var h=0;return f.forEach(function(v){h+=v.length+1}),Z[u>>2]=h,0}function Pa(i){ao(i)}function xa(i){try{var u=K.getStreamFromFD(i);return g.close(u),0}catch(f){if(typeof g>"u"||!(f instanceof g.ErrnoError))throw f;return f.errno}}function Ca(i,u,f,h){for(var v=0,b=0;b<f;b++){var S=Z[u>>2],T=Z[u+4>>2];u+=8;var P=g.read(i,ye,S,T,h);if(P<0)return-1;if(v+=P,P<T)break}return v}function ka(i,u,f,h){try{var v=K.getStreamFromFD(i),b=Ca(v,u,f);return I[h>>2]=b,0}catch(S){if(typeof g>"u"||!(S instanceof g.ErrnoError))throw S;return S.errno}}function Aa(i,u){return u+2097152>>>0<4194305-!!i?(i>>>0)+u*4294967296:NaN}function Da(i,u,f,h,v){try{var b=Aa(u,f);if(isNaN(b))return 61;var S=K.getStreamFromFD(i);return g.llseek(S,b,h),ke=[S.position>>>0,(me=S.position,+Math.abs(me)>=1?me>0?(Math.min(+Math.floor(me/4294967296),4294967295)|0)>>>0:~~+Math.ceil((me-+(~~me>>>0))/4294967296)>>>0:0)],I[v>>2]=ke[0],I[v+4>>2]=ke[1],S.getdents&&b===0&&h===0&&(S.getdents=null),0}catch(T){if(typeof g>"u"||!(T instanceof g.ErrnoError))throw T;return T.errno}}function Oa(i,u,f,h){for(var v=0,b=0;b<f;b++){var S=Z[u>>2],T=Z[u+4>>2];u+=8;var P=g.write(i,ye,S,T,h);if(P<0)return-1;v+=P}return v}function Ra(i,u,f,h){try{var v=K.getStreamFromFD(i),b=Oa(v,u,f);return Z[h>>2]=b,0}catch(S){if(typeof g>"u"||!(S instanceof g.ErrnoError))throw S;return S.errno}}function dr(i){for(var u=i.split("."),f=0;f<4;f++){var h=Number(u[f]);if(isNaN(h))return null;u[f]=h}return(u[0]|u[1]<<8|u[2]<<16|u[3]<<24)>>>0}function tt(i){return parseInt(i)}function Ma(i){var u,f,h,v,b=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,S=[];if(!b.test(i))return null;if(i==="::")return[0,0,0,0,0,0,0,0];for(i.startsWith("::")?i=i.replace("::","Z:"):i=i.replace("::",":Z:"),i.indexOf(".")>0?(i=i.replace(new RegExp("[.]","g"),":"),u=i.split(":"),u[u.length-4]=tt(u[u.length-4])+tt(u[u.length-3])*256,u[u.length-3]=tt(u[u.length-2])+tt(u[u.length-1])*256,u=u.slice(0,u.length-2)):u=i.split(":"),h=0,v=0,f=0;f<u.length;f++)if(typeof u[f]=="string")if(u[f]==="Z"){for(v=0;v<8-u.length+1;v++)S[f+v]=0;h=v-1}else S[f+h]=Sr(parseInt(u[f],16));else S[f+h]=u[f];return[S[1]<<16|S[0],S[3]<<16|S[2],S[5]<<16|S[4],S[7]<<16|S[6]]}var Le={address_map:{id:1,addrs:{},names:{}},lookup_name:function(i){var u=dr(i);if(u!==null||(u=Ma(i),u!==null))return i;var f;if(Le.address_map.addrs[i])f=Le.address_map.addrs[i];else{var h=Le.address_map.id++;j(h<65535,"exceeded max address mappings of 65535"),f="172.29."+(h&255)+"."+(h&65280),Le.address_map.names[f]=i,Le.address_map.addrs[i]=f}return f},lookup_addr:function(i){return Le.address_map.names[i]?Le.address_map.names[i]:null}};function Fa(i){var u=Re(20),f=Re(i.length+1);H(i,f,i.length+1),Z[u>>2]=f;var h=Re(4);Z[h>>2]=0,Z[u+4>>2]=h;var v=2;I[u+8>>2]=v,I[u+12>>2]=4;var b=Re(12);return Z[b>>2]=b+8,Z[b+4>>2]=0,I[b+8>>2]=dr(Le.lookup_name(i)),Z[u+16>>2]=b,u}function Ia(i){return Fa(X(i))}function Ba(i){var u=i.getExtension("ANGLE_instanced_arrays");if(u)return i.vertexAttribDivisor=function(f,h){u.vertexAttribDivisorANGLE(f,h)},i.drawArraysInstanced=function(f,h,v,b){u.drawArraysInstancedANGLE(f,h,v,b)},i.drawElementsInstanced=function(f,h,v,b,S){u.drawElementsInstancedANGLE(f,h,v,b,S)},1}function La(i){var u=i.getExtension("OES_vertex_array_object");if(u)return i.createVertexArray=function(){return u.createVertexArrayOES()},i.deleteVertexArray=function(f){u.deleteVertexArrayOES(f)},i.bindVertexArray=function(f){u.bindVertexArrayOES(f)},i.isVertexArray=function(f){return u.isVertexArrayOES(f)},1}function Ua(i){var u=i.getExtension("WEBGL_draw_buffers");if(u)return i.drawBuffers=function(f,h){u.drawBuffersWEBGL(f,h)},1}function Na(i){return!!(i.multiDrawWebgl=i.getExtension("WEBGL_multi_draw"))}var se={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(u){se.lastError||(se.lastError=u)},getNewId:function(i){for(var u=se.counter++,f=i.length;f<u;f++)i[f]=null;return u},getSource:function(i,u,f,h){for(var v="",b=0;b<u;++b){var S=h?I[h+b*4>>2]:-1;v+=X(I[f+b*4>>2],S<0?void 0:S)}return v},createContext:function(i,u){if(!i.getContextSafariWebGL2Fixed){let v=function(b,S){var T=i.getContextSafariWebGL2Fixed(b,S);return b=="webgl"==T instanceof WebGLRenderingContext?T:null};i.getContextSafariWebGL2Fixed=i.getContext,i.getContext=v}var f=i.getContext("webgl",u);if(!f)return 0;var h=se.registerContext(f,u);return h},registerContext:function(i,u){var f=se.getNewId(se.contexts),h={handle:f,attributes:u,version:u.majorVersion,GLctx:i};return i.canvas&&(i.canvas.GLctxObject=h),se.contexts[f]=h,(typeof u.enableExtensionsByDefault>"u"||u.enableExtensionsByDefault)&&se.initExtensions(h),f},makeContextCurrent:function(i){return se.currentContext=se.contexts[i],r.ctx=Se=se.currentContext&&se.currentContext.GLctx,!(i&&!Se)},getContext:function(i){return se.contexts[i]},deleteContext:function(i){se.currentContext===se.contexts[i]&&(se.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(se.contexts[i].GLctx.canvas),se.contexts[i]&&se.contexts[i].GLctx.canvas&&(se.contexts[i].GLctx.canvas.GLctxObject=void 0),se.contexts[i]=null},initExtensions:function(i){if(i||(i=se.currentContext),!i.initExtensionsDone){i.initExtensionsDone=!0;var u=i.GLctx;Ba(u),La(u),Ua(u),u.disjointTimerQueryExt=u.getExtension("EXT_disjoint_timer_query"),Na(u);var f=u.getSupportedExtensions()||[];f.forEach(function(h){!h.includes("lose_context")&&!h.includes("debug")&&u.getExtension(h)})}}};function vr(i){return i.slice(-1)=="]"&&i.lastIndexOf("[")}function Ga(i){var u=i.uniformLocsById,f=i.uniformSizeAndIdsByName,h,v;if(!u)for(i.uniformLocsById=u={},i.uniformArrayNamesById={},h=0;h<Se.getProgramParameter(i,35718);++h){var b=Se.getActiveUniform(i,h),S=b.name,T=b.size,P=vr(S),C=P>0?S.slice(0,P):S,M=i.uniformIdCounter;for(i.uniformIdCounter+=T,f[C]=[T,M],v=0;v<T;++v)u[M]=v,i.uniformArrayNamesById[M++]=C}}function Va(i,u){if(u=X(u),i=se.programs[i]){Ga(i);var f=i.uniformLocsById,h=0,v=u,b=vr(u);b>0&&(h=tt(u.slice(b+1))>>>0,v=u.slice(0,b));var S=i.uniformSizeAndIdsByName[v];if(S&&h<S[0]&&(h+=S[1],f[h]=f[h]||Se.getUniformLocation(i,u)))return h}else se.recordError(1281);return-1}function Ue(i){var u=Se.currentProgram;if(u){var f=u.uniformLocsById[i];return typeof f=="number"&&(u.uniformLocsById[i]=f=Se.getUniformLocation(u,u.uniformArrayNamesById[i]+(f>0?"["+f+"]":""))),f}else se.recordError(1282)}function za(i,u){Se.uniform1f(Ue(i),u)}function Ha(i,u){Se.uniform1i(Ue(i),u)}var gt=[];function Wa(i,u,f){if(u<=144)for(var h=gt[2*u-1],v=0;v<2*u;v+=2)h[v]=Ee[f+4*v>>2],h[v+1]=Ee[f+(4*v+4)>>2];else var h=Ee.subarray(f>>2,f+u*8>>2);Se.uniform2fv(Ue(i),h)}var mt=[];function $a(i,u,f){if(u<=144)for(var h=mt[2*u-1],v=0;v<2*u;v+=2)h[v]=I[f+4*v>>2],h[v+1]=I[f+(4*v+4)>>2];else var h=I.subarray(f>>2,f+u*8>>2);Se.uniform2iv(Ue(i),h)}function Ya(i,u,f){if(u<=96)for(var h=gt[3*u-1],v=0;v<3*u;v+=3)h[v]=Ee[f+4*v>>2],h[v+1]=Ee[f+(4*v+4)>>2],h[v+2]=Ee[f+(4*v+8)>>2];else var h=Ee.subarray(f>>2,f+u*12>>2);Se.uniform3fv(Ue(i),h)}function Xa(i,u,f){if(u<=96)for(var h=mt[3*u-1],v=0;v<3*u;v+=3)h[v]=I[f+4*v>>2],h[v+1]=I[f+(4*v+4)>>2],h[v+2]=I[f+(4*v+8)>>2];else var h=I.subarray(f>>2,f+u*12>>2);Se.uniform3iv(Ue(i),h)}function qa(i,u,f){if(u<=72){var h=gt[4*u-1],v=Ee;f>>=2;for(var b=0;b<4*u;b+=4){var S=f+b;h[b]=v[S],h[b+1]=v[S+1],h[b+2]=v[S+2],h[b+3]=v[S+3]}}else var h=Ee.subarray(f>>2,f+u*16>>2);Se.uniform4fv(Ue(i),h)}function ja(i,u,f){if(u<=72)for(var h=mt[4*u-1],v=0;v<4*u;v+=4)h[v]=I[f+4*v>>2],h[v+1]=I[f+(4*v+4)>>2],h[v+2]=I[f+(4*v+8)>>2],h[v+3]=I[f+(4*v+12)>>2];else var h=I.subarray(f>>2,f+u*16>>2);Se.uniform4iv(Ue(i),h)}function Za(i){}function yt(i){return i%4===0&&(i%100!==0||i%400===0)}function Qa(i,u){for(var f=0,h=0;h<=u;f+=i[h++]);return f}var gr=[31,29,31,30,31,30,31,31,30,31,30,31],mr=[31,28,31,30,31,30,31,31,30,31,30,31];function Ka(i,u){for(var f=new Date(i.getTime());u>0;){var h=yt(f.getFullYear()),v=f.getMonth(),b=(h?gr:mr)[v];if(u>b-f.getDate())u-=b-f.getDate()+1,f.setDate(1),v<11?f.setMonth(v+1):(f.setMonth(0),f.setFullYear(f.getFullYear()+1));else return f.setDate(f.getDate()+u),f}return f}function Ja(i,u,f,h){var v=I[h+40>>2],b={tm_sec:I[h>>2],tm_min:I[h+4>>2],tm_hour:I[h+8>>2],tm_mday:I[h+12>>2],tm_mon:I[h+16>>2],tm_year:I[h+20>>2],tm_wday:I[h+24>>2],tm_yday:I[h+28>>2],tm_isdst:I[h+32>>2],tm_gmtoff:I[h+36>>2],tm_zone:v?X(v):""},S=X(f),T={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var P in T)S=S.replace(new RegExp(P,"g"),T[P]);var C=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],M=["January","February","March","April","May","June","July","August","September","October","November","December"];function F(D,N,de){for(var ne=typeof D=="number"?D.toString():D||"";ne.length<N;)ne=de[0]+ne;return ne}function O(D,N){return F(D,N,"0")}function B(D,N){function de(_e){return _e<0?-1:_e>0?1:0}var ne;return(ne=de(D.getFullYear()-N.getFullYear()))===0&&(ne=de(D.getMonth()-N.getMonth()))===0&&(ne=de(D.getDate()-N.getDate())),ne}function z(D){switch(D.getDay()){case 0:return new Date(D.getFullYear()-1,11,29);case 1:return D;case 2:return new Date(D.getFullYear(),0,3);case 3:return new Date(D.getFullYear(),0,2);case 4:return new Date(D.getFullYear(),0,1);case 5:return new Date(D.getFullYear()-1,11,31);case 6:return new Date(D.getFullYear()-1,11,30)}}function ee(D){var N=Ka(new Date(D.tm_year+1900,0,1),D.tm_yday),de=new Date(N.getFullYear(),0,4),ne=new Date(N.getFullYear()+1,0,4),_e=z(de),ce=z(ne);return B(_e,N)<=0?B(ce,N)<=0?N.getFullYear()+1:N.getFullYear():N.getFullYear()-1}var ue={"%a":function(D){return C[D.tm_wday].substring(0,3)},"%A":function(D){return C[D.tm_wday]},"%b":function(D){return M[D.tm_mon].substring(0,3)},"%B":function(D){return M[D.tm_mon]},"%C":function(D){var N=D.tm_year+1900;return O(N/100|0,2)},"%d":function(D){return O(D.tm_mday,2)},"%e":function(D){return F(D.tm_mday,2," ")},"%g":function(D){return ee(D).toString().substring(2)},"%G":function(D){return ee(D)},"%H":function(D){return O(D.tm_hour,2)},"%I":function(D){var N=D.tm_hour;return N==0?N=12:N>12&&(N-=12),O(N,2)},"%j":function(D){return O(D.tm_mday+Qa(yt(D.tm_year+1900)?gr:mr,D.tm_mon-1),3)},"%m":function(D){return O(D.tm_mon+1,2)},"%M":function(D){return O(D.tm_min,2)},"%n":function(){return`
`},"%p":function(D){return D.tm_hour>=0&&D.tm_hour<12?"AM":"PM"},"%S":function(D){return O(D.tm_sec,2)},"%t":function(){return"	"},"%u":function(D){return D.tm_wday||7},"%U":function(D){var N=D.tm_yday+7-D.tm_wday;return O(Math.floor(N/7),2)},"%V":function(D){var N=Math.floor((D.tm_yday+7-(D.tm_wday+6)%7)/7);if((D.tm_wday+371-D.tm_yday-2)%7<=2&&N++,N){if(N==53){var ne=(D.tm_wday+371-D.tm_yday)%7;ne!=4&&(ne!=3||!yt(D.tm_year))&&(N=1)}}else{N=52;var de=(D.tm_wday+7-D.tm_yday-1)%7;(de==4||de==5&&yt(D.tm_year%400-1))&&N++}return O(N,2)},"%w":function(D){return D.tm_wday},"%W":function(D){var N=D.tm_yday+7-(D.tm_wday+6)%7;return O(Math.floor(N/7),2)},"%y":function(D){return(D.tm_year+1900).toString().substring(2)},"%Y":function(D){return D.tm_year+1900},"%z":function(D){var N=D.tm_gmtoff,de=N>=0;return N=Math.abs(N)/60,N=N/60*100+N%60,(de?"+":"-")+("0000"+N).slice(-4)},"%Z":function(D){return D.tm_zone},"%%":function(){return"%"}};S=S.replace(/%%/g,"\0\0");for(var P in ue)S.includes(P)&&(S=S.replace(new RegExp(P,"g"),ue[P](b)));S=S.replace(/\0\0/g,"%");var le=St(S,!1);return le.length>u?0:(Xe(le,i),le.length-1)}function eo(i,u,f,h){return Ja(i,u,f,h)}var yr=function(i,u,f,h){i||(i=this),this.parent=i,this.mount=i.mount,this.mounted=null,this.id=g.nextInode++,this.name=u,this.mode=f,this.node_ops={},this.stream_ops={},this.rdev=h},bt=365,wt=146;Object.defineProperties(yr.prototype,{read:{get:function(){return(this.mode&bt)===bt},set:function(i){i?this.mode|=bt:this.mode&=~bt}},write:{get:function(){return(this.mode&wt)===wt},set:function(i){i?this.mode|=wt:this.mode&=~wt}},isFolder:{get:function(){return g.isDir(this.mode)}},isDevice:{get:function(){return g.isChrdev(this.mode)}}}),g.FSNode=yr,g.staticInit(),Jr(),$e=r.BindingError=xt(Error,"BindingError"),tr=r.InternalError=xt(Error,"InternalError"),yn(),cn(),xn(),ir=r.UnboundTypeError=xt(Error,"UnboundTypeError"),Ln();for(var Se,to=new Float32Array(288),Oe=0;Oe<288;++Oe)gt[Oe]=to.subarray(0,Oe+1);for(var ro=new Int32Array(288),Oe=0;Oe<288;++Oe)mt[Oe]=ro.subarray(0,Oe+1);function St(i,u,f){var h=$(i)+1,v=new Array(h),b=te(i,v,0,v.length);return u&&(v.length=b),v}var no={_:Mr,k:Fr,a:Ir,b:Lr,S:zr,T:Hr,p:$r,M:Yr,V:Xr,J:qr,K:jr,t:Zr,L:Qr,B:Kr,X:rn,d:On,f:Rn,e:Mn,c:Fn,W:Un,i:Gn,h:Vn,w:Hn,j:$n,g:Yn,v:Xn,q:qn,Y:jn,P:Zn,O:Kn,m:Jn,la:ra,y:It,ma:na,ka:sa,r:ia,z:ua,ja:la,na:ca,n:fa,l:pa,x:ha,Q:da,G:va,R:Nt,s:ma,F:ya,N:ba,E:Sa,H:_a,I:Ea,$:Pa,o:xa,U:ka,A:Da,u:Ra,Z:Ia,ia:Va,ga:za,ha:Ha,ca:Wa,fa:$a,ba:Ya,ea:Xa,aa:qa,da:ja,C:Za,D:eo};Rr(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Re=r._malloc=function(){return(Re=r._malloc=r.asm.qa).apply(null,arguments)},Me=r._free=function(){return(Me=r._free=r.asm.ra).apply(null,arguments)},br=r.___errno_location=function(){return(br=r.___errno_location=r.asm.sa).apply(null,arguments)},wr=r.___getTypeName=function(){return(wr=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var Sr=r._htons=function(){return(Sr=r._htons=r.asm.wa).apply(null,arguments)},Tr=r._emscripten_builtin_memalign=function(){return(Tr=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},_r=r.___cxa_is_pointer_type=function(){return(_r=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Aa).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Ea).apply(null,arguments)},r.FS=g;var Tt;function Vt(i){this.name="ExitStatus",this.message="Program terminated with exit("+i+")",this.status=i}je=function i(){Tt||zt(),Tt||(je=i)};function zt(i){if(Ne>0||(Er(),Ne>0))return;function u(){Tt||(Tt=!0,r.calledRun=!0,!oe&&(Pr(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),xr()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),u()},1)):u()}r.run=zt;function ao(i,u){oo(i)}function oo(i){jt()||(r.onExit&&r.onExit(i),oe=!0),l(i,new Vt(i))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return zt(),r.ready}})(),opencascadeWasm="/Abundance/assets/replicad_single-C4NBJ5vg.wasm";const OC={library:null},setOC=t=>{OC.library=t},getOC=()=>{if(!OC.library)throw new Error("oppencascade has not been loaded");return OC.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const deletetableRegistry=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class WrappingObj{constructor(e){this.oc=getOC(),e&&deletetableRegistry.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(deletetableRegistry.unregister(this._wrapped),this._wrapped.delete()),deletetableRegistry.register(this,e,e),this._wrapped=e}delete(){var e;deletetableRegistry.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const GCWithScope=()=>{function t(e){return deletetableRegistry.register(t,e),e}return t},GCWithObject=t=>{function e(r){return deletetableRegistry.register(t,r),r}return e},localGC=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},void 0]},HASH_CODE_MAX=2147483647,DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI,round3=t=>Math.round(t*1e3)/1e3,makeAx3=(t,e,r)=>{const n=getOC(),a=asPnt(t),o=asDir(e);let s;if(r){const l=asDir(r);s=new n.gp_Ax3_3(a,o,l),l.delete()}else s=new n.gp_Ax3_4(a,o);return a.delete(),o.delete(),s},makeAx2=(t,e,r)=>{const n=getOC(),a=asPnt(t),o=asDir(e);let s;if(r){const l=asDir(r);s=new n.gp_Ax2_2(a,o,l),l.delete()}else s=new n.gp_Ax2_3(a,o);return a.delete(),o.delete(),s},makeAx1=(t,e)=>{const r=getOC(),n=asPnt(t),a=asDir(e),o=new r.gp_Ax1_2(n,a);return n.delete(),a.delete(),o},makeVec=(t=[0,0,0])=>{const e=getOC();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof Vector)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class Vector extends WrappingObj{constructor(e=[0,0,0]){super(makeVec(e))}get repr(){return`x: ${round3(this.x)}, y: ${round3(this.y)}, z: ${round3(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new Vector(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new Vector(this.wrapped.Subtracted(e.wrapped))}add(e){return new Vector(this.wrapped.Added(e.wrapped))}multiply(e){return new Vector(this.wrapped.Multiplied(e))}normalized(){return new Vector(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*RAD2DEG}projectToPlane(e){const r=e.origin,n=e.zDir,a=this.sub(r),o=n.multiply(a.dot(n)/n.Length**2),s=this.sub(o);return a.delete(),o.delete(),s}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const a=makeAx1(r,n);return this.wrapped.Rotate(a,e*DEG2RAD),a.delete(),this}}const DIRECTIONS$1={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function makeDirection(t){return t==="X"||t==="Y"||t==="Z"?DIRECTIONS$1[t]:t}function asPnt(t){const e=new Vector(t),r=e.toPnt();return e.delete(),r}function asDir(t){const e=new Vector(t),r=e.toDir();return e.delete(),r}class Transformation extends WrappingObj{constructor(e){const r=getOC();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const a=new Vector(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(a.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const a=asDir(n),o=asPnt(r),s=new this.oc.gp_Ax1_2(o,a);return this.wrapped.SetRotation_1(s,e*DEG2RAD),s.delete(),a.delete(),o.delete(),this}mirror(e="YZ",r){const n=GCWithScope();let a,o;if(typeof e=="string"){const l=n(createNamedPlane(e,r));a=l.origin,o=l.zDir}else e instanceof Plane?(a=r||e.origin,o=e.zDir):(a=r||[0,0,0],o=e);const s=n(makeAx2(a,o));return this.wrapped.SetMirror_3(s),this}scale(e,r){const n=asPnt(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=GCWithScope(),a=n(e==="reference"?new this.oc.gp_Ax3_1:makeAx3(e.origin,e.zDir,e.xDir)),o=n(r==="reference"?new this.oc.gp_Ax3_1:makeAx3(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(a,o),this}transformPoint(e){const r=asPnt(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Plane{constructor(e,r=null,n=[0,0,1]){this.oc=getOC();const a=new Vector(n);if(a.Length===0)throw new Error("normal should be non null");this.zDir=a.normalize();let o;if(r)o=new Vector(r);else{const s=makeAx3(e,a);o=new Vector(s.XDirection()),s.delete()}if(o.Length===0)throw new Error("xDir should be non null");this.xDir=o.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new Vector(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Plane(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new Vector(e),r}translate(e,r=0,n=0){const a=new Vector(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(a))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=makeDirection(r),a=new Vector(this.zDir).rotate(e,[0,0,0],n),o=new Vector(this.xDir).rotate(e,[0,0,0],n);return new Plane(this.origin,o,a)}rotate2DAxes(e){const r=new Vector(this.xDir).rotate(e,[0,0,0],this.zDir);return new Plane(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=makeAx3(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new Transformation,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new Transformation,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new Vector(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new Vector(r);return r.delete(),n}}const PLANES_CONFIG={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},createNamedPlane=(t,e=[0,0,0])=>{const r=PLANES_CONFIG[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(a=>a*e):n=e,new Plane(n,r.xDir,r.normal)};let BoundingBox$1=class extends WrappingObj{constructor(e){const r=getOC();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new Vector(e).repr} - ${new Vector(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},a={current:0},o={current:0},s={current:0};return this.wrapped.Get(e,r,n,a,o,s),[[e.current,r.current,n.current],[a.current,o.current,s.current]]}get center(){const[[e,r,n],[a,o,s]]=this.bounds;return[e+(a-e)/2,r+(o-r)/2,n+(s-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function makePlane(t="XY",e=[0,0,0]){return t instanceof Plane?t.clone():createNamedPlane(t,e)}function rotate$1(t,e,r=[0,0,0],n=[0,0,1]){const a=new Transformation;a.rotate(e,r,n);const o=a.transform(t);return a.delete(),o}function translate(t,e){const r=new Transformation;r.translate(e);const n=r.transform(t);return r.delete(),n}function mirror(t,e,r){const n=new Transformation;n.mirror(e,r);const a=n.transform(t);return n.delete(),a}function scale(t,e,r){const n=new Transformation;n.scale(e,r);const a=n.transform(t);return n.delete(),a}function isPoint2D(t){return Array.isArray(t)&&t.length===2}let CURVE_TYPES_MAP=null;const getCurveTypesMap=t=>{if(CURVE_TYPES_MAP&&!t)return CURVE_TYPES_MAP;const r=getOC().GeomAbs_CurveType;return CURVE_TYPES_MAP=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),CURVE_TYPES_MAP},findCurveType=t=>{let e=getCurveTypesMap().get(t);if(e||(e=getCurveTypesMap(!0).get(t)),!e)throw new Error("unknown type");return e};function precisionRound(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function range$1(t){return Array.from(Array(t).keys())}function zip(t){const e=Math.min(...t.map(r=>r.length));return range$1(e).map(r=>t.map(n=>n[r]))}function round2(t){return Math.round(t*100)/100}const reprPnt=([t,e])=>`(${round2(t)},${round2(e)})`,asFixed=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},removeDuplicatePoints=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${asFixed(r,e)},${asFixed(n,e)}]`,[r,n]])).values()),pnt=([t,e])=>{const r=getOC();return new r.gp_Pnt2d_3(t,e)},direction2d=([t,e])=>{const r=getOC();return new r.gp_Dir2d_4(t,e)},vec=([t,e])=>{const r=getOC();return new r.gp_Vec2d_4(t,e)},axis2d=(t,e)=>{const r=getOC(),[n,a]=localGC(),o=new r.gp_Ax2d_2(n(pnt(t)),n(direction2d(e)));return a(),o};class BoundingBox2d extends WrappingObj{constructor(e){const r=getOC();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${reprPnt(e)} - ${reprPnt(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},a={current:0};return this.wrapped.Get(e,r,n,a),[[e.current,r.current],[n.current,a.current]]}get center(){const[[e,r],[n,a]]=this.bounds;return[e+(n-e)/2,r+(a-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,a=n[0]-r[0],o=n[1]-r[1];return[n[0]+a/100*e,n[1]+o/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=GCWithScope()(pnt(e));return!this.wrapped.IsOut_1(n)}}const samePoint$2=([t,e],[r,n],a=1e-6)=>Math.abs(t-r)<=a&&Math.abs(e-n)<=a,add2d=([t,e],[r,n])=>[t+r,e+n],subtract2d=([t,e],[r,n])=>[t-r,e-n],scalarMultiply2d=([t,e],r)=>[t*r,e*r],distance2d=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),squareDistance2d=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function crossProduct2d([t,e],[r,n]){return t*n-e*r}const angle2d=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),polarAngle2d=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),normalize2d=([t,e])=>{const r=distance2d([t,e]);return[t/r,e/r]},rotate2d=(t,e,r=[0,0])=>{const[n,a]=t,[o,s]=r,l=n-o,c=a-s,p=Math.sin(e),d=Math.cos(e),y=l*d-c*p,m=l*p+c*d;return[y+o,m+s]},polarToCartesian=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},cartesianToPolar=([t,e])=>{const r=distance2d([t,e]),n=Math.atan2(e,t);return[r,n]};class Curve2D extends WrappingObj{constructor(e){const r=getOC(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=getOC(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new BoundingBox2d(r),this._boundingBox}get repr(){return`${this.geomType} ${reprPnt(this.firstPoint)} - ${reprPnt(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=getOC();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=findCurveType(e.GetType());return e.delete(),r}clone(){return new Curve2D(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=getOC(),n=GCWithScope(),a=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(pnt(e)),this.wrapped));let o=1/0;try{o=a.LowerDistance()}catch{o=1/0}return Math.min(o,distance2d(e,this.firstPoint),distance2d(e,this.lastPoint))}distanceFromCurve(e){const r=getOC(),n=GCWithScope();let a=1/0;const o=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{a=o.LowerDistance()}catch{a=1/0}return Math.min(a,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return isPoint2D(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=getOC(),a=GCWithScope();let o,s;try{const l=a(new n.Geom2dAPI_ProjectPointOnCurve_2(a(pnt(e)),this.wrapped));o=l.LowerDistance(),s=l.LowerDistanceParameter()}catch{if(samePoint$2(e,this.firstPoint,r))return this.firstParameter;if(samePoint$2(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(o>r)throw new Error(`Point ${reprPnt(e)} not on curve ${this.repr}, ${o.toFixed(9)}`);return s}tangentAt(e){const r=getOC(),[n,a]=localGC();let o;Array.isArray(e)?o=this.parameter(e):o=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const s=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(o,s,l);const c=[l.X(),l.Y()];return a(),c}splitAt(e,r=1e-9){const n=getOC(),a=GCWithScope();let o=e.map(c=>isPoint2D(c)?this.parameter(c,r):c);o=Array.from(new Map(o.map(c=>[precisionRound(c,-Math.log10(r)),c])).values()).sort((c,p)=>c-p);const s=this.firstParameter,l=this.lastParameter;return s>l&&o.reverse(),Math.abs(o[0]-s)<r*100&&(o=o.slice(1)),o.length?(Math.abs(o[o.length-1]-l)<r*100&&(o=o.slice(0,-1)),o.length?zip([[s,...o],[...o,l]]).map(([c,p])=>{try{if(this.geomType==="BEZIER_CURVE"){const y=new n.Geom2d_BezierCurve_1(a(this.adaptor()).Bezier().get().Poles_2());return y.Segment(c,p),new Curve2D(new n.Handle_Geom2d_Curve_2(y))}if(this.geomType==="BSPLINE_CURVE"){const y=a(this.adaptor()).BSpline().get(),m=new n.Geom2d_BSplineCurve_1(y.Poles_2(),y.Knots_2(),y.Multiplicities_2(),y.Degree(),y.IsPeriodic());return m.Segment(c,p,r),new Curve2D(new n.Handle_Geom2d_Curve_2(m))}const d=new n.Geom2d_TrimmedCurve(this.wrapped,c,p,!0,!0);return new Curve2D(new n.Handle_Geom2d_Curve_2(d))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const approximateAsBSpline=(t,e=1e-8)=>{const r=getOC(),a=GCWithScope()(new r.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,r.GeomAbs_Shape.GeomAbs_C0,30,3));return new Curve2D(a.Curve())},BSplineToBezier=t=>{if(findCurveType(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=getOC(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*a(){const s=n.NbArcs();if(s)for(let l=1;l<=s;l++){const c=n.Arc(l);yield new Curve2D(c)}}const o=Array.from(a());return n.delete(),o};function*pointsIteration(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*commonSegmentsIteration(t){const e=t.NbSegments();if(!e)return;const r=getOC();for(let n=1;n<=e;n++){const a=new r.Handle_Geom2d_Curve_1,o=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,a,o)}catch{continue}yield new Curve2D(a),o.delete()}}const intersectCurves=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=getOC(),a=new n.Geom2dAPI_InterCurveCurve_1;let o,s;try{a.Init_1(t.wrapped,e.wrapped,r),o=Array.from(pointsIteration(a)),s=Array.from(commonSegmentsIteration(a))}catch(p){throw console.error(t,e,p),new Error("Intersections failed between curves")}finally{a.delete()}const l=s.filter(p=>samePoint$2(p.firstPoint,p.lastPoint,r)).map(p=>p.firstPoint);l.length&&(o.push(...l),s=s.filter(p=>!samePoint$2(p.firstPoint,p.lastPoint,r)));const c=s.flatMap(p=>[p.firstPoint,p.lastPoint]);return{intersections:o,commonSegments:s,commonSegmentsPoints:c}},selfIntersections=(t,e=1e-9)=>{const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1;let a;try{n.Init_1(t.wrapped,t.wrapped,e),a=Array.from(pointsIteration(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return a},make2dSegmentCurve=(t,e)=>{const r=getOC(),[n,a]=localGC(),o=n(new r.GCE2d_MakeSegment_1(n(pnt(t)),n(pnt(e)))).Value(),s=new Curve2D(o);return samePoint$2(s.firstPoint,t)||s.reverse(),a(),s},make2dThreePointArc=(t,e,r)=>{const n=getOC(),[a,o]=localGC(),s=a(new n.GCE2d_MakeArcOfCircle_4(a(pnt(t)),a(pnt(e)),a(pnt(r)))).Value();o();const l=new Curve2D(s);return samePoint$2(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},make2dTangentArc=(t,e,r)=>{const n=getOC(),[a,o]=localGC(),s=a(new n.GCE2d_MakeArcOfCircle_5(a(pnt(t)),a(vec(e)),a(pnt(r)))).Value();o();const l=new Curve2D(s);return samePoint$2(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},make2dEllipseArc=(t,e,r,n,a=[0,0],o,s=!0)=>{const l=getOC(),[c,p]=localGC(),d=c(new l.gp_Elips2d_2(c(axis2d(a,o)),t,e,!0)),y=c(new l.GCE2d_MakeArcOfEllipse_1(d,r,n,s)).Value();return p(),new Curve2D(y)},make2dBezierCurve=(t,e,r)=>{const n=getOC(),[a,o]=localGC(),s=a(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));s.SetValue(1,a(pnt(t))),e.forEach((c,p)=>{s.SetValue(p+2,a(pnt(c)))}),s.SetValue(e.length+2,a(pnt(r)));const l=new n.Geom2d_BezierCurve_1(s);return o(),new Curve2D(new n.Handle_Geom2d_Curve_2(l))},make2dArcFromCenter=(t,e,r)=>{const n=scalarMultiply2d(add2d(t,e),.5),a=distance2d(r,t),o=normalize2d(subtract2d(n,r));return make2dThreePointArc(t,add2d(scalarMultiply2d(o,a),r),e)},offsetEndPoints=(t,e,r)=>{const n=normalize2d(subtract2d(e,t)),a=[n[1],-n[0]],o=[a[0]*r,a[1]*r];return{firstPoint:add2d(t,o),lastPoint:add2d(e,o)}},make2dOffset=(t,e)=>{const r=GCWithScope(),n=t.geomType;if(n==="CIRCLE"){const c=r(r(t.adaptor()).Circle()),p=c.Radius(),d=c.IsDirect()?1:-1,y=e*d,m=p+y;if(m<1e-10){const k=r(c.Location()),R=[k.X(),k.Y()],A=G=>{const[L,q]=normalize2d(subtract2d(G,R));return add2d(G,[y*L,y*q])};return{collapsed:!0,firstPoint:A(t.firstPoint),lastPoint:A(t.lastPoint)}}const w=getOC(),_=new w.gp_Circ2d_3(c.Axis(),m),E=new w.Geom2d_Circle_1(_),x=new w.Geom2d_TrimmedCurve(new w.Handle_Geom2d_Curve_2(E),t.firstParameter,t.lastParameter,!0,!0);return new Curve2D(new w.Handle_Geom2d_Curve_2(x))}if(n==="LINE"){const{firstPoint:c,lastPoint:p}=offsetEndPoints(t.firstPoint,t.lastPoint,e);return make2dSegmentCurve(c,p)}const a=getOC(),o=new Curve2D(new a.Handle_Geom2d_Curve_2(new a.Geom2d_OffsetCurve(t.wrapped,e,!0))),s=approximateAsBSpline(o.adaptor());return selfIntersections(s).length?{collapsed:!0,firstPoint:s.firstPoint,lastPoint:s.lastPoint}:s};function removeCorner(t,e,r){const n=crossProduct2d(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const a=n>0?-1:1,o=Math.abs(r)*a,s=make2dOffset(t,o),l=make2dOffset(e,o);if(!(s instanceof Curve2D)||!(l instanceof Curve2D))return null;let c;try{const{intersections:w}=intersectCurves(s,l,1e-9);c=w.at(-1)}catch{return null}if(!isPoint2D(c))return null;const p=c,d=(w,_)=>{const[E,x]=_.tangentAt(p),k=normalize2d([-x,E]),R=add2d(p,scalarMultiply2d(k,o)),A=w.parameter(R,1e-6);return w.splitAt([A])},[y]=d(t,s),[,m]=d(e,l);return{first:y,second:m,center:p}}function filletCurves(t,e,r){const n=removeCorner(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:a,second:o,center:s}=n;return[a,make2dArcFromCenter(a.lastPoint,o.firstPoint,s),o]}function chamferCurves(t,e,r){const n=removeCorner(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:a,second:o}=n;return[a,make2dSegmentCurve(a.lastPoint,o.firstPoint),o]}class FlatQueue{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const a=n-1>>1,o=this.values[a];if(r>=o)break;this.ids[n]=this.ids[a],this.values[n]=o,n=a}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],a=this.length>>1;let o=0;for(;o<a;){let s=(o<<1)+1;const l=s+1;let c=this.ids[s],p=this.values[s];const d=this.values[l];if(l<this.length&&d<p&&(s=l,c=this.ids[l],p=d),p>=n)break;this.ids[o]=c,this.values[o]=p,o=s}this.ids[o]=r,this.values[o]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const ARRAY_TYPES=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],VERSION=3;class Flatbush{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==VERSION)throw new Error(`Got v${n>>4} data when expected v${VERSION}.`);const[a]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new Flatbush(o,a,ARRAY_TYPES[n&15],e)}constructor(e,r=16,n=Float64Array,a){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let o=e,s=o;this._levelBounds=[o*4];do o=Math.ceil(o/this.nodeSize),s+=o,this._levelBounds.push(s*4);while(o!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=s<16384?Uint16Array:Uint32Array;const l=ARRAY_TYPES.indexOf(this.ArrayType),c=s*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);a&&a instanceof ArrayBuffer?(this.data=a,this._boxes=new this.ArrayType(this.data,8,s*4),this._indices=new this.IndexArrayType(this.data,8+c,s),this._pos=s*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+c+s*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,s*4),this._indices=new this.IndexArrayType(this.data,8+c,s),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(VERSION<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new FlatQueue}add(e,r,n,a){const o=this._pos>>2;return this._indices[o]=o,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=a,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),a>this.maxY&&(this.maxY=a),o}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),a=65535;for(let o=0;o<this.numItems;o++){let s=4*o;const l=this._boxes[s++],c=this._boxes[s++],p=this._boxes[s++],d=this._boxes[s++],y=Math.floor(a*((l+p)/2-this.minX)/e),m=Math.floor(a*((c+d)/2-this.minY)/r);n[o]=hilbert(y,m)}sort(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let o=0,s=0;o<this._levelBounds.length-1;o++){const l=this._levelBounds[o];for(;s<l;){const c=s;let p=1/0,d=1/0,y=-1/0,m=-1/0;for(let w=0;w<this.nodeSize&&s<l;w++)p=Math.min(p,this._boxes[s++]),d=Math.min(d,this._boxes[s++]),y=Math.max(y,this._boxes[s++]),m=Math.max(m,this._boxes[s++]);this._indices[this._pos>>2]=c,this._boxes[this._pos++]=p,this._boxes[this._pos++]=d,this._boxes[this._pos++]=y,this._boxes[this._pos++]=m}}}search(e,r,n,a,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let s=this._boxes.length-4;const l=[],c=[];for(;s!==void 0;){const p=Math.min(s+this.nodeSize*4,upperBound(s,this._levelBounds));for(let d=s;d<p;d+=4){if(n<this._boxes[d]||a<this._boxes[d+1]||e>this._boxes[d+2]||r>this._boxes[d+3])continue;const y=this._indices[d>>2]|0;s<this.numItems*4?(o===void 0||o(y))&&c.push(y):l.push(y)}s=l.pop()}return c}neighbors(e,r,n=1/0,a=1/0,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let s=this._boxes.length-4;const l=this._queue,c=[],p=a*a;for(;s!==void 0;){const d=Math.min(s+this.nodeSize*4,upperBound(s,this._levelBounds));for(let y=s;y<d;y+=4){const m=this._indices[y>>2]|0,w=axisDist(e,this._boxes[y],this._boxes[y+2]),_=axisDist(r,this._boxes[y+1],this._boxes[y+3]),E=w*w+_*_;s<this.numItems*4?(o===void 0||o(m))&&l.push((m<<1)+1,E):l.push(m<<1,E)}for(;l.length&&l.peek()&1;)if(l.peekValue()>p||(c.push(l.pop()>>1),c.length===n))return l.clear(),c;s=l.pop()>>1}return l.clear(),c}}function axisDist(t,e,r){return t<e?e-t:t<=r?0:t-r}function upperBound(t,e){let r=0,n=e.length-1;for(;r<n;){const a=r+n>>1;e[a]>t?n=a:r=a+1}return e[r]}function sort(t,e,r,n,a,o){if(Math.floor(n/o)>=Math.floor(a/o))return;const s=t[n+a>>1];let l=n-1,c=a+1;for(;;){do l++;while(t[l]<s);do c--;while(t[c]>s);if(l>=c)break;swap(t,e,r,l,c)}sort(t,e,r,n,c,o),sort(t,e,r,c+1,a,o)}function swap(t,e,r,n,a){const o=t[n];t[n]=t[a],t[a]=o;const s=4*n,l=4*a,c=e[s],p=e[s+1],d=e[s+2],y=e[s+3];e[s]=e[l],e[s+1]=e[l+1],e[s+2]=e[l+2],e[s+3]=e[l+3],e[l]=c,e[l+1]=p,e[l+2]=d,e[l+3]=y;const m=r[n];r[n]=r[a],r[a]=m}function hilbert(t,e){let r=t^e,n=65535^r,a=65535^(t|e),o=t&(e^65535),s=r|n>>1,l=r>>1^r,c=a>>1^n&o>>1^a,p=r&a>>1^o>>1^o;r=s,n=l,a=c,o=p,s=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,c^=r&a>>2^n&o>>2,p^=n&a>>2^(r^n)&o>>2,r=s,n=l,a=c,o=p,s=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,c^=r&a>>4^n&o>>4,p^=n&a>>4^(r^n)&o>>4,r=s,n=l,a=c,o=p,c^=r&a>>8^n&o>>8,p^=n&a>>8^(r^n)&o>>8,r=c^c>>1,n=p^p>>1;let d=t^e,y=n|65535^(d|r);return d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|d)>>>0}const stitchCurves=(t,e=1e-7)=>{const r=new Flatbush(t.length);t.forEach(o=>{const[s,l]=o.firstPoint;r.add(s-e,l-e,s+e,l+e)}),r.finish();const n=[],a=new Set;return t.forEach((o,s)=>{if(a.has(s))return;const l=[o];let c=s;a.add(s);let p=t.length;for(;;){if(p--<0)throw new Error("Infinite loop detected");const d=l[l.length-1].lastPoint,[y,m]=d,w=r.search(y-e,m-e,y+e,m+e),_=R=>Math.abs((c-R)%t.length),E=w.filter(R=>!a.has(R)).map(R=>[t[R],R,_(R)]).sort(([,,R],[,,A])=>_(R)-_(A));if(E.length===0){n.push(l);break}const[x,k]=E[0];l.push(x),a.add(k),c=k}}),n};function round5(t){return Math.round(t*1e5)/1e5}const fromPnt=t=>`${round2(t.X())} ${round2(t.Y())}`,adaptedCurveToPathElem=(t,e)=>{const r=getOC(),n=findCurveType(t.GetType()),[a,o]=e,s=`${round5(a)} ${round5(o)}`;if(n==="LINE")return`L ${s}`;if(n==="BEZIER_CURVE"){const p=t.Bezier().get(),d=p.Degree();if(d===1)return`L ${s}`;if(d===2)return`Q ${fromPnt(p.Pole(2))} ${s}`;if(d===3){const y=fromPnt(p.Pole(2)),m=fromPnt(p.Pole(3));return`C ${y} ${m} ${s}`}}if(n==="CIRCLE"){const p=t.Circle(),d=p.Radius(),y=t.FirstParameter(),w=(t.LastParameter()-y)*RAD2DEG,_=w!==360?s:`${round5(a)} ${round5(o+1e-4)}`;return`A ${d} ${d} 0 ${Math.abs(w)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${_}`}if(n==="ELLIPSE"){const p=t.Ellipse(),d=p.MajorRadius(),y=p.MinorRadius(),m=t.FirstParameter(),_=(t.LastParameter()-m)*RAD2DEG,E=_!==360?s:`${round5(a)} ${round5(o+1e-4)}`,x=new r.gp_Dir2d_1,k=180-p.XAxis().Direction().Angle(x)*RAD2DEG;return x.delete(),`A ${round5(d)} ${round5(y)} ${round5(k)} ${Math.abs(_)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${E}`}if(n==="BSPLINE_CURVE"&&t.BSpline().get().Degree()<4)return BSplineToBezier(t).map(y=>adaptedCurveToPathElem(y.adaptor(),y.lastPoint)).join(" ");const l=approximateAsBSpline(t);return BSplineToBezier(l.adaptor()).map(p=>adaptedCurveToPathElem(p.adaptor(),p.lastPoint)).join(" ")},DIRECTIONS={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},PLANE_TO_DIR={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Finder{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:a})=>!r.shouldKeep(a);return this.filters.push(n),this}either(e){const r=e.map(a=>{const o=new this.constructor;return a(o),o}),n=({element:a})=>r.some(o=>o.shouldKeep(a));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Finder3d extends Finder{inList(e){const r=({element:n})=>!!e.find(a=>a.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new Vector(DIRECTIONS[e]):n=new Vector(e);const a=({normal:o})=>{if(!o)return!1;const s=Math.acos(Math.abs(o.dot(n)));return Math.abs(s-DEG2RAD*r)<1e-6};return this.filters.push(a),this}atDistance(e,r=[0,0,0]){const n=asPnt(r),a=getOC(),o=new a.BRepBuilderAPI_MakeVertex(n),s=o.Vertex();o.delete();const l=new a.BRepExtrema_DistShapeShape_1;l.LoadS1(s);const c=({element:p})=>{const d=GCWithScope();l.LoadS2(p.wrapped);const y=d(new a.Message_ProgressRange_1);return l.Perform(y),Math.abs(l.Value()-e)<1e-6};return this.filters.push(c),GCWithObject(c)(l),this}containsPoint(e){return this.atDistance(0,e)}inBox(e,r){const n=getOC(),a=new n.BRepPrimAPI_MakeBox_4(asPnt(e),asPnt(r)),o=a.Solid();a.delete();const s=new n.BRepExtrema_DistShapeShape_1;s.LoadS1(o);const l=({element:p})=>{const d=GCWithScope();s.LoadS2(p.wrapped);const y=d(new n.Message_ProgressRange_1);return s.Perform(y),s.Value()<1e-6},c=GCWithObject(l);return c(o),c(s),this.filters.push(l),this}}class EdgeFinder extends Finder3d{clone(){const e=new EdgeFinder;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&PLANE_TO_DIR[e])return this.atAngleWith(PLANE_TO_DIR[e],90);if(typeof e!="string"&&e instanceof Plane)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Plane?makePlane(e):makePlane(e,r);this.parallelTo(n);const a=({element:o})=>{const s=o.startPoint,l=s.projectToPlane(n);return s.equals(l)};return this.filters.push(a),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class FaceFinder extends Finder3d{clone(){const e=new FaceFinder;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&PLANE_TO_DIR[e])return this.atAngleWith(PLANE_TO_DIR[e]);if(typeof e!="string"&&e instanceof Plane)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Plane?makePlane(e):makePlane(e,r);this.parallelTo(n);const a=({element:o})=>{const s=o.center,l=s.projectToPlane(n);return s.equals(l)};return this.filters.push(a),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(a=>a({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const blueprintCorners=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},PI_2=2*Math.PI,positiveHalfAngle=t=>{const e=t%PI_2,r=e<0?e+PI_2:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-PI_2)};class CornerFinder extends Finder{clone(){const e=new CornerFinder;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(a=>samePoint$2(a,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:a}){return Math.abs(distance2d(r,a.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return samePoint$2(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,a]=e,[o,s]=r,l=Math.min(n,o),c=Math.max(n,o),p=Math.min(a,s),d=Math.max(a,s);function y({element:m}){const[w,_]=m.point;return w>=l&&w<=c&&_>=p&&_<=d}return this.filters.push(y),this}ofAngle(e){function r({element:n}){const a=n.firstCurve.tangentAt(1),o=n.secondCurve.tangentAt(0);return Math.abs(positiveHalfAngle(angle2d(a,o))-positiveHalfAngle(DEG2RAD*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return blueprintCorners(e).filter(r=>this.shouldKeep(r))}}const asTopo=t=>{const e=getOC();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},iterTopo=function*(e,r){const n=getOC(),a=new n.TopExp_Explorer_2(e,asTopo(r),asTopo("shape")),o=new Map;for(;a.More();){const s=a.Current(),l=s.HashCode(HASH_CODE_MAX);o.get(l)||(o.set(l,!0),yield s),a.Next()}a.delete()},shapeType=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class Shape extends WrappingObj{constructor(e){super(e)}clone(){return new this.constructor(downcast(this.wrapped))}get hashCode(){return this.wrapped.HashCode(HASH_CODE_MAX)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=getOC(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=cast(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const a=typeof e=="number"?[e,r,n]:e,o=cast(translate(this.wrapped,a));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const a=cast(rotate$1(this.wrapped,e,r,n));if(this.delete(),this.constructor!==a.constructor)throw new Error("unexpected types mismatch");return a}mirror(e,r){const n=cast(mirror(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=cast(scale(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return iterTopo(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>downcast(r))}get edges(){return this._listTopo("edge").map(e=>new Edge(e))}get faces(){return this._listTopo("face").map(e=>new Face(e))}get wires(){return this._listTopo("wire").map(e=>new Wire(e))}get boundingBox(){const e=new BoundingBox$1;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],a=[],o=[];const s=[];for(const l of this.faces){const c=l.triangulation(a.length/3);if(!c)continue;const{trianglesIndexes:p,vertices:d,verticesNormals:y}=c;s.push({start:n.length,count:p.length,faceId:l.hashCode}),n=n.concat(p),a=a.concat(d),o=o.concat(y)}return{triangles:n,vertices:a,normals:o,faceGroups:s}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const a=GCWithScope(),o=new Set,s=[],l=[],c=()=>{const d=s.length;let y=null;return[m=>{y?(s.push(...y),y=[m.X(),m.Y(),m.Z()],s.push(...y)):y=[m.X(),m.Y(),m.Z()]},m=>{l.push({start:d/3,count:(s.length-d)/3,edgeId:m}),o.add(m)}]},p=a(new this.oc.TopLoc_Location_1);for(const d of this.faces){const y=a(this.oc.BRep_Tool.Triangulation(d.wrapped,p,0));if(y.IsNull())continue;const m=y.get();for(const w of d.edges){if(a(w),o.has(w.hashCode))continue;const _=a(new this.oc.TopLoc_Location_1),E=a(this.oc.BRep_Tool.PolygonOnTriangulation_1(w.wrapped,y,_)),x=(n=E==null?void 0:E.get())==null?void 0:n.Nodes();if(!x)continue;a(x);const[k,R]=c();for(let A=x.Lower();A<=x.Upper();A++){const G=a(a(m.Node(x.Value(A))).Transformed(_.Transformation()));k(G)}R(w.hashCode)}}for(const d of this.edges){a(d);const y=d.hashCode;if(o.has(y))continue;const m=a(new this.oc.BRepAdaptor_Curve_2(d.wrapped)),w=a(new this.oc.GCPnts_TangentialDeflection_2(m,e,r,2,1e-9,1e-7)),[_,E]=c();for(let x=0;x<w.NbPoints();x++){const k=a(w.Value(x+1).Transformed(p.Transformation()));_(k)}E(y)}return{lines:s,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const a=r.Write(e);if(r.delete(),n.delete(),a===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const o=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([o],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const a="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,a,!n)){const s=this.oc.FS.readFile("/"+a);return this.oc.FS.unlink("/"+a),new Blob([s],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Vertex extends Shape{}class _1DShape extends Shape{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new Curve(this._geomAdaptor())}get startPoint(){const e=this.curve,r=e.startPoint;return e.delete(),r}get endPoint(){const e=this.curve,r=e.endPoint;return e.delete(),r}tangentAt(e=0){const r=this.curve,n=r.tangentAt(e);return r.delete(),n}get isClosed(){const e=this.curve,r=e.isClosed;return e.delete(),r}get isPeriodic(){const e=this.curve,r=e.isPeriodic;return e.delete(),r}get period(){const e=this.curve,r=e.period;return e.delete(),r}get geomType(){const e=this.curve,r=e.curveType;return e.delete(),r}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Curve extends WrappingObj{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return findCurveType(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new Vector(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new Vector(e)}tangentAt(e){let r=e;e||(r=(this.wrapped.LastParameter()-this.wrapped.FirstParameter())/2);const n=new this.oc.gp_Pnt_1,a=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,a);const o=new Vector(a);return n.delete(),a.delete(),o}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Edge extends _1DShape{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Wire extends _1DShape{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},a=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);a.Perform(e,0);const o=cast(a.Shape());if(a.delete(),this.delete(),!(o instanceof Wire))throw new Error("Could not offset with a wire");return o}}class Surface extends WrappingObj{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Face extends Shape{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Surface(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},a={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,a),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:a.current}}pointOnSurface(e,r){const{uMin:n,uMax:a,vMin:o,vMax:s}=this.UVBounds,l=this._geomAdaptor(),c=new this.oc.gp_Pnt_1,p=e*(a-n)+n,d=r*(s-o)+o;l.D0(p,d,c);const y=new Vector(c);return l.delete(),c.delete(),y}normalAt(e){let r=0,n=0;const a=GCWithScope();if(e){const p=a(this.oc.BRep_Tool.Surface_2(this.wrapped)),d=a(new this.oc.GeomAPI_ProjectPointOnSurf_2(a(asPnt(e)),p,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),y={current:0},m={current:0};d.LowerDistanceParameters(y,m),r=y.current,n=m.current}else{const{uMin:p,uMax:d,vMin:y,vMax:m}=this.UVBounds;r=.5*(p+d),n=.5*(y+m)}const o=a(new this.oc.gp_Pnt_1),s=a(new this.oc.gp_Vec_1);return a(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,o,s),new Vector(s)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new Vector(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Wire(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=GCWithScope(),n=r(new this.oc.TopLoc_Location_1),a=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(a.IsNull())return null;const o=r(n.Transformation()),s={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=a.get(),c=l.NbNodes();s.vertices=new Array(c*3);for(let _=1;_<=c;_++){const E=r(r(l.Node(_)).Transformed(o));s.vertices[(_-1)*3+0]=E.X(),s.vertices[(_-1)*3+1]=E.Y(),s.vertices[(_-1)*3+2]=E.Z()}const p=r(new this.oc.TColgp_Array1OfDir_2(1,c)),d=r(new this.oc.Poly_Connect_2(a));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,d,p),s.verticesNormals=new Array(p.Length()*3);for(let _=p.Lower();_<=p.Upper();_++){const E=r(r(p.Value(_)).Transformed(o));s.verticesNormals[(_-1)*3+0]=E.X(),s.verticesNormals[(_-1)*3+1]=E.Y(),s.verticesNormals[(_-1)*3+2]=E.Z()}const y=this.orientation,m=l.NbTriangles();s.trianglesIndexes=new Array(m*3);let w=0;for(let _=1;_<=m;_++){const E=r(l.Triangle(_));let x=E.Value(1),k=E.Value(2);const R=E.Value(3);if(y==="backward"){const A=x;x=k,k=A}s.trianglesIndexes[w*3+0]=x-1+e,s.trianglesIndexes[w*3+1]=k-1+e,s.trianglesIndexes[w*3+2]=R-1+e,w++}return s}}class _3DShape extends Shape{fuse(e,{optimisation:r="none"}={}){const n=GCWithScope(),a=n(new this.oc.Message_ProgressRange_1),o=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,a));r==="commonFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),o.Build(a),o.SimplifyResult(!0,!0,.001);const s=cast(o.Shape());if(!isShape3D(s))throw new Error("Could not fuse as a 3d shape");return s}cut(e,{optimisation:r="none"}={}){const n=GCWithScope(),a=n(new this.oc.Message_ProgressRange_1),o=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,a));r==="commonFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),o.Build(a),o.SimplifyResult(!0,!0,.001);const s=cast(o.Shape());if(!isShape3D(s))throw new Error("Could not cut as a 3d shape");return s}intersect(e){const r=GCWithScope(),n=r(new this.oc.Message_ProgressRange_1),a=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));a.Build(n),a.SimplifyResult(!0,!0,.001);const o=cast(a.Shape());if(!isShape3D(o))throw new Error("Could not intersect as a 3d shape");return o}shell(e,r=null,n=.001){const a=typeof r=="number"?r:n;let o,s;if(typeof e=="number"){s=e;const w=new FaceFinder;o=typeof r=="function"?r(w):w}else s=e.thickness,o=e.filter;const l=GCWithScope(),c=o.find(this),p=l(new this.oc.TopTools_ListOfShape_1);c.forEach(w=>{p.Append_1(w.wrapped)});const d=l(new this.oc.Message_ProgressRange_1),y=l(new this.oc.BRepOffsetAPI_MakeThickSolid);y.MakeThickSolidByJoin(this.wrapped,p,-s,a,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,d);const m=cast(y.Shape());if(!isShape3D(m))throw new Error("Could not shell as a 3d shape");return m}_builderIter(e,r){if(typeof e=="number"){let s=0;for(const l of this._iterTopo("edge"))r(e,downcast(l)),s+=1;return s}let n,a=null;typeof e=="function"?n=e:(n=s=>e.filter.shouldKeep(s)?e.radius||1:0,e.filter&&!e.keep&&(a=()=>e.filter.delete()));let o=0;for(const s of this._iterTopo("edge")){const l=downcast(s),c=new Edge(l),p=n(c);p&&(r(p,l),o+=1),c.delete()}return a&&a(),o}fillet(e,r){const a=GCWithScope()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let o=e;if(typeof e=="number"&&r&&(o={radius:e,filter:r(new EdgeFinder)}),!this._builderIter(o,(c,p)=>a.Add_2(c,p)))throw new Error("Could not fillet, no edge was selected");const l=cast(a.Shape());if(!isShape3D(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const a=GCWithScope()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let o=e;if(typeof e=="number"&&r&&(o={radius:e,filter:r(new EdgeFinder)}),!this._builderIter(o,(c,p)=>a.Add_2(c,p)))throw new Error("Could not chamfer, no edge was selected");const l=cast(a.Shape());if(!isShape3D(l))throw new Error("Could not chamfer as a 3d shape");return l}}class Shell extends _3DShape{}class Solid extends _3DShape{}class CompSolid extends _3DShape{}class Compound extends _3DShape{}function isShape3D(t){return t instanceof Shell||t instanceof Solid||t instanceof CompSolid||t instanceof Compound}function isWire(t){return t instanceof Wire}function downcast(t){const e=getOC(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),a=shapeType(t),o=n.get(a);if(!o)throw new Error("Could not find a wrapper for this shape type");return o(t)}function cast(t){const r=getOC().TopAbs_ShapeEnum,a=new Map([[r.TopAbs_VERTEX,Vertex],[r.TopAbs_EDGE,Edge],[r.TopAbs_WIRE,Wire],[r.TopAbs_FACE,Face],[r.TopAbs_SHELL,Shell],[r.TopAbs_SOLID,Solid],[r.TopAbs_COMPSOLID,CompSolid],[r.TopAbs_COMPOUND,Compound]]).get(shapeType(t));if(!a)throw new Error("Could not find a wrapper for this shape type");return new a(downcast(t))}const makeLine=(t,e)=>{const r=getOC();return new Edge(new r.BRepBuilderAPI_MakeEdge_3(asPnt(t),asPnt(e)).Edge())},makeHelix=(t,e,r,n=[0,0,0],a=[0,0,1],o=!1)=>{const s=getOC(),[l,c]=localGC();let p=2*Math.PI;o&&(p=-2*Math.PI);const d=l(new s.Geom2d_Line_3(l(new s.gp_Pnt2d_3(0,0)),l(new s.gp_Dir2d_4(p,t)))),y=e/t,m=d.Value(0),w=d.Value(y*Math.sqrt((2*Math.PI)**2+t**2)),_=l(new s.GCE2d_MakeSegment_1(m,w)),E=new s.Geom_CylindricalSurface_1(l(makeAx3(n,a)),r),x=l(new s.BRepBuilderAPI_MakeEdge_30(l(new s.Handle_Geom2d_Curve_2(_.Value().get())),l(new s.Handle_Geom_Surface_2(E)))).Edge(),k=l(new s.BRepBuilderAPI_MakeWire_2(x)).Wire();return s.BRepLib.BuildCurves3d_2(k),c(),new Edge(k)},assembleWire=t=>{const e=getOC(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(s=>{s instanceof Edge&&r.Add_1(s.wrapped),s instanceof Wire&&r.Add_2(s.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const a=r.Error();if(a!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const s=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${s.get(a)||"unknown error"}`)}const o=new Wire(r.Wire());return r.delete(),n.delete(),o},makeFace=(t,e)=>{const r=getOC(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const a=n.Face();return n.delete(),new Face(a)},makeNewFaceWithinFace=(t,e)=>{const r=getOC(),[n,a]=localGC(),o=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(o,e.wrapped,!0)).Face();return a(),new Face(l)},makeVertex=t=>{const e=getOC(),r=asPnt(t),n=new e.BRepBuilderAPI_MakeVertex(r),a=n.Vertex();return n.delete(),new Vertex(a)},compoundShapes=t=>{const e=getOC(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(o=>{r.Add(n,o.wrapped),o.delete()}),cast(n)};function makeSolid(t){const e=getOC(),[r,n]=localGC(),a=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));t.forEach(({wrapped:l})=>{a.Add(l)}),a.Perform(r(new e.Message_ProgressRange_1));const o=r(downcast(a.SewedShape())),s=cast(r(new e.ShapeFix_Solid_1).SolidFromShell(o));if(n(),!(s instanceof Solid))throw new Error("Could not make a solid of faces and shells");return s}const addHolesInFace=(t,e)=>{const r=getOC(),[n,a]=localGC(),o=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(p=>{o.Add(p.wrapped)});const s=n(o.Face()),l=n(new r.ShapeFix_Face_2(s));l.FixOrientation_1();const c=l.Face();return a(),new Face(c)},isTangent=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,defaultsSplineConfig=t=>{let e;t?isTangent(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:a=1,startTangent:o}=e;let s;typeof r=="number"?s=polarToCartesian(1,r*DEG2RAD):s=r;let l;return typeof o=="number"?l=polarToCartesian(1,o*DEG2RAD):l=o,{endTangent:s,startFactor:n,endFactor:a,startTangent:l}};function radianAngle(t,e,r,n){const a=t*r+e*n,o=Math.sqrt((t*t+e*e)*(r*r+n*n));let s=Math.acos(a/o);return t*n-e*r<0&&(s=-s),s}function convertSvgEllipseParams([t,e],[r,n],a,o,s,l,c){const p=Math.PI*2;if(a<0&&(a=-a),o<0&&(o=-o),a==0||o==0)throw Error("rx and ry can not be 0");const d=Math.sin(s),y=Math.cos(s),m=(t-r)/2,w=(e-n)/2,_=(t+r)/2,E=(e+n)/2,x=y*m+d*w,k=y*w-d*m,R=x*x/(a*a)+k*k/(o*o);R>1&&(a=a*Math.sqrt(R),o=o*Math.sqrt(R));const A=a*o,G=a*k,L=o*x,q=G*G+L*L;if(!q)throw Error("start point can not be same as end point");let V=Math.sqrt(Math.abs((A*A-q)/q));l==c&&(V=-V);const U=V*G/o,W=-V*L/a,oe=y*U-d*W+_,j=d*U+y*W+E,fe=(x-U)/a,ie=(x+U)/a,X=(k-W)/o,te=(k+W)/o,H=radianAngle(1,0,fe,X);let $=radianAngle(fe,X,-ie,-te);for(;$>p;)$-=p;for(;$<0;)$+=p;c||($-=p);let re=H+$;for(;re>p;)re-=p;for(;re<0;)re+=p;return{cx:oe,cy:j,startAngle:H,deltaAngle:$,endAngle:re,clockwise:!!c,rx:a,ry:o}}const basicFaceExtrusion=(t,e)=>{const r=getOC(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),a=new Solid(downcast(n.Shape()));return n.delete(),a},revolution=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const a=getOC(),o=makeAx1(e,r),s=new a.BRepPrimAPI_MakeRevol_1(t.wrapped,o,n*DEG2RAD,!1),l=cast(s.Shape());if(o.delete(),s.delete(),!isShape3D(l))throw new Error("Could not revolve to a 3d shape");return l};function genericSweep(t,e,{frenet:r=!1,auxiliarySpine:n,law:a=null,transitionMode:o="right",withContact:s,support:l,forceProfileSpineOthogonality:c}={},p=!1){const d=getOC(),y=o==="round"?!0:!!c,m=new d.BRepOffsetAPI_MakePipeShell(e.wrapped);if(o){const E={transformed:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[o];E&&m.SetTransitionMode(E)}l?m.SetMode_4(l):r&&m.SetMode_1(r),n&&m.SetMode_5(n.wrapped,!1,d.BRepFill_TypeOfContact.BRepFill_NoContact),a?m.SetLaw_1(t.wrapped,a,!!s,y):m.Add_1(t.wrapped,!!s,y);const w=new d.Message_ProgressRange_1;m.Build(w),p||m.MakeSolid();const _=cast(m.Shape());if(!isShape3D(_))throw new Error("Could not sweep to a 3d shape");if(p){const E=cast(m.FirstShape()),x=cast(m.LastShape());if(!isWire(E))throw new Error("Could not sweep with one start wire");if(!isWire(x))throw new Error("Could not sweep with one end wire");return m.delete(),[_,E,x]}return m.delete(),w.delete(),_}const buildLawFromProfile=(t,{profile:e,endFactor:r=1})=>{let n;const a=getOC();if(e==="s-curve")n=new a.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new a.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function complexExtrude(t,e,r,n,a=!1){const o=new Vector(e),s=new Vector(r),l=makeLine(o,o.add(s)),c=assembleWire([l]),p=n?buildLawFromProfile(s.Length,n):null;return a?genericSweep(t,c,{law:p},a):genericSweep(t,c,{law:p},a)}function twistExtrude(t,e,r,n,a,o=!1){const s=new Vector(r),l=new Vector(n),c=makeLine(s,s.add(l)),p=assembleWire([c]),d=360/e*l.Length,m=makeHelix(d,l.Length,1,r,n),w=a?buildLawFromProfile(l.Length,a):null;return o?genericSweep(t,p,{auxiliarySpine:m,law:w},o):genericSweep(t,p,{auxiliarySpine:m,law:w},o)}const loft=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},a=!1)=>{const o=getOC(),[s,l]=localGC(),c=s(new o.BRepOffsetAPI_ThruSections(!a,e,1e-6));r&&c.AddVertex(s(makeVertex(r)).wrapped),t.forEach(y=>c.AddWire(y.wrapped)),n&&c.AddVertex(s(makeVertex(n)).wrapped);const p=s(new o.Message_ProgressRange_1);c.Build(p);const d=cast(c.Shape());if(l(),!isShape3D(d))throw new Error("Could not loft to a 3d shape");return d};class Sketch{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Sketch(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new Vector(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new Vector(e)}face(){let e;return this.baseFace?e=makeNewFaceWithinFace(this.baseFace,this.wire):e=makeFace(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=makeFace(this.wire),a=revolution(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),a}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:a,origin:o}={}){const[s,l]=localGC(),c=s(new Vector(r||this.defaultDirection).normalized().multiply(e));if(n&&!a){const y=complexExtrude(this.wire,o||this.defaultOrigin,c,n);return l(),this.delete(),y}if(a){const y=twistExtrude(this.wire,a,o||this.defaultOrigin,c,n);return l(),this.delete(),y}const p=makeFace(this.wire),d=basicFaceExtrusion(p,c);return l(),this.delete(),d}sweepSketch(e,r={}){const n=this.wire.startPoint,a=this.wire.tangentAt(1e-9).multiply(-1).normalize(),o=a.cross(this.defaultDirection).multiply(-1),s=e(new Plane(n,o,a),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const c=genericSweep(s.wire,this.wire,l);return this.delete(),c}loftWith(e,r={},n=!1){const a=Array.isArray(e)?[this,...e]:[this,e],o=loft(a.map(s=>s.wire),r,n);return a.forEach(s=>s.delete()),o}}const curvesBoundingBox=t=>{const e=getOC(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new BoundingBox2d(r)};function curvesAsEdgesOnPlane(t,e){const[r,n]=localGC(),a=r(makeAx2(e.origin,e.zDir,e.xDir)),o=getOC(),s=t.map(l=>{const c=o.GeomLib.To3d(a,l.wrapped);return new Edge(new o.BRepBuilderAPI_MakeEdge_24(c).Edge())});return n(),s}const curvesAsEdgesOnSurface=(t,e)=>{const[r,n]=localGC(),a=getOC(),o=t.map(s=>{const l=r(new a.BRepBuilderAPI_MakeEdge_30(s.wrapped,e));return new Edge(l.Edge())});return n(),o},transformCurves=(t,e)=>{const r=getOC();return t.map(a=>e?new Curve2D(r.GeomLib.GTransform(a.wrapped,e)):a.clone())};class Transformation2D extends WrappingObj{transformCurves(e){return transformCurves(e,this.wrapped)}}const stretchTransform2d=(t,e,r=[0,0])=>{const n=getOC(),a=axis2d(r,e),o=new n.gp_GTrsf2d_1;return o.SetAffinity(a,t),a.delete(),new Transformation2D(o)},translationTransform2d=t=>{const e=getOC(),[r,n]=localGC(),a=new e.gp_Trsf2d_1;a.SetTranslation_1(r(vec(t)));const o=new e.gp_GTrsf2d_2(a);return n(),new Transformation2D(o)},mirrorTransform2d=(t,e=[0,0],r="center")=>{const n=getOC(),[a,o]=localGC(),s=new n.gp_Trsf2d_1;r==="center"?s.SetMirror_1(a(pnt(t))):s.SetMirror_2(a(axis2d(e,t)));const l=new n.gp_GTrsf2d_2(s);return o(),new Transformation2D(l)},rotateTransform2d=(t,e=[0,0])=>{const r=getOC(),[n,a]=localGC(),o=new r.gp_Trsf2d_1;o.SetRotation(n(pnt(e)),t);const s=new r.gp_GTrsf2d_2(o);return a(),new Transformation2D(s)},scaleTransform2d=(t,e=[0,0])=>{const r=getOC(),[n,a]=localGC(),o=new r.gp_Trsf2d_1;o.SetScale(n(pnt(e)),t);const s=new r.gp_GTrsf2d_2(o);return a(),new Transformation2D(s)};function curvesAsEdgesOnFace(t,e,r="original"){const[n,a]=localGC(),o=getOC();let s=n(o.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let c=null;const p=n(axis2d([0,0],[0,1])),d=n(axis2d([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const w=n(s.get().Cylinder());w.Direct()||(s=s.get().UReversed());const _=w.Radius();c=stretchTransform2d(1/_,[0,1]).wrapped}if(r==="bounds"){if(c=n(new o.gp_GTrsf2d_1),c.SetAffinity(p,l.uMax-l.uMin),l.uMin!==0){const _=n(new o.gp_GTrsf2d_1);_.SetTranslationPart(new o.gp_XY_2(0,-l.uMin)),c.Multiply(_)}const w=n(new o.gp_GTrsf2d_1);if(w.SetAffinity(d,l.vMax-l.vMin),c.Multiply(w),l.vMin!==0){const _=n(new o.gp_GTrsf2d_1);_.SetTranslationPart(n(new o.gp_XY_2(0,-l.vMin))),c.Multiply(_)}}const y=transformCurves(t,c),m=curvesAsEdgesOnSurface(y,s);return a(),m}function edgeToCurve(t,e){const r=getOC(),a=GCWithScope()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),o=new r.Geom2d_TrimmedCurve(a.Curve(),a.FirstParameter(),a.LastParameter(),!0,!0);return t.orientation==="backward"&&o.Reverse(),new Curve2D(new r.Handle_Geom2d_Curve_2(o))}const viewbox=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},asSVG=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${viewbox(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class Blueprint{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new Blueprint(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=curvesBoundingBox(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,a)=>{const o=e[(a+1)%e.length];return(o[0]-n[0])*(o[1]+n[1])}).reduce((n,a)=>n+a,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const a=stretchTransform2d(e,r,n).transformCurves(this.curves);return new Blueprint(a)}scale(e,r){const n=r||this.boundingBox.center,a=scaleTransform2d(e,n).transformCurves(this.curves);return new Blueprint(a)}rotate(e,r){const n=rotateTransform2d(e*DEG2RAD,r).transformCurves(this.curves);return new Blueprint(n)}translate(e,r=0){const n=isPoint2D(e)?e:[e,r],a=translationTransform2d(n).transformCurves(this.curves);return new Blueprint(a)}mirror(e,r=[0,0],n="center"){const a=mirrorTransform2d(e,r,n).transformCurves(this.curves);return new Blueprint(a)}sketchOnPlane(e,r){const n=e instanceof Plane?makePlane(e):makePlane(e,r),a=curvesAsEdgesOnPlane(this.curves,n),o=assembleWire(a);return new Sketch(o,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=getOC(),a=curvesAsEdgesOnFace(this.curves,e,r),o=assembleWire(a);n.BRepLib.BuildCurves3d_2(o.wrapped);const s=new n.ShapeFix_Wire_2(o.wrapped,e.wrapped,1e-9);s.FixEdgeCurves(),s.delete();const l=new Sketch(o);if(o.isClosed){const c=l.clone().face();l.defaultOrigin=c.pointOnSurface(.5,.5),l.defaultDirection=c.normalAt(),c.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const c=o.startPoint;l.defaultOrigin=c,l.defaultDirection=e.normalAt(c),l.baseFace=e}return l}toSVGPathD(){const e=GCWithScope(),r=this.clone().mirror([1,0],[0,0],"plane"),n=r.curves.flatMap(s=>{if((s.geomType==="ELLIPSE"||s.geomType==="CIRCLE")&&samePoint$2(s.firstPoint,s.lastPoint)){const[l,c]=s.splitAt([.5]);return[adaptedCurveToPathElem(e(l.adaptor()),l.lastPoint),adaptedCurveToPathElem(e(c.adaptor()),c.lastPoint)]}return adaptedCurveToPathElem(e(s.adaptor()),s.lastPoint)}),[a,o]=r.curves[0].firstPoint;return`M ${round5(a)} ${round5(o)} ${n.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return asSVG(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1,a=make2dSegmentCurve(e,this.boundingBox.outsidePoint());let o=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(a.boundingBox)||(n.Init_1(a.wrapped,l.wrapped,1e-9),o+=n.NbPoints())}),n.delete(),!!(o%2))}isClosed(){return samePoint$2(this.firstPoint,this.lastPoint)}intersects(e){const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const a of this.curves)for(const o of e.curves)if(!a.boundingBox.isOut(o.boundingBox)&&(n.Init_1(a.wrapped,o.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class BaseSketcher2d{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?chamferCurves:filletCurves;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=make2dSegmentCurve(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*DEG2RAD,a=polarToCartesian(e,n);return this.lineTo(a)}polarLine(e,r){const n=r*DEG2RAD,[a,o]=polarToCartesian(e,n);return this.line(a,o)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=normalize2d(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(make2dThreePointArc(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,a){const[o,s]=this.pointer;return this.threePointsArcTo([o+e,s+r],[o+n,s+a])}sagittaArcTo(e,r){const[n,a]=this.pointer,[o,s]=e,l=[(n+o)/2,(a+s)/2],c=[-(s-a),o-n],p=Math.sqrt(c[0]**2+c[1]**2),d=[l[0]+c[0]/p*r,l[1]+c[1]/p*r];return this.saveCurve(make2dThreePointArc(this._convertToUV(this.pointer),this._convertToUV(d),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=distance2d(this.pointer,e)/2,a=-r*n;return this.sagittaArcTo(e,a)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(make2dTangentArc(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,a]=this.pointer;return this.tangentArcTo([e+n,r+a])}ellipseTo(e,r,n,a=0,o=!1,s=!1){let l=a,c=r,p=n;r<n&&(l=a+90,c=n,p=r);const d=l*DEG2RAD,y=U=>distance2d(this._convertToUV(U)),m=y(polarToCartesian(c,d)),w=y(polarToCartesian(p,d+Math.PI/2)),_=normalize2d(this._convertToUV(rotate2d([1,0],d))),[,E]=cartesianToPolar(_),{cx:x,cy:k,startAngle:R,endAngle:A,clockwise:G,rx:L,ry:q}=convertSvgEllipseParams(this._convertToUV(this.pointer),this._convertToUV(e),m,w,E,o,s),V=make2dEllipseArc(L,q,G?R:A,G?A:R,[x,k],_);return G||V.reverse(),this.saveCurve(V),this.pointer=e,this}ellipse(e,r,n,a,o=0,s=!1,l=!1){const[c,p]=this.pointer;return this.ellipseTo([e+c,r+p],n,a,o,s,l)}halfEllipseTo(e,r,n=!1){const a=polarAngle2d(e,this.pointer),o=distance2d(e,this.pointer);return this.ellipseTo(e,o/2,r,a*RAD2DEG,!0,n)}halfEllipse(e,r,n,a=!1){const[o,s]=this.pointer;return this.halfEllipseTo([o+e,s+r],n,a)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(make2dBezierCurve(this._convertToUV(this.pointer),n.map(a=>this._convertToUV(a)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:a,startFactor:o,endFactor:s}=defaultsSplineConfig(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,c=distance2d(this.pointer,e)*.25;let p;a?p=a:l?p=this._convertFromUV(l.tangentAt(1)):p=[1,0],p=normalize2d(p);const d=[this.pointer[0]+p[0]*o*c,this.pointer[1]+p[1]*o*c];let y;n==="symmetric"?y=[-p[0],-p[1]]:y=n,y=normalize2d(y);const m=[e[0]-y[0]*s*c,e[1]-y[1]*s*c];return this.cubicBezierCurveTo(e,d,m)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),a=this.pendingCurves.shift();if(!n||!a)throw new Error("Not enough curves to close and fillet");const o=r==="chamfer"?chamferCurves:filletCurves;this.pendingCurves.push(...o(n,a,e))}_closeSketch(){samePoint$2(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(samePoint$2(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=axis2d(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(a=>new Curve2D(a.innerCurve.Mirrored_2(r)));n.reverse(),n.map(a=>a.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class BlueprintSketcher extends BaseSketcher2d{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Blueprint(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const guessFaceFromWires=t=>{const e=getOC(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((o,s)=>{o.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,s===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const a=cast(r.Shape());if(r.delete(),!(a instanceof Face))throw new Error("Failed to create a face");return a},fixWire=(t,e)=>{const r=getOC(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},faceFromWires=t=>{let e,r;try{e=makeFace(t[0]),r=t.slice(1)}catch{e=guessFaceFromWires(t),r=t.slice(1).map(a=>fixWire(a,e))}return addHolesInFace(e,r)},solidFromShellGenerator=(t,e)=>{const r=[],n=[],a=[];t.forEach(c=>{const[p,d,y]=e(c);r.push(p),n.push(d),a.push(y)});const o=faceFromWires(n),s=faceFromWires(a);return makeSolid([o,...r,s])};class CompoundSketch{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return compoundShapes(e)}face(){const e=this.outerSketch.face();return addHolesInFace(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:a,origin:o}={}){const s=new Vector(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!a?solidFromShellGenerator(this.sketches,p=>complexExtrude(p.wire,o||this.outerSketch.defaultOrigin,s,n,!0)):a?solidFromShellGenerator(this.sketches,p=>twistExtrude(p.wire,a,o||this.outerSketch.defaultOrigin,s,n,!0)):basicFaceExtrusion(this.face(),s)}revolve(e,{origin:r}={}){return revolution(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((o,s)=>{const l=e.sketches[s];return o.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),a=this.face().clone();return n.push(a,e.face()),makeSolid(n)}}class CompoundBlueprint{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new CompoundBlueprint(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new BoundingBox2d;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new CompoundBlueprint(this.blueprints.map(a=>a.stretch(e,r,n)))}rotate(e,r){return new CompoundBlueprint(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new CompoundBlueprint(this.blueprints.map(a=>a.scale(e,n)))}translate(e,r=0){return new CompoundBlueprint(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new CompoundBlueprint(this.blueprints.map(a=>a.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(a=>a.sketchOnPlane(e,r));return new CompoundSketch(n)}sketchOnFace(e,r){const n=this.blueprints.map(a=>a.sketchOnFace(e,r));return new CompoundSketch(n)}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return asSVG(this.toSVGGroup(),this.boundingBox,e)}}class Sketches{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof Sketch?r.wire:r.wires);return compoundShapes(e)}faces(){const e=this.sketches.map(r=>r.face());return compoundShapes(e)}extrude(e,r={}){const n=this.sketches.map(a=>a.extrude(e,r));return compoundShapes(n)}revolve(e,r){return compoundShapes(this.sketches.map(n=>n.revolve(e,r)))}}class Blueprints{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new Blueprints(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new BoundingBox2d;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new Blueprints(this.blueprints.map(a=>a.stretch(e,r,n)))}rotate(e,r){return new Blueprints(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new Blueprints(this.blueprints.map(a=>a.scale(e,n)))}translate(e,r=0){return new Blueprints(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new Blueprints(this.blueprints.map(a=>a.mirror(e,r,n)))}sketchOnPlane(e,r){return new Sketches(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new Sketches(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return viewbox(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof Blueprint?n.toSVGPath():n.toSVGGroup());return asSVG(r.join(`
    `),this.boundingBox,e)}}const groupByBoundingBoxOverlap=t=>{const e=t.map((a,o)=>t.slice(o+1).map((s,l)=>[l+o+1,s]).filter(([,s])=>!a.boundingBox.isOut(s.boundingBox)).map(([s])=>s)),r=[],n=Array(e.length);return e.forEach((a,o)=>{let s=n[o];s||(s=[],r.push(s)),s.push(t[o]),a.length&&a.forEach(l=>{n[l]=s})}),r},addContainmentInfo=t=>t.map((e,r)=>{const n=e.curves[0],a=n.value((n.lastParameter+n.firstParameter)/2),o=t.filter((s,l)=>r===l?!1:s.isInside(a));return{blueprint:e,isIn:o}}),splitMultipleOuterBlueprints=(t,e)=>t.flatMap(({blueprint:r})=>cleanEdgeCases(e.filter(({blueprint:n,isIn:a})=>n===r||a.indexOf(r)!==-1))),handleNestedBlueprints=(t,e)=>{const r=e.filter(({isIn:a})=>a.length<=1),n=cleanEdgeCases(addContainmentInfo(t.map(({blueprint:a})=>a)));return[r,...n]},cleanEdgeCases=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?splitMultipleOuterBlueprints(e,t):handleNestedBlueprints(r,t)},organiseBlueprints=t=>{const e=groupByBoundingBoxOverlap(t).map(addContainmentInfo);return new Blueprints(e.flatMap(cleanEdgeCases).map(r=>r.length===1?r[0].blueprint:(r.sort((n,a)=>n.isIn.length-a.isIn.length),new CompoundBlueprint(r.map(({blueprint:n})=>n)))))},polysidesBlueprint=(t,e,r=0)=>{const n=[...Array(e).keys()].map(o=>{const s=-(Math.PI*2/e)*o;return[t*Math.sin(s),t*Math.cos(s)]}),a=new BlueprintSketcher().movePointerTo([n[n.length-1][0],n[n.length-1][1]]);return r?n.forEach(([o,s])=>a.sagittaArcTo([o,s],r)):n.forEach(([o,s])=>a.lineTo([o,s])),a.done()},roundedRectangleBlueprint$1=(t,e,r=0)=>{const{rx:n=0,ry:a=0}=typeof r=="number"?{ry:r,rx:r}:r;let o=Math.min(n,t/2),s=Math.min(a,e/2);const l=o&&s;l||(o=0,s=0);const c=o===s,p=new BlueprintSketcher([Math.min(0,-(t/2-o)),-e/2]),d=(y,m)=>{l&&(c?p.tangentArc(y,m):p.ellipse(y,m,o,s,0,!1,!0))};return o<t/2&&p.hLine(t-2*o),d(o,s),s<e/2&&p.vLine(e-2*s),d(-o,s),o<t/2&&p.hLine(-(t-2*o)),d(-o,-s),s<e/2&&p.vLine(-(e-2*s)),d(o,-s),p.close()},PRECISION$1=1e-9,samePoint$1=(t,e)=>samePoint$2(t,e,PRECISION$1),curveMidPoint=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},rotateToStartAt=(t,e)=>{const r=t.findIndex(o=>samePoint$1(e,o.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},rotateToStartAtSegment=(t,e)=>{const r=s=>samePoint$1(e.firstPoint,s.firstPoint)&&samePoint$1(e.lastPoint,s.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=reverseSegment(t),n=t.findIndex(r),n===-1))throw console.error(t.map(s=>s.repr),e.repr),new Error("Failed to rotate to segment start");const a=t.slice(0,n);return t.slice(n).concat(a)};function*createSegmentOnPoints(t,e,r){const n=s=>!!e.find(l=>samePoint$1(l,s.lastPoint)),a=s=>!!r.find(l=>samePoint$1(l.firstPoint,s.firstPoint)&&samePoint$1(l.lastPoint,s.lastPoint)||samePoint$1(l.firstPoint,s.lastPoint)&&samePoint$1(l.lastPoint,s.firstPoint));let o=[];for(const s of t)n(s)?(o.push(s),yield o,o=[]):a(s)?(o.length&&(yield o,o=[]),yield[s]):o.push(s);o.length&&(yield o)}const startOfSegment=t=>t[0].firstPoint,endOfSegment=t=>t[t.length-1].lastPoint,reverseSegment=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),reverseSegments=t=>(t.reverse(),t.map(reverseSegment));function removeNonCrossingPoint(t,e,r){return t.filter(n=>{const a=e.filter(l=>samePoint$1(l.firstPoint,n)||samePoint$1(l.lastPoint,n));if(a.length%2)throw console.error(a,n),new Error("Bug in the intersection algo on non crossing point");const o=a.map(l=>r.isInside(curveMidPoint(l)));return!(o.every(l=>l)||!o.some(l=>l))})}function blueprintsIntersectionSegments(t,e){let r=[];const n=[],a=new Array(t.curves.length).fill(0).map(()=>[]),o=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((m,w)=>{e.curves.forEach((_,E)=>{const{intersections:x,commonSegments:k,commonSegmentsPoints:R}=intersectCurves(m,_,PRECISION$1/100);r.push(...x),a[w].push(...x),o[E].push(...x),n.push(...k),r.push(...R),a[w].push(...R),o[E].push(...R)})}),r=removeDuplicatePoints(r,PRECISION$1),!r.length||r.length===1)return null;const s=([m,w])=>w.length?m.splitAt(w,PRECISION$1/100):[m];let l=zip([t.curves,a]).flatMap(s),c=zip([e.curves,o]).flatMap(s);const p=n.map(m=>[m.firstPoint,m.lastPoint]);if(r=removeNonCrossingPoint(r,l,e),!r.length&&!n.length)return null;if(n.length){const m=n[0];l=rotateToStartAtSegment(l,m),c=rotateToStartAtSegment(c,m)}else{const m=r[0];l=rotateToStartAt(l,m),c=rotateToStartAt(c,m)}const d=Array.from(createSegmentOnPoints(l,r,n));let y=Array.from(createSegmentOnPoints(c,r,n));return(!samePoint$1(endOfSegment(y[0]),endOfSegment(d[0]))||n.length>0&&y[0].length!==1)&&(y=reverseSegments(y)),zip([d,y]).map(([m,w])=>{const _=startOfSegment(m),E=endOfSegment(m);return p.find(([x,k])=>samePoint$1(x,_)&&samePoint$1(k,E)||samePoint$1(x,E)&&samePoint$1(x,_))?[m,"same"]:[m,w]})}const splitPaths=t=>{const e=t.map(s=>s.firstPoint);let r=t.map(s=>s.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=zip([e,r]).map(([s,l],c)=>samePoint$1(s,l)?null:c).filter(s=>s!==null);if(!n.length)return[t];const a=zip([n.slice(0,-1),n.slice(1)]).map(([s,l])=>t.slice(s,l));let o=t.slice(n[n.length-1]);return n[0]!==0&&(o=o.concat(t.slice(0,n[0]))),a.push(o),a};function booleanOperation(t,e,{firstInside:r,secondInside:n}){const a=blueprintsIntersectionSegments(t,e);if(!a){const p=curveMidPoint(t.curves[0]),d=e.isInside(p),y=curveMidPoint(e.curves[0]),m=t.isInside(y);return{identical:!1,firstCurveInSecond:d,secondCurveInFirst:m}}if(a.every(([,p])=>p==="same"))return{identical:!0};let o=null,s=null;const l=a.flatMap(([p,d])=>{let y=[],m=0;if(d==="same")return s===1?(s=1,[...p]):s===2||s===0?(s=null,[]):s===null?(o?o=[...o,...p]:o=p,[]):(console.error("weird situation"),[]);const w=curveMidPoint(p[0]),_=e.isInside(w);(r==="keep"&&_||r==="remove"&&!_)&&(m+=1,y.push(...p));const E=curveMidPoint(d[0]),x=t.isInside(E);if(n==="keep"&&x||n==="remove"&&!x){let k=d;m===1&&(k=reverseSegment(d)),m+=1,y.push(...k)}return s===null&&m===1&&o&&(y=[...o,...y]),m===1&&(s=m,o=null),y}),c=splitPaths(l).filter(p=>p.length).map(p=>new Blueprint(p));return c.length===0?null:c.length===1?c[0]:organiseBlueprints(c)}const fuseBlueprints=(t,e)=>{const r=booleanOperation(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new Blueprints([t,e])},cutBlueprints=(t,e)=>{const r=booleanOperation(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new Blueprints([new CompoundBlueprint([t,e])]):t.clone()},intersectBlueprints=(t,e)=>{const r=booleanOperation(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},genericIntersects=(t,e)=>{if(t instanceof Blueprint&&e instanceof Blueprint){let r=[];return t.curves.forEach(n=>{e.curves.forEach(a=>{const{intersections:o,commonSegmentsPoints:s}=intersectCurves(n,a);r.push(...o),r.push(...s)})}),r=removeDuplicatePoints(r),r.length>1}if(t instanceof CompoundBlueprint||t instanceof Blueprints)return t.blueprints.some(r=>genericIntersects(r,e));if(e instanceof CompoundBlueprint||e instanceof Blueprints)return e.blueprints.some(r=>genericIntersects(t,r));throw new Error("Bug in the generic intersects algorithm")},genericFuse=(t,e)=>{if(t instanceof CompoundBlueprint){if(e instanceof Blueprint)return fuseBlueprintWithCompound(e,t);if(e instanceof CompoundBlueprint)return fuseCompoundWithCompound(t,e)}if(e instanceof CompoundBlueprint){if(t instanceof Blueprint)return fuseBlueprintWithCompound(t,e);if(t instanceof CompoundBlueprint)return fuseCompoundWithCompound(t,e)}if(t instanceof Blueprint&&e instanceof Blueprint)return fuseBlueprints(t,e);throw new Error("Bug in the generic fuse algorithm")},fuseIntersectingBlueprints$1=t=>{const e=new Map,r=[];return t.forEach((n,a)=>{let o;e.has(a)?o=e.get(a):(o={current:n,fusedWith:new Set([a])},r.push(o)),t.slice(a+1).forEach((s,l)=>{const c=o.current,p=a+l+1;if(o.fusedWith.has(p))return;let d=s,y=!1;if(e.has(p)&&(d=e.get(p).current,y=!0),c.boundingBox.isOut(d.boundingBox)||!genericIntersects(c,d))return;let m;if(c instanceof Blueprints||d instanceof Blueprints?m=fuse2D(c,d):m=genericFuse(c,d),!(m instanceof Blueprint||m instanceof CompoundBlueprint)){if(m instanceof Blueprints&&m.blueprints.length===2)return;if(m instanceof Blueprints&&m.blueprints.length===1)m=m.blueprints[0];else if(!(m instanceof Blueprints))throw console.error(m),new Error("Bug in blueprint fusing algorigthm")}o.fusedWith.add(p),o.current=m,y||e.set(p,o)})}),organiseBlueprints(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>allBlueprints(n)))},allBlueprints=t=>t instanceof Blueprint?[t]:t instanceof CompoundBlueprint?t.blueprints:t instanceof Blueprints?t.blueprints.flatMap(e=>allBlueprints(e)):[],fuseBlueprintWithCompound=(t,e)=>{const r=fuseBlueprints(t,e.blueprints[0]),n=e.blueprints.slice(1).map(a=>cutBlueprints(a,t));return organiseBlueprints([...allBlueprints(r),...n.flatMap(a=>allBlueprints(a))])};function allPairs(t,e){const r=[];for(const n of t)for(const a of e)r.push([n,a]);return r}const fuseCompoundWithCompound=(t,e)=>{const r=fuseBlueprints(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(s=>cutBlueprints(s,t.blueprints[0])),a=t.blueprints.slice(1).map(s=>cutBlueprints(s,e.blueprints[0])),o=allPairs(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([s,l])=>allBlueprints(intersectBlueprints(s,l)));return organiseBlueprints([...allBlueprints(r),...n.flatMap(s=>allBlueprints(s)),...a.flatMap(s=>allBlueprints(s)),...o])},fuse2D=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof Blueprints)&&e instanceof Blueprints)return fuseIntersectingBlueprints$1([t,...e.blueprints]);if(!(e instanceof Blueprints)&&t instanceof Blueprints)return fuseIntersectingBlueprints$1([e,...t.blueprints]);if(t instanceof Blueprints&&e instanceof Blueprints){let r=fuse2D(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=fuse2D(n,r)}),r}if(t instanceof CompoundBlueprint){if(e instanceof Blueprints)return fuse2D(e,t);if(e instanceof Blueprint)return fuseBlueprintWithCompound(e,t);if(e instanceof CompoundBlueprint)return fuseCompoundWithCompound(t,e)}if(e instanceof CompoundBlueprint){if(t instanceof Blueprints)return fuse2D(t,e);if(t instanceof Blueprint)return fuseBlueprintWithCompound(t,e);if(t instanceof CompoundBlueprint)return fuseCompoundWithCompound(t,e)}return t instanceof Blueprint&&e instanceof Blueprint?fuseBlueprints(t,e):null},mergeNonIntersecting=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof Blueprints?r.blueprints:r);return e.length===1?e[0]:new Blueprints(e)},cut2D=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof Blueprints)return mergeNonIntersecting(t.blueprints.map(n=>cut2D(n,e)));if(t instanceof CompoundBlueprint){const n=t.blueprints[0];if(e instanceof Blueprint&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const a=fuse2D(e,new Blueprints(t.blueprints.slice(1)));return organiseBlueprints([n,...allBlueprints(a)])}else{let a=cut2D(t.blueprints[0],e);return t.blueprints.slice(1).forEach(o=>{a=cut2D(a,o)}),a}}if(e instanceof Blueprints)return mergeNonIntersecting(e.blueprints.map(n=>cut2D(t,n)));if(e instanceof CompoundBlueprint){let n=cutBlueprints(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(a=>{n=fuse2D(n,intersectBlueprints(a,t))}),n}return cutBlueprints(t,e)};function intersect2D(t,e){if(t===null||e===null)return null;if(t instanceof Blueprint&&e instanceof Blueprint)return intersectBlueprints(t,e);if(t instanceof Blueprints)return mergeNonIntersecting(t.blueprints.map(r=>intersect2D(r,e)));if(t instanceof CompoundBlueprint){const r=t.blueprints[0],n=t.blueprints[1];return cut2D(intersect2D(r,e),n)}if(e instanceof Blueprints)return mergeNonIntersecting(e.blueprints.map(r=>intersect2D(t,r)));if(e instanceof CompoundBlueprint){const r=e.blueprints[0],n=e.blueprints[1];return cut2D(intersect2D(r,t),n)}throw new Error("intersct 2D algorithm error")}/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,a=n(r,r,r)&&n}catch{}return a}(),e=function(r){if(this==null)throw TypeError();var n=String(this),a=n.length,o=r?Number(r):0;if(o!=o&&(o=0),!(o<0||o>=a)){var s=n.charCodeAt(o),l;return s>=55296&&s<=56319&&a>o+1&&(l=n.charCodeAt(o+1),l>=56320&&l<=57343)?(s-55296)*1024+l-56320+65536:s}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();var TINF_OK=0,TINF_DATA_ERROR=-3;function Tree(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Data(t,e){this.source=t,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new Tree,this.dtree=new Tree}var sltree=new Tree,sdtree=new Tree,length_bits=new Uint8Array(30),length_base=new Uint16Array(30),dist_bits=new Uint8Array(30),dist_base=new Uint16Array(30),clcidx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),code_tree=new Tree,lengths=new Uint8Array(320);function tinf_build_bits_base(t,e,r,n){var a,o;for(a=0;a<r;++a)t[a]=0;for(a=0;a<30-r;++a)t[a+r]=a/r|0;for(o=n,a=0;a<30;++a)e[a]=o,o+=1<<t[a]}function tinf_build_fixed_trees(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[168+r]=280+r;for(r=0;r<112;++r)t.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}var offs=new Uint16Array(16);function tinf_build_tree(t,e,r,n){var a,o;for(a=0;a<16;++a)t.table[a]=0;for(a=0;a<n;++a)t.table[e[r+a]]++;for(t.table[0]=0,o=0,a=0;a<16;++a)offs[a]=o,o+=t.table[a];for(a=0;a<n;++a)e[r+a]&&(t.trans[offs[e[r+a]]++]=a)}function tinf_getbit(t){t.bitcount--||(t.tag=t.source[t.sourceIndex++],t.bitcount=7);var e=t.tag&1;return t.tag>>>=1,e}function tinf_read_bits(t,e,r){if(!e)return r;for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var n=t.tag&65535>>>16-e;return t.tag>>>=e,t.bitcount-=e,n+r}function tinf_decode_symbol(t,e){for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var r=0,n=0,a=0,o=t.tag;do n=2*n+(o&1),o>>>=1,++a,r+=e.table[a],n-=e.table[a];while(n>=0);return t.tag=o,t.bitcount-=a,e.trans[r+n]}function tinf_decode_trees(t,e,r){var n,a,o,s,l,c;for(n=tinf_read_bits(t,5,257),a=tinf_read_bits(t,5,1),o=tinf_read_bits(t,4,4),s=0;s<19;++s)lengths[s]=0;for(s=0;s<o;++s){var p=tinf_read_bits(t,3,0);lengths[clcidx[s]]=p}for(tinf_build_tree(code_tree,lengths,0,19),l=0;l<n+a;){var d=tinf_decode_symbol(t,code_tree);switch(d){case 16:var y=lengths[l-1];for(c=tinf_read_bits(t,2,3);c;--c)lengths[l++]=y;break;case 17:for(c=tinf_read_bits(t,3,3);c;--c)lengths[l++]=0;break;case 18:for(c=tinf_read_bits(t,7,11);c;--c)lengths[l++]=0;break;default:lengths[l++]=d;break}}tinf_build_tree(e,lengths,0,n),tinf_build_tree(r,lengths,n,a)}function tinf_inflate_block_data(t,e,r){for(;;){var n=tinf_decode_symbol(t,e);if(n===256)return TINF_OK;if(n<256)t.dest[t.destLen++]=n;else{var a,o,s,l;for(n-=257,a=tinf_read_bits(t,length_bits[n],length_base[n]),o=tinf_decode_symbol(t,r),s=t.destLen-tinf_read_bits(t,dist_bits[o],dist_base[o]),l=s;l<s+a;++l)t.dest[t.destLen++]=t.dest[l]}}}function tinf_inflate_uncompressed_block(t){for(var e,r,n;t.bitcount>8;)t.sourceIndex--,t.bitcount-=8;if(e=t.source[t.sourceIndex+1],e=256*e+t.source[t.sourceIndex],r=t.source[t.sourceIndex+3],r=256*r+t.source[t.sourceIndex+2],e!==(~r&65535))return TINF_DATA_ERROR;for(t.sourceIndex+=4,n=e;n;--n)t.dest[t.destLen++]=t.source[t.sourceIndex++];return t.bitcount=0,TINF_OK}function tinf_uncompress(t,e){var r=new Data(t,e),n,a,o;do{switch(n=tinf_getbit(r),a=tinf_read_bits(r,2,0),a){case 0:o=tinf_inflate_uncompressed_block(r);break;case 1:o=tinf_inflate_block_data(r,sltree,sdtree);break;case 2:tinf_decode_trees(r,r.ltree,r.dtree),o=tinf_inflate_block_data(r,r.ltree,r.dtree);break;default:o=TINF_DATA_ERROR}if(o!==TINF_OK)throw new Error("Data error")}while(!n);return r.destLen<r.dest.length?typeof r.dest.slice=="function"?r.dest.slice(0,r.destLen):r.dest.subarray(0,r.destLen):r.dest}tinf_build_fixed_trees(sltree,sdtree),tinf_build_bits_base(length_bits,length_base,4,3),tinf_build_bits_base(dist_bits,dist_base,2,1),length_bits[28]=0,length_base[28]=258;var tinyInflate=tinf_uncompress;function derive(t,e,r,n,a){return Math.pow(1-a,3)*t+3*Math.pow(1-a,2)*a*e+3*(1-a)*Math.pow(a,2)*r+Math.pow(a,3)*n}function BoundingBox2(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}BoundingBox2.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},BoundingBox2.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},BoundingBox2.prototype.addX=function(t){this.addPoint(t,null)},BoundingBox2.prototype.addY=function(t){this.addPoint(null,t)},BoundingBox2.prototype.addBezier=function(t,e,r,n,a,o,s,l){var c=[t,e],p=[r,n],d=[a,o],y=[s,l];this.addPoint(t,e),this.addPoint(s,l);for(var m=0;m<=1;m++){var w=6*c[m]-12*p[m]+6*d[m],_=-3*c[m]+9*p[m]-9*d[m]+3*y[m],E=3*p[m]-3*c[m];if(_===0){if(w===0)continue;var x=-E/w;0<x&&x<1&&(m===0&&this.addX(derive(c[m],p[m],d[m],y[m],x)),m===1&&this.addY(derive(c[m],p[m],d[m],y[m],x)));continue}var k=Math.pow(w,2)-4*E*_;if(!(k<0)){var R=(-w+Math.sqrt(k))/(2*_);0<R&&R<1&&(m===0&&this.addX(derive(c[m],p[m],d[m],y[m],R)),m===1&&this.addY(derive(c[m],p[m],d[m],y[m],R)));var A=(-w-Math.sqrt(k))/(2*_);0<A&&A<1&&(m===0&&this.addX(derive(c[m],p[m],d[m],y[m],A)),m===1&&this.addY(derive(c[m],p[m],d[m],y[m],A)))}}},BoundingBox2.prototype.addQuad=function(t,e,r,n,a,o){var s=t+.6666666666666666*(r-t),l=e+2/3*(n-e),c=s+1/3*(a-t),p=l+1/3*(o-e);this.addBezier(t,e,s,l,c,p,a,o)};function Path(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Path.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},Path.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(t,e,r,n,a,o){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:a,y:o})},Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})},Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})},Path.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof BoundingBox2){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)},Path.prototype.getBoundingBox=function(){for(var t=new BoundingBox2,e=0,r=0,n=0,a=0,o=0;o<this.commands.length;o++){var s=this.commands[o];switch(s.type){case"M":t.addPoint(s.x,s.y),e=n=s.x,r=a=s.y;break;case"L":t.addPoint(s.x,s.y),n=s.x,a=s.y;break;case"Q":t.addQuad(n,a,s.x1,s.y1,s.x,s.y),n=s.x,a=s.y;break;case"C":t.addBezier(n,a,s.x1,s.y1,s.x2,s.y2,s.x,s.y),n=s.x,a=s.y;break;case"Z":n=e,a=r;break;default:throw new Error("Unexpected path command "+s.type)}}return t.isEmpty()&&t.addPoint(0,0),t},Path.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},Path.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(s){return Math.round(s)===s?""+Math.round(s):s.toFixed(t)}function r(){for(var s=arguments,l="",c=0;c<arguments.length;c+=1){var p=s[c];p>=0&&c>0&&(l+=" "),l+=e(p)}return l}for(var n="",a=0;a<this.commands.length;a+=1){var o=this.commands[a];o.type==="M"?n+="M"+r(o.x,o.y):o.type==="L"?n+="L"+r(o.x,o.y):o.type==="C"?n+="C"+r(o.x1,o.y1,o.x2,o.y2,o.x,o.y):o.type==="Q"?n+="Q"+r(o.x1,o.y1,o.x,o.y):o.type==="Z"&&(n+="Z")}return n},Path.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Path.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function fail(t){throw new Error(t)}function argument(t,e){t||fail(e)}var check={fail,argument,assert:argument},LIMIT16=32768,LIMIT32=2147483648,decode={},encode={},sizeOf={};function constant(t){return function(){return t}}encode.BYTE=function(t){return check.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},sizeOf.BYTE=constant(1),encode.CHAR=function(t){return[t.charCodeAt(0)]},sizeOf.CHAR=constant(1),encode.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e},sizeOf.CHARARRAY=function(t){return typeof t>"u"?0:t.length},encode.USHORT=function(t){return[t>>8&255,t&255]},sizeOf.USHORT=constant(2),encode.SHORT=function(t){return t>=LIMIT16&&(t=-(2*LIMIT16-t)),[t>>8&255,t&255]},sizeOf.SHORT=constant(2),encode.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]},sizeOf.UINT24=constant(3),encode.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]},sizeOf.ULONG=constant(4),encode.LONG=function(t){return t>=LIMIT32&&(t=-(2*LIMIT32-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]},sizeOf.LONG=constant(4),encode.FIXED=encode.ULONG,sizeOf.FIXED=sizeOf.ULONG,encode.FWORD=encode.SHORT,sizeOf.FWORD=sizeOf.SHORT,encode.UFWORD=encode.USHORT,sizeOf.UFWORD=sizeOf.USHORT,encode.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]},sizeOf.LONGDATETIME=constant(8),encode.TAG=function(t){return check.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},sizeOf.TAG=constant(4),encode.Card8=encode.BYTE,sizeOf.Card8=sizeOf.BYTE,encode.Card16=encode.USHORT,sizeOf.Card16=sizeOf.USHORT,encode.OffSize=encode.BYTE,sizeOf.OffSize=sizeOf.BYTE,encode.SID=encode.USHORT,sizeOf.SID=sizeOf.USHORT,encode.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?encode.NUMBER16(t):encode.NUMBER32(t)},sizeOf.NUMBER=function(t){return encode.NUMBER(t).length},encode.NUMBER16=function(t){return[28,t>>8&255,t&255]},sizeOf.NUMBER16=constant(3),encode.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]},sizeOf.NUMBER32=constant(5),encode.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var a="",o=0,s=e.length;o<s;o+=1){var l=e[o];l==="e"?a+=e[++o]==="-"?"c":"b":l==="."?a+="a":l==="-"?a+="e":a+=l}a+=a.length&1?"f":"ff";for(var c=[30],p=0,d=a.length;p<d;p+=2)c.push(parseInt(a.substr(p,2),16));return c},sizeOf.REAL=function(t){return encode.REAL(t).length},encode.NAME=encode.CHARARRAY,sizeOf.NAME=sizeOf.CHARARRAY,encode.STRING=encode.CHARARRAY,sizeOf.STRING=sizeOf.CHARARRAY,decode.UTF8=function(t,e,r){for(var n=[],a=r,o=0;o<a;o++,e+=1)n[o]=t.getUint8(e);return String.fromCharCode.apply(null,n)},decode.UTF16=function(t,e,r){for(var n=[],a=r/2,o=0;o<a;o++,e+=2)n[o]=t.getUint16(e);return String.fromCharCode.apply(null,n)},encode.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e},sizeOf.UTF16=function(t){return t.length*2};var eightBitMacEncodings={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};decode.MACSTRING=function(t,e,r,n){var a=eightBitMacEncodings[n];if(a!==void 0){for(var o="",s=0;s<r;s++){var l=t.getUint8(e+s);l<=127?o+=String.fromCharCode(l):o+=a[l&127]}return o}};var macEncodingTableCache=typeof WeakMap=="function"&&new WeakMap,macEncodingCacheKeys,getMacEncodingTable=function(t){if(!macEncodingCacheKeys){macEncodingCacheKeys={};for(var e in eightBitMacEncodings)macEncodingCacheKeys[e]=new String(e)}var r=macEncodingCacheKeys[t];if(r!==void 0){if(macEncodingTableCache){var n=macEncodingTableCache.get(r);if(n!==void 0)return n}var a=eightBitMacEncodings[t];if(a!==void 0){for(var o={},s=0;s<a.length;s++)o[a.charCodeAt(s)]=s+128;return macEncodingTableCache&&macEncodingTableCache.set(r,o),o}}};encode.MACSTRING=function(t,e){var r=getMacEncodingTable(e);if(r!==void 0){for(var n=[],a=0;a<t.length;a++){var o=t.charCodeAt(a);if(o>=128&&(o=r[o],o===void 0))return;n[a]=o}return n}},sizeOf.MACSTRING=function(t,e){var r=encode.MACSTRING(t,e);return r!==void 0?r.length:0};function isByteEncodable(t){return t>=-128&&t<=127}function encodeVarDeltaRunAsZeroes(t,e,r){for(var n=0,a=t.length;e<a&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function encodeVarDeltaRunAsBytes(t,e,r){for(var n=0,a=t.length,o=e;o<a&&n<64;){var s=t[o];if(!isByteEncodable(s)||s===0&&o+1<a&&t[o+1]===0)break;++o,++n}r.push(n-1);for(var l=e;l<o;++l)r.push(t[l]+256&255);return o}function encodeVarDeltaRunAsWords(t,e,r){for(var n=0,a=t.length,o=e;o<a&&n<64;){var s=t[o];if(s===0||isByteEncodable(s)&&o+1<a&&isByteEncodable(t[o+1]))break;++o,++n}r.push(64|n-1);for(var l=e;l<o;++l){var c=t[l];r.push(c+65536>>8&255,c+256&255)}return o}encode.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=encodeVarDeltaRunAsZeroes(t,e,r):n>=-128&&n<=127?e=encodeVarDeltaRunAsBytes(t,e,r):e=encodeVarDeltaRunAsWords(t,e,r)}return r},encode.INDEX=function(t){for(var e=1,r=[e],n=[],a=0;a<t.length;a+=1){var o=encode.OBJECT(t[a]);Array.prototype.push.apply(n,o),e+=o.length,r.push(e)}if(n.length===0)return[0,0];for(var s=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,c=[void 0,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][l],p=0;p<r.length;p+=1){var d=c(r[p]);Array.prototype.push.apply(s,d)}return Array.prototype.concat(encode.Card16(t.length),encode.OffSize(l),s,n)},sizeOf.INDEX=function(t){return encode.INDEX(t).length},encode.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,a=0;a<n;a+=1){var o=parseInt(r[a],0),s=t[o];e=e.concat(encode.OPERAND(s.value,s.type)),e=e.concat(encode.OPERATOR(o))}return e},sizeOf.DICT=function(t){return encode.DICT(t).length},encode.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},encode.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)check.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(encode.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(encode.NUMBER(t));else if(e==="offset")r=r.concat(encode.NUMBER32(t));else if(e==="number")r=r.concat(encode.NUMBER(t));else if(e==="real")r=r.concat(encode.REAL(t));else throw new Error("Unknown operand type "+e);return r},encode.OP=encode.BYTE,sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap=="function"&&new WeakMap;encode.CHARSTRING=function(t){if(wmm){var e=wmm.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,a=0;a<n;a+=1){var o=t[a];r=r.concat(encode[o.type](o.value))}return wmm&&wmm.set(t,r),r},sizeOf.CHARSTRING=function(t){return encode.CHARSTRING(t).length},encode.OBJECT=function(t){var e=encode[t.type];return check.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)},sizeOf.OBJECT=function(t){var e=sizeOf[t.type];return check.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)},encode.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],a=[],o=0;o<r;o+=1){var s=t.fields[o],l=encode[s.type];check.argument(l!==void 0,"No encoding function for field type "+s.type+" ("+s.name+")");var c=t[s.name];c===void 0&&(c=s.value);var p=l(c);s.type==="TABLE"?(a.push(e.length),e=e.concat([0,0]),n.push(p)):e=e.concat(p)}for(var d=0;d<n.length;d+=1){var y=a[d],m=e.length;check.argument(m<65536,"Table "+t.tableName+" too big."),e[y]=m>>8,e[y+1]=m&255,e=e.concat(n[d])}return e},sizeOf.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var a=t.fields[n],o=sizeOf[a.type];check.argument(o!==void 0,"No sizeOf function for field type "+a.type+" ("+a.name+")");var s=t[a.name];s===void 0&&(s=a.value),e+=o(s),a.type==="TABLE"&&(e+=2)}return e},encode.RECORD=encode.TABLE,sizeOf.RECORD=sizeOf.TABLE,encode.LITERAL=function(t){return t},sizeOf.LITERAL=function(t){return t.length};function Table(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var a=e[n];this[a.name]=a.value}if(this.tableName=t,this.fields=e,r)for(var o=Object.keys(r),s=0;s<o.length;s+=1){var l=o[s],c=r[l];this[l]!==void 0&&(this[l]=c)}}Table.prototype.encode=function(){return encode.TABLE(this)},Table.prototype.sizeOf=function(){return sizeOf.TABLE(this)};function ushortList(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var a=0;a<e.length;a++)n[a+1]={name:t+a,type:"USHORT",value:e[a]};return n}function tableList(t,e,r){var n=e.length,a=new Array(n+1);a[0]={name:t+"Count",type:"USHORT",value:n};for(var o=0;o<n;o++)a[o+1]={name:t+o,type:"TABLE",value:r(e[o],o)};return a}function recordList(t,e,r){var n=e.length,a=[];a[0]={name:t+"Count",type:"USHORT",value:n};for(var o=0;o<n;o++)a=a.concat(r(e[o],o));return a}function Coverage(t){t.format===1?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(ushortList("glyph",t.glyphs))):t.format===2?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(recordList("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):check.assert(!1,"Coverage format must be 1 or 2.")}Coverage.prototype=Object.create(Table.prototype),Coverage.prototype.constructor=Coverage;function ScriptList(t){Table.call(this,"scriptListTable",recordList("scriptRecord",t,function(e,r){var n=e.script,a=n.defaultLangSys;return check.assert(!!a,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Table("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Table("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:a.reqFeatureIndex}].concat(ushortList("featureIndex",a.featureIndexes)))}].concat(recordList("langSys",n.langSysRecords,function(o,s){var l=o.langSys;return[{name:"langSysTag"+s,type:"TAG",value:o.tag},{name:"langSys"+s,type:"TABLE",value:new Table("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(ushortList("featureIndex",l.featureIndexes)))}]})))}]}))}ScriptList.prototype=Object.create(Table.prototype),ScriptList.prototype.constructor=ScriptList;function FeatureList(t){Table.call(this,"featureListTable",recordList("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Table("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(ushortList("lookupListIndex",n.lookupListIndexes)))}]}))}FeatureList.prototype=Object.create(Table.prototype),FeatureList.prototype.constructor=FeatureList;function LookupList(t,e){Table.call(this,"lookupListTable",tableList("lookup",t,function(r){var n=e[r.lookupType];return check.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Table("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(tableList("subtable",r.subtables,n)))}))}LookupList.prototype=Object.create(Table.prototype),LookupList.prototype.constructor=LookupList;var table={Table,Record:Table,Coverage,ScriptList,FeatureList,LookupList,ushortList,tableList,recordList};function getByte(t,e){return t.getUint8(e)}function getUShort(t,e){return t.getUint16(e,!1)}function getShort(t,e){return t.getInt16(e,!1)}function getULong(t,e){return t.getUint32(e,!1)}function getFixed(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function getTag(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function getOffset(t,e,r){for(var n=0,a=0;a<r;a+=1)n<<=8,n+=t.getUint8(e+a);return n}function getBytes(t,e,r){for(var n=[],a=e;a<r;a+=1)n.push(t.getUint8(a));return n}function bytesToString(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var typeOffsets={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(t,e){this.data=t,this.offset=e,this.relativeOffset=0}Parser.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},Parser.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},Parser.prototype.parseCard8=Parser.prototype.parseByte,Parser.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},Parser.prototype.parseCard16=Parser.prototype.parseUShort,Parser.prototype.parseSID=Parser.prototype.parseUShort,Parser.prototype.parseOffset16=Parser.prototype.parseUShort,Parser.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},Parser.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},Parser.prototype.parseULong=function(){var t=getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},Parser.prototype.parseOffset32=Parser.prototype.parseULong,Parser.prototype.parseFixed=function(){var t=getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},Parser.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var a=0;a<t;a++)n+=String.fromCharCode(e.getUint8(r+a));return n},Parser.prototype.parseTag=function(){return this.parseString(4)},Parser.prototype.parseLongDateTime=function(){var t=getULong(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},Parser.prototype.parseVersion=function(t){var e=getUShort(this.data,this.offset+this.relativeOffset),r=getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10},Parser.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=typeOffsets[t]*e},Parser.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,a=0;a<t;a++)e[a]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e},Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,a=0;a<t;a++)e[a]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e},Parser.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,a=0;a<t;a++)e[a]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e},Parser.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,a=0;a<t;a++)e[a]=r.getUint8(n++);return this.relativeOffset+=t,e},Parser.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},Parser.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},Parser.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),a=0;a<t;a++){for(var o={},s=0;s<n.length;s++){var l=n[s],c=e[l];o[l]=c.call(this)}r[a]=o}return r},Parser.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),a=0;a<t;a++){for(var o={},s=0;s<n.length;s++){var l=n[s],c=e[l];o[l]=c.call(this)}r[a]=o}return r},Parser.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var a=e[n],o=t[a];r[a]=o.call(this)}return r},Parser.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},Parser.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r},Parser.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new Parser(this.data,this.offset+e).parseStruct(t)},Parser.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new Parser(this.data,this.offset+e).parseStruct(t)},Parser.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,a=new Array(r),o=0;o<r;o++){var s=e[o];if(s===0){a[o]=void 0;continue}if(this.relativeOffset=s,t){for(var l=this.parseOffset16List(),c=new Array(l.length),p=0;p<l.length;p++)this.relativeOffset=s+l[p],c[p]=t.call(this);a[o]=c}else a[o]=this.parseUShortList()}return this.relativeOffset=n,a},Parser.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),a=0;a<r;a++)n[a]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},Parser.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:Parser.uShort,end:Parser.uShort,classId:Parser.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},Parser.list=function(t,e){return function(){return this.parseList(t,e)}},Parser.list32=function(t,e){return function(){return this.parseList32(t,e)}},Parser.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},Parser.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},Parser.pointer=function(t){return function(){return this.parsePointer(t)}},Parser.pointer32=function(t){return function(){return this.parsePointer32(t)}},Parser.tag=Parser.prototype.parseTag,Parser.byte=Parser.prototype.parseByte,Parser.uShort=Parser.offset16=Parser.prototype.parseUShort,Parser.uShortList=Parser.prototype.parseUShortList,Parser.uLong=Parser.offset32=Parser.prototype.parseULong,Parser.uLongList=Parser.prototype.parseULongList,Parser.struct=Parser.prototype.parseStruct,Parser.coverage=Parser.prototype.parseCoverage,Parser.classDef=Parser.prototype.parseClassDef;var langSysTable={reserved:Parser.uShort,reqFeatureIndex:Parser.uShort,featureIndexes:Parser.uShortList};Parser.prototype.parseScriptList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,script:Parser.pointer({defaultLangSys:Parser.pointer(langSysTable),langSysRecords:Parser.recordList({tag:Parser.tag,langSys:Parser.pointer(langSysTable)})})}))||[]},Parser.prototype.parseFeatureList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,feature:Parser.pointer({featureParams:Parser.offset16,lookupListIndexes:Parser.uShortList})}))||[]},Parser.prototype.parseLookupList=function(t){return this.parsePointer(Parser.list(Parser.pointer(function(){var e=this.parseUShort();check.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(Parser.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},Parser.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();check.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:Parser.offset32,featureTableSubstitutionOffset:Parser.offset32});return r})||[]};var parse$1={getByte,getCard8:getByte,getUShort,getCard16:getUShort,getShort,getULong,getFixed,getTag,getOffset,getBytes,bytesToString,Parser};function parseCmapTableFormat12(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var a=e.parseULong(),o=e.parseULong(),s=e.parseULong(),l=a;l<=o;l+=1)t.glyphIndexMap[l]=s,s++}function parseCmapTableFormat4(t,e,r,n,a){t.length=e.parseUShort(),t.language=e.parseUShort();var o;t.segCount=o=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var s=new parse$1.Parser(r,n+a+14),l=new parse$1.Parser(r,n+a+16+o*2),c=new parse$1.Parser(r,n+a+16+o*4),p=new parse$1.Parser(r,n+a+16+o*6),d=n+a+16+o*8,y=0;y<o-1;y+=1)for(var m=void 0,w=s.parseUShort(),_=l.parseUShort(),E=c.parseShort(),x=p.parseUShort(),k=_;k<=w;k+=1)x!==0?(d=p.offset+p.relativeOffset-2,d+=x,d+=(k-_)*2,m=parse$1.getUShort(r,d),m!==0&&(m=m+E&65535)):m=k+E&65535,t.glyphIndexMap[k]=m}function parseCmapTable(t,e){var r={};r.version=parse$1.getUShort(t,e),check.argument(r.version===0,"cmap table version should be 0."),r.numTables=parse$1.getUShort(t,e+2);for(var n=-1,a=r.numTables-1;a>=0;a-=1){var o=parse$1.getUShort(t,e+4+a*8),s=parse$1.getUShort(t,e+4+a*8+2);if(o===3&&(s===0||s===1||s===10)||o===0&&(s===0||s===1||s===2||s===3||s===4)){n=parse$1.getULong(t,e+4+a*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new parse$1.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)parseCmapTableFormat12(r,l);else if(r.format===4)parseCmapTableFormat4(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function addSegment(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function addTerminatorSegment(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var a=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(a=a.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),a=a.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var o=new table.Table("cmap",a);for(o.segments=[],r=0;r<t.length;r+=1){for(var s=t.get(r),l=0;l<s.unicodes.length;l+=1)addSegment(o,s.unicodes[l],r);o.segments=o.segments.sort(function(R,A){return R.start-A.start})}addTerminatorSegment(o);var c=o.segments.length,p=0,d=[],y=[],m=[],w=[],_=[],E=[];for(r=0;r<c;r+=1){var x=o.segments[r];x.end<=65535&&x.start<=65535?(d=d.concat({name:"end_"+r,type:"USHORT",value:x.end}),y=y.concat({name:"start_"+r,type:"USHORT",value:x.start}),m=m.concat({name:"idDelta_"+r,type:"SHORT",value:x.delta}),w=w.concat({name:"idRangeOffset_"+r,type:"USHORT",value:x.offset}),x.glyphId!==void 0&&(_=_.concat({name:"glyph_"+r,type:"USHORT",value:x.glyphId}))):p+=1,!e&&x.glyphIndex!==void 0&&(E=E.concat({name:"cmap12Start_"+r,type:"ULONG",value:x.start}),E=E.concat({name:"cmap12End_"+r,type:"ULONG",value:x.end}),E=E.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:x.glyphIndex}))}if(o.segCountX2=(c-p)*2,o.searchRange=Math.pow(2,Math.floor(Math.log(c-p)/Math.log(2)))*2,o.entrySelector=Math.log(o.searchRange/2)/Math.log(2),o.rangeShift=o.segCountX2-o.searchRange,o.fields=o.fields.concat(d),o.fields.push({name:"reservedPad",type:"USHORT",value:0}),o.fields=o.fields.concat(y),o.fields=o.fields.concat(m),o.fields=o.fields.concat(w),o.fields=o.fields.concat(_),o.cmap4Length=14+d.length*2+2+y.length*2+m.length*2+w.length*2+_.length*2,!e){var k=16+E.length*4;o.cmap12Offset=12+2*2+4+o.cmap4Length,o.fields=o.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:k},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:E.length/3}]),o.fields=o.fields.concat(E)}return o}var cmap={parse:parseCmapTable,make:makeCmapTable},cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(t){this.font=t}DefaultEncoding.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var a=r.get(n),o=0;o<a.unicodes.length;o+=1)if(a.unicodes[o]===e)return n}return null};function CmapEncoding(t){this.cmap=t}CmapEncoding.prototype.charToGlyphIndex=function(t){return this.cmap.glyphIndexMap[t.codePointAt(0)]||0};function CffEncoding(t,e){this.encoding=t,this.charset=e}CffEncoding.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function GlyphNames(t){switch(t.version){case 1:this.names=standardNames.slice();break;case 2:this.names=new Array(t.numberOfGlyphs);for(var e=0;e<t.numberOfGlyphs;e++)t.glyphNameIndex[e]<standardNames.length?this.names[e]=standardNames[t.glyphNameIndex[e]]:this.names[e]=t.names[t.glyphNameIndex[e]-standardNames.length];break;case 2.5:this.names=new Array(t.numberOfGlyphs);for(var r=0;r<t.numberOfGlyphs;r++)this.names[r]=standardNames[r+t.glyphNameIndex[r]];break;case 3:this.names=[];break;default:this.names=[];break}}GlyphNames.prototype.nameToGlyphIndex=function(t){return this.names.indexOf(t)},GlyphNames.prototype.glyphIndexToName=function(t){return this.names[t]};function addGlyphNamesAll(t){for(var e,r=t.tables.cmap.glyphIndexMap,n=Object.keys(r),a=0;a<n.length;a+=1){var o=n[a],s=r[o];e=t.glyphs.get(s),e.addUnicode(parseInt(o))}for(var l=0;l<t.glyphs.length;l+=1)e=t.glyphs.get(l),t.cffEncoding?t.isCIDFont?e.name="gid"+l:e.name=t.cffEncoding.charset[l]:t.glyphNames.names&&(e.name=t.glyphNames.glyphIndexToName(l))}function addGlyphNamesToUnicodeMap(t){t._IndexToUnicodeMap={};for(var e=t.tables.cmap.glyphIndexMap,r=Object.keys(e),n=0;n<r.length;n+=1){var a=r[n],o=e[a];t._IndexToUnicodeMap[o]===void 0?t._IndexToUnicodeMap[o]={unicodes:[parseInt(a)]}:t._IndexToUnicodeMap[o].unicodes.push(parseInt(a))}}function addGlyphNames(t,e){e.lowMemory?addGlyphNamesToUnicodeMap(t):addGlyphNamesAll(t)}function line(t,e,r,n,a){t.beginPath(),t.moveTo(e,r),t.lineTo(n,a),t.stroke()}var draw$1={line};function getPathDefinition(t,e){var r=e||new Path;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function Glyph(t){this.bindConstructorValues(t)}Glyph.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",getPathDefinition(this,t.path))},Glyph.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)},Glyph.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Glyph.prototype.getPath=function(t,e,r,n,a){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var o,s;n||(n={});var l=n.xScale,c=n.yScale;if(n.hinting&&a&&a.hinting&&(s=this.path&&a.hinting.exec(this,r)),s)o=a.hinting.getCommands(s),t=Math.round(t),e=Math.round(e),l=c=1;else{o=this.path.commands;var p=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=p),c===void 0&&(c=p)}for(var d=new Path,y=0;y<o.length;y+=1){var m=o[y];m.type==="M"?d.moveTo(t+m.x*l,e+-m.y*c):m.type==="L"?d.lineTo(t+m.x*l,e+-m.y*c):m.type==="Q"?d.quadraticCurveTo(t+m.x1*l,e+-m.y1*c,t+m.x*l,e+-m.y*c):m.type==="C"?d.curveTo(t+m.x1*l,e+-m.y1*c,t+m.x2*l,e+-m.y2*c,t+m.x*l,e+-m.y*c):m.type==="Z"&&d.closePath()}return d},Glyph.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return check.argument(e.length===0,"There are still points left in the current contour."),t},Glyph.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var a=t[n];a.type!=="Z"&&(e.push(a.x),r.push(a.y)),(a.type==="Q"||a.type==="C")&&(e.push(a.x1),r.push(a.y1)),a.type==="C"&&(e.push(a.x2),r.push(a.y2))}var o={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(o.xMin)||(o.xMin=0),isFinite(o.xMax)||(o.xMax=this.advanceWidth),isFinite(o.yMin)||(o.yMin=0),isFinite(o.yMax)||(o.yMax=0),o.rightSideBearing=this.advanceWidth-o.leftSideBearing-(o.xMax-o.xMin),o},Glyph.prototype.draw=function(t,e,r,n,a){this.getPath(e,r,n,a).draw(t)},Glyph.prototype.drawPoints=function(t,e,r,n){function a(y,m,w,_){t.beginPath();for(var E=0;E<y.length;E+=1)t.moveTo(m+y[E].x*_,w+y[E].y*_),t.arc(m+y[E].x*_,w+y[E].y*_,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var o=1/this.path.unitsPerEm*n,s=[],l=[],c=this.path,p=0;p<c.commands.length;p+=1){var d=c.commands[p];d.x!==void 0&&s.push({x:d.x,y:-d.y}),d.x1!==void 0&&l.push({x:d.x1,y:-d.y1}),d.x2!==void 0&&l.push({x:d.x2,y:-d.y2})}t.fillStyle="blue",a(s,e,r,o),t.fillStyle="red",a(l,e,r,o)},Glyph.prototype.drawMetrics=function(t,e,r,n){var a;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,a=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",draw$1.line(t,e,-1e4,e,1e4),draw$1.line(t,-1e4,r,1e4,r);var o=this.xMin||0,s=this.yMin||0,l=this.xMax||0,c=this.yMax||0,p=this.advanceWidth||0;t.strokeStyle="blue",draw$1.line(t,e+o*a,-1e4,e+o*a,1e4),draw$1.line(t,e+l*a,-1e4,e+l*a,1e4),draw$1.line(t,-1e4,r+-s*a,1e4,r+-s*a),draw$1.line(t,-1e4,r+-c*a,1e4,r+-c*a),t.strokeStyle="green",draw$1.line(t,e+p*a,-1e4,e+p*a,1e4)};function defineDependentProperty(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function GlyphSet(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}GlyphSet.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},GlyphSet.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function glyphLoader(t,e){return new Glyph({index:e,font:t})}function ttfGlyphLoader(t,e,r,n,a,o){return function(){var s=new Glyph({index:e,font:t});return s.path=function(){r(s,n,a);var l=o(t.glyphs,s);return l.unitsPerEm=t.unitsPerEm,l},defineDependentProperty(s,"xMin","_xMin"),defineDependentProperty(s,"xMax","_xMax"),defineDependentProperty(s,"yMin","_yMin"),defineDependentProperty(s,"yMax","_yMax"),s}}function cffGlyphLoader(t,e,r,n){return function(){var a=new Glyph({index:e,font:t});return a.path=function(){var o=r(t,a,n);return o.unitsPerEm=t.unitsPerEm,o},a}}var glyphset={GlyphSet,glyphLoader,ttfGlyphLoader,cffGlyphLoader};function equals(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!equals(t[r],e[r]))return!1;return!0}else return!1}function calcCFFSubroutineBias(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function parseCFFIndex(t,e,r){var n=[],a=[],o=parse$1.getCard16(t,e),s,l;if(o!==0){var c=parse$1.getByte(t,e+2);s=e+(o+1)*c+2;for(var p=e+3,d=0;d<o+1;d+=1)n.push(parse$1.getOffset(t,p,c)),p+=c;l=s+n[o]}else l=e+2;for(var y=0;y<n.length-1;y+=1){var m=parse$1.getBytes(t,s+n[y],s+n[y+1]);r&&(m=r(m)),a.push(m)}return{objects:a,startOffset:e,endOffset:l}}function parseCFFIndexLowMemory(t,e){var r=[],n=parse$1.getCard16(t,e),a,o;if(n!==0){var s=parse$1.getByte(t,e+2);a=e+(n+1)*s+2;for(var l=e+3,c=0;c<n+1;c+=1)r.push(parse$1.getOffset(t,l,s)),l+=s;o=a+r[n]}else o=e+2;return{offsets:r,startOffset:e,endOffset:o}}function getCffIndexObject(t,e,r,n,a){var o=parse$1.getCard16(r,n),s=0;if(o!==0){var l=parse$1.getByte(r,n+2);s=n+(o+1)*l+2}var c=parse$1.getBytes(r,s+e[t],s+e[t+1]);return c}function parseFloatOperand(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var a=t.parseByte(),o=a>>4,s=a&15;if(o===r||(e+=n[o],s===r))break;e+=n[s]}return parseFloat(e)}function parseOperand(t,e){var r,n,a,o;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),a=t.parseByte(),o=t.parseByte(),r<<24|n<<16|a<<8|o;if(e===30)return parseFloatOperand(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function entriesToObject(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],a=t[r][1],o=void 0;if(a.length===1?o=a[0]:o=a,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=o}return e}function parseCFFDict(t,e,r){e=e!==void 0?e:0;var n=new parse$1.Parser(t,e),a=[],o=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var s=n.parseByte();s<=21?(s===12&&(s=1200+n.parseByte()),a.push([s,o]),o=[]):o.push(parseOperand(n,s))}return entriesToObject(a)}function getCFFString(t,e){return e<=390?e=cffStandardStrings[e]:e=t[e-391],e}function interpretDict(t,e,r){for(var n={},a,o=0;o<e.length;o+=1){var s=e[o];if(Array.isArray(s.type)){var l=[];l.length=s.type.length;for(var c=0;c<s.type.length;c++)a=t[s.op]!==void 0?t[s.op][c]:void 0,a===void 0&&(a=s.value!==void 0&&s.value[c]!==void 0?s.value[c]:null),s.type[c]==="SID"&&(a=getCFFString(r,a)),l[c]=a;n[s.name]=l}else a=t[s.op],a===void 0&&(a=s.value!==void 0?s.value:null),s.type==="SID"&&(a=getCFFString(r,a)),n[s.name]=a}return n}function parseCFFHeader(t,e){var r={};return r.formatMajor=parse$1.getCard8(t,e),r.formatMinor=parse$1.getCard8(t,e+1),r.size=parse$1.getCard8(t,e+2),r.offsetSize=parse$1.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(t,e){var r=parseCFFDict(t,0,t.byteLength);return interpretDict(r,TOP_DICT_META,e)}function parseCFFPrivateDict(t,e,r,n){var a=parseCFFDict(t,e,r);return interpretDict(a,PRIVATE_DICT_META,n)}function gatherCFFTopDicts(t,e,r,n){for(var a=[],o=0;o<r.length;o+=1){var s=new DataView(new Uint8Array(r[o]).buffer),l=parseCFFTopDict(s,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var c=l.private[0],p=l.private[1];if(c!==0&&p!==0){var d=parseCFFPrivateDict(t,p+e,c,n);if(l._defaultWidthX=d.defaultWidthX,l._nominalWidthX=d.nominalWidthX,d.subrs!==0){var y=p+d.subrs,m=parseCFFIndex(t,y+e);l._subrs=m.objects,l._subrsBias=calcCFFSubroutineBias(l._subrs)}l._privateDict=d}a.push(l)}return a}function parseCFFCharset(t,e,r,n){var a,o,s=new parse$1.Parser(t,e);r-=1;var l=[".notdef"],c=s.parseCard8();if(c===0)for(var p=0;p<r;p+=1)a=s.parseSID(),l.push(getCFFString(n,a));else if(c===1)for(;l.length<=r;){a=s.parseSID(),o=s.parseCard8();for(var d=0;d<=o;d+=1)l.push(getCFFString(n,a)),a+=1}else if(c===2)for(;l.length<=r;){a=s.parseSID(),o=s.parseCard16();for(var y=0;y<=o;y+=1)l.push(getCFFString(n,a)),a+=1}else throw new Error("Unknown charset format "+c);return l}function parseCFFEncoding(t,e,r){var n,a={},o=new parse$1.Parser(t,e),s=o.parseCard8();if(s===0)for(var l=o.parseCard8(),c=0;c<l;c+=1)n=o.parseCard8(),a[n]=c;else if(s===1){var p=o.parseCard8();n=1;for(var d=0;d<p;d+=1)for(var y=o.parseCard8(),m=o.parseCard8(),w=y;w<=y+m;w+=1)a[w]=n,n+=1}else throw new Error("Unknown encoding format "+s);return new CffEncoding(a,r)}function parseCFFCharstring(t,e,r){var n,a,o,s,l=new Path,c=[],p=0,d=!1,y=!1,m=0,w=0,_,E,x,k;if(t.isCIDFont){var R=t.tables.cff.topDict._fdSelect[e.index],A=t.tables.cff.topDict._fdArray[R];_=A._subrs,E=A._subrsBias,x=A._defaultWidthX,k=A._nominalWidthX}else _=t.tables.cff.topDict._subrs,E=t.tables.cff.topDict._subrsBias,x=t.tables.cff.topDict._defaultWidthX,k=t.tables.cff.topDict._nominalWidthX;var G=x;function L(U,W){y&&l.closePath(),l.moveTo(U,W),y=!0}function q(){var U;U=c.length%2!==0,U&&!d&&(G=c.shift()+k),p+=c.length>>1,c.length=0,d=!0}function V(U){for(var W,oe,j,fe,ie,X,te,H,$,re,pe,ge,ae=0;ae<U.length;){var ve=U[ae];switch(ae+=1,ve){case 1:q();break;case 3:q();break;case 4:c.length>1&&!d&&(G=c.shift()+k,d=!0),w+=c.pop(),L(m,w);break;case 5:for(;c.length>0;)m+=c.shift(),w+=c.shift(),l.lineTo(m,w);break;case 6:for(;c.length>0&&(m+=c.shift(),l.lineTo(m,w),c.length!==0);)w+=c.shift(),l.lineTo(m,w);break;case 7:for(;c.length>0&&(w+=c.shift(),l.lineTo(m,w),c.length!==0);)m+=c.shift(),l.lineTo(m,w);break;case 8:for(;c.length>0;)n=m+c.shift(),a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),m=o+c.shift(),w=s+c.shift(),l.curveTo(n,a,o,s,m,w);break;case 10:ie=c.pop()+E,X=_[ie],X&&V(X);break;case 11:return;case 12:switch(ve=U[ae],ae+=1,ve){case 35:n=m+c.shift(),a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),te=o+c.shift(),H=s+c.shift(),$=te+c.shift(),re=H+c.shift(),pe=$+c.shift(),ge=re+c.shift(),m=pe+c.shift(),w=ge+c.shift(),c.shift(),l.curveTo(n,a,o,s,te,H),l.curveTo($,re,pe,ge,m,w);break;case 34:n=m+c.shift(),a=w,o=n+c.shift(),s=a+c.shift(),te=o+c.shift(),H=s,$=te+c.shift(),re=s,pe=$+c.shift(),ge=w,m=pe+c.shift(),l.curveTo(n,a,o,s,te,H),l.curveTo($,re,pe,ge,m,w);break;case 36:n=m+c.shift(),a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),te=o+c.shift(),H=s,$=te+c.shift(),re=s,pe=$+c.shift(),ge=re+c.shift(),m=pe+c.shift(),l.curveTo(n,a,o,s,te,H),l.curveTo($,re,pe,ge,m,w);break;case 37:n=m+c.shift(),a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),te=o+c.shift(),H=s+c.shift(),$=te+c.shift(),re=H+c.shift(),pe=$+c.shift(),ge=re+c.shift(),Math.abs(pe-m)>Math.abs(ge-w)?m=pe+c.shift():w=ge+c.shift(),l.curveTo(n,a,o,s,te,H),l.curveTo($,re,pe,ge,m,w);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+ve),c.length=0}break;case 14:c.length>0&&!d&&(G=c.shift()+k,d=!0),y&&(l.closePath(),y=!1);break;case 18:q();break;case 19:case 20:q(),ae+=p+7>>3;break;case 21:c.length>2&&!d&&(G=c.shift()+k,d=!0),w+=c.pop(),m+=c.pop(),L(m,w);break;case 22:c.length>1&&!d&&(G=c.shift()+k,d=!0),m+=c.pop(),L(m,w);break;case 23:q();break;case 24:for(;c.length>2;)n=m+c.shift(),a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),m=o+c.shift(),w=s+c.shift(),l.curveTo(n,a,o,s,m,w);m+=c.shift(),w+=c.shift(),l.lineTo(m,w);break;case 25:for(;c.length>6;)m+=c.shift(),w+=c.shift(),l.lineTo(m,w);n=m+c.shift(),a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),m=o+c.shift(),w=s+c.shift(),l.curveTo(n,a,o,s,m,w);break;case 26:for(c.length%2&&(m+=c.shift());c.length>0;)n=m,a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),m=o,w=s+c.shift(),l.curveTo(n,a,o,s,m,w);break;case 27:for(c.length%2&&(w+=c.shift());c.length>0;)n=m+c.shift(),a=w,o=n+c.shift(),s=a+c.shift(),m=o+c.shift(),w=s,l.curveTo(n,a,o,s,m,w);break;case 28:W=U[ae],oe=U[ae+1],c.push((W<<24|oe<<16)>>16),ae+=2;break;case 29:ie=c.pop()+t.gsubrsBias,X=t.gsubrs[ie],X&&V(X);break;case 30:for(;c.length>0&&(n=m,a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),m=o+c.shift(),w=s+(c.length===1?c.shift():0),l.curveTo(n,a,o,s,m,w),c.length!==0);)n=m+c.shift(),a=w,o=n+c.shift(),s=a+c.shift(),w=s+c.shift(),m=o+(c.length===1?c.shift():0),l.curveTo(n,a,o,s,m,w);break;case 31:for(;c.length>0&&(n=m+c.shift(),a=w,o=n+c.shift(),s=a+c.shift(),w=s+c.shift(),m=o+(c.length===1?c.shift():0),l.curveTo(n,a,o,s,m,w),c.length!==0);)n=m,a=w+c.shift(),o=n+c.shift(),s=a+c.shift(),m=o+c.shift(),w=s+(c.length===1?c.shift():0),l.curveTo(n,a,o,s,m,w);break;default:ve<32?console.log("Glyph "+e.index+": unknown operator "+ve):ve<247?c.push(ve-139):ve<251?(W=U[ae],ae+=1,c.push((ve-247)*256+W+108)):ve<255?(W=U[ae],ae+=1,c.push(-(ve-251)*256-W-108)):(W=U[ae],oe=U[ae+1],j=U[ae+2],fe=U[ae+3],ae+=4,c.push((W<<24|oe<<16|j<<8|fe)/65536))}}}return V(r),e.advanceWidth=G,l}function parseCFFFDSelect(t,e,r,n){var a=[],o,s=new parse$1.Parser(t,e),l=s.parseCard8();if(l===0)for(var c=0;c<r;c++){if(o=s.parseCard8(),o>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+n+")");a.push(o)}else if(l===3){var p=s.parseCard16(),d=s.parseCard16();if(d!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+d);for(var y,m=0;m<p;m++){if(o=s.parseCard8(),y=s.parseCard16(),o>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+n+")");if(y>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+y);for(;d<y;d++)a.push(o);d=y}if(y!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+y)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return a}function parseCFFTable(t,e,r,n){r.tables.cff={};var a=parseCFFHeader(t,e),o=parseCFFIndex(t,a.endOffset,parse$1.bytesToString),s=parseCFFIndex(t,o.endOffset),l=parseCFFIndex(t,s.endOffset,parse$1.bytesToString),c=parseCFFIndex(t,l.endOffset);r.gsubrs=c.objects,r.gsubrsBias=calcCFFSubroutineBias(r.gsubrs);var p=gatherCFFTopDicts(t,e,s.objects,l.objects);if(p.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+p.length);var d=p[0];if(r.tables.cff.topDict=d,d._privateDict&&(r.defaultWidthX=d._privateDict.defaultWidthX,r.nominalWidthX=d._privateDict.nominalWidthX),d.ros[0]!==void 0&&d.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var y=d.fdArray,m=d.fdSelect;if(y===0||m===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");y+=e;var w=parseCFFIndex(t,y),_=gatherCFFTopDicts(t,e,w.objects,l.objects);d._fdArray=_,m+=e,d._fdSelect=parseCFFFDSelect(t,m,r.numGlyphs,_.length)}var E=e+d.private[1],x=parseCFFPrivateDict(t,E,d.private[0],l.objects);if(r.defaultWidthX=x.defaultWidthX,r.nominalWidthX=x.nominalWidthX,x.subrs!==0){var k=E+x.subrs,R=parseCFFIndex(t,k);r.subrs=R.objects,r.subrsBias=calcCFFSubroutineBias(r.subrs)}else r.subrs=[],r.subrsBias=0;var A;n.lowMemory?(A=parseCFFIndexLowMemory(t,e+d.charStrings),r.nGlyphs=A.offsets.length):(A=parseCFFIndex(t,e+d.charStrings),r.nGlyphs=A.objects.length);var G=parseCFFCharset(t,e+d.charset,r.nGlyphs,l.objects);if(d.encoding===0?r.cffEncoding=new CffEncoding(cffStandardEncoding,G):d.encoding===1?r.cffEncoding=new CffEncoding(cffExpertEncoding,G):r.cffEncoding=parseCFFEncoding(t,e+d.encoding,G),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new glyphset.GlyphSet(r),n.lowMemory)r._push=function(V){var U=getCffIndexObject(V,A.offsets,t,e+d.charStrings);r.glyphs.push(V,glyphset.cffGlyphLoader(r,V,parseCFFCharstring,U))};else for(var L=0;L<r.nGlyphs;L+=1){var q=A.objects[L];r.glyphs.push(L,glyphset.cffGlyphLoader(r,L,parseCFFCharstring,q))}}function encodeString(t,e){var r,n=cffStandardStrings.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+cffStandardStrings.length:(r=cffStandardStrings.length+e.length,e.push(t)),r}function makeHeader(){return new table.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(t){var e=new table.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function makeDict(t,e,r){for(var n={},a=0;a<t.length;a+=1){var o=t[a],s=e[o.name];s!==void 0&&!equals(s,o.value)&&(o.type==="SID"&&(s=encodeString(s,r)),n[o.op]={name:o.name,type:o.type,value:s})}return n}function makeTopDict(t,e){var r=new table.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=makeDict(TOP_DICT_META,t,e),r}function makeTopDictIndex(t){var e=new table.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function makeStringIndex(t){var e=new table.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function makeGlobalSubrIndex(){return new table.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(t,e){for(var r=new table.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var a=t[n],o=encodeString(a,e);r.fields.push({name:"glyph_"+n,type:"SID",value:o})}return r}function glyphToOps(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,a=0,o=0;o<r.commands.length;o+=1){var s=void 0,l=void 0,c=r.commands[o];if(c.type==="Q"){var p=.3333333333333333,d=2/3;c={type:"C",x:c.x,y:c.y,x1:Math.round(p*n+d*c.x1),y1:Math.round(p*a+d*c.y1),x2:Math.round(p*c.x+d*c.x1),y2:Math.round(p*c.y+d*c.y1)}}if(c.type==="M")s=Math.round(c.x-n),l=Math.round(c.y-a),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),a=Math.round(c.y);else if(c.type==="L")s=Math.round(c.x-n),l=Math.round(c.y-a),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),a=Math.round(c.y);else if(c.type==="C"){var y=Math.round(c.x1-n),m=Math.round(c.y1-a),w=Math.round(c.x2-c.x1),_=Math.round(c.y2-c.y1);s=Math.round(c.x-c.x2),l=Math.round(c.y-c.y2),e.push({name:"dx1",type:"NUMBER",value:y}),e.push({name:"dy1",type:"NUMBER",value:m}),e.push({name:"dx2",type:"NUMBER",value:w}),e.push({name:"dy2",type:"NUMBER",value:_}),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),a=Math.round(c.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function makeCharStringsIndex(t){for(var e=new table.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),a=glyphToOps(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:a})}return e}function makePrivateDict(t,e){var r=new table.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=makeDict(PRIVATE_DICT_META,t,e),r}function makeCFFTable(t,e){for(var r=new table.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,a={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o={},s=[],l,c=1;c<t.length;c+=1)l=t.get(c),s.push(l.name);var p=[];r.header=makeHeader(),r.nameIndex=makeNameIndex([e.postScriptName]);var d=makeTopDict(a,p);r.topDictIndex=makeTopDictIndex(d),r.globalSubrIndex=makeGlobalSubrIndex(),r.charsets=makeCharsets(s,p),r.charStringsIndex=makeCharStringsIndex(t),r.privateDict=makePrivateDict(o,p),r.stringIndex=makeStringIndex(p);var y=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return a.charset=y,a.encoding=0,a.charStrings=a.charset+r.charsets.sizeOf(),a.private[1]=a.charStrings+r.charStringsIndex.sizeOf(),d=makeTopDict(a,p),r.topDictIndex=makeTopDictIndex(d),r}var cff={parse:parseCFFTable,make:makeCFFTable};function parseHeadTable(t,e){var r={},n=new parse$1.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),check.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function makeHeadTable(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var head={parse:parseHeadTable,make:makeHeadTable};function parseHheaTable(t,e){var r={},n=new parse$1.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function makeHheaTable(t){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var hhea={parse:parseHheaTable,make:makeHheaTable};function parseHmtxTableAll(t,e,r,n,a){for(var o,s,l=new parse$1.Parser(t,e),c=0;c<n;c+=1){c<r&&(o=l.parseUShort(),s=l.parseShort());var p=a.get(c);p.advanceWidth=o,p.leftSideBearing=s}}function parseHmtxTableOnLowMemory(t,e,r,n,a){t._hmtxTableData={};for(var o,s,l=new parse$1.Parser(e,r),c=0;c<a;c+=1)c<n&&(o=l.parseUShort(),s=l.parseShort()),t._hmtxTableData[c]={advanceWidth:o,leftSideBearing:s}}function parseHmtxTable(t,e,r,n,a,o,s){s.lowMemory?parseHmtxTableOnLowMemory(t,e,r,n,a):parseHmtxTableAll(e,r,n,a,o)}function makeHmtxTable(t){for(var e=new table.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),a=n.advanceWidth||0,o=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:a}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:o})}return e}var hmtx={parse:parseHmtxTable,make:makeHmtxTable};function makeLtagTable(t){for(var e=new table.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,a=0;a<t.length;++a){var o=r.indexOf(t[a]);o<0&&(o=r.length,r+=t[a]),e.fields.push({name:"offset "+a,type:"USHORT",value:n+o}),e.fields.push({name:"length "+a,type:"USHORT",value:t[a].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function parseLtagTable(t,e){var r=new parse$1.Parser(t,e),n=r.parseULong();check.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var a=r.parseULong(),o=[],s=0;s<a;s++){for(var l="",c=e+r.parseUShort(),p=r.parseUShort(),d=c;d<c+p;++d)l+=String.fromCharCode(t.getInt8(d));o.push(l)}return o}var ltag={make:makeLtagTable,parse:parseLtagTable};function parseMaxpTable(t,e){var r={},n=new parse$1.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function makeMaxpTable(t){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var maxp={parse:parseMaxpTable,make:makeMaxpTable},nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],macLanguages={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},macLanguageToScript={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},windowsLanguages={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function getLanguageCode(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return macLanguages[e];case 3:return windowsLanguages[e]}}var utf16="utf-16",macScriptEncodings={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},macLanguageEncodings={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function getEncoding(t,e,r){switch(t){case 0:return utf16;case 1:return macLanguageEncodings[r]||macScriptEncodings[e];case 3:if(e===1||e===10)return utf16;break}}function parseNameTable(t,e,r){for(var n={},a=new parse$1.Parser(t,e),o=a.parseUShort(),s=a.parseUShort(),l=a.offset+a.parseUShort(),c=0;c<s;c++){var p=a.parseUShort(),d=a.parseUShort(),y=a.parseUShort(),m=a.parseUShort(),w=nameTableNames[m]||m,_=a.parseUShort(),E=a.parseUShort(),x=getLanguageCode(p,y,r),k=getEncoding(p,d,y);if(k!==void 0&&x!==void 0){var R=void 0;if(k===utf16?R=decode.UTF16(t,l+E,_):R=decode.MACSTRING(t,l+E,_,k),R){var A=n[w];A===void 0&&(A=n[w]={}),A[x]=R}}}return o===1&&a.parseUShort(),n}function reverseDict(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function makeNameRecord(t,e,r,n,a,o){return new table.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:a},{name:"offset",type:"USHORT",value:o}])}function findSubArray(t,e){var r=t.length,n=e.length-r+1;e:for(var a=0;a<n;a++)for(;a<n;a++){for(var o=0;o<r;o++)if(e[a+o]!==t[o])continue e;return a}return-1}function addStringToPool(t,e){var r=findSubArray(t,e);if(r<0){r=e.length;for(var n=0,a=t.length;n<a;++n)e.push(t[n])}return r}function makeNameTable(t,e){var r,n=[],a={},o=reverseDict(nameTableNames);for(var s in t){var l=o[s];if(l===void 0&&(l=s),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');a[r]=t[s],n.push(r)}for(var c=reverseDict(macLanguages),p=reverseDict(windowsLanguages),d=[],y=[],m=0;m<n.length;m++){r=n[m];var w=a[r];for(var _ in w){var E=w[_],x=1,k=c[_],R=macLanguageToScript[k],A=getEncoding(x,R,k),G=encode.MACSTRING(E,A);G===void 0&&(x=0,k=e.indexOf(_),k<0&&(k=e.length,e.push(_)),R=4,G=encode.UTF16(E));var L=addStringToPool(G,y);d.push(makeNameRecord(x,R,k,r,G.length,L));var q=p[_];if(q!==void 0){var V=encode.UTF16(E),U=addStringToPool(V,y);d.push(makeNameRecord(3,1,q,r,V.length,U))}}}d.sort(function(j,fe){return j.platformID-fe.platformID||j.encodingID-fe.encodingID||j.languageID-fe.languageID||j.nameID-fe.nameID});for(var W=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:d.length},{name:"stringOffset",type:"USHORT",value:6+d.length*12}]),oe=0;oe<d.length;oe++)W.fields.push({name:"record_"+oe,type:"RECORD",value:d[oe]});return W.fields.push({name:"strings",type:"LITERAL",value:y}),W}var _name={parse:parseNameTable,make:makeNameTable},unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(t){for(var e=0;e<unicodeRanges.length;e+=1){var r=unicodeRanges[e];if(t>=r.begin&&t<r.end)return e}return-1}function parseOS2Table(t,e){var r={},n=new parse$1.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var a=0;a<10;a++)r.panose[a]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function makeOS2Table(t){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var os2={parse:parseOS2Table,make:makeOS2Table,unicodeRanges,getUnicodeRange};function parsePostTable(t,e){var r={},n=new parse$1.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=standardNames.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var a=0;a<r.numberOfGlyphs;a++)r.glyphNameIndex[a]=n.parseUShort();r.names=[];for(var o=0;o<r.numberOfGlyphs;o++)if(r.glyphNameIndex[o]>=standardNames.length){var s=n.parseChar();r.names.push(n.parseString(s))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var post={parse:parsePostTable,make:makePostTable},subtableParsers=new Array(9);subtableParsers[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),substitute:this.parseOffset16List()};check.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},subtableParsers[2]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),sequences:this.parseListOfLists()}},subtableParsers[3]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),alternateSets:this.parseListOfLists()}},subtableParsers[4]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var lookupRecordDesc={sequenceIndex:Parser.uShort,lookupListIndex:Parser.uShort};subtableParsers[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(Parser.coverage),ruleSets:this.parseListOfLists(function(){var o=this.parseUShort(),s=this.parseUShort();return{input:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(s,lookupRecordDesc)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(Parser.coverage),classDef:this.parsePointer(Parser.classDef),classSets:this.parseListOfLists(function(){var o=this.parseUShort(),s=this.parseUShort();return{classes:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(s,lookupRecordDesc)}})};if(r===3){var n=this.parseUShort(),a=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(a,lookupRecordDesc)}}check.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},subtableParsers[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),backtrackClassDef:this.parsePointer(Parser.classDef),inputClassDef:this.parsePointer(Parser.classDef),lookaheadClassDef:this.parsePointer(Parser.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),inputCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(lookupRecordDesc)};check.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},subtableParsers[7]=function(){var e=this.parseUShort();check.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new Parser(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:subtableParsers[r].call(n)}},subtableParsers[8]=function(){var e=this.parseUShort();return check.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Parser.coverage),backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),substitutes:this.parseUShortList()}};function parseGsubTable(t,e){e=e||0;var r=new Parser(t,e),n=r.parseVersion(1);return check.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers),variations:r.parseFeatureVariationsList()}}var subtableMakers=new Array(9);subtableMakers[1]=function(e){return e.substFormat===1?new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.ushortList("substitute",e.substitute)))},subtableMakers[2]=function(e){return check.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("seqSet",e.sequences,function(r){return new table.Table("sequenceSetTable",table.ushortList("sequence",r))})))},subtableMakers[3]=function(e){return check.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("altSet",e.alternateSets,function(r){return new table.Table("alternateSetTable",table.ushortList("alternate",r))})))},subtableMakers[4]=function(e){return check.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("ligSet",e.ligatureSets,function(r){return new table.Table("ligatureSetTable",table.tableList("ligature",r,function(n){return new table.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(table.ushortList("component",n.components,n.components.length+1)))}))})))},subtableMakers[6]=function(e){if(e.substFormat===1){var r=new table.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new table.Coverage(e.coverage)}].concat(table.tableList("chainRuleSet",e.chainRuleSets,function(o){return new table.Table("chainRuleSetTable",table.tableList("chainRule",o,function(s){var l=table.ushortList("backtrackGlyph",s.backtrack,s.backtrack.length).concat(table.ushortList("inputGlyph",s.input,s.input.length+1)).concat(table.ushortList("lookaheadGlyph",s.lookahead,s.lookahead.length)).concat(table.ushortList("substitution",[],s.lookupRecords.length));return s.lookupRecords.forEach(function(c,p){l=l.concat({name:"sequenceIndex"+p,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+p,type:"USHORT",value:c.lookupListIndex})}),new table.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)check.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(o,s){n.push({name:"backtrackCoverage"+s,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(o,s){n.push({name:"inputCoverage"+s,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(o,s){n.push({name:"lookaheadCoverage"+s,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(o,s){n=n.concat({name:"sequenceIndex"+s,type:"USHORT",value:o.sequenceIndex}).concat({name:"lookupListIndex"+s,type:"USHORT",value:o.lookupListIndex})});var a=new table.Table("chainContextTable",n);return a}check.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function makeGsubTable(t){return new table.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(t.lookups,subtableMakers)}])}var gsub={parse:parseGsubTable,make:makeGsubTable};function parseMetaTable(t,e){var r=new parse$1.Parser(t,e),n=r.parseULong();check.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var a=r.parseULong(),o={},s=0;s<a;s++){var l=r.parseTag(),c=r.parseULong(),p=r.parseULong(),d=decode.UTF8(t,e+c,p);o[l]=d}return o}function makeMetaTable(t){var e=Object.keys(t).length,r="",n=16+e*12,a=new table.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var o in t){var s=r.length;r+=t[o],a.fields.push({name:"tag "+o,type:"TAG",value:o}),a.fields.push({name:"offset "+o,type:"ULONG",value:n+s}),a.fields.push({name:"length "+o,type:"ULONG",value:t[o].length})}return a.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),a}var meta={parse:parseMetaTable,make:makeMetaTable};function log2(t){return Math.log(t)/Math.log(2)|0}function computeCheckSum(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function makeTableRecord(t,e,r,n){return new table.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function makeSfntTable(t){var e=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,log2(e.numTables));e.searchRange=16*r,e.entrySelector=log2(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],a=[],o=e.sizeOf()+makeTableRecord().sizeOf()*e.numTables;o%4!==0;)o+=1,a.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<t.length;s+=1){var l=t[s];check.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var c=l.sizeOf(),p=makeTableRecord(l.tableName,computeCheckSum(l.encode()),o,c);for(n.push({name:p.tag+" Table Record",type:"RECORD",value:p}),a.push({name:l.tableName+" table",type:"RECORD",value:l}),o+=c,check.argument(!isNaN(o),"Something went wrong calculating the offset.");o%4!==0;)o+=1,a.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(d,y){return d.value.tag>y.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(a),e}function metricsForChar(t,e,r){for(var n=0;n<e.length;n+=1){var a=t.charToGlyphIndex(e[n]);if(a>0){var o=t.glyphs.get(a);return o.getMetrics()}}return r}function average(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function fontToSfntTable(t){for(var e=[],r=[],n=[],a=[],o=[],s=[],l=[],c,p=0,d=0,y=0,m=0,w=0,_=0;_<t.glyphs.length;_+=1){var E=t.glyphs.get(_),x=E.unicode|0;if(isNaN(E.advanceWidth))throw new Error("Glyph "+E.name+" ("+_+"): advanceWidth is not a number.");(c>x||c===void 0)&&x>0&&(c=x),p<x&&(p=x);var k=os2.getUnicodeRange(x);if(k<32)d|=1<<k;else if(k<64)y|=1<<k-32;else if(k<96)m|=1<<k-64;else if(k<123)w|=1<<k-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(E.name!==".notdef"){var R=E.getMetrics();e.push(R.xMin),r.push(R.yMin),n.push(R.xMax),a.push(R.yMax),s.push(R.leftSideBearing),l.push(R.rightSideBearing),o.push(E.advanceWidth)}}var A={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,a),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:average(o),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,l)};A.ascender=t.ascender,A.descender=t.descender;var G=head.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:A.xMin,yMin:A.yMin,xMax:A.xMax,yMax:A.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),L=hhea.make({ascender:A.ascender,descender:A.descender,advanceWidthMax:A.advanceWidthMax,minLeftSideBearing:A.minLeftSideBearing,minRightSideBearing:A.minRightSideBearing,xMaxExtent:A.maxLeftSideBearing+(A.xMax-A.xMin),numberOfHMetrics:t.glyphs.length}),q=maxp.make(t.glyphs.length),V=os2.make(Object.assign({xAvgCharWidth:Math.round(A.advanceWidthAvg),usFirstCharIndex:c,usLastCharIndex:p,ulUnicodeRange1:d,ulUnicodeRange2:y,ulUnicodeRange3:m,ulUnicodeRange4:w,sTypoAscender:A.ascender,sTypoDescender:A.descender,sTypoLineGap:0,usWinAscent:A.yMax,usWinDescent:Math.abs(A.yMin),ulCodePageRange1:1,sxHeight:metricsForChar(t,"xyvw",{yMax:Math.round(A.ascender/2)}).yMax,sCapHeight:metricsForChar(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",A).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),U=hmtx.make(t.glyphs),W=cmap.make(t.glyphs),oe=t.getEnglishName("fontFamily"),j=t.getEnglishName("fontSubfamily"),fe=oe+" "+j,ie=t.getEnglishName("postScriptName");ie||(ie=oe.replace(/\s/g,"")+"-"+j);var X={};for(var te in t.names)X[te]=t.names[te];X.uniqueID||(X.uniqueID={en:t.getEnglishName("manufacturer")+":"+fe}),X.postScriptName||(X.postScriptName={en:ie}),X.preferredFamily||(X.preferredFamily=t.names.fontFamily),X.preferredSubfamily||(X.preferredSubfamily=t.names.fontSubfamily);var H=[],$=_name.make(X,H),re=H.length>0?ltag.make(H):void 0,pe=post.make(),ge=cff.make(t.glyphs,{version:t.getEnglishName("version"),fullName:fe,familyName:oe,weightName:j,postScriptName:ie,unitsPerEm:t.unitsPerEm,fontBBox:[0,A.yMin,A.ascender,A.advanceWidthMax]}),ae=t.metas&&Object.keys(t.metas).length>0?meta.make(t.metas):void 0,ve=[G,L,q,V,$,W,pe,ge,U];re&&ve.push(re),t.tables.gsub&&ve.push(gsub.make(t.tables.gsub)),ae&&ve.push(ae);for(var Ye=makeSfntTable(ve),_t=Ye.encode(),rt=computeCheckSum(_t),Xe=Ye.fields,nt=!1,Ce=0;Ce<Xe.length;Ce+=1)if(Xe[Ce].name==="head table"){Xe[Ce].value.checkSumAdjustment=2981146554-rt,nt=!0;break}if(!nt)throw new Error("Could not find head table with checkSum to adjust.");return Ye}var sfnt={make:makeSfntTable,fontToTable:fontToSfntTable,computeCheckSum};function searchTag(t,e){for(var r=0,n=t.length-1;r<=n;){var a=r+n>>>1,o=t[a].tag;if(o===e)return a;o<e?r=a+1:n=a-1}return-r-1}function binSearch(t,e){for(var r=0,n=t.length-1;r<=n;){var a=r+n>>>1,o=t[a];if(o===e)return a;o<e?r=a+1:n=a-1}return-r-1}function searchRange(t,e){for(var r,n=0,a=t.length-1;n<=a;){var o=n+a>>>1;r=t[o];var s=r.start;if(s===e)return r;s<e?n=o+1:a=o-1}if(n>0)return r=t[n-1],e>r.end?0:r}function Layout(t,e){this.font=t,this.tableName=e}Layout.prototype={searchTag,binSearch,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,a=searchTag(r.scripts,t);if(a>=0)return n[a].script;if(e){var o={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-a,0,o),o.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var a=searchTag(n.langSysRecords,e);if(a>=0)return n.langSysRecords[a].langSys;if(r){var o={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-a,0,o),o.langSys}}},getFeatureTable:function(t,e,r,n){var a=this.getLangSysTable(t,e,n);if(a){for(var o,s=a.featureIndexes,l=this.font.tables[this.tableName].features,c=0;c<s.length;c++)if(o=l[s[c]],o.tag===r)return o.feature;if(n){var p=l.length;return check.assert(p===0||r>=l[p-1].tag,"Features must be added in alphabetical order."),o={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(o),s.push(p),o.feature}}},getLookupTables:function(t,e,r,n,a){var o=this.getFeatureTable(t,e,r,a),s=[];if(o){for(var l,c=o.lookupListIndexes,p=this.font.tables[this.tableName].lookups,d=0;d<c.length;d++)l=p[c[d]],l.lookupType===n&&s.push(l);if(s.length===0&&a){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var y=p.length;return p.push(l),c.push(y),[l]}}return s},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=searchRange(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=binSearch(t.glyphs,e);return r>=0?r:-1;case 2:var n=searchRange(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var a=r[n],o=a.start,s=a.end,l=o;l<=s;l++)e.push(l);return e}};function Position(t){Layout.call(this,t,"gpos")}Position.prototype=Layout.prototype,Position.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},Position.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var a=t[n].subtables,o=0;o<a.length;o++){var s=a[o],l=this.getCoverageIndex(s.coverage,e);if(!(l<0))switch(s.posFormat){case 1:for(var c=s.pairSets[l],p=0;p<c.length;p++){var d=c[p];if(d.secondGlyph===r)return d.value1&&d.value1.xAdvance||0}break;case 2:var y=this.getGlyphClass(s.classDef1,e),m=this.getGlyphClass(s.classDef2,r),w=s.classRecords[y][m];return w.value1&&w.value1.xAdvance||0}}return 0},Position.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function Substitution(t){Layout.call(this,t,"gsub")}function arraysEqual(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function getSubstFormat(t,e,r){for(var n=t.subtables,a=0;a<n.length;a++){var o=n[a];if(o.substFormat===e)return o}if(r)return n.push(r),r}Substitution.prototype=Layout.prototype,Substitution.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Substitution.prototype.getSingle=function(t,e,r){for(var n=[],a=this.getLookupTables(e,r,t,1),o=0;o<a.length;o++)for(var s=a[o].subtables,l=0;l<s.length;l++){var c=s[l],p=this.expandCoverage(c.coverage),d=void 0;if(c.substFormat===1){var y=c.deltaGlyphId;for(d=0;d<p.length;d++){var m=p[d];n.push({sub:m,by:m+y})}}else{var w=c.substitute;for(d=0;d<p.length;d++)n.push({sub:p[d],by:w[d]})}}return n},Substitution.prototype.getMultiple=function(t,e,r){for(var n=[],a=this.getLookupTables(e,r,t,2),o=0;o<a.length;o++)for(var s=a[o].subtables,l=0;l<s.length;l++){var c=s[l],p=this.expandCoverage(c.coverage),d=void 0;for(d=0;d<p.length;d++){var y=p[d],m=c.sequences[d];n.push({sub:y,by:m})}}return n},Substitution.prototype.getAlternates=function(t,e,r){for(var n=[],a=this.getLookupTables(e,r,t,3),o=0;o<a.length;o++)for(var s=a[o].subtables,l=0;l<s.length;l++)for(var c=s[l],p=this.expandCoverage(c.coverage),d=c.alternateSets,y=0;y<p.length;y++)n.push({sub:p[y],by:d[y]});return n},Substitution.prototype.getLigatures=function(t,e,r){for(var n=[],a=this.getLookupTables(e,r,t,4),o=0;o<a.length;o++)for(var s=a[o].subtables,l=0;l<s.length;l++)for(var c=s[l],p=this.expandCoverage(c.coverage),d=c.ligatureSets,y=0;y<p.length;y++)for(var m=p[y],w=d[y],_=0;_<w.length;_++){var E=w[_];n.push({sub:[m].concat(E.components),by:E.ligGlyph})}return n},Substitution.prototype.addSingle=function(t,e,r,n){var a=this.getLookupTables(r,n,t,1,!0)[0],o=getSubstFormat(a,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});check.assert(o.coverage.format===1,"Single: unable to modify coverage table format "+o.coverage.format);var s=e.sub,l=this.binSearch(o.coverage.glyphs,s);l<0&&(l=-1-l,o.coverage.glyphs.splice(l,0,s),o.substitute.splice(l,0,0)),o.substitute[l]=e.by},Substitution.prototype.addMultiple=function(t,e,r,n){check.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var a=this.getLookupTables(r,n,t,2,!0)[0],o=getSubstFormat(a,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});check.assert(o.coverage.format===1,"Multiple: unable to modify coverage table format "+o.coverage.format);var s=e.sub,l=this.binSearch(o.coverage.glyphs,s);l<0&&(l=-1-l,o.coverage.glyphs.splice(l,0,s),o.sequences.splice(l,0,0)),o.sequences[l]=e.by},Substitution.prototype.addAlternate=function(t,e,r,n){var a=this.getLookupTables(r,n,t,3,!0)[0],o=getSubstFormat(a,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});check.assert(o.coverage.format===1,"Alternate: unable to modify coverage table format "+o.coverage.format);var s=e.sub,l=this.binSearch(o.coverage.glyphs,s);l<0&&(l=-1-l,o.coverage.glyphs.splice(l,0,s),o.alternateSets.splice(l,0,0)),o.alternateSets[l]=e.by},Substitution.prototype.addLigature=function(t,e,r,n){var a=this.getLookupTables(r,n,t,4,!0)[0],o=a.subtables[0];o||(o={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},a.subtables[0]=o),check.assert(o.coverage.format===1,"Ligature: unable to modify coverage table format "+o.coverage.format);var s=e.sub[0],l=e.sub.slice(1),c={ligGlyph:e.by,components:l},p=this.binSearch(o.coverage.glyphs,s);if(p>=0){for(var d=o.ligatureSets[p],y=0;y<d.length;y++)if(arraysEqual(d[y].components,l))return;d.push(c)}else p=-1-p,o.coverage.glyphs.splice(p,0,s),o.ligatureSets.splice(p,0,[c])},Substitution.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}},Substitution.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function isBrowser(){return typeof window<"u"}function nodeBufferToArrayBuffer(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;++n)r[n]=t[n];return e}function arrayBufferToNodeBuffer(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function checkArgument(t,e){if(!t)throw e}function parseGlyphCoordinate(t,e,r,n,a){var o;return(e&n)>0?(o=t.parseByte(),e&a||(o=-o),o=r+o):(e&a)>0?o=r:o=r+t.parseShort(),o}function parseGlyph(t,e,r){var n=new parse$1.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var a,o;if(t.numberOfContours>0){for(var s=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)s.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var c=0;c<t.instructionLength;c+=1)t.instructions.push(n.parseByte());var p=s[s.length-1]+1;a=[];for(var d=0;d<p;d+=1)if(o=n.parseByte(),a.push(o),(o&8)>0)for(var y=n.parseByte(),m=0;m<y;m+=1)a.push(o),d+=1;if(check.argument(a.length===p,"Bad flags."),s.length>0){var w=[],_;if(p>0){for(var E=0;E<p;E+=1)o=a[E],_={},_.onCurve=!!(o&1),_.lastPointOfContour=s.indexOf(E)>=0,w.push(_);for(var x=0,k=0;k<p;k+=1)o=a[k],_=w[k],_.x=parseGlyphCoordinate(n,o,x,2,16),x=_.x;for(var R=0,A=0;A<p;A+=1)o=a[A],_=w[A],_.y=parseGlyphCoordinate(n,o,R,4,32),R=_.y}t.points=w}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var G=!0;G;){a=n.parseUShort();var L={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(a&1)>0?(a&2)>0?(L.dx=n.parseShort(),L.dy=n.parseShort()):L.matchedPoints=[n.parseUShort(),n.parseUShort()]:(a&2)>0?(L.dx=n.parseChar(),L.dy=n.parseChar()):L.matchedPoints=[n.parseByte(),n.parseByte()],(a&8)>0?L.xScale=L.yScale=n.parseF2Dot14():(a&64)>0?(L.xScale=n.parseF2Dot14(),L.yScale=n.parseF2Dot14()):(a&128)>0&&(L.xScale=n.parseF2Dot14(),L.scale01=n.parseF2Dot14(),L.scale10=n.parseF2Dot14(),L.yScale=n.parseF2Dot14()),t.components.push(L),G=!!(a&32)}if(a&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var q=0;q<t.instructionLength;q+=1)t.instructions.push(n.parseByte())}}}function transformPoints(t,e){for(var r=[],n=0;n<t.length;n+=1){var a=t[n],o={x:e.xScale*a.x+e.scale01*a.y+e.dx,y:e.scale10*a.x+e.yScale*a.y+e.dy,onCurve:a.onCurve,lastPointOfContour:a.lastPointOfContour};r.push(o)}return r}function getContours(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var a=t[n];r.push(a),a.lastPointOfContour&&(e.push(r),r=[])}return check.argument(r.length===0,"There are still points left in the current contour."),e}function getPath(t){var e=new Path;if(!t)return e;for(var r=getContours(t),n=0;n<r.length;++n){var a=r[n],o=null,s=a[a.length-1],l=a[0];if(s.onCurve)e.moveTo(s.x,s.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var c={x:(s.x+l.x)*.5,y:(s.y+l.y)*.5};e.moveTo(c.x,c.y)}for(var p=0;p<a.length;++p)if(o=s,s=l,l=a[(p+1)%a.length],s.onCurve)e.lineTo(s.x,s.y);else{var d=l;o.onCurve||((s.x+o.x)*.5,(s.y+o.y)*.5),l.onCurve||(d={x:(s.x+l.x)*.5,y:(s.y+l.y)*.5}),e.quadraticCurveTo(s.x,s.y,d.x,d.y)}e.closePath()}return e}function buildPath(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],a=t.get(n.glyphIndex);if(a.getPath(),a.points){var o=void 0;if(n.matchedPoints===void 0)o=transformPoints(a.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>a.points.length-1)throw Error("Matched points out of range in "+e.name);var s=e.points[n.matchedPoints[0]],l=a.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=transformPoints([l],c)[0],c.dx=s.x-l.x,c.dy=s.y-l.y,o=transformPoints(a.points,c)}e.points=e.points.concat(o)}}return getPath(e.points)}function parseGlyfTableAll(t,e,r,n){for(var a=new glyphset.GlyphSet(n),o=0;o<r.length-1;o+=1){var s=r[o],l=r[o+1];s!==l?a.push(o,glyphset.ttfGlyphLoader(n,o,parseGlyph,t,e+s,buildPath)):a.push(o,glyphset.glyphLoader(n,o))}return a}function parseGlyfTableOnLowMemory(t,e,r,n){var a=new glyphset.GlyphSet(n);return n._push=function(o){var s=r[o],l=r[o+1];s!==l?a.push(o,glyphset.ttfGlyphLoader(n,o,parseGlyph,t,e+s,buildPath)):a.push(o,glyphset.glyphLoader(n,o))},a}function parseGlyfTable(t,e,r,n,a){return a.lowMemory?parseGlyfTableOnLowMemory(t,e,r,n):parseGlyfTableAll(t,e,r,n)}var glyf={getPath,parse:parseGlyfTable},instructionTable,exec,execGlyph,execComponent;function Hinting(t){this.font=t,this.getCommands=function(e){return glyf.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function roundOff(t){return t}function roundToGrid(t){return Math.sign(t)*Math.round(Math.abs(t))}function roundToDoubleGrid(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function roundToHalfGrid(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function roundUpToGrid(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function roundDownToGrid(t){return Math.sign(t)*Math.floor(Math.abs(t))}var roundSuper=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,a=1;return t<0&&(t=-t,a=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*a:t*a},xUnitVector={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var a,o,s,l,c,p,d;if(!n||n===this){if(a=t.xo-e.xo,o=t.xo-r.xo,c=e.x-e.xo,p=r.x-r.xo,s=Math.abs(a),l=Math.abs(o),d=s+l,d===0){t.x=t.xo+(c+p)/2;return}t.x=t.xo+(c*l+p*s)/d;return}if(a=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),s=Math.abs(a),l=Math.abs(o),d=s+l,d===0){xUnitVector.setRelative(t,t,(c+p)/2,n,!0);return}xUnitVector.setRelative(t,t,(c*l+p*s)/d,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,a){if(!n||n===this){t.x=(a?e.xo:e.x)+r;return}var o=a?e.xo:e.x,s=a?e.yo:e.y,l=o+r*n.x,c=s+r*n.y;t.x=l+(t.y-c)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},yUnitVector={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var a,o,s,l,c,p,d;if(!n||n===this){if(a=t.yo-e.yo,o=t.yo-r.yo,c=e.y-e.yo,p=r.y-r.yo,s=Math.abs(a),l=Math.abs(o),d=s+l,d===0){t.y=t.yo+(c+p)/2;return}t.y=t.yo+(c*l+p*s)/d;return}if(a=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),s=Math.abs(a),l=Math.abs(o),d=s+l,d===0){yUnitVector.setRelative(t,t,(c+p)/2,n,!0);return}yUnitVector.setRelative(t,t,(c*l+p*s)/d,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,a){if(!n||n===this){t.y=(a?e.yo:e.y)+r;return}var o=a?e.xo:e.x,s=a?e.yo:e.y,l=o+r*n.x,c=s+r*n.y;t.y=c+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(xUnitVector),Object.freeze(yUnitVector);function UnitVector(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}UnitVector.prototype.distance=function(t,e,r,n){return this.x*xUnitVector.distance(t,e,r,n)+this.y*yUnitVector.distance(t,e,r,n)},UnitVector.prototype.interpolate=function(t,e,r,n){var a,o,s,l,c,p,d;if(s=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),a=n.distance(e,e,!1,!0),o=n.distance(r,r,!1,!0),c=Math.abs(s),p=Math.abs(l),d=c+p,d===0){this.setRelative(t,t,(a+o)/2,n,!0);return}this.setRelative(t,t,(a*p+o*c)/d,n,!0)},UnitVector.prototype.setRelative=function(t,e,r,n,a){n=n||this;var o=a?e.xo:e.x,s=a?e.yo:e.y,l=o+r*n.x,c=s+r*n.y,p=n.normalSlope,d=this.slope,y=t.x,m=t.y;t.x=(d*y-p*l+c-m)/(d-p),t.y=d*(t.x-y)+m},UnitVector.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function getUnitVector(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?xUnitVector:t===0&&e===1?yUnitVector:new UnitVector(t,e)}function HPoint(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}HPoint.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},HPoint.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var HPZero=Object.freeze(new HPoint(0,0)),defaultState={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function State(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=xUnitVector,this.round=roundToGrid}}Hinting.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var a=this._fpgmState;if(!a){State.prototype=defaultState,a=this._fpgmState=new State("fpgm",r.tables.fpgm),a.funcs=[],a.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),a.step=-1);try{exec(a)}catch(p){console.log("Hinting error in FPGM:"+p),this._errorState=3;return}}State.prototype=a,n=this._prepState=new State("prep",r.tables.prep),n.ppem=e;var o=r.tables.cvt;if(o)for(var s=n.cvt=new Array(o.length),l=e/r.unitsPerEm,c=0;c<o.length;c++)s[c]=o[c]*l;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{exec(n)}catch(p){this._errorState<2&&console.log("Hinting error in PREP:"+p),this._errorState=2}}if(!(this._errorState>1))try{return execGlyph(t,n)}catch(p){this._errorState<1&&(console.log("Hinting error:"+p),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},execGlyph=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,a=t.components,o,s,l;if(State.prototype=e,!a)l=new State("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),execComponent(t,l,r,n),s=l.gZone;else{var c=e.font;s=[],o=[];for(var p=0;p<a.length;p++){var d=a[p],y=c.glyphs.get(d.glyphIndex);l=new State("glyf",y.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+p+"---"),l.step=-1),execComponent(y,l,r,n);for(var m=Math.round(d.dx*r),w=Math.round(d.dy*n),_=l.gZone,E=l.contours,x=0;x<_.length;x++){var k=_[x];k.xTouched=k.yTouched=!1,k.xo=k.x=k.x+m,k.yo=k.y=k.y+w}var R=s.length;s.push.apply(s,_);for(var A=0;A<E.length;A++)o.push(E[A]+R)}t.instructions&&!l.inhibitGridFit&&(l=new State("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=s,l.contours=o,s.push(new HPoint(0,0),new HPoint(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),exec(l),s.length-=2)}return s},execComponent=function(t,e,r,n){for(var a=t.points||[],o=a.length,s=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],c,p=0;p<o;p++)c=a[p],s[p]=new HPoint(c.x*r,c.y*n,c.lastPointOfContour,c.onCurve);for(var d,y,m=0;m<o;m++)c=s[m],d||(d=c,l.push(m)),c.lastPointOfContour?(c.nextPointOnContour=d,d.prevPointOnContour=c,d=void 0):(y=s[m+1],c.nextPointOnContour=y,y.prevPointOnContour=c);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var w=0;w<o;w++)console.log(w,s[w].x,s[w].y)}if(s.push(new HPoint(0,0),new HPoint(Math.round(t.advanceWidth*r),0)),exec(e),s.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var _=0;_<o;_++)console.log(_,s[_].x,s[_].y)}}},exec=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=instructionTable[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function initTZone(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new HPoint(0,0)}function skip(t,e){var r=t.prog,n=t.ip,a=1,o;do if(o=r[++n],o===88)a++;else if(o===89)a--;else if(o===64)n+=r[n+1]+1;else if(o===65)n+=2*r[n+1]+1;else if(o>=176&&o<=183)n+=o-176+1;else if(o>=184&&o<=191)n+=(o-184+1)*2;else if(e&&a===1&&o===27)break;while(a>0);t.ip=n}function SVTCA(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function SPVTCA(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function SFVTCA(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function SPVTL(t,e){var r=e.stack,n=r.pop(),a=r.pop(),o=e.z2[n],s=e.z1[a];exports.DEBUG&&console.log("SPVTL["+t+"]",n,a);var l,c;t?(l=o.y-s.y,c=s.x-o.x):(l=s.x-o.x,c=s.y-o.y),e.pv=e.dpv=getUnitVector(l,c)}function SFVTL(t,e){var r=e.stack,n=r.pop(),a=r.pop(),o=e.z2[n],s=e.z1[a];exports.DEBUG&&console.log("SFVTL["+t+"]",n,a);var l,c;t?(l=o.y-s.y,c=s.x-o.x):(l=s.x-o.x,c=s.y-o.y),e.fv=getUnitVector(l,c)}function SPVFS(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=getUnitVector(n,r)}function SFVFS(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=getUnitVector(n,r)}function GPV(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function GFV(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function SFVTPV(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function ISECT(t){var e=t.stack,r=e.pop(),n=e.pop(),a=e.pop(),o=e.pop(),s=e.pop(),l=t.z0,c=t.z1,p=l[r],d=l[n],y=c[a],m=c[o],w=t.z2[s];exports.DEBUG&&console.log("ISECT[], ",r,n,a,o,s);var _=p.x,E=p.y,x=d.x,k=d.y,R=y.x,A=y.y,G=m.x,L=m.y,q=(_-x)*(A-L)-(E-k)*(R-G),V=_*k-E*x,U=R*L-A*G;w.x=(V*(R-G)-U*(_-x))/q,w.y=(V*(A-L)-U*(E-k))/q}function SRP0(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function SRP1(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function SRP2(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function SZP0(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||initTZone(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP1(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||initTZone(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP2(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||initTZone(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZPS(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||initTZone(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function SLOOP(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function RTG(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=roundToGrid}function RTHG(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=roundToHalfGrid}function SMD(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function ELSE(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),skip(t,!1)}function JMPR(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function SCVTCI(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function DUP(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function POP(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function CLEAR(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function SWAP(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function DEPTH(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function LOOPCALL(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var a=t.ip,o=t.prog;t.prog=t.funcs[r];for(var s=0;s<n;s++)exec(t),exports.DEBUG&&console.log(++t.step,s+1<n?"next loopcall":"done loopcall",s);t.ip=a,t.prog=o}function CALL(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],exec(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function CINDEX(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function MINDEX(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function FDEF(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,a=e.pop(),o=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",a);r[++n]!==45;);t.ip=n,t.funcs[a]=r.slice(o+1,n)}function MDAP(t,e){var r=e.stack.pop(),n=e.z0[r],a=e.fv,o=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var s=o.distance(n,HPZero);t&&(s=e.round(s)),a.setRelative(n,HPZero,s,o),a.touch(n),e.rp0=e.rp1=r}function IUP(t,e){var r=e.z2,n=r.length-2,a,o,s;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)a=r[l],!t.touched(a)&&(o=a.prevTouched(t),o!==a&&(s=a.nextTouched(t),o===s&&t.setRelative(a,a,t.distance(o,o,!1,!0),t,!0),t.interpolate(a,o,s,t)))}function SHP(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,a=(t?e.z0:e.z1)[n],o=e.fv,s=e.pv,l=e.loop,c=e.z2;l--;){var p=r.pop(),d=c[p],y=s.distance(a,a,!1,!0);o.setRelative(d,d,y,s),o.touch(d),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",p)}e.loop=1}function SHC(t,e){var r=e.stack,n=t?e.rp1:e.rp2,a=(t?e.z0:e.z1)[n],o=e.fv,s=e.pv,l=r.pop(),c=e.z2[e.contours[l]],p=c;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var d=s.distance(a,a,!1,!0);do p!==a&&o.setRelative(p,p,d,s),p=p.nextPointOnContour;while(p!==c)}function SHZ(t,e){var r=e.stack,n=t?e.rp1:e.rp2,a=(t?e.z0:e.z1)[n],o=e.fv,s=e.pv,l=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var c;switch(l){case 0:c=e.tZone;break;case 1:c=e.gZone;break;default:throw new Error("Invalid zone")}for(var p,d=s.distance(a,a,!1,!0),y=c.length-2,m=0;m<y;m++)p=c[m],o.setRelative(p,p,d,s)}function SHPIX(t){for(var e=t.stack,r=t.loop,n=t.fv,a=e.pop()/64,o=t.z2;r--;){var s=e.pop(),l=o[s];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",s,a),n.setRelative(l,l,a),n.touch(l)}t.loop=1}function IP(t){for(var e=t.stack,r=t.rp1,n=t.rp2,a=t.loop,o=t.z0[r],s=t.z1[n],l=t.fv,c=t.dpv,p=t.z2;a--;){var d=e.pop(),y=p[d];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-a)+": ":"")+"IP[]",d,r,"<->",n),l.interpolate(y,o,s,c),l.touch(y)}t.loop=1}function MSIRP(t,e){var r=e.stack,n=r.pop()/64,a=r.pop(),o=e.z1[a],s=e.z0[e.rp0],l=e.fv,c=e.pv;l.setRelative(o,s,n,c),l.touch(o),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,a),e.rp1=e.rp0,e.rp2=a,t&&(e.rp0=a)}function ALIGNRP(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],a=t.loop,o=t.fv,s=t.pv,l=t.z1;a--;){var c=e.pop(),p=l[c];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-a)+": ":"")+"ALIGNRP[]",c),o.setRelative(p,n,0,s),o.touch(p)}t.loop=1}function RTDG(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=roundToDoubleGrid}function MIAP(t,e){var r=e.stack,n=r.pop(),a=r.pop(),o=e.z0[a],s=e.fv,l=e.pv,c=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",c,")",a);var p=l.distance(o,HPZero);t&&(Math.abs(p-c)<e.cvCutIn&&(p=c),p=e.round(p)),s.setRelative(o,HPZero,p,l),e.zp0===0&&(o.xo=o.x,o.yo=o.y),s.touch(o),e.rp0=e.rp1=a}function NPUSHB(t){var e=t.prog,r=t.ip,n=t.stack,a=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",a);for(var o=0;o<a;o++)n.push(e[++r]);t.ip=r}function NPUSHW(t){var e=t.ip,r=t.prog,n=t.stack,a=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",a);for(var o=0;o<a;o++){var s=r[++e]<<8|r[++e];s&32768&&(s=-((s^65535)+1)),n.push(s)}t.ip=e}function WS(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),a=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,a),r[a]=n}function RS(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var a=r&&r[n]||0;e.push(a)}function WCVTP(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function RCVT(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function GC(t,e){var r=e.stack,n=r.pop(),a=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(a,HPZero,t,!1)*64)}function MD(t,e){var r=e.stack,n=r.pop(),a=r.pop(),o=e.z1[n],s=e.z0[a],l=e.dpv.distance(s,o,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,a,"->",l),e.stack.push(Math.round(l*64))}function MPPEM(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function FLIPON(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function LT(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function LTEQ(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function GT(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function GTEQ(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function EQ(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function NEQ(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function ODD(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function EVEN(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function IF(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(skip(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function EIF(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function AND(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function OR(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function NOT(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function DELTAP123(t,e){var r=e.stack,n=r.pop(),a=e.fv,o=e.pv,s=e.ppem,l=e.deltaBase+(t-1)*16,c=e.deltaShift,p=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var d=0;d<n;d++){var y=r.pop(),m=r.pop(),w=l+((m&240)>>4);if(w===s){var _=(m&15)-8;_>=0&&_++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",y,"by",_*c);var E=p[y];a.setRelative(E,E,_*c,o)}}}function SDB(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function SDS(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function ADD(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function SUB(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function DIV(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function MUL(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function ABS(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function NEG(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function FLOOR(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function CEILING(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function ROUND(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function WCVTF(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function DELTAC123(t,e){var r=e.stack,n=r.pop(),a=e.ppem,o=e.deltaBase+(t-1)*16,s=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var c=r.pop(),p=r.pop(),d=o+((p&240)>>4);if(d===a){var y=(p&15)-8;y>=0&&y++;var m=y*s;exports.DEBUG&&console.log(e.step,"DELTACFIX",c,"by",m),e.cvt[c]+=m}}}function SROUND(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=roundSuper;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function S45ROUND(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=roundSuper;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function ROFF(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=roundOff}function RUTG(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=roundUpToGrid}function RDTG(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=roundDownToGrid}function SCANCTRL(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function SDPVTL(t,e){var r=e.stack,n=r.pop(),a=r.pop(),o=e.z2[n],s=e.z1[a];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,a);var l,c;t?(l=o.y-s.y,c=s.x-o.x):(l=s.x-o.x,c=s.y-o.y),e.dpv=getUnitVector(l,c)}function GETINFO(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function ROLL(t){var e=t.stack,r=e.pop(),n=e.pop(),a=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(a)}function MAX(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function MIN(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function SCANTYPE(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function INSTCTRL(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function PUSHB(t,e){var r=e.stack,n=e.prog,a=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var o=0;o<t;o++)r.push(n[++a]);e.ip=a}function PUSHW(t,e){var r=e.ip,n=e.prog,a=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var o=0;o<t;o++){var s=n[++r]<<8|n[++r];s&32768&&(s=-((s^65535)+1)),a.push(s)}e.ip=r}function MDRP_MIRP(t,e,r,n,a,o){var s=o.stack,l=t&&s.pop(),c=s.pop(),p=o.rp0,d=o.z0[p],y=o.z1[c],m=o.minDis,w=o.fv,_=o.dpv,E,x,k,R;x=E=_.distance(y,d,!0,!0),k=x>=0?1:-1,x=Math.abs(x),t&&(R=o.cvt[l],n&&Math.abs(x-R)<o.cvCutIn&&(x=R)),r&&x<m&&(x=m),n&&(x=o.round(x)),w.setRelative(y,d,k*x,_),w.touch(y),exports.DEBUG&&console.log(o.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(a===0?"Gr":a===1?"Bl":a===2?"Wh":"")+"]",t?l+"("+o.cvt[l]+","+R+")":"",c,"(d =",E,"->",k*x,")"),o.rp1=o.rp0,o.rp2=c,e&&(o.rp0=c)}instructionTable=[SVTCA.bind(void 0,yUnitVector),SVTCA.bind(void 0,xUnitVector),SPVTCA.bind(void 0,yUnitVector),SPVTCA.bind(void 0,xUnitVector),SFVTCA.bind(void 0,yUnitVector),SFVTCA.bind(void 0,xUnitVector),SPVTL.bind(void 0,0),SPVTL.bind(void 0,1),SFVTL.bind(void 0,0),SFVTL.bind(void 0,1),SPVFS,SFVFS,GPV,GFV,SFVTPV,ISECT,SRP0,SRP1,SRP2,SZP0,SZP1,SZP2,SZPS,SLOOP,RTG,RTHG,SMD,ELSE,JMPR,SCVTCI,void 0,void 0,DUP,POP,CLEAR,SWAP,DEPTH,CINDEX,MINDEX,void 0,void 0,void 0,LOOPCALL,CALL,FDEF,void 0,MDAP.bind(void 0,0),MDAP.bind(void 0,1),IUP.bind(void 0,yUnitVector),IUP.bind(void 0,xUnitVector),SHP.bind(void 0,0),SHP.bind(void 0,1),SHC.bind(void 0,0),SHC.bind(void 0,1),SHZ.bind(void 0,0),SHZ.bind(void 0,1),SHPIX,IP,MSIRP.bind(void 0,0),MSIRP.bind(void 0,1),ALIGNRP,RTDG,MIAP.bind(void 0,0),MIAP.bind(void 0,1),NPUSHB,NPUSHW,WS,RS,WCVTP,RCVT,GC.bind(void 0,0),GC.bind(void 0,1),void 0,MD.bind(void 0,0),MD.bind(void 0,1),MPPEM,void 0,FLIPON,void 0,void 0,LT,LTEQ,GT,GTEQ,EQ,NEQ,ODD,EVEN,IF,EIF,AND,OR,NOT,DELTAP123.bind(void 0,1),SDB,SDS,ADD,SUB,DIV,MUL,ABS,NEG,FLOOR,CEILING,ROUND.bind(void 0,0),ROUND.bind(void 0,1),ROUND.bind(void 0,2),ROUND.bind(void 0,3),void 0,void 0,void 0,void 0,WCVTF,DELTAP123.bind(void 0,2),DELTAP123.bind(void 0,3),DELTAC123.bind(void 0,1),DELTAC123.bind(void 0,2),DELTAC123.bind(void 0,3),SROUND,S45ROUND,void 0,void 0,ROFF,void 0,RUTG,RDTG,POP,POP,void 0,void 0,void 0,void 0,void 0,SCANCTRL,SDPVTL.bind(void 0,0),SDPVTL.bind(void 0,1),GETINFO,void 0,ROLL,MAX,MIN,SCANTYPE,INSTCTRL,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,PUSHB.bind(void 0,1),PUSHB.bind(void 0,2),PUSHB.bind(void 0,3),PUSHB.bind(void 0,4),PUSHB.bind(void 0,5),PUSHB.bind(void 0,6),PUSHB.bind(void 0,7),PUSHB.bind(void 0,8),PUSHW.bind(void 0,1),PUSHW.bind(void 0,2),PUSHW.bind(void 0,3),PUSHW.bind(void 0,4),PUSHW.bind(void 0,5),PUSHW.bind(void 0,6),PUSHW.bind(void 0,7),PUSHW.bind(void 0,8),MDRP_MIRP.bind(void 0,0,0,0,0,0),MDRP_MIRP.bind(void 0,0,0,0,0,1),MDRP_MIRP.bind(void 0,0,0,0,0,2),MDRP_MIRP.bind(void 0,0,0,0,0,3),MDRP_MIRP.bind(void 0,0,0,0,1,0),MDRP_MIRP.bind(void 0,0,0,0,1,1),MDRP_MIRP.bind(void 0,0,0,0,1,2),MDRP_MIRP.bind(void 0,0,0,0,1,3),MDRP_MIRP.bind(void 0,0,0,1,0,0),MDRP_MIRP.bind(void 0,0,0,1,0,1),MDRP_MIRP.bind(void 0,0,0,1,0,2),MDRP_MIRP.bind(void 0,0,0,1,0,3),MDRP_MIRP.bind(void 0,0,0,1,1,0),MDRP_MIRP.bind(void 0,0,0,1,1,1),MDRP_MIRP.bind(void 0,0,0,1,1,2),MDRP_MIRP.bind(void 0,0,0,1,1,3),MDRP_MIRP.bind(void 0,0,1,0,0,0),MDRP_MIRP.bind(void 0,0,1,0,0,1),MDRP_MIRP.bind(void 0,0,1,0,0,2),MDRP_MIRP.bind(void 0,0,1,0,0,3),MDRP_MIRP.bind(void 0,0,1,0,1,0),MDRP_MIRP.bind(void 0,0,1,0,1,1),MDRP_MIRP.bind(void 0,0,1,0,1,2),MDRP_MIRP.bind(void 0,0,1,0,1,3),MDRP_MIRP.bind(void 0,0,1,1,0,0),MDRP_MIRP.bind(void 0,0,1,1,0,1),MDRP_MIRP.bind(void 0,0,1,1,0,2),MDRP_MIRP.bind(void 0,0,1,1,0,3),MDRP_MIRP.bind(void 0,0,1,1,1,0),MDRP_MIRP.bind(void 0,0,1,1,1,1),MDRP_MIRP.bind(void 0,0,1,1,1,2),MDRP_MIRP.bind(void 0,0,1,1,1,3),MDRP_MIRP.bind(void 0,1,0,0,0,0),MDRP_MIRP.bind(void 0,1,0,0,0,1),MDRP_MIRP.bind(void 0,1,0,0,0,2),MDRP_MIRP.bind(void 0,1,0,0,0,3),MDRP_MIRP.bind(void 0,1,0,0,1,0),MDRP_MIRP.bind(void 0,1,0,0,1,1),MDRP_MIRP.bind(void 0,1,0,0,1,2),MDRP_MIRP.bind(void 0,1,0,0,1,3),MDRP_MIRP.bind(void 0,1,0,1,0,0),MDRP_MIRP.bind(void 0,1,0,1,0,1),MDRP_MIRP.bind(void 0,1,0,1,0,2),MDRP_MIRP.bind(void 0,1,0,1,0,3),MDRP_MIRP.bind(void 0,1,0,1,1,0),MDRP_MIRP.bind(void 0,1,0,1,1,1),MDRP_MIRP.bind(void 0,1,0,1,1,2),MDRP_MIRP.bind(void 0,1,0,1,1,3),MDRP_MIRP.bind(void 0,1,1,0,0,0),MDRP_MIRP.bind(void 0,1,1,0,0,1),MDRP_MIRP.bind(void 0,1,1,0,0,2),MDRP_MIRP.bind(void 0,1,1,0,0,3),MDRP_MIRP.bind(void 0,1,1,0,1,0),MDRP_MIRP.bind(void 0,1,1,0,1,1),MDRP_MIRP.bind(void 0,1,1,0,1,2),MDRP_MIRP.bind(void 0,1,1,0,1,3),MDRP_MIRP.bind(void 0,1,1,1,0,0),MDRP_MIRP.bind(void 0,1,1,1,0,1),MDRP_MIRP.bind(void 0,1,1,1,0,2),MDRP_MIRP.bind(void 0,1,1,1,0,3),MDRP_MIRP.bind(void 0,1,1,1,1,0),MDRP_MIRP.bind(void 0,1,1,1,1,1),MDRP_MIRP.bind(void 0,1,1,1,1,2),MDRP_MIRP.bind(void 0,1,1,1,1,3)];function Token(t){this.char=t,this.state={},this.activeState=null}function ContextRange(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function ContextChecker(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function ContextParams(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Event(t){this.eventId=t,this.subscribers=[]}function initializeCoreEvents(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(a){Object.defineProperty(e.events,a,{value:new Event(a)})}),t&&r.forEach(function(a){var o=t[a];typeof o=="function"&&e.events[a].subscribe(o)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(a){e.events[a].subscribe(e.updateContextsRanges)})}function Tokenizer(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],initializeCoreEvents.call(this,t)}Token.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},Token.prototype.getState=function(t){return this.state[t]||null},Tokenizer.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},Tokenizer.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(o){return e[o[0]].apply(e,o.slice(1).concat(r))}),a=function(o){return typeof o=="object"&&o.hasOwnProperty("FAIL")};if(n.every(a))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(a)};this.dispatch("composeRUD",[n.filter(function(o){return!a(o)})])},Tokenizer.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var a=r.every(function(s){return s instanceof Token});if(!isNaN(t)&&this.inboundIndex(t)&&a){var o=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[o,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Tokenizer.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Token){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},Tokenizer.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n},Tokenizer.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}},Tokenizer.prototype.insertToken=function(t,e,r){var n=t.every(function(a){return a instanceof Token});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},Tokenizer.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,a){var o=[n,a],s=e===null||e.apply(this,o)===!0,l=[n,a];if(s){var c=r.apply(this,l);n.setState(t,c)}}),this.registeredModifiers.push(t)},Event.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Event.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},ContextParams.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},ContextParams.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}},Tokenizer.prototype.rangeToText=function(t){if(t instanceof ContextRange)return this.getRangeTokens(t).map(function(e){return e.char}).join("")},Tokenizer.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},Tokenizer.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null},Tokenizer.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null},Tokenizer.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Event&&n.subscribers.forEach(function(a){a.apply(r,e||[])})},Tokenizer.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new ContextChecker(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},Tokenizer.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},Tokenizer.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},Tokenizer.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}},Tokenizer.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new ContextParams(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Tokenizer.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new ContextRange(r,t,e),a=this.getContext(e).ranges;return n.rangeId=e+"."+a.length,a.push(n),this.getContext(e).openRange=null,n},Tokenizer.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var a=n.contextName,o=e.getContext(a).openRange;if(!o&&n.checkStart(t)&&(o=new ContextRange(r,null,a),e.getContext(a).openRange=o,e.dispatch("contextStart",[a,r])),o&&n.checkEnd(t)){var s=r-o.startIndex+1,l=e.setEndOffset(s,a);e.dispatch("contextEnd",[a,l])}})},Tokenizer.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],a=new ContextParams(e,r);this.dispatch("next",[a]),this.runContextCheck(a);var o=new Token(n);this.tokens.push(o),this.dispatch("newToken",[o,a])}return this.dispatch("end",[this.tokens]),this.tokens};function isArabicChar(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function isIsolatedArabicChar(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function isTashkeelArabicChar(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function isLatinChar(t){return/[A-z]/.test(t)}function isWhiteSpace(t){return/\s/.test(t)}function FeatureQuery(t){this.font=t,this.features={}}function SubstitutionAction(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function lookupCoverage(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var a=r[n];if(t>=a.start&&t<=a.end){var o=t-a.start;return a.index+o}}break;default:return-1}return-1}function singleSubstitutionFormat1(t,e){var r=lookupCoverage(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function singleSubstitutionFormat2(t,e){var r=lookupCoverage(t,e.coverage);return r===-1?null:e.substitute[r]}function lookupCoverageList(t,e){for(var r=[],n=0;n<t.length;n++){var a=t[n],o=e.current;o=Array.isArray(o)?o[0]:o;var s=lookupCoverage(o,a);s!==-1&&r.push(s)}return r.length!==t.length?-1:r}function chainingSubstitutionFormat3(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=lookupCoverageList(e.inputCoverage,t);if(n===-1)return[];var a=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var o=t.lookahead.slice(a);o.length&&isTashkeelArabicChar(o[0].char);)o.shift();var s=new ContextParams(o,0),l=lookupCoverageList(e.lookaheadCoverage,s),c=[].concat(t.backtrack);for(c.reverse();c.length&&isTashkeelArabicChar(c[0].char);)c.shift();if(c.length<e.backtrackCoverage.length)return[];var p=new ContextParams(c,0),d=lookupCoverageList(e.backtrackCoverage,p),y=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&d.length===e.backtrackCoverage.length,m=[];if(y)for(var w=0;w<e.lookupRecords.length;w++)for(var _=e.lookupRecords[w],E=_.lookupListIndex,x=this.getLookupByIndex(E),k=0;k<x.subtables.length;k++){var R=x.subtables[k],A=this.getLookupMethod(x,R),G=this.getSubstitutionType(x,R);if(G==="12")for(var L=0;L<n.length;L++){var q=t.get(L),V=A(q);V&&m.push(V)}}return m}function ligatureSubstitutionFormat1(t,e){var r=t.current,n=lookupCoverage(r,e.coverage);if(n===-1)return null;for(var a,o=e.ligatureSets[n],s=0;s<o.length;s++){a=o[s];for(var l=0;l<a.components.length;l++){var c=t.lookahead[l],p=a.components[l];if(c!==p)break;if(l===a.components.length-1)return a}}return null}function decompositionSubstitutionFormat1(t,e){var r=lookupCoverage(t,e.coverage);return r===-1?null:e.sequences[r]}FeatureQuery.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},FeatureQuery.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var a=r[n];if(a.tag===t&&a.script.defaultLangSys)return a.script.defaultLangSys.featureIndexes;var o=a.langSysRecords;if(o)for(var s=0;s<o.length;s++){var l=o[s];if(l.tag===t){var c=l.langSys;return c.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},FeatureQuery.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var a=t[n].tag,o=t[n].feature;r[a]=o}this.features[e].tags=r},FeatureQuery.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(a){return n.features[a]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},FeatureQuery.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n},FeatureQuery.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(a){return singleSubstitutionFormat1.apply(r,[a,e])};case"12":return function(a){return singleSubstitutionFormat2.apply(r,[a,e])};case"63":return function(a){return chainingSubstitutionFormat3.apply(r,[a,e])};case"41":return function(a){return ligatureSubstitutionFormat1.apply(r,[a,e])};case"21":return function(a){return decompositionSubstitutionFormat1.apply(r,[a,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},FeatureQuery.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var a=this.getFeatureLookups(n),o=[].concat(e.context),s=0;s<a.length;s++)for(var l=a[s],c=this.getLookupSubtables(l),p=0;p<c.length;p++){var d=c[p],y=this.getSubstitutionType(l,d),m=this.getLookupMethod(l,d),w=void 0;switch(y){case"11":w=m(e.current),w&&o.splice(r,1,new SubstitutionAction({id:11,tag:t.tag,substitution:w}));break;case"12":w=m(e.current),w&&o.splice(r,1,new SubstitutionAction({id:12,tag:t.tag,substitution:w}));break;case"63":w=m(e),Array.isArray(w)&&w.length&&o.splice(r,1,new SubstitutionAction({id:63,tag:t.tag,substitution:w}));break;case"41":w=m(e),w&&o.splice(r,1,new SubstitutionAction({id:41,tag:t.tag,substitution:w}));break;case"21":w=m(e.current),w&&o.splice(r,1,new SubstitutionAction({id:21,tag:t.tag,substitution:w}));break}e=new ContextParams(o,r),!(Array.isArray(w)&&!w.length)&&(w=null)}return o.length?o:null},FeatureQuery.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r},FeatureQuery.prototype.getLookupSubtables=function(t){return t.subtables||null},FeatureQuery.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null},FeatureQuery.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},FeatureQuery.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function arabicWordStartCheck(t){var e=t.current,r=t.get(-1);return r===null&&isArabicChar(e)||!isArabicChar(r)&&isArabicChar(e)}function arabicWordEndCheck(t){var e=t.get(1);return e===null||!isArabicChar(e)}var arabicWordCheck={startCheck:arabicWordStartCheck,endCheck:arabicWordEndCheck};function arabicSentenceStartCheck(t){var e=t.current,r=t.get(-1);return(isArabicChar(e)||isTashkeelArabicChar(e))&&!isArabicChar(r)}function arabicSentenceEndCheck(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!isArabicChar(e)&&!isTashkeelArabicChar(e)):var r=isWhiteSpace(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(a){return isArabicChar(a)||isTashkeelArabicChar(a)}),!n)return!0}break;default:return!1}}var arabicSentenceCheck={startCheck:arabicSentenceStartCheck,endCheck:arabicSentenceEndCheck};function singleSubstitutionFormat1$1(t,e,r){e[r].setState(t.tag,t.substitution)}function singleSubstitutionFormat2$1(t,e,r){e[r].setState(t.tag,t.substitution)}function chainingSubstitutionFormat3$1(t,e,r){t.substitution.forEach(function(n,a){var o=e[r+a];o.setState(t.tag,n)})}function ligatureSubstitutionFormat1$1(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var a=t.substitution.components.length,o=0;o<a;o++)n=e[r+o+1],n.setState("deleted",!0)}var SUBSTITUTIONS={11:singleSubstitutionFormat1$1,12:singleSubstitutionFormat2$1,63:chainingSubstitutionFormat3$1,41:ligatureSubstitutionFormat1$1};function applySubstitution(t,e,r){t instanceof SubstitutionAction&&SUBSTITUTIONS[t.id]&&SUBSTITUTIONS[t.id](t,e,r)}function willConnectPrev(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],a=isIsolatedArabicChar(n),o=isTashkeelArabicChar(n);if(!a&&!o)return!0;if(a)return!1}return!1}function willConnectNext(t){if(isIsolatedArabicChar(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=isTashkeelArabicChar(r);if(!n)return!0}return!1}function arabicPresentationForms(t){var e=this,r="arab",n=this.featuresTags[r],a=this.tokenizer.getRangeTokens(t);if(a.length!==1){var o=new ContextParams(a.map(function(l){return l.getState("glyphIndex")}),0),s=new ContextParams(a.map(function(l){return l.char}),0);a.forEach(function(l,c){if(!isTashkeelArabicChar(l.char)){o.setCurrentIndex(c),s.setCurrentIndex(c);var p=0;willConnectPrev(s)&&(p|=1),willConnectNext(s)&&(p|=2);var d;switch(p){case 1:d="fina";break;case 2:d="init";break;case 3:d="medi";break}if(n.indexOf(d)!==-1){var y=e.query.lookupFeature({tag:d,script:r,contextParams:o});if(y instanceof Error)return console.info(y.message);y.forEach(function(m,w){m instanceof SubstitutionAction&&(applySubstitution(m,a,w),o.context[w]=m.substitution)})}}})}}function getContextParams(t,e){var r=t.map(function(n){return n.activeState.value});return new ContextParams(r,0)}function arabicRequiredLigatures(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),a=getContextParams(n);a.context.forEach(function(o,s){a.setCurrentIndex(s);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:a});l.length&&(l.forEach(function(c){return applySubstitution(c,n,s)}),a=getContextParams(n))})}function latinWordStartCheck(t){var e=t.current,r=t.get(-1);return r===null&&isLatinChar(e)||!isLatinChar(r)&&isLatinChar(e)}function latinWordEndCheck(t){var e=t.get(1);return e===null||!isLatinChar(e)}var latinWordCheck={startCheck:latinWordStartCheck,endCheck:latinWordEndCheck};function getContextParams$1(t,e){var r=t.map(function(n){return n.activeState.value});return new ContextParams(r,0)}function latinLigature(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),a=getContextParams$1(n);a.context.forEach(function(o,s){a.setCurrentIndex(s);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:a});l.length&&(l.forEach(function(c){return applySubstitution(c,n,s)}),a=getContextParams$1(n))})}function Bidi(t){this.baseDir=t||"ltr",this.tokenizer=new Tokenizer,this.featuresTags={}}Bidi.prototype.setText=function(t){this.text=t},Bidi.prototype.contextChecks={latinWordCheck,arabicWordCheck,arabicSentenceCheck};function registerContextChecker(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function tokenizeText(){return registerContextChecker.call(this,"latinWord"),registerContextChecker.call(this,"arabicWord"),registerContextChecker.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function reverseArabicSentences(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Bidi.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(a){return r.query.supports({script:t,tag:a})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},Bidi.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new FeatureQuery(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},Bidi.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function checkGlyphIndexStatus(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function applyArabicPresentationForms(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){checkGlyphIndexStatus.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){arabicPresentationForms.call(t,n)})}}function applyArabicRequireLigatures(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){checkGlyphIndexStatus.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(a){arabicRequiredLigatures.call(t,a)})}}}function applyLatinLigatures(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){checkGlyphIndexStatus.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(a){latinLigature.call(t,a)})}}}Bidi.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},Bidi.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(applyArabicPresentationForms.call(this),applyArabicRequireLigatures.call(this)),this.checkContextReady("latinWord")&&applyLatinLigatures.call(this),this.checkContextReady("arabicSentence")&&reverseArabicSentences.call(this)},Bidi.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),tokenizeText.call(this),this.applyFeaturesToContexts())},Bidi.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},Bidi.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var a=n.activeState.value;e.push(Array.isArray(a)?a[0]:a)}}return e};function Font(t){t=t||{},t.tables=t.tables||{},t.empty||(checkArgument(t.familyName,"When creating a new Font object, familyName is required."),checkArgument(t.styleName,"When creating a new Font object, styleName is required."),checkArgument(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),checkArgument(t.ascender,"When creating a new Font object, ascender is required."),checkArgument(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new glyphset.GlyphSet(this,t.glyphs||[]),this.encoding=new DefaultEncoding(this),this.position=new Position(this),this.substitution=new Substitution(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Hinting(this)}})}Font.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null},Font.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},Font.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},Font.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})},Font.prototype.stringToGlyphs=function(t,e){var r=this,n=new Bidi,a=function(y){return r.charToGlyphIndex(y.char)};n.registerModifier("glyphIndex",null,a);var o=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,o);for(var s=n.getTextGlyphs(t),l=s.length,c=new Array(l),p=this.glyphs.get(0),d=0;d<l;d+=1)c[d]=this.glyphs.get(s[d])||p;return c},Font.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},Font.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},Font.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},Font.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0},Font.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Font.prototype.forEachGlyph=function(t,e,r,n,a,o){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,a=Object.assign({},this.defaultRenderOptions,a);var s=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,a),c;if(a.kerning){var p=a.script||this.position.getDefaultScriptName();c=this.position.getKerningTables(p,a.language)}for(var d=0;d<l.length;d+=1){var y=l[d];if(o.call(this,y,e,r,n,a),y.advanceWidth&&(e+=y.advanceWidth*s),a.kerning&&d<l.length-1){var m=c?this.position.getKerningValue(c,y.index,l[d+1].index):this.getKerningValue(y,l[d+1]);e+=m*s}a.letterSpacing?e+=a.letterSpacing*n:a.tracking&&(e+=a.tracking/1e3*n)}return e},Font.prototype.getPath=function(t,e,r,n,a){var o=new Path;return this.forEachGlyph(t,e,r,n,a,function(s,l,c,p){var d=s.getPath(l,c,p,a,this);o.extend(d)}),o},Font.prototype.getPaths=function(t,e,r,n,a){var o=[];return this.forEachGlyph(t,e,r,n,a,function(s,l,c,p){var d=s.getPath(l,c,p,a,this);o.push(d)}),o},Font.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})},Font.prototype.draw=function(t,e,r,n,a,o){this.getPath(e,r,n,a,o).draw(t)},Font.prototype.drawPoints=function(t,e,r,n,a,o){this.forEachGlyph(e,r,n,a,o,function(s,l,c,p){s.drawPoints(t,l,c,p)})},Font.prototype.drawMetrics=function(t,e,r,n,a,o){this.forEachGlyph(e,r,n,a,o,function(s,l,c,p){s.drawMetrics(t,l,c,p)})},Font.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},Font.prototype.validate=function(){var t=this;function e(n,a){}function r(n){var a=t.getEnglishName(n);a&&a.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},Font.prototype.toTables=function(){return sfnt.fontToTable(this)},Font.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Font.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0;a<e.length;a++)n[a]=e[a];return r},Font.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(isBrowser())if(window.URL=window.URL||window.webkitURL,window.URL){var a=new DataView(n),o=new Blob([a],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(o),s.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),s.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),p=arrayBufferToNodeBuffer(n);c.writeFileSync(t,p)}},Font.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Font.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Font.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function addName(t,e){var r=JSON.stringify(t),n=256;for(var a in e){var o=parseInt(a);if(!(!o||o<256)){if(JSON.stringify(e[a])===r)return o;n<=o&&(n=o+1)}}return e[n]=t,n}function makeFvarAxis(t,e,r){var n=addName(e.name,r);return[{name:"tag_"+t,type:"TAG",value:e.tag},{name:"minValue_"+t,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+t,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+t,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+t,type:"USHORT",value:0},{name:"nameID_"+t,type:"USHORT",value:n}]}function parseFvarAxis(t,e,r){var n={},a=new parse$1.Parser(t,e);return n.tag=a.parseTag(),n.minValue=a.parseFixed(),n.defaultValue=a.parseFixed(),n.maxValue=a.parseFixed(),a.skip("uShort",1),n.name=r[a.parseUShort()]||{},n}function makeFvarInstance(t,e,r,n){for(var a=addName(e.name,n),o=[{name:"nameID_"+t,type:"USHORT",value:a},{name:"flags_"+t,type:"USHORT",value:0}],s=0;s<r.length;++s){var l=r[s].tag;o.push({name:"axis_"+t+" "+l,type:"FIXED",value:e.coordinates[l]<<16})}return o}function parseFvarInstance(t,e,r,n){var a={},o=new parse$1.Parser(t,e);a.name=n[o.parseUShort()]||{},o.skip("uShort",1),a.coordinates={};for(var s=0;s<r.length;++s)a.coordinates[r[s].tag]=o.parseFixed();return a}function makeFvarTable(t,e){var r=new table.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:t.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:t.instances.length},{name:"instanceSize",type:"USHORT",value:4+t.axes.length*4}]);r.offsetToData=r.sizeOf();for(var n=0;n<t.axes.length;n++)r.fields=r.fields.concat(makeFvarAxis(n,t.axes[n],e));for(var a=0;a<t.instances.length;a++)r.fields=r.fields.concat(makeFvarInstance(a,t.instances[a],t.axes,e));return r}function parseFvarTable(t,e,r){var n=new parse$1.Parser(t,e),a=n.parseULong();check.argument(a===65536,"Unsupported fvar table version.");var o=n.parseOffset16();n.skip("uShort",1);for(var s=n.parseUShort(),l=n.parseUShort(),c=n.parseUShort(),p=n.parseUShort(),d=[],y=0;y<s;y++)d.push(parseFvarAxis(t,e+o+y*l,r));for(var m=[],w=e+o+s*l,_=0;_<c;_++)m.push(parseFvarInstance(t,w+_*p,d,r));return{axes:d,instances:m}}var fvar={make:makeFvarTable,parse:parseFvarTable},attachList=function(){return{coverage:this.parsePointer(Parser.coverage),attachPoints:this.parseList(Parser.pointer(Parser.uShortList))}},caretValue=function(){var t=this.parseUShort();if(check.argument(t===1||t===2||t===3,"Unsupported CaretValue table version."),t===1)return{coordinate:this.parseShort()};if(t===2)return{pointindex:this.parseShort()};if(t===3)return{coordinate:this.parseShort()}},ligGlyph=function(){return this.parseList(Parser.pointer(caretValue))},ligCaretList=function(){return{coverage:this.parsePointer(Parser.coverage),ligGlyphs:this.parseList(Parser.pointer(ligGlyph))}},markGlyphSets=function(){return this.parseUShort(),this.parseList(Parser.pointer(Parser.coverage))};function parseGDEFTable(t,e){e=e||0;var r=new Parser(t,e),n=r.parseVersion(1);check.argument(n===1||n===1.2||n===1.3,"Unsupported GDEF table version.");var a={version:n,classDef:r.parsePointer(Parser.classDef),attachList:r.parsePointer(attachList),ligCaretList:r.parsePointer(ligCaretList),markAttachClassDef:r.parsePointer(Parser.classDef)};return n>=1.2&&(a.markGlyphSets=r.parsePointer(markGlyphSets)),a}var gdef={parse:parseGDEFTable},subtableParsers$1=new Array(10);subtableParsers$1[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(Parser.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(Parser.coverage),values:this.parseValueRecordList()};check.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},subtableParsers$1[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();check.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(Parser.coverage),a=this.parseUShort(),o=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:a,valueFormat2:o,pairSets:this.parseList(Parser.pointer(Parser.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(a),value2:this.parseValueRecord(o)}})))};if(r===2){var s=this.parsePointer(Parser.classDef),l=this.parsePointer(Parser.classDef),c=this.parseUShort(),p=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:a,valueFormat2:o,classDef1:s,classDef2:l,class1Count:c,class2Count:p,classRecords:this.parseList(c,Parser.list(p,function(){return{value1:this.parseValueRecord(a),value2:this.parseValueRecord(o)}}))}}},subtableParsers$1[3]=function(){return{error:"GPOS Lookup 3 not supported"}},subtableParsers$1[4]=function(){return{error:"GPOS Lookup 4 not supported"}},subtableParsers$1[5]=function(){return{error:"GPOS Lookup 5 not supported"}},subtableParsers$1[6]=function(){return{error:"GPOS Lookup 6 not supported"}},subtableParsers$1[7]=function(){return{error:"GPOS Lookup 7 not supported"}},subtableParsers$1[8]=function(){return{error:"GPOS Lookup 8 not supported"}},subtableParsers$1[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function parseGposTable(t,e){e=e||0;var r=new Parser(t,e),n=r.parseVersion(1);return check.argument(n===1||n===1.1,"Unsupported GPOS table version "+n),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers$1)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers$1),variations:r.parseFeatureVariationsList()}}var subtableMakers$1=new Array(10);function makeGposTable(t){return new table.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(t.lookups,subtableMakers$1)}])}var gpos={parse:parseGposTable,make:makeGposTable};function parseWindowsKernTable(t){var e={};t.skip("uShort");var r=t.parseUShort();check.argument(r===0,"Unsupported kern sub-table version."),t.skip("uShort",2);var n=t.parseUShort();t.skip("uShort",3);for(var a=0;a<n;a+=1){var o=t.parseUShort(),s=t.parseUShort(),l=t.parseShort();e[o+","+s]=l}return e}function parseMacKernTable(t){var e={};t.skip("uShort");var r=t.parseULong();r>1&&console.warn("Only the first kern subtable is supported."),t.skip("uLong");var n=t.parseUShort(),a=n&255;if(t.skip("uShort"),a===0){var o=t.parseUShort();t.skip("uShort",3);for(var s=0;s<o;s+=1){var l=t.parseUShort(),c=t.parseUShort(),p=t.parseShort();e[l+","+c]=p}}return e}function parseKernTable(t,e){var r=new parse$1.Parser(t,e),n=r.parseUShort();if(n===0)return parseWindowsKernTable(r);if(n===1)return parseMacKernTable(r);throw new Error("Unsupported kern table version ("+n+").")}var kern={parse:parseKernTable};function parseLocaTable(t,e,r,n){for(var a=new parse$1.Parser(t,e),o=n?a.parseUShort:a.parseULong,s=[],l=0;l<r+1;l+=1){var c=o.call(a);n&&(c*=2),s.push(c)}return s}var loca={parse:parseLocaTable};function loadFromFile(t,e){var r=require("fs");r.readFile(t,function(n,a){if(n)return e(n.message);e(null,nodeBufferToArrayBuffer(a))})}function loadFromUrl(t,e){var r=new XMLHttpRequest;r.open("get",t,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?e(null,r.response):e("Font could not be loaded: "+r.statusText)},r.onerror=function(){e("Font could not be loaded")},r.send()}function parseOpenTypeTableEntries(t,e){for(var r=[],n=12,a=0;a<e;a+=1){var o=parse$1.getTag(t,n),s=parse$1.getULong(t,n+4),l=parse$1.getULong(t,n+8),c=parse$1.getULong(t,n+12);r.push({tag:o,checksum:s,offset:l,length:c,compression:!1}),n+=16}return r}function parseWOFFTableEntries(t,e){for(var r=[],n=44,a=0;a<e;a+=1){var o=parse$1.getTag(t,n),s=parse$1.getULong(t,n+4),l=parse$1.getULong(t,n+8),c=parse$1.getULong(t,n+12),p=void 0;l<c?p="WOFF":p=!1,r.push({tag:o,offset:s,compression:p,compressedLength:l,length:c}),n+=20}return r}function uncompressTable(t,e){if(e.compression==="WOFF"){var r=new Uint8Array(t.buffer,e.offset+2,e.compressedLength-2),n=new Uint8Array(e.length);if(tinyInflate(r,n),n.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var a=new DataView(n.buffer,0);return{data:a,offset:0}}else return{data:t,offset:e.offset}}function parseBuffer(t,e){e=e??{};var r,n,a=new Font({empty:!0}),o=new DataView(t,0),s,l=[],c=parse$1.getTag(o,0);if(c==="\0\0\0"||c==="true"||c==="typ1")a.outlinesFormat="truetype",s=parse$1.getUShort(o,4),l=parseOpenTypeTableEntries(o,s);else if(c==="OTTO")a.outlinesFormat="cff",s=parse$1.getUShort(o,4),l=parseOpenTypeTableEntries(o,s);else if(c==="wOFF"){var p=parse$1.getTag(o,4);if(p==="\0\0\0")a.outlinesFormat="truetype";else if(p==="OTTO")a.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+c);s=parse$1.getUShort(o,12),l=parseWOFFTableEntries(o,s)}else throw new Error("Unsupported OpenType signature "+c);for(var d,y,m,w,_,E,x,k,R,A,G,L,q=0;q<s;q+=1){var V=l[q],U=void 0;switch(V.tag){case"cmap":U=uncompressTable(o,V),a.tables.cmap=cmap.parse(U.data,U.offset),a.encoding=new CmapEncoding(a.tables.cmap);break;case"cvt ":U=uncompressTable(o,V),L=new parse$1.Parser(U.data,U.offset),a.tables.cvt=L.parseShortList(V.length/2);break;case"fvar":y=V;break;case"fpgm":U=uncompressTable(o,V),L=new parse$1.Parser(U.data,U.offset),a.tables.fpgm=L.parseByteList(V.length);break;case"head":U=uncompressTable(o,V),a.tables.head=head.parse(U.data,U.offset),a.unitsPerEm=a.tables.head.unitsPerEm,r=a.tables.head.indexToLocFormat;break;case"hhea":U=uncompressTable(o,V),a.tables.hhea=hhea.parse(U.data,U.offset),a.ascender=a.tables.hhea.ascender,a.descender=a.tables.hhea.descender,a.numberOfHMetrics=a.tables.hhea.numberOfHMetrics;break;case"hmtx":x=V;break;case"ltag":U=uncompressTable(o,V),n=ltag.parse(U.data,U.offset);break;case"maxp":U=uncompressTable(o,V),a.tables.maxp=maxp.parse(U.data,U.offset),a.numGlyphs=a.tables.maxp.numGlyphs;break;case"name":A=V;break;case"OS/2":U=uncompressTable(o,V),a.tables.os2=os2.parse(U.data,U.offset);break;case"post":U=uncompressTable(o,V),a.tables.post=post.parse(U.data,U.offset),a.glyphNames=new GlyphNames(a.tables.post);break;case"prep":U=uncompressTable(o,V),L=new parse$1.Parser(U.data,U.offset),a.tables.prep=L.parseByteList(V.length);break;case"glyf":m=V;break;case"loca":R=V;break;case"CFF ":d=V;break;case"kern":k=V;break;case"GDEF":w=V;break;case"GPOS":_=V;break;case"GSUB":E=V;break;case"meta":G=V;break}}var W=uncompressTable(o,A);if(a.tables.name=_name.parse(W.data,W.offset,n),a.names=a.tables.name,m&&R){var oe=r===0,j=uncompressTable(o,R),fe=loca.parse(j.data,j.offset,a.numGlyphs,oe),ie=uncompressTable(o,m);a.glyphs=glyf.parse(ie.data,ie.offset,fe,a,e)}else if(d){var X=uncompressTable(o,d);cff.parse(X.data,X.offset,a,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var te=uncompressTable(o,x);if(hmtx.parse(a,te.data,te.offset,a.numberOfHMetrics,a.numGlyphs,a.glyphs,e),addGlyphNames(a,e),k){var H=uncompressTable(o,k);a.kerningPairs=kern.parse(H.data,H.offset)}else a.kerningPairs={};if(w){var $=uncompressTable(o,w);a.tables.gdef=gdef.parse($.data,$.offset)}if(_){var re=uncompressTable(o,_);a.tables.gpos=gpos.parse(re.data,re.offset),a.position.init()}if(E){var pe=uncompressTable(o,E);a.tables.gsub=gsub.parse(pe.data,pe.offset)}if(y){var ge=uncompressTable(o,y);a.tables.fvar=fvar.parse(ge.data,ge.offset,a.names)}if(G){var ae=uncompressTable(o,G);a.tables.meta=meta.parse(ae.data,ae.offset),a.metas=a.tables.meta}return a}function load(t,e,r){r=r??{};var n=typeof window>"u",a=n&&!r.isUrl?loadFromFile:loadFromUrl;return new Promise(function(o,s){a(t,function(l,c){if(l){if(e)return e(l);s(l)}var p;try{p=parseBuffer(c,r)}catch(d){if(e)return e(d,null);s(d)}if(e)return e(null,p);o(p)})})}function loadSync(t,e){var r=require("fs"),n=r.readFileSync(t);return parseBuffer(nodeBufferToArrayBuffer(n),e)}var opentype=Object.freeze({__proto__:null,Font,Glyph,Path,BoundingBox:BoundingBox2,_parse:parse$1,parse:parseBuffer,load,loadSync});const FONT_REGISTER={},loadFont=async(t,e="default")=>{const r=await opentype.load(t,null,{isUrl:!0});return FONT_REGISTER[e]=r,FONT_REGISTER.default||(FONT_REGISTER.default=r),r},getFont=(t="default")=>FONT_REGISTER[t],sketchFontCommands=function*(t){let e=null,r=null;for(const n of t){if(n.type==="Z"){e&&(yield e.close()),e=null;continue}const a=[-n.x,n.y];if(n.type==="M"){e&&(yield e.done()),e=new BlueprintSketcher,e.movePointerTo(a),r=a;continue}r&&Math.abs(a[0]-r[0])<1e-9&&Math.abs(a[1]-r[1])<1e-9||(n.type==="L"&&(e==null||e.lineTo(a)),n.type==="C"&&(e==null||e.cubicBezierCurveTo(a,[-n.x1,n.y1],[-n.x2,n.y2])),n.type==="Q"&&(e==null||e.quadraticBezierCurveTo(a,[-n.x1,n.y1])),r=a)}};function textBlueprints(t,{startX:e=0,startY:r=0,fontSize:n=16,fontFamily:a="default"}={}){const s=getFont(a).getPath(t,-e,-r,n),l=Array.from(sketchFontCommands(s.commands));return organiseBlueprints(l).mirror([0,0])}const uniqueId=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);async function importSTEP(t){const e=getOC(),[r,n]=localGC(),a=uniqueId(),o=new Uint8Array(await t.arrayBuffer());e.FS.writeFile(`/${a}`,o);const s=r(new e.STEPControl_Reader_1);if(s.ReadFile(a)){e.FS.unlink("/"+a),s.TransferRoots(r(new e.Message_ProgressRange_1));const l=r(s.OneShape()),c=cast(l);return n(),c}else throw e.FS.unlink("/"+a),n(),new Error("Failed to load STEP file")}async function importSTL(t){const e=getOC(),[r,n]=localGC(),a=uniqueId(),o=new Uint8Array(await t.arrayBuffer());e.FS.writeFile(`/${a}`,o);const s=r(new e.StlAPI_Reader),l=r(new e.TopoDS_Shell);if(s.Read(l,a)){e.FS.unlink("/"+a);const c=r(new e.ShapeUpgrade_UnifySameDomain_2(l,!0,!0,!1));c.Build();const p=r(c.Shape()),d=r(new e.BRepBuilderAPI_MakeSolid_1);d.Add(e.TopoDS.Shell_1(p));const y=r(d.Solid()),m=cast(y);return n(),m}else throw e.FS.unlink("/"+a),n(),new Error("Failed to load STL file")}const PROJECTION_PLANES={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function lookFromPlane(t){const{dir:e,xAxis:r}=PROJECTION_PLANES[t];return new ProjectionCamera([0,0,0],e,r)}function defaultXDir(t){const e=new Vector(t);let r=new Vector([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new Vector([0,1,0]),n=r.cross(e)),n.normalize()}class ProjectionCamera extends WrappingObj{constructor(e=[0,0,0],r=[0,0,1],n){const a=n?new Vector(n):defaultXDir(r),o=makeAx2(e,r,a);super(o)}get position(){return new Vector(this.wrapped.Location())}get direction(){return new Vector(this.wrapped.Direction())}get xAxis(){return new Vector(this.wrapped.XDirection())}get yAxis(){return new Vector(this.wrapped.YDirection())}autoAxes(){const e=defaultXDir(this.direction);this.wrapped.SetXDirection(asDir(e))}setPosition(e){return this.wrapped.SetLocation(asPnt(e)),this}setXAxis(e){return this.wrapped.SetYDirection(asDir(e)),this}setYAxis(e){return this.wrapped.SetYDirection(asDir(e)),this}lookAt(e){const r=new Vector("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const getEdges=t=>t.IsNull()?[]:cast(t).edges;function makeProjectedEdges(t,e,r=!0){const n=getOC(),a=GCWithScope(),o=a(new n.HLRBRep_Algo_1);o.Add_2(t.wrapped,0);const s=a(new n.HLRAlgo_Projector_2(e.wrapped));o.Projector_1(s),o.Update(),o.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(o)),c=[...getEdges(l.VCompound_1()),...getEdges(l.Rg1LineVCompound_1()),...getEdges(l.OutLineVCompound_1())];c.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped));const p=r?[...getEdges(l.HCompound_1()),...getEdges(l.Rg1LineHCompound_1()),...getEdges(l.OutLineHCompound_1())]:[];return p.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped)),{visible:c,hidden:p}}const PRECISION=1e-8,samePoint=(t,e)=>samePoint$2(t,e,PRECISION*10);function rawOffsets(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(p=>({offset:make2dOffset(p,r),original:p})),a=[];let o=null,s=n.at(-1);if(!s)return[];if(a.length===1)return a;const l=p=>{o?p.offset instanceof Curve2D?a.push(p.offset):samePoint(p.offset.firstPoint,p.offset.lastPoint)||a.push(make2dSegmentCurve(p.offset.firstPoint,p.offset.lastPoint)):o=p},c=function*(){for(const p of n.slice(0,-1))yield p;if(!o)throw new Error("Bug in the offset algorithm");yield o};for(const p of c()){const d=s.offset.lastPoint,y=p.offset.firstPoint;if(samePoint(d,y)){l(s),s=p;continue}let m=[];if(s.offset instanceof Curve2D&&p.offset instanceof Curve2D){const{intersections:_,commonSegmentsPoints:E}=intersectCurves(s.offset,p.offset,PRECISION/100);m=[..._,...E]}if(m.length>0){let _=m[0];if(m.length>1){const k=s==null?void 0:s.original.lastPoint,R=m.map(A=>squareDistance2d(A,k));_=m[R.indexOf(Math.min(...R))]}const E=s.offset.splitAt([_],PRECISION)[0],x=p.offset.splitAt([_],PRECISION).at(-1);if(!x)throw new Error("Bug in the splitting algo in offset");l({offset:E,original:s.original}),s={offset:x,original:p.original};continue}const w=make2dArcFromCenter(d,y,s.original.lastPoint);l(s),a.push(w),s=p}return l(s),a}function offsetBlueprint(t,e){const r=rawOffsets(t,e);if(r.length<2)return null;const n=new Map,a=(p,d)=>{const y=n.get(p)||[];n.set(p,[...y,...d])};if(r.forEach((p,d)=>{r.slice(d+1).forEach((y,m)=>{const{intersections:w,commonSegmentsPoints:_}=intersectCurves(p,y,PRECISION),E=[...w,..._].filter(x=>{const k=samePoint(x,p.firstPoint)||samePoint(x,p.lastPoint),R=samePoint(x,y.firstPoint)||samePoint(x,y.lastPoint);return!(k&&R)});E.length&&(a(d,E),a(m+d+1,E))})}),!n.size){const p=new Blueprint(r);return t.intersects(p)?null:p}const s=r.flatMap((p,d)=>{if(!n.has(d))return p;const y=n.get(d)||[];return p.splitAt(y,PRECISION*100)}).filter(p=>!t.curves.find(y=>y.distanceFrom(p)<Math.abs(e)-PRECISION));if(!s.length)return null;const c=stitchCurves(s).filter(p=>p.length>1).map(p=>new Blueprint(p)).filter(p=>p.isClosed());return c.length?c.length===1?c[0]:new Blueprints(c):null}const fuseAll=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=fuse2D(e,t[r]);return e};function offset(t,e){if(t instanceof Blueprint)return offsetBlueprint(t,e);if(t instanceof Blueprints)return fuseAll(t.blueprints.map(r=>offset(r,e)));if(t instanceof CompoundBlueprint){const r=fuseAll(t.blueprints.slice(1).map(n=>offset(n,e)));return cut2D(offset(t.blueprints[0],e),r)}return null}function modifyCorners(t,e,r,n){let a=()=>!0;n&&(a=n.shouldKeep.bind(n));const o=[e.curves[0]],s=(c,p)=>{a({firstCurve:c,secondCurve:p,point:c.lastPoint})?o.push(...t(c,p,r)):o.push(c,p)};e.curves.slice(1).forEach(c=>{const p=o.pop();if(!p)throw new Error("Bug in the blueprint filletting algo");s(p,c)});const l=o.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(samePoint$2(o[0].firstPoint,l.lastPoint)&&o.length>1){const c=o.pop(),p=o.shift();if(!c||!p)throw new Error("Bug in the blueprint filletting algo");s(c,p)}return new Blueprint(o)}function modifyCorner2D(t,e,r,n){if(e instanceof Blueprint)return modifyCorners(t,e,r,n);if(e instanceof CompoundBlueprint)return new CompoundBlueprint(e.blueprints.map(a=>modifyCorners(t,a,r,n)));if(e instanceof Blueprints){const a=e.blueprints.map(o=>modifyCorner2D(t,o,r,n)).filter(o=>o!==null);return new Blueprints(a)}return null}function fillet2D(t,e,r){return modifyCorner2D(filletCurves,t,e,r)}function chamfer2D(t,e,r){return modifyCorner2D(chamferCurves,t,e,r)}class Drawing{constructor(e=null){this.innerShape=e}clone(){var e;return new Drawing(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new BoundingBox2d}stretch(e,r,n){return this.innerShape?new Drawing(this.innerShape.stretch(e,r,n)):new Drawing}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Drawing(this.innerShape.rotate(e,r)):new Drawing}translate(e,r=0){return this.innerShape?new Drawing(this.innerShape.translate(e,r)):new Drawing}scale(e,r){return this.innerShape?new Drawing(this.innerShape.scale(e,r)):new Drawing}mirror(e,r,n){return this.innerShape?new Drawing(this.innerShape.mirror(e,r,n)):new Drawing}cut(e){return new Drawing(cut2D(this.innerShape,e.innerShape))}fuse(e){return new Drawing(fuse2D(this.innerShape,e.innerShape))}intersect(e){return new Drawing(intersect2D(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new CornerFinder);return new Drawing(fillet2D(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new CornerFinder);return new Drawing(chamfer2D(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Drawing(offset(this.innerShape,e))}get blueprint(){if(!(this.innerShape instanceof Blueprint)){if(this.innerShape instanceof Blueprints&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof Blueprint)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class DrawingPen extends BaseSketcher2d{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Drawing(new Blueprint(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}function draw(t){const e=new DrawingPen;return t&&e.movePointerTo(t),e}function drawRoundedRectangle(t,e,r=0){return new Drawing(roundedRectangleBlueprint$1(t,e,r))}const drawRectangle=drawRoundedRectangle;function drawCircle(t){return draw().movePointerTo([-t,0]).sagittaArc(2*t,0,t).sagittaArc(-2*t,0,t).close()}function drawPolysides(t,e,r=0){return new Drawing(polysidesBlueprint(t,e,r))}function drawText(t,{startX:e=0,startY:r=0,fontSize:n=16,fontFamily:a="default"}={}){return new Drawing(textBlueprints(t,{startX:e,startY:r,fontSize:n,fontFamily:a}))}const edgesToDrawing=t=>{const e=drawRectangle(1e3,1e3).sketchOnPlane().face(),r=t.map(a=>edgeToCurve(a,e)),n=stitchCurves(r).map(a=>new Blueprint(a));return n.length===0?new Drawing:n.length===1?new Drawing(n[0]):new Drawing(new Blueprints(n))};function drawProjection(t,e="front"){let r;e instanceof ProjectionCamera?r=e:r=lookFromPlane(e);const{visible:n,hidden:a}=makeProjectedEdges(t,r);return{visible:edgesToDrawing(n),hidden:edgesToDrawing(a)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),finalizer=Symbol("Comlink.finalizer"),throwMarker=Symbol("Comlink.thrown"),isObject=t=>typeof t=="object"&&t!==null||typeof t=="function",proxyTransferHandler={canHandle:t=>isObject(t)&&t[proxyMarker],serialize(t){const{port1:e,port2:r}=new MessageChannel;return expose(t,e),[r,[r]]},deserialize(t){return t.start(),wrap(t)}},throwTransferHandler={canHandle:t=>isObject(t)&&throwMarker in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},transferHandlers=new Map([["proxy",proxyTransferHandler],["throw",throwTransferHandler]]);function isAllowedOrigin(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function expose(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(a){if(!a||!a.data)return;if(!isAllowedOrigin(r,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:o,type:s,path:l}=Object.assign({path:[]},a.data),c=(a.data.argumentList||[]).map(fromWireValue);let p;try{const d=l.slice(0,-1).reduce((m,w)=>m[w],t),y=l.reduce((m,w)=>m[w],t);switch(s){case"GET":p=y;break;case"SET":d[l.slice(-1)[0]]=fromWireValue(a.data.value),p=!0;break;case"APPLY":p=y.apply(d,c);break;case"CONSTRUCT":{const m=new y(...c);p=proxy(m)}break;case"ENDPOINT":{const{port1:m,port2:w}=new MessageChannel;expose(t,w),p=transfer(m,[m])}break;case"RELEASE":p=void 0;break;default:return}}catch(d){p={value:d,[throwMarker]:0}}Promise.resolve(p).catch(d=>({value:d,[throwMarker]:0})).then(d=>{const[y,m]=toWireValue(d);e.postMessage(Object.assign(Object.assign({},y),{id:o}),m),s==="RELEASE"&&(e.removeEventListener("message",n),closeEndPoint(e),finalizer in t&&typeof t[finalizer]=="function"&&t[finalizer]())}).catch(d=>{const[y,m]=toWireValue({value:new TypeError("Unserializable return value"),[throwMarker]:0});e.postMessage(Object.assign(Object.assign({},y),{id:o}),m)})}),e.start&&e.start()}function isMessagePort(t){return t.constructor.name==="MessagePort"}function closeEndPoint(t){isMessagePort(t)&&t.close()}function wrap(t,e){return createProxy(t,[],e)}function throwIfProxyReleased(t){if(t)throw new Error("Proxy has been released and is not useable")}function releaseEndpoint(t){return requestResponseMessage(t,{type:"RELEASE"}).then(()=>{closeEndPoint(t)})}const proxyCounter=new WeakMap,proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(proxyCounter.get(t)||0)-1;proxyCounter.set(t,e),e===0&&releaseEndpoint(t)});function registerProxy(t,e){const r=(proxyCounter.get(e)||0)+1;proxyCounter.set(e,r),proxyFinalizers&&proxyFinalizers.register(t,e,t)}function unregisterProxy(t){proxyFinalizers&&proxyFinalizers.unregister(t)}function createProxy(t,e=[],r=function(){}){let n=!1;const a=new Proxy(r,{get(o,s){if(throwIfProxyReleased(n),s===releaseProxy)return()=>{unregisterProxy(a),releaseEndpoint(t),n=!0};if(s==="then"){if(e.length===0)return{then:()=>a};const l=requestResponseMessage(t,{type:"GET",path:e.map(c=>c.toString())}).then(fromWireValue);return l.then.bind(l)}return createProxy(t,[...e,s])},set(o,s,l){throwIfProxyReleased(n);const[c,p]=toWireValue(l);return requestResponseMessage(t,{type:"SET",path:[...e,s].map(d=>d.toString()),value:c},p).then(fromWireValue)},apply(o,s,l){throwIfProxyReleased(n);const c=e[e.length-1];if(c===createEndpoint)return requestResponseMessage(t,{type:"ENDPOINT"}).then(fromWireValue);if(c==="bind")return createProxy(t,e.slice(0,-1));const[p,d]=processArguments(l);return requestResponseMessage(t,{type:"APPLY",path:e.map(y=>y.toString()),argumentList:p},d).then(fromWireValue)},construct(o,s){throwIfProxyReleased(n);const[l,c]=processArguments(s);return requestResponseMessage(t,{type:"CONSTRUCT",path:e.map(p=>p.toString()),argumentList:l},c).then(fromWireValue)}});return registerProxy(a,t),a}function myFlat(t){return Array.prototype.concat.apply([],t)}function processArguments(t){const e=t.map(toWireValue);return[e.map(r=>r[0]),myFlat(e.map(r=>r[1]))]}const transferCache=new WeakMap;function transfer(t,e){return transferCache.set(t,e),t}function proxy(t){return Object.assign(t,{[proxyMarker]:!0})}function toWireValue(t){for(const[e,r]of transferHandlers)if(r.canHandle(t)){const[n,a]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},a]}return[{type:"RAW",value:t},transferCache.get(t)||[]]}function fromWireValue(t){switch(t.type){case"HANDLER":return transferHandlers.get(t.name).deserialize(t.value);case"RAW":return t.value}}function requestResponseMessage(t,e,r){return new Promise(n=>{const a=generateUUID();t.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==a||(t.removeEventListener("message",o),n(s.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:a},e),r)})}function generateUUID(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let EPS=1e-6;const atan2=Math.atan2,grahamScan2=(t,e=EPS)=>{const r=t.length;if(r<=3)return t.slice();let n=1,a,o,s,l,c,p;const d=findMin(t);[c,p]=t[d];const y=[];for(a=0;a<r;a++)o=t[a],y[a]={p:o,t:atan2(o[1]-p,o[0]-c)};y.sort((w,_)=>w.t!==_.t?w.t-_.t:w.p[0]-_.p[0]);const m=[y[0].p];for(a=1;a<r;a++){for(o=m[n-2],s=m[n-1],l=y[a].p,c=l[0],p=l[1];n>1&&notCCW(o[0],o[1],s[0],s[1],c,p,e)||n===1&&s[0]===c&&s[1]===p;)n--,s=o,o=m[n-2];m[n++]=l}return m.length=n,m},notCCW=(t,e,r,n,a,o,s)=>(n-e)*(a-t)>=(r-t)*(o-e)-s,findMin=t=>{let e=t.length-1,r=e,[n,a]=t[e],o,s;for(;e-- >0;)o=t[e],s=o[1],(s<a||s===a&&o[0]<n)&&(n=o[0],a=s,r=e);return r};function makeSegmentCurve(t,e){return draw(t).lineTo(e).pendingCurves[0]}const range=t=>Array.from({length:t},(e,r)=>r),isSamePoint=([t,e],[r,n],a=1e-6)=>Math.abs(t-r)<=a&&Math.abs(e-n)<=a,zipWithNext=t=>t.slice(0,-1).map((e,r)=>[t[r],t[r+1]]).concat([[t.at(-1),t[0]]]),asPoints=(t,e)=>{const r=t.innerShape,n=r.blueprints||[r],a=0,o=e-1;let s=0;return n.flatMap(l=>{const c=l.curves;let p=c.flatMap((d,y)=>{const m=d.firstParameter,w=d.lastParameter,_=w-m,E=d.value(w),x=(y+1)%c.length,k=c[x];E.meta=[{curve:d,param:w,curveIndex:y+s,pointIndex:o},{curve:k,param:k.firstParameter,curveIndex:x+s,pointIndex:a}];const R=A=>m+A*_;return[E,...range(e-2).map(A=>{const G=R((A+1)/e),L=d.value(G);return L.meta={curve:d,param:G,curveIndex:y+s,pointIndex:A+1},L})]});return s+=c.length,p})};function shrinkWrap(t,e=100){const r=asPoints(t,e);let n=grahamScan2(r);n=n.flatMap((s,l)=>{const c=s.meta;if(!Array.isArray(c))return[s];const[p,d]=c.map(E=>{const x=[s[0],s[1]];return x.meta=E,x}),y=p.meta.curveIndex,m=d.meta.curveIndex,w=n[(l+1)%n.length].meta.curveIndex,_=n[(l-1+n.length)%n.length].meta.curveIndex;return y===w&&m===_?[d,p]:[p,d]});let a=zipWithNext(n).filter(([s,l])=>s.meta.curveIndex===l.meta.curveIndex?s.meta.curve.geomType==="LINE"?!1:Math.abs(l.meta.pointIndex-s.meta.pointIndex)!==1:!0).flat();a=a.filter((s,l)=>{const c=a[(l+1)%a.length],p=s.meta.curveIndex===c.meta.curveIndex,d=s.meta.pointIndex===c.meta.pointIndex;return!p||!d});const o=zipWithNext(a).filter(([s,l])=>!isSamePoint(s,l)).map(([s,l])=>{if(s.meta.curveIndex===l.meta.curveIndex){if(s.meta.pointIndex===0&&l.meta.pointIndex===e-1)return s.meta.curve;if(s.meta.pointIndex===e-1&&l.meta.pointIndex===0){let y=s.meta.curve.clone();return y.reverse(),y}const c=[s,l].filter(y=>y.meta.pointIndex!==0&&y.meta.pointIndex!==e-1).map(y=>y.meta.param),p=s.meta.curve.splitAt(c);let d=p[0];return s.meta.pointIndex!==0&&l.meta.pointIndex!==0&&(d=p[1]),s.meta.pointIndex>l.meta.pointIndex&&d.reverse(),d}return makeSegmentCurve(s,l)});return new Drawing(new Blueprint(o))}var entities={};entities.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",times:"",divide:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",euro:"",trade:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:""};var sax$1={},nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function ParseError$1(t,e){this.message=t,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,ParseError$1)}ParseError$1.prototype=new Error,ParseError$1.prototype.name=ParseError$1.name;function XMLReader$1(){}XMLReader$1.prototype={parse:function(t,e,r){var n=this.domBuilder;n.startDocument(),_copy(e,e={}),parse(t,e,r,n,this.errorHandler),n.endDocument()}};function parse(t,e,r,n,a){function o(H){if(H>65535){H-=65536;var $=55296+(H>>10),re=56320+(H&1023);return String.fromCharCode($,re)}else return String.fromCharCode(H)}function s(H){var $=H.slice(1,-1);return $ in r?r[$]:$.charAt(0)==="#"?o(parseInt($.substr(1).replace("x","0x"))):(a.error("entity not found:"+H),H)}function l(H){if(H>E){var $=t.substring(E,H).replace(/&#?\w+;/g,s);m&&c(E),n.characters($,0,H-E),E=H}}function c(H,$){for(;H>=d&&($=y.exec(t));)p=$.index,d=p+$[0].length,m.lineNumber++;m.columnNumber=H-p+1}for(var p=0,d=0,y=/.*(?:\r\n?|\n)|.*$/g,m=n.locator,w=[{currentNSMap:e}],_={},E=0;;){try{var x=t.indexOf("<",E);if(x<0){if(!t.substr(E).match(/^\s*$/)){var k=n.doc,R=k.createTextNode(t.substr(E));k.appendChild(R),n.currentElement=R}return}switch(x>E&&l(x),t.charAt(x+1)){case"/":var j=t.indexOf(">",x+3),A=t.substring(x+2,j),G=w.pop();j<0?(A=t.substring(x+2).replace(/[\s<].*/,""),a.error("end tag name: "+A+" is not complete:"+G.tagName),j=x+1+A.length):A.match(/\s</)&&(A=A.replace(/[\s<].*/,""),a.error("end tag name: "+A+" maybe not complete"),j=x+1+A.length);var L=G.localNSMap,q=G.tagName==A,V=q||G.tagName&&G.tagName.toLowerCase()==A.toLowerCase();if(V){if(n.endElement(G.uri,G.localName,A),L)for(var U in L)n.endPrefixMapping(U);q||a.fatalError("end tag name: "+A+" is not match the current start tagName:"+G.tagName)}else w.push(G);j++;break;case"?":m&&c(x),j=parseInstruction(t,x,n);break;case"!":m&&c(x),j=parseDCC(t,x,n,a);break;default:m&&c(x);var W=new ElementAttributes,oe=w[w.length-1].currentNSMap,j=parseElementStartPart(t,x,W,oe,s,a),fe=W.length;if(!W.closed&&fixSelfClosed(t,j,W.tagName,_)&&(W.closed=!0,r.nbsp||a.warning("unclosed xml attribute")),m&&fe){for(var ie=copyLocator(m,{}),X=0;X<fe;X++){var te=W[X];c(te.offset),te.locator=copyLocator(m,{})}n.locator=ie,appendElement$1(W,n,oe)&&w.push(W),n.locator=m}else appendElement$1(W,n,oe)&&w.push(W);W.uri==="http://www.w3.org/1999/xhtml"&&!W.closed?j=parseHtmlSpecialContent(t,j,W.tagName,s,n):j++}}catch(H){if(H instanceof ParseError$1)throw H;a.error("element parse error: "+H),j=-1}j>E?E=j:l(Math.max(x,E)+1)}}function copyLocator(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function parseElementStartPart(t,e,r,n,a,o){function s(m,w,_){m in r.attributeNames&&o.fatalError("Attribute "+m+" redefined"),r.addValue(m,w,_)}for(var l,c,p=++e,d=S_TAG;;){var y=t.charAt(p);switch(y){case"=":if(d===S_ATTR)l=t.slice(e,p),d=S_EQ;else if(d===S_ATTR_SPACE)d=S_EQ;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(d===S_EQ||d===S_ATTR)if(d===S_ATTR&&(o.warning('attribute value must after "="'),l=t.slice(e,p)),e=p+1,p=t.indexOf(y,e),p>0)c=t.slice(e,p).replace(/&#?\w+;/g,a),s(l,c,e-1),d=S_ATTR_END;else throw new Error("attribute value no end '"+y+"' match");else if(d==S_ATTR_NOQUOT_VALUE)c=t.slice(e,p).replace(/&#?\w+;/g,a),s(l,c,e),o.warning('attribute "'+l+'" missed start quot('+y+")!!"),e=p+1,d=S_ATTR_END;else throw new Error('attribute value must after "="');break;case"/":switch(d){case S_TAG:r.setTagName(t.slice(e,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:d=S_TAG_CLOSE,r.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return o.error("unexpected end of input"),d==S_TAG&&r.setTagName(t.slice(e,p)),p;case">":switch(d){case S_TAG:r.setTagName(t.slice(e,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:c=t.slice(e,p),c.slice(-1)==="/"&&(r.closed=!0,c=c.slice(0,-1));case S_ATTR_SPACE:d===S_ATTR_SPACE&&(c=l),d==S_ATTR_NOQUOT_VALUE?(o.warning('attribute "'+c+'" missed quot(")!'),s(l,c.replace(/&#?\w+;/g,a),e)):((n[""]!=="http://www.w3.org/1999/xhtml"||!c.match(/^(?:disabled|checked|selected)$/i))&&o.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),s(c,c,e));break;case S_EQ:throw new Error("attribute value missed!!")}return p;case"":y=" ";default:if(y<=" ")switch(d){case S_TAG:r.setTagName(t.slice(e,p)),d=S_TAG_SPACE;break;case S_ATTR:l=t.slice(e,p),d=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var c=t.slice(e,p).replace(/&#?\w+;/g,a);o.warning('attribute "'+c+'" missed quot(")!!'),s(l,c,e);case S_ATTR_END:d=S_TAG_SPACE;break}else switch(d){case S_ATTR_SPACE:r.tagName,(n[""]!=="http://www.w3.org/1999/xhtml"||!l.match(/^(?:disabled|checked|selected)$/i))&&o.warning('attribute "'+l+'" missed value!! "'+l+'" instead2!!'),s(l,l,e),e=p,d=S_ATTR;break;case S_ATTR_END:o.warning('attribute space is required"'+l+'"!!');case S_TAG_SPACE:d=S_ATTR,e=p;break;case S_EQ:d=S_ATTR_NOQUOT_VALUE,e=p;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}p++}}function appendElement$1(t,e,r){for(var n=t.tagName,a=null,y=t.length;y--;){var o=t[y],s=o.qName,l=o.value,m=s.indexOf(":");if(m>0)var c=o.prefix=s.slice(0,m),p=s.slice(m+1),d=c==="xmlns"&&p;else p=s,c=null,d=s==="xmlns"&&"";o.localName=p,d!==!1&&(a==null&&(a={},_copy(r,r={})),r[d]=a[d]=l,o.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(d,l))}for(var y=t.length;y--;){o=t[y];var c=o.prefix;c&&(c==="xml"&&(o.uri="http://www.w3.org/XML/1998/namespace"),c!=="xmlns"&&(o.uri=r[c||""]))}var m=n.indexOf(":");m>0?(c=t.prefix=n.slice(0,m),p=t.localName=n.slice(m+1)):(c=null,p=t.localName=n);var w=t.uri=r[c||""];if(e.startElement(w,p,n,t),t.closed){if(e.endElement(w,p,n),a)for(c in a)e.endPrefixMapping(c)}else return t.currentNSMap=r,t.localNSMap=a,!0}function parseHtmlSpecialContent(t,e,r,n,a){if(/^(?:script|textarea)$/i.test(r)){var o=t.indexOf("</"+r+">",e),s=t.substring(e+1,o);if(/[&<]/.test(s))return/^script$/i.test(r)?(a.characters(s,0,s.length),o):(s=s.replace(/&#?\w+;/g,n),a.characters(s,0,s.length),o)}return e+1}function fixSelfClosed(t,e,r,n){var a=n[r];return a==null&&(a=t.lastIndexOf("</"+r+">"),a<e&&(a=t.lastIndexOf("</"+r)),n[r]=a),a<e}function _copy(t,e){for(var r in t)e[r]=t[r]}function parseDCC(t,e,r,n){var a=t.charAt(e+2);switch(a){case"-":if(t.charAt(e+3)==="-"){var o=t.indexOf("-->",e+4);return o>e?(r.comment(t,e+4,o-e-4),o+3):(n.error("Unclosed comment"),-1)}else return-1;default:if(t.substr(e+3,6)=="CDATA["){var o=t.indexOf("]]>",e+9);return r.startCDATA(),r.characters(t,e+9,o-e-9),r.endCDATA(),o+3}var s=split(t,e),l=s.length;if(l>1&&/!doctype/i.test(s[0][0])){var c=s[1][0],p=!1,d=!1;l>3&&(/^public$/i.test(s[2][0])?(p=s[3][0],d=l>4&&s[4][0]):/^system$/i.test(s[2][0])&&(d=s[3][0]));var y=s[l-1];return r.startDTD(c,p,d),r.endDTD(),y.index+y[0].length}}return-1}function parseInstruction(t,e,r){var n=t.indexOf("?>",e);if(n){var a=t.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return a?(a[0].length,r.processingInstruction(a[1],a[2]),n+2):-1}return-1}function ElementAttributes(){this.attributeNames={}}ElementAttributes.prototype={setTagName:function(t){if(!tagNamePattern.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},addValue:function(t,e,r){if(!tagNamePattern.test(t))throw new Error("invalid attribute:"+t);this.attributeNames[t]=this.length,this[this.length++]={qName:t,value:e,offset:r}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}};function split(t,e){var r,n=[],a=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(a.lastIndex=e,a.exec(t);r=a.exec(t);)if(n.push(r),r[1])return n}sax$1.XMLReader=XMLReader$1,sax$1.ParseError=ParseError$1;var dom={};function copy(t,e){for(var r in t)e[r]=t[r]}function _extends(t,e){var r=t.prototype;if(!(r instanceof e)){let n=function(){};n.prototype=e.prototype,n=new n,copy(r,n),t.prototype=r=n}r.constructor!=t&&(typeof t!="function"&&console.error("unknow Class:"+t),r.constructor=t)}var htmlns="http://www.w3.org/1999/xhtml",NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={};ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(t,e){if(e instanceof Error)var r=e;else r=this,Error.call(this,ExceptionMessage[t]),this.message=ExceptionMessage[t],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return r.code=t,e&&(this.message=this.message+": "+e),r}DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var r=[],n=0;n<this.length;n++)serializeToString(this[n],r,t,e);return r.join("")}};function LiveNodeList(t,e){this._node=t,this._refresh=e,_updateLiveList(this)}function _updateLiveList(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var r=t._refresh(t._node);__set__(t,"length",r.length),copy(r,t),t._inc=e}}LiveNodeList.prototype.item=function(t){return _updateLiveList(this),this[t]},_extends(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(t,e){for(var r=t.length;r--;)if(t[r]===e)return r}function _addNamedNode(t,e,r,n){if(n?e[_findNodeIndex(e,n)]=r:e[e.length++]=r,t){r.ownerElement=t;var a=t.ownerDocument;a&&(n&&_onRemoveAttribute(a,t,n),_onAddAttribute(a,t,r))}}function _removeNamedNode(t,e,r){var n=_findNodeIndex(e,r);if(n>=0){for(var a=e.length-1;n<a;)e[n]=e[++n];if(e.length=a,t){var o=t.ownerDocument;o&&(_onRemoveAttribute(o,t,r),r.ownerElement=null)}}else throw DOMException(NOT_FOUND_ERR,new Error(t.tagName+"@"+r))}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var r=this[e];if(r.nodeName==t)return r}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var r=this.getNamedItem(t.nodeName);return _addNamedNode(this._ownerElement,this,t,r),r},setNamedItemNS:function(t){var e=t.ownerElement,r;if(e&&e!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return r=this.getNamedItemNS(t.namespaceURI,t.localName),_addNamedNode(this._ownerElement,this,t,r),r},removeNamedItem:function(t){var e=this.getNamedItem(t);return _removeNamedNode(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var r=this.getNamedItemNS(t,e);return _removeNamedNode(this._ownerElement,this,r),r},getNamedItemNS:function(t,e){for(var r=this.length;r--;){var n=this[r];if(n.localName==e&&n.namespaceURI==t)return n}return null}};function DOMImplementation$1(t){if(this._features={},t)for(var e in t)this._features=t[e]}DOMImplementation$1.prototype={hasFeature:function(t,e){var r=this._features[t.toLowerCase()];return!!(r&&(!e||e in r))},createDocument:function(t,e,r){var n=new Document;if(n.implementation=this,n.childNodes=new NodeList,n.doctype=r,r&&n.appendChild(r),e){var a=n.createElementNS(t,e);n.appendChild(a)}return n},createDocumentType:function(t,e,r){var n=new DocumentType;return n.name=t,n.nodeName=t,n.publicId=e,n.systemId=r,n}};function Node(){}Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return _insertBefore(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return _removeChild(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(t){return cloneNode(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==TEXT_NODE&&t.nodeType==TEXT_NODE?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var r=e._nsMap;if(r){for(var n in r)if(r[n]==t)return n}e=e.nodeType==ATTRIBUTE_NODE?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var r=e._nsMap;if(r&&t in r)return r[t];e=e.nodeType==ATTRIBUTE_NODE?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){var e=this.lookupPrefix(t);return e==null}};function _xmlEncoder(t){return t=="<"&&"&lt;"||t==">"&&"&gt;"||t=="&"&&"&amp;"||t=='"'&&"&quot;"||"&#"+t.charCodeAt()+";"}copy(NodeType,Node),copy(NodeType,Node.prototype);function _visitNode(t,e){if(e(t))return!0;if(t=t.firstChild)do if(_visitNode(t,e))return!0;while(t=t.nextSibling)}function Document(){}function _onAddAttribute(t,e,r){t&&t._inc++;var n=r.namespaceURI;n=="http://www.w3.org/2000/xmlns/"&&(e._nsMap[r.prefix?r.localName:""]=r.value)}function _onRemoveAttribute(t,e,r,n){t&&t._inc++;var a=r.namespaceURI;a=="http://www.w3.org/2000/xmlns/"&&delete e._nsMap[r.prefix?r.localName:""]}function _onUpdateChild(t,e,r){if(t&&t._inc){t._inc++;var n=e.childNodes;if(r)n[n.length++]=r;else{for(var a=e.firstChild,o=0;a;)n[o++]=a,a=a.nextSibling;n.length=o}}}function _removeChild(t,e){var r=e.previousSibling,n=e.nextSibling;return r?r.nextSibling=n:t.firstChild=n,n?n.previousSibling=r:t.lastChild=r,_onUpdateChild(t.ownerDocument,t),e}function _insertBefore(t,e,r){var n=e.parentNode;if(n&&n.removeChild(e),e.nodeType===DOCUMENT_FRAGMENT_NODE){var a=e.firstChild;if(a==null)return e;var o=e.lastChild}else a=o=e;var s=r?r.previousSibling:t.lastChild;a.previousSibling=s,o.nextSibling=r,s?s.nextSibling=a:t.firstChild=a,r==null?t.lastChild=o:r.previousSibling=o;do a.parentNode=t;while(a!==o&&(a=a.nextSibling));return _onUpdateChild(t.ownerDocument||t,t),e.nodeType==DOCUMENT_FRAGMENT_NODE&&(e.firstChild=e.lastChild=null),e}function _appendSingleChild(t,e){var r=e.parentNode;if(r){var n=t.lastChild;r.removeChild(e);var n=t.lastChild}var n=t.lastChild;return e.parentNode=t,e.previousSibling=n,e.nextSibling=null,n?n.nextSibling=e:t.firstChild=e,t.lastChild=e,_onUpdateChild(t.ownerDocument,t,e),e}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==DOCUMENT_FRAGMENT_NODE){for(var r=t.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,e),r=n}return t}return this.documentElement==null&&t.nodeType==ELEMENT_NODE&&(this.documentElement=t),_insertBefore(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),_removeChild(this,t)},importNode:function(t,e){return importNode(this,t,e)},getElementById:function(t){var e=null;return _visitNode(this.documentElement,function(r){if(r.nodeType==ELEMENT_NODE&&r.getAttribute("id")==t)return e=r,!0}),e},getElementsByClassName:function(t){var e=new RegExp("(^|\\s)"+t+"(\\s|$)");return new LiveNodeList(this,function(r){var n=[];return _visitNode(r.documentElement,function(a){a!==r&&a.nodeType==ELEMENT_NODE&&e.test(a.getAttribute("class"))&&n.push(a)}),n})},createElement:function(t){var e=new Element;e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new NodeList;var r=e.attributes=new NamedNodeMap;return r._ownerElement=e,e},createDocumentFragment:function(){var t=new DocumentFragment;return t.ownerDocument=this,t.childNodes=new NodeList,t},createTextNode:function(t){var e=new Text;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new Comment;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new CDATASection;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var r=new ProcessingInstruction;return r.ownerDocument=this,r.tagName=r.target=t,r.nodeValue=r.data=e,r},createAttribute:function(t){var e=new Attr;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new EntityReference;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var r=new Element,n=e.split(":"),a=r.attributes=new NamedNodeMap;return r.childNodes=new NodeList,r.ownerDocument=this,r.nodeName=e,r.tagName=e,r.namespaceURI=t,n.length==2?(r.prefix=n[0],r.localName=n[1]):r.localName=e,a._ownerElement=r,r},createAttributeNS:function(t,e){var r=new Attr,n=e.split(":");return r.ownerDocument=this,r.nodeName=e,r.name=e,r.namespaceURI=t,r.specified=!0,n.length==2?(r.prefix=n[0],r.localName=n[1]):r.localName=e,r}},_extends(Document,Node);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(t){return this.getAttributeNode(t)!=null},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var r=this.ownerDocument.createAttribute(t);r.value=r.nodeValue=""+e,this.setAttributeNode(r)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(t,null):_appendSingleChild(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);r&&this.removeAttributeNode(r)},hasAttributeNS:function(t,e){return this.getAttributeNodeNS(t,e)!=null},getAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);return r&&r.value||""},setAttributeNS:function(t,e,r){var n=this.ownerDocument.createAttributeNS(t,e);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new LiveNodeList(this,function(e){var r=[];return _visitNode(e,function(n){n!==e&&n.nodeType==ELEMENT_NODE&&(t==="*"||n.tagName==t)&&r.push(n)}),r})},getElementsByTagNameNS:function(t,e){return new LiveNodeList(this,function(r){var n=[];return _visitNode(r,function(a){a!==r&&a.nodeType===ELEMENT_NODE&&(t==="*"||a.namespaceURI===t)&&(e==="*"||a.localName==e)&&n.push(a)}),n})}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends(Attr,Node);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,r){var n=this.data.substring(0,t),a=this.data.substring(t+e);r=n+r+a,this.nodeValue=this.data=r,this.length=r.length}},_extends(CharacterData,Node);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(t){var e=this.data,r=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},_extends(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE},_extends(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE},_extends(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends(DocumentType,Node);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE,_extends(Notation,Node);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE,_extends(Entity,Node);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends(EntityReference,Node);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends(DocumentFragment,Node);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends(ProcessingInstruction,Node);function XMLSerializer(){}XMLSerializer.prototype.serializeToString=function(t,e,r){return nodeSerializeToString.call(t,e,r)},Node.prototype.toString=nodeSerializeToString;function nodeSerializeToString(t,e){var r=[],n=this.nodeType==9&&this.documentElement||this,a=n.prefix,o=n.namespaceURI;if(o&&a==null){var a=n.lookupPrefix(o);if(a==null)var s=[{namespace:o,prefix:null}]}return serializeToString(this,r,t,e,s),r.join("")}function needNamespaceDefine(t,e,r){var n=t.prefix||"",a=t.namespaceURI;if(!n&&!a||n==="xml"&&a==="http://www.w3.org/XML/1998/namespace"||a=="http://www.w3.org/2000/xmlns/")return!1;for(var o=r.length;o--;){var s=r[o];if(s.prefix==n)return s.namespace!=a}return!0}function serializeToString(t,e,r,n,a){if(n)if(t=n(t),t){if(typeof t=="string"){e.push(t);return}}else return;switch(t.nodeType){case ELEMENT_NODE:a||(a=[]),a.length;var o=t.attributes,s=o.length,w=t.firstChild,l=t.tagName;r=htmlns===t.namespaceURI||r,e.push("<",l);for(var c=0;c<s;c++){var p=o.item(c);p.prefix=="xmlns"?a.push({prefix:p.localName,namespace:p.value}):p.nodeName=="xmlns"&&a.push({prefix:"",namespace:p.value})}for(var c=0;c<s;c++){var p=o.item(c);if(needNamespaceDefine(p,r,a)){var d=p.prefix||"",y=p.namespaceURI,m=d?" xmlns:"+d:" xmlns";e.push(m,'="',y,'"'),a.push({prefix:d,namespace:y})}serializeToString(p,e,r,n,a)}if(needNamespaceDefine(t,r,a)){var d=t.prefix||"",y=t.namespaceURI;if(y){var m=d?" xmlns:"+d:" xmlns";e.push(m,'="',y,'"'),a.push({prefix:d,namespace:y})}}if(w||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(e.push(">"),r&&/^script$/i.test(l))for(;w;)w.data?e.push(w.data):serializeToString(w,e,r,n,a),w=w.nextSibling;else for(;w;)serializeToString(w,e,r,n,a),w=w.nextSibling;e.push("</",l,">")}else e.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(var w=t.firstChild;w;)serializeToString(w,e,r,n,a),w=w.nextSibling;return;case ATTRIBUTE_NODE:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return e.push(t.data.replace(/[<&]/g,_xmlEncoder).replace(/]]>/g,"]]&gt;"));case CDATA_SECTION_NODE:return e.push("<![CDATA[",t.data,"]]>");case COMMENT_NODE:return e.push("<!--",t.data,"-->");case DOCUMENT_TYPE_NODE:var _=t.publicId,E=t.systemId;if(e.push("<!DOCTYPE ",t.name),_)e.push(" PUBLIC ",_),E&&E!="."&&e.push(" ",E),e.push(">");else if(E&&E!=".")e.push(" SYSTEM ",E,">");else{var x=t.internalSubset;x&&e.push(" [",x,"]"),e.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return e.push("<?",t.target," ",t.data,"?>");case ENTITY_REFERENCE_NODE:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function importNode(t,e,r){var n;switch(e.nodeType){case ELEMENT_NODE:n=e.cloneNode(!1),n.ownerDocument=t;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:r=!0;break}if(n||(n=e.cloneNode(!1)),n.ownerDocument=t,n.parentNode=null,r)for(var a=e.firstChild;a;)n.appendChild(importNode(t,a,r)),a=a.nextSibling;return n}function cloneNode(t,e,r){var n=new e.constructor;for(var a in e){var o=e[a];typeof o!="object"&&o!=n[a]&&(n[a]=o)}switch(e.childNodes&&(n.childNodes=new NodeList),n.ownerDocument=t,n.nodeType){case ELEMENT_NODE:var s=e.attributes,l=n.attributes=new NamedNodeMap,c=s.length;l._ownerElement=n;for(var p=0;p<c;p++)n.setAttributeNode(cloneNode(t,s.item(p),!0));break;case ATTRIBUTE_NODE:r=!0}if(r)for(var d=e.firstChild;d;)n.appendChild(cloneNode(t,d,r)),d=d.nextSibling;return n}function __set__(t,e,r){t[e]=r}try{if(Object.defineProperty){let t=function(e){switch(e.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var r=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&r.push(t(e)),e=e.nextSibling;return r.join("");default:return e.nodeValue}};Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return t(this)},set:function(e){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),__set__=function(e,r,n){e["$$"+r]=n}}}catch(t){}dom.Node=Node,dom.DOMException=DOMException,dom.DOMImplementation=DOMImplementation$1,dom.XMLSerializer=XMLSerializer;function DOMParser(t){this.options=t||{locator:{}}}DOMParser.prototype.parseFromString=function(t,e){var r=this.options,n=new XMLReader,a=r.domBuilder||new DOMHandler,o=r.errorHandler,s=r.locator,l=r.xmlns||{},c=/\/x?html?$/.test(e),p=c?htmlEntity.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&a.setDocumentLocator(s),n.errorHandler=buildErrorHandler(o,a,s),n.domBuilder=r.domBuilder||a,c&&(l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",t&&typeof t=="string"?n.parse(t,l,p):n.errorHandler.error("invalid doc source"),a.doc};function buildErrorHandler(t,e,r){if(!t){if(e instanceof DOMHandler)return e;t=e}var n={},a=t instanceof Function;r=r||{};function o(s){var l=t[s];!l&&a&&(l=t.length==2?function(c){t(s,c)}:t),n[s]=l&&function(c){l("[xmldom "+s+"]	"+c+_locator(r))}||function(){}}return o("warning"),o("error"),o("fatalError"),n}function DOMHandler(){this.cdata=!1}function position(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}DOMHandler.prototype={startDocument:function(){this.doc=new DOMImplementation().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,r,n){var a=this.doc,o=a.createElementNS(t,r||e),s=n.length;appendElement(this,o),this.currentElement=o,this.locator&&position(this.locator,o);for(var l=0;l<s;l++){var t=n.getURI(l),c=n.getValue(l),r=n.getQName(l),p=a.createAttributeNS(t,r);this.locator&&position(n.getLocator(l),p),p.value=p.nodeValue=c,o.setAttributeNode(p)}},endElement:function(t,e,r){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var r=this.doc.createProcessingInstruction(t,e);this.locator&&position(this.locator,r),appendElement(this,r)},ignorableWhitespace:function(t,e,r){},characters:function(t,e,r){if(t=_toString.apply(this,arguments),t){if(this.cdata)var n=this.doc.createCDATASection(t);else var n=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(t)&&this.doc.appendChild(n),this.locator&&position(this.locator,n)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,r){t=_toString.apply(this,arguments);var n=this.doc.createComment(t);this.locator&&position(this.locator,n),appendElement(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var a=n.createDocumentType(t,e,r);this.locator&&position(this.locator,a),appendElement(this,a)}},warning:function(t){console.warn("[xmldom warning]	"+t,_locator(this.locator))},error:function(t){console.error("[xmldom error]	"+t,_locator(this.locator))},fatalError:function(t){throw new ParseError(t,this.locator)}};function _locator(t){if(t)return`
@`+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function _toString(t,e,r){return typeof t=="string"?t.substr(e,r):t.length>=e+r||e?new java.lang.String(t,e,r)+"":t}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){DOMHandler.prototype[t]=function(){return null}});function appendElement(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}var htmlEntity=entities,sax=sax$1,XMLReader=sax.XMLReader,ParseError=sax.ParseError,DOMImplementation=dom.DOMImplementation,DOMParser_1=DOMParser;const fuseIntersectingBlueprints=t=>{const e=new Map,r=[];return t.forEach((n,a)=>{let o={current:n};e.has(a)?o=e.get(a):r.push(o);let s=o.current;t.slice(a+1).forEach((l,c)=>{const p=a+c+1;let d=l,y=!1;e.has(p)&&(d=e.get(p).current,y=!0),!s.boundingBox.isOut(d.boundingBox)&&s.intersects(d)&&(o.current=fuseBlueprints(s,d),y&&(e.get(p).current=!1),e.set(p,o))})}),r.map(({current:n})=>n).filter(n=>n)},COMMAND=0,NUMBER=1,EOD=2,PARAMS={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function tokenize(t){const e=new Array;for(;t!=="";)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:COMMAND,text:RegExp.$1},t=t.substr(RegExp.$1.length);else if(t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))e[e.length]={type:NUMBER,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length);else return[];return e[e.length]={type:EOD,text:""},e}function isType(t,e){return t.type===e}function parsePath(t){const e=[],r=tokenize(t);let n="BOD",a=0,o=r[a];for(;!isType(o,EOD);){let s=0;const l=[];if(n==="BOD")if(o.text==="M"||o.text==="m")a++,s=PARAMS[o.text],n=o.text;else return parsePath("M0,0"+t);else isType(o,NUMBER)?s=PARAMS[n]:(a++,s=PARAMS[o.text],n=o.text);if(a+s<r.length){for(let c=a;c<a+s;c++){const p=r[c];if(isType(p,NUMBER))l[l.length]=+p.text;else throw new Error("Param not a number: "+n+","+p.text)}if(typeof PARAMS[n]=="number"){const c={key:n,data:l};e.push(c),a+=s,o=r[a],n==="M"&&(n="L"),n==="m"&&(n="l")}else throw new Error("Bad segment: "+n)}else throw new Error("Path data ended short")}return e}function absolutize(t){let e=0,r=0,n=0,a=0;const o=[];for(const{key:s,data:l}of t)switch(s){case"M":o.push({key:"M",data:[...l]}),[e,r]=l,[n,a]=l;break;case"m":e+=l[0],r+=l[1],o.push({key:"M",data:[e,r]}),n=e,a=r;break;case"L":o.push({key:"L",data:[...l]}),[e,r]=l;break;case"l":e+=l[0],r+=l[1],o.push({key:"L",data:[e,r]});break;case"C":o.push({key:"C",data:[...l]}),e=l[4],r=l[5];break;case"c":{const c=l.map((p,d)=>d%2?p+r:p+e);o.push({key:"C",data:c}),e=c[4],r=c[5];break}case"Q":o.push({key:"Q",data:[...l]}),e=l[2],r=l[3];break;case"q":{const c=l.map((p,d)=>d%2?p+r:p+e);o.push({key:"Q",data:c}),e=c[2],r=c[3];break}case"A":o.push({key:"A",data:[...l]}),e=l[5],r=l[6];break;case"a":e+=l[5],r+=l[6],o.push({key:"A",data:[l[0],l[1],l[2],l[3],l[4],e,r]});break;case"H":o.push({key:"H",data:[...l]}),e=l[0];break;case"h":e+=l[0],o.push({key:"H",data:[e]});break;case"V":o.push({key:"V",data:[...l]}),r=l[0];break;case"v":r+=l[0],o.push({key:"V",data:[r]});break;case"S":o.push({key:"S",data:[...l]}),e=l[2],r=l[3];break;case"s":{const c=l.map((p,d)=>d%2?p+r:p+e);o.push({key:"S",data:c}),e=c[2],r=c[3];break}case"T":o.push({key:"T",data:[...l]}),e=l[0],r=l[1];break;case"t":e+=l[0],r+=l[1],o.push({key:"T",data:[e,r]});break;case"Z":case"z":o.push({key:"Z",data:[]}),e=n,r=a;break}return o}const roundedRectangleBlueprint=({x:t=0,y:e=0,rx:r=0,ry:n=0,width:a,height:o})=>{let s=Math.min(r,a/2),l=Math.min(n,o/2);const c=s&&l;c||(s=0,l=0);const p=new BlueprintSketcher([t+a/2,e]);return s<a/2&&p.hLine(a/2-s),c&&p.ellipse(s,l,s,l,0,!1,!0),l<o/2&&p.vLine(o-2*l),c&&p.ellipse(-s,l,s,l,0,!1,!0),p.hLine(-a/2+s).closeWithMirror()},ellipseBlueprint=({cx:t=0,cy:e=0,rx:r,ry:n})=>{const a=new BlueprintSketcher([t-r,e]);return a.halfEllipse(2*r,0,n,!1,!0),a.halfEllipse(-2*r,0,n,!1,!0),a.close()},parseArgs=(t,e,r)=>{let n,a=null,o=null;if(t.key==="M"){const[s,l]=t.data;return n=[s,l],{p:n}}if(t.key==="H"){const[s]=t.data;return n=[s,(e==null?void 0:e[1])||0],{p:n}}if(t.key==="V"){const[s]=t.data;return n=[(e==null?void 0:e[0])||0,s],{p:n}}if(t.key==="L"){const[s,l]=t.data;return n=[s,l],{p:n}}if(t.key==="C"){const[s,l,c,p,d,y]=t.data;return n=[d,y],a=[s,l],o=[c,p],{p:n,control1:a,control2:o}}if(t.key==="S"){const[s,l,c,p]=t.data;if(n=[c,p],o=[s,l],a=e,r.control2){const d=e;a=[d[0]+(d[0]-r.control2[0]),d[1]+(d[1]-r.control2[1])]}return{p:n,control1:a,control2:o}}if(t.key==="Q"){const[s,l,c,p]=t.data;return n=[c,p],a=[s,l],{p:n,control1:a}}if(t.key==="T"){const[s,l]=t.data;if(n=[s,l],a=e,r.control1&&!r.control2){const c=e;a=[c[0]+(c[0]-r.control1[0]),c[1]+(c[1]-r.control1[1])]}}if(t.key==="A"){const[s,l,c=0,p=0,d=0,y,m]=t.data;n=[y,m];const w=Math.sqrt((e[0]-y)**2+(e[1]-m)**2),_=Math.max(s,l);let E=s,x=l;if(_<w/2){const k=w/2/_;E=s*k,x=l*k}return{p:n,arcConfig:[E,x,c,!!p,!!d]}}},SVGPathBlueprint=function*(t){const e=absolutize(parsePath(t));let r=null,n=null,a={control1:null,control2:null};for(const o of e){if(o.key==="Z"){r&&(yield r.close()),r=null;continue}const{p:s,control1:l,control2:c,arcConfig:p=[]}=parseArgs(o,n,a);if(o.key==="M"){r&&(yield r.done()),r=new BlueprintSketcher(s),n=s;continue}if(n&&Math.abs(s[0]-n[0])<1e-9&&Math.abs(s[1]-n[1])<1e-9){n=s,a={control1:l,control2:c};continue}(o.key==="L"||o.key==="H"||o.key==="V")&&(r==null||r.lineTo(s)),(o.key==="C"||o.key==="S")&&(r==null||r.cubicBezierCurveTo(s,l,c)),(o.key==="Q"||o.key==="T")&&(r==null||r.quadraticBezierCurveTo(s,l)),o.key==="A"&&(r==null||r.ellipseTo(s,...p)),n=s,a={control1:l,control2:c}}r&&(yield r.done())};function drawSVG(t,{width:e}={}){const n=new DOMParser_1().parseFromString(t,"text/html");let a=[];for(let l of Array.from(n.getElementsByTagName("path"))){let c=l.getAttribute("d");const p=Array.from(SVGPathBlueprint(c));a.push(...p)}for(let l of Array.from(n.getElementsByTagName("polygon"))){let c=l.getAttribute("points");a=a.concat(Array.from(SVGPathBlueprint(`M${c}z`)))}for(let l of Array.from(n.getElementsByTagName("rect"))){const c=parseFloat(l.getAttribute("x"))||0,p=parseFloat(l.getAttribute("y"))||0,d=parseFloat(l.getAttribute("width"))||0,y=parseFloat(l.getAttribute("height"))||0;let m=parseFloat(l.getAttribute("rx"))||0,w=parseFloat(l.getAttribute("ry"))||0;a.push(roundedRectangleBlueprint({x:c,y:p,rx:m,ry:w,width:d,height:y}))}for(let l of Array.from(n.getElementsByTagName("circle"))){const c=parseFloat(l.getAttribute("cx"))||0,p=parseFloat(l.getAttribute("cy"))||0,d=parseFloat(l.getAttribute("r"))||0;a.push(ellipseBlueprint({cx:c,cy:p,rx:d,ry:d}))}for(let l of Array.from(n.getElementsByTagName("ellipse"))){const c=parseFloat(l.getAttribute("cx"))||0,p=parseFloat(l.getAttribute("cy"))||0,d=parseFloat(l.getAttribute("rx"))||0,y=parseFloat(l.getAttribute("ry"))||0;a.push(ellipseBlueprint({cx:c,cy:p,rx:d,ry:y}))}const o=fuseIntersectingBlueprints(a);let s=organiseBlueprints(o).mirror([1,0],[0,0],"plane");if(e){const l=e/s.boundingBox.width;s=s.scale(l,s.boundingBox.center)}return new Drawing(s)}const fonts={ROBOTO:"https://fonts.gstatic.com/s/roboto/v15/W5F8_SL0XFawnjxHGsZjJA.ttf",NOTOSANS:"http://fonts.gstatic.com/s/notosansdisplay/v20/RLplK4fy6r6tOBEJg0IAKzqdFZVZxokvfn_BDLxR.ttf",ANONYMOUSPRO:"http://fonts.gstatic.com/s/anonymouspro/v14/rP2Bp2a15UIB7Un-bOeISG3pLlw89CH98Ko.ttf",MONSERRAT:"http://fonts.gstatic.com/s/montserrat/v15/JTURjIg1_i6t8kCHKm45_dJE3gnD-w.ttf"};var library={};let loaded=!1;const init=async()=>{if(loaded)return Promise.resolve(!0);const t=await Module({locateFile:()=>opencascadeWasm});return loaded=!0,setOC(t),!0},started=init();function generateUniqueID(){const t=new Date().getTime(),e=Math.floor(Math.random()*1e3);return t+e}function deleteFromLibrary(t){return started.then(()=>{delete library[t]})}function createMesh(t){return started.then(()=>[])}function circle(t,e){return started.then(()=>{const r=new Plane().pivot(0,"Y");return library[t]={geometry:[drawCircle(e/2)],tags:[],plane:r,color:"#FF9065",bom:[]},!0})}function rectangle(t,e,r){return started.then(()=>{const n=new Plane().pivot(0,"Y");return library[t]={geometry:[drawRectangle(e,r)],tags:[],plane:n,color:"#FF9065",bom:[]},!0})}function regularPolygon(t,e,r){return started.then(()=>{const n=new Plane().pivot(0,"Y");return library[t]={geometry:[drawPolysides(e,r)],tags:[],plane:n,color:"#FF9065",bom:[]},!0})}async function text(t,e,r,n){return await loadFont(fonts[n]).then(()=>console.log("Font loaded")).catch(a=>console.error("Error loading font: ",a)),started.then(()=>{const a=new Plane().pivot(0,"Y"),o=drawText(e,{startX:0,startY:0,fontSize:r,font:n});return library[t]={geometry:[o],tags:[],plane:a,color:"#FF9065",bom:[]},!0})}function loftShapes(t,e){return started.then(()=>{let r=[];e.forEach(o=>{if(is3D(library[o]))throw new Error("Parts to be lofted must be sketches");let l=digFuse(library[o]).sketchOnPlane(library[o].plane);if(!l.sketches)r.push(l);else throw new Error("Sketches to be lofted can't have interior geometries")});let n=r.shift();const a=new Plane().pivot(0,"Y");return library[t]={geometry:[n.loftWith([...r])],tags:[],plane:a,color:"#FF9065",bom:[]},!0})}function extrude(t,e,r){return started.then(()=>(library[t]=actOnLeafs(library[e],n=>({geometry:[n.geometry[0].clone().sketchOnPlane(n.plane).extrude(r)],tags:n.tags,plane:n.plane,color:n.color,bom:n.bom})),!0))}function is3D(t){return isAssembly(t)?t.geometry.some(e=>is3D(e)):t.geometry[0].mesh!==void 0}function move(t,e,r,n,a){return started.then(()=>(is3D(library[e])?library[t]=actOnLeafs(library[e],o=>({geometry:[o.geometry[0].clone().translate(r,n,a)],plane:o.plane,tags:o.tags,color:o.color,bom:o.bom})):library[t]=actOnLeafs(library[e],o=>({geometry:[o.geometry[0].clone().translate([r,n])],tags:o.tags,plane:o.plane.translate([0,0,a]),color:o.color,bom:o.bom}),library[e].plane.translate([0,0,a])),!0))}function rotate(t,e,r,n,a){return started.then(()=>(is3D(library[e])?library[t]=actOnLeafs(library[e],o=>({geometry:[o.geometry[0].clone().rotate(r,[0,0,0],[1,0,0]).rotate(n,[0,0,0],[0,1,0]).rotate(a,[0,0,0],[0,0,1])],tags:o.tags,plane:o.plane,color:o.color,bom:o.bom})):library[t]=actOnLeafs(library[e],o=>({geometry:[o.geometry[0].clone().rotate(a,[0,0,0],[0,0,1])],tags:o.tags,plane:o.plane.pivot(r,"X").pivot(n,"Y"),color:o.color,bom:o.bom}),library[e].plane.pivot(r,"X").pivot(n,"Y")),!0))}function difference(t,e,r){return started.then(()=>{let n;if(is3D(library[e])&&is3D(library[r])||!is3D(library[e])&&!is3D(library[r]))n=digFuse(library[r]),library[t]=actOnLeafs(library[e],a=>({geometry:[a.geometry[0].clone().cut(n)],tags:a.tags,color:a.color,plane:a.plane,bom:a.bom}));else throw new Error("Both inputs must be either 3D or 2D");return!0})}function shrinkWrapSketches(t,e){return started.then(()=>{let r=[];if(e.every(n=>!is3D(library[n]))){let n=[];e.forEach(s=>{let l=digFuse(library[s]);if(n.push(l),l.innerShape.blueprints)throw new Error("Sketches to be lofted can't have interior geometries");r.push(library[s].bom)});let a=chainFuse(n);const o=new Plane().pivot(0,"Y");return library[t]={geometry:[shrinkWrap(a,50)],tags:[],color:"#FF9065",plane:o,bom:r},!0}else throw new Error("All inputs must be sketches")})}function intersect(t,e,r){return started.then(()=>(library[t]=actOnLeafs(library[e],n=>{const a=digFuse(library[r]);return{geometry:[n.geometry[0].clone().intersect(a)],tags:n.tags,color:n.color,plane:n.plane,bom:n.bom}}),!0))}function tag(t,e,r){return started.then(()=>(library[t]={geometry:library[e].geometry,bom:library[e].bom,tags:[...r,...library[e].tags],color:library[e].color,plane:library[e].plane},!0))}function code(targetID,code,argumentsArray){return started.then(()=>{let keys1=[],inputValues=[];for(const[t,e]of Object.entries(argumentsArray))keys1.push(`${t}`),inputValues.push(e);var result=eval("(function("+keys1+") {"+code+"}("+inputValues+"))");return new Plane().pivot(0,"Y"),library[targetID]=result,!0})}function color(t,e,r){return started.then(()=>{library[t]=actOnLeafs(library[e],n=>({geometry:n.geometry,tags:[...n.tags],color:r,bom:n.bom,plane:n.plane}))})}function bom(t,e,r){return started.then(()=>(library[e].bom!=[]&&(r=[...library[e].bom,r]),library[t]={geometry:library[e].geometry,tags:[...library[e].tags],bom:r,color:library[e].color},!0))}function extractTag(t,e,r){return started.then(()=>{let n=extractTags(library[e],r);if(n!=!1)library[t]={geometry:n.geometry,tags:n.tags,color:n.color};else throw new Error("Tag not found");return!0})}function output(t,e){return started.then(()=>{if(library[e]!=null)library[t]=library[e];else throw new Error("Nothing is connected to the output");return!0})}function molecule(t,e){return started.then(()=>{if(library[e]!=null)library[t]=library[e];else throw new Error("output ID is undefined");return!0})}function extractBomList(t){return library[t].bom!==void 0?library[t].bom:!1}function visExport(t,e,r){return started.then(()=>{let n=digFuse(library[e]),a=r=="STL"?"#91C8D5":r=="STEP"?"#ACAFDD":"#3C3C3C",o;return r=="SVG"?is3D(library[e])?o=[drawProjection(n,"top").visible]:o=[n]:o=[n],library[t]={geometry:o,color:a,plane:library[e].plane},!0})}function downExport(t,e,r,n){return started.then(()=>{let a=n=="Inches"?1:n=="MM"?25.4:1;if(e=="SVG"){let s=library[t].geometry[0].scale(r/a).toSVG(r/a);var o=new Blob([s],{type:"image/svg+xml;charset=utf-8"});return o}else return e=="STL"?library[t].geometry[0].clone().blobSTL():library[t].geometry[0].clone().blobSTEP()})}async function importingSTEP(t,e){let r=await importSTEP(e);return library[t]={geometry:[r],tags:[],color:"#FF9065",bom:[]},!0}async function importingSTL(t,e){let r=await importSTL(e);return library[t]={geometry:[r],tags:[],color:"#FF9065",bom:[]},!0}async function importingSVG(t,e,r){const n=r+r*.05;drawRectangle(n,n).sketchOnPlane().extrude(1);const a=e;return library[t]={geometry:[drawSVG(a,{width:r})],tags:[],color:"#FF9065",bom:[]},!0}const prettyProjection=t=>{const e=t.boundingBox,r=e.center,n=[e.center[0]+e.width,e.center[1]-e.height,e.center[2]+e.depth],a=new ProjectionCamera(n).lookAt(r),{visible:o,hidden:s}=drawProjection(t,a);return{visible:o,hidden:s}};function generateThumbnail(t){return started.then(()=>{if(library[t]!=null){let e,r,n;return is3D(library[t])?(e=digFuse(library[t]),r=prettyProjection(e),n=r.visible.toSVG()):(e=digFuse(library[t]).sketchOnPlane("XY").extrude(1e-4),r=drawProjection(e,"top").visible,n=r.toSVG()),n}else throw new Error("can't generate thumbnail for undefined geometry")})}function extractTags(t,e){if(t.tags.includes(e))return t;if(isAssembly(t)){let r=[];return t.geometry.forEach(n=>{let a=extractTags(n,e);a!=!1&&r.push(a)}),r.length>0?{geometry:r,tags:t.tags,color:t.color,bom:t.bom}:!1}else return!1}function layout(t,e,r,n){return started.then(()=>{var a=.001;let o=extractTags(library[e],r);if(!o)throw new Error("No Upstream Geometries Tagged for Cut");let s=0;return library[t]=actOnLeafs(o,l=>{let c=[],p=!1;l.geometry[0].faces.forEach(m=>{if(m.geomType=="PLANE"){p=!0;let w=moveFaceToCuttingPlane(l.geometry[0],m);w.boundingBox.depth<n+a&&w.boundingBox.bounds[0][2]>-1*a&&c.push({face:m,geom:w})}});let d;if(c.length==0)throw p?new Error("Upstream object too thick for specified material"):new Error("Upstream object uncuttable, has no flat face");if(c.length==1)d=c[0];else{let m=Math.min(...c.map(E=>E.face.clone().innerWires().length));c=c.filter(E=>E.face.clone().innerWires().length===m),c.length===1&&(d=c[0]);let w=c.filter(E=>Math.abs(E.geom.boundingBox.depth-n)<a);w.length>0&&(c=w);let _=0;c.forEach(E=>{areaApprox(E.face.UVBounds)>_&&(_=areaApprox(E.face.UVBounds),d=E)})}let y=d.geom.clone().translate(s,0,0);return s+=y.boundingBox.width,{geometry:[y],tags:l.tags,color:l.color,plane:l.plane,bom:l.bom}}),!0})}function moveFaceToCuttingPlane(t,e){let r=e.pointOnSurface(0,0),n=e.normalAt(),a=new Vector([0,0,-1]),o=n.cross(a);if(o.Length==0)return t.clone().translate(0,0,-1*r.z);let s=Math.acos(n.dot(a)/(a.Length*n.Length))*360/(2*Math.PI);return t.clone().rotate(s,r,o).translate(0,0,-1*r.z)}function areaApprox(t){return(t.uMax-t.uMin)*(t.vMax-t.vMin)}function isAssembly(t){return t.geometry.length>0?!!t.geometry[0].geometry:!1}function cutAssembly(t,e,r){try{if(isAssembly(t)){let a=t.geometry,o=[];a.forEach(l=>{o.push(cutAssembly(l,e,r))});let s=generateUniqueID();return library[s]={geometry:o,tags:t.tags,bom:t.bom},library[s]}else{var n=t.geometry[0];e.forEach(o=>{n=recursiveCut(n,library[o])});let a=generateUniqueID();return library[a]={geometry:[n],tags:t.tags,color:t.color,bom:t.bom,plane:t.plane},library[a]}}catch{throw new Error("Cut Assembly failed")}}function recursiveCut(t,e){try{let r=t;if(isAssembly(e)){for(let n=0;n<e.geometry.length;n++)r=recursiveCut(r,e.geometry[n]);return r}else{let n;return n=t.cut(e.geometry[0]),n}}catch{throw new Error("Recursive Cut failed")}}function assembly(t,e){return started.then(()=>{let r=[],n=[];if(e.length>1)if(e.every(o=>is3D(library[o]))||e.every(o=>!is3D(library[o])))for(let o=0;o<e.length;o++)r.push(cutAssembly(library[e[o]],e.slice(o+1),t)),library[e[o]].bom.length>0&&n.push(...library[e[o]].bom);else throw new Error("Assemblies must be composed from only sketches OR only solids");else r.push(library[e[0]]),library[e[0]].bom.length>0&&n.push(...library[e[0]].bom);const a=new Plane().pivot(0,"Y");return library[t]={geometry:r,plane:a,tags:[],bom:n},!0})}function fusion(t,e){return started.then(()=>{let r=[],n=[];e.forEach(o=>{if(e.every(s=>is3D(library[s])))r.push(digFuse(library[o]));else if(e.every(s=>!is3D(library[s])))r.push(digFuse(library[o]));else throw new Error("Fusion must be composed from only sketches OR only solids");library[o].bom.length>0&&n.push(...library[o].bom)});const a=new Plane().pivot(0,"Y");return library[t]={geometry:[chainFuse(r)],tags:[],bom:n,plane:a,color:"#FF9065"},!0})}function actOnLeafs(t,e,r){if(r=r||t.plane,t.geometry.length==1&&t.geometry[0].geometry==null)return e(t);{let n=[];return t.geometry.forEach(a=>{n.push(actOnLeafs(a,e))}),{geometry:n,tags:t.tags,bom:t.bom,plane:r}}}function flattenAssembly(t){var e=[];return t.geometry.length==1&&t.geometry[0].geometry==null?(e.push({geometry:t.geometry[0],color:t.color}),e):(t.geometry.forEach(r=>{e.push(...flattenAssembly(r))}),e)}function chainFuse(t){try{let e=t[0].clone();for(let r=1;r<t.length;r++)e=e.fuse(t[r]);return e}catch{throw new Error("Fusion failed")}}function digFuse(t){var e=[];return isAssembly(t)?(t.geometry.forEach(r=>{isAssembly(r)?e.push(digFuse(r)):e.push(r.geometry[0])}),chainFuse(e)):t.geometry[0]}function generateDisplayMesh(t){return started.then(()=>{if(library[t]==null)throw new Error("ID not found in library");let e=[];flattenAssembly(library[t]).forEach(a=>{var o=[];if(a.geometry.mesh==null){let s=library[t].plane;o=a.geometry.clone().sketchOnPlane(s).extrude(1e-4)}else o=a.geometry;e.push({color:a.color,geometry:o})});let n=[];return e.forEach(a=>{if(a.geometry.mesh==null){const o=a.sketchOnPlane(sketchPlane).clone().extrude(1e-4);return{faces:o.mesh(),edges:o.meshEdges()}}else n.push({faces:a.geometry.mesh(),edges:a.geometry.meshEdges(),color:a.color})}),n})}expose({deleteFromLibrary,importingSTEP,importingSTL,importingSVG,createMesh,circle,color,code,regularPolygon,rectangle,generateDisplayMesh,extrude,fusion,extractBomList,generateThumbnail,visExport,downExport,shrinkWrapSketches,move,rotate,difference,tag,layout,output,molecule,bom,extractTag,intersect,assembly,loftShapes,text})})();
